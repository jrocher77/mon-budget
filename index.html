<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Mon Budget</title>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADdUlEQVR4nL2XT2gVRxjAfzMxkkQl7QtJk1QTSrDSHko0GqiEilBoXyVQ6EWaVCitF9NS8GBziiBGPIgURJKTilawPYqQ0ouokGptUrF/sGraNNqoCW/x1fzBvrwdD7uzO9l9u/teaPxgD9ndmd/v++Z7kx1BIFI1jSp47/8MKzMpzL9XBOFDxze1LadAugdlSngCGp7uGR1JmiRVXR75zMrmYsc6DF9ClALXYNuOXiUpRaKIZlmZSSGKgQfBMXxcfqKIZsroqcJwW/lwpcKXlrOVLxu3XACxAqnqcgfswk2wd9+4QiLu/TiJSAFzkK3C4EIVCD4zlypKYkXBuxrsZu5l5U7uVKJQIwjvPSmFI+FmoHuiKAGv9AbDhJeVwYc7mnmn4yVS1SuZtp7y5/1ZLl6bZvjnDAt55Um4fHCXItiUiU2oS2tmvr/ndTq3N3Dk5B069wxzcPAW6+qr6NvzGu1vvFhwXFSEBApl78so0m/Vs7W1hq9O3+XHXyzmn+b5bexf+o79bvRKeLBuymAvxPaAmYVSjtTO9Dqs7H9c+mkaZfvvjk/OcvfvGQ8mUYDwlkIUboF4gWA0N1axtr6SH25ksPM6M4UUAmXDp30jSBENW7KAEHD68BYa6yoBeLO1hitfb/Oe53I2H3xxlccz8f8HliygFHz05XXef/tlPu9q4eyFCQbP/QX4FQAQiS0djpKG6OZSyoeZ8FLLDwkVEAJ3Q1GcOtROY10FAN2dTXR3NgHwx/gTdveNeiKOFAhXJq4BCwpY2ZzzUwns/7t6r9PUUMWJ/jau3bToPfqr9xs3M9fwYEhXpuSNyMxi4sEc/zyaZ8MraxCCRRfAyf7NvNtRHxoXFwUFrGwOKQXm9q0n++a7+7ywppzt7bVOVu71avNqGmorGL6R8eBJ2UNCD0gpnKXAWQYpBUOXH9KxsYbPulqYnctz83aWlqZV7PtkAwPnxpiZW/DgQvjwqIgU8HrBzUBvelIKDgzcYud7a9n78XpS1St5MDXPt0P3+H54alHZTW7Ul1FsBUwJ3ZRCwELe5sz5Cc6cn1j0vrneZuZx34eJTagH657QWQWb0My6WDgUuRPqScxqREWx4JIEIkVi3ik2ShJYKiQupJWZFOme0ZHlPpKZYR5MJDgHxuclYcJBf8a68XwOpz48JKAlllMgeDx/BlYuBVBY1RiQAAAAAElFTkSuQmCC" />
  <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAIAAACyr5FlAAAjsElEQVR42u2daZAkx3Xf38vMquprZvaevbFYnEuAAGGABECKIiEQlCUegoI6bFqUHEGbYjgcouywwzSlCIcibIbDQVmU5A+S5bBo0TJ1WoZECCQBBQlQAESBWIIEdrEAFtgLi713Z6avOjLz+UP19PRRd1d19+x2YQOxO9PTU535q/87MvM93HfdXsjjIgIC4AiIIAQwAMaAcwCC2VXUhaAUaA0aQEogAkWAAIj5vL0YnQkA4AwMAwTv3JbSAABSg+PNJrDYi3PgDDiAWepMh1Tgyc4UjEiJGAULRLAMMAQwBKnB9UBq0BoAgABwNnXFX1KtDTVjIBgIAdUSaAJPgis70zQ+ODQBZ1A2QfCOPEgFelXQ/FuZkTFG27L2uLoSHAkMQXAwBMwZIBXYHigNDAuGwzciVQsEB1dCow2aOvLFZjhMAyjYYcWT4ElgCKYBtRJIBS0ntaERqQTDElAyQRHU26AJGObm+8yu3CnxjXvbBceDSgnmK2C7HV3JEw4iQICKBQaHpgNSAZtJxTq5/GlqtEFwqFrAOdgOUDIJYUnI4AxqZWAIyy1QaobFukREKVhuAUOolYGzjocwEhxdMhwJDXtmR9a3oWEIDRscmZQPEU2G4FAyod4Gra8GweiSveq3xbBOsJbEI/9ftO4lxPVAKqhYYLsgVdQIiGgyyiY0HdB6vQoGroKAmT4A9kSKHZ5wFRTqJIXX4xOiNbQcqFrQjuRDRFiTkgkNB2gdkoEIrMibRv8/7A4X0boSFZ+Phs+HAypkikWglvp+Rr29nsjAbApBsdKR5FejrzHkCwqtj+EiDS0H5srQaHcWZeLhQIJyCdruurEmLIlKZJswSgcNdiQFyJcTWgf60XahbEGzHfChBqMVTVCygAgcb9rJQATOkEeQQT1/8r0o5s0RgCFyhlMe3yGC4wERlKxOsjtUOYjAMkAIWGlOdWyCiKG3RwknNx0vCJhIYDDY4hBMr7nx49v5Klga3H5FEANjYBnQtqeXDMbC54nypCH6x2PuAYMdZCLQU2lrGELbhrIFrgwxK5qgbILW4KkpBZwzZMMDH67tfrBZRMgZ885Bt9TZ+IKRdnByl6dAayibfcZlTTk4A4NDvT11stEbl1ICqUiCQtrHN2I+e3/doKIMCQmtetAEoDVN1bPnRy69mVPRlY2KOerekEKi0+HYlFIDMbqSD79D4Ch1bwOHieinBAE4w6myMv52EMuAltMRCNYFx+CD/sgksQBgiCwBGWHaTj3SX9BQRrx/8F0N2RqGyBhOy5gjuB4YfM10iG6QIjXo6ZANBGAMIQEWGUSCRr63iF+KmFhI1rLygIgENA1GRhNIDaboJDKYf7emAE9OS0ZrkIxh5y7ouYwWibzyHdHvE+ajBqtIf8TLp0NCPAmm6NydAADBADFmgW7MjmfYICZXi6KfQ4qQk9W7RBz8WoSE+FZGTzQd0sHABMFAEwgiEKJjUyYYpwSQEWdHiDIZjlGGPi7DgkHUxiPSzwch+Tv4J2hZBAfHAwYAhgBPTnK/eCwZA2odaEGiBD+vPHpc1jzwO8N3O2h8hkwMm9xjigCeBEMAAAg/+a8mt8bGI33PWLWgkRWCUitFnGIEZUoDVWRNQnp/gFYDXT0BC9OFgSGIzjblCdk5vrr0kMTDGHr+UjNB6ZUiETEhlMQiMmhlBkzMhBIh3ZsUhgClJuNw+OJJ6QWD0kx7ESuyEa7o8DcCEUkkIb6LOnY8NIFS/kHGCVmTwcAtbzIKWquPS2tFeNMQ+aEo4hGayBwhgvA3rY9fM/IhI1MQm+1RxMh9IwFCQjESMmxiIvRDwVg3rGoNnIPgDBxvrKFKQjLSYkF50xD9JoGsUDJEwkxMhAvCEdW4zAsCSA2mMXIJhpHICJdWohywSMhE2KtiTi30/FighYz40rCERLkguBbWjTl+GSscfVFrHmRQSiZSDW3gi4MXY4myIZLUxOBk4hcxZs2gSDKiTMkIWOQ4mr1vNZi3S45IAgkJ5WOM9oWN6dcgYNiMpk9YUBAWw2QUumQPYYnawDtJHnhTosfs6oHD37OTygOl8HiREghGoUwkQXAYEQoXwoFvUc8BTOo5jdnrMI6HDzYW2RiNjPCkQsAc0MSyvYGIRElGOPQUOEr9fIwh+VG4z8FYCjIixpIi1SLDntCumIWN8tpdUYoj1IOu5ZAjQpEuSIz/MV7no1g4MGQPfyoyYu1IkiHqVCrDFNnGtSP53e3N1JWrkRAZ9FIT8BEIE2eoitxAViwcgQYlnoxcBcMHIhcR7hLm/+rY7eODCQyiUAmJ4yM8eIHi8CgQjsCsRkQONDYqSUVGZ+c6FiiKnCMAaB2fWemVkHz5QEQsLPHBCtOMmMgtiQeajQzEzkbU8axXMQacY1w6NfyDJAzfJxHZioKeqpClh7gl1VDvPaneZGaie0B+6I4pee5Bh6+v9zmYCfQjpXHBIhLrxcABmFA2ciQjAxbdQ1NKk1QkldaK/FFGQGTAEAVHxpDz1fPQkd4oY0gU+pr8+eh1hmg9KEef9xcUu+ZOhm9H0t4kQ/Sktl2lNZUtPl8ztmw052uGZTKGqBTZrmq05JUVr970mm0pJXGOlsEMgyGEHon2gQtzV5PyEfPFoMiWYe7nK/OHg0UaFKIYzzM9GchYaixsV9mO3rLBfNcdm+5+28YD++d2bitVy6JkcUMgIJAGT2rH1W1HXVl2T55tv3Gqceho/ejJxoXLjtJUsrhpMAg58urzmp2PIOc0OrL102L52hZ8+617W05uh1ZYb4CQPnZNS0ZaU8IZelI3bbV/d/XD79vxwL1b926vGAI9RVJqpak39PCxYww5Q0MwZOB5+vwl59DRlWe+d+m5l668daHNECtlzjA43xBhYgLzKDCgExjwxeGCiL3fziXt4dcKrFh5w8E5rs0wRckGTYKMlZa3ed76+If3/MSP7Nyy0bQd7XiKOiX9MWKvtT/FDNEQaJkMAM9dsv/uhctfe/rsC0eWHVdVSkLw4P0WYV5q780H84HDnMTAkcuCfiFwsN4gJaFsxBmUCLueNtdZb8r33bPlMz9/0417qo2W8qTuxcufV79Wk18GxK+1olTn6110/HszDFa2uOvqH7y69Mg3zzz59xdWmrJaFoIHqMjofIxTPLpw8MUtC57K5wj1mleYMELJSkYqzWCIWoPt6l/8mf2f/We3zlVFvSl7hUdrAsBKWVTLHAFatmq2VNtWniTOsFYRZYsTgCe1Dz8iYuc9ldawZ0flwXu33f+OTQhw7HRrpeFZBmOINJilxWg+khuXPqQC8ckjeWOI/JSj79RakQbFz0smFzNPEUP83Kdu/cgD25frHtEaxL4MVCtCKXrptZVnv3/p5dfr5y7ZKw2piUyDbZw3di+W7zqw8b47N+3dWXEc5Xh64BSWLzkVixsGe/mN+v959OQTz56XkkoWG7j/WP3IwMcwHKOXhcnfrEQnyxPKRr5kIKJSGhH/42due/C+bZeXXT9d0f1djGGlJL7zg8tf/ssTzx9esh3FGBoC/U1rmkApkkoTwZYN1gffs/hzH9m7fUup3vKGT+n5xr5S4oLjC0eWv/gHR48cq1sGG3BCMvKR0riMuNU0Z7PSVx2WkoWvkSnjwB9JZU38tJBU8Gv/8m0ffM/i5WVX9JChNRkGA8Df/sPXv/D7r5480y5ZrGxx02CcoZ9994MUy+Qlkzuu/u7hK08+d2HP9vIt18/Zjhq4FUT0EydtWx24Yf7CZefpg5fKFqehc7DRkUvvazKLB4ycEvPNCsvJRCWatIQGZXQyAAAZNtvqlz5x4z9873afjJ6nHAzBXFd/9tdf/NL/O26ZrFYRRKA0+U92948m0pqUJs5h07xxccn5N1948c8fPz1fMwL9Pr9ST6stHVeH3W3gWGWoIkEU+gOImIsLkvfCWzHrg2nX3DnH5Yb3sYd2/ZMP7bmy0keGX9adCH7lNw9967kLmxfMhIvvUpFlclOwz//3I3/91Nn5qhEWF8RyHP0s9dnWyMdpOB4MdlkmCEfClGhm2UibHWcMW211+w3zv/RzN7RsNXiEiqhcEl/88mtPfffCpgVTqhQ4a02coWXw//x7rxx6faVSEtlcv8BPlG9yM5djriyXxzoJy0melTCDkurdtCYh8F//05uqFeHJPnlXmuaqxtf/9uyffv30hvl0ZHQdT8PApi1//fdfdT2debk8UAsHNibGPlQ0nEyiqHkZNxwYuW8joWyM7s30GpR6S/7UB3fdc/vGRlP2hhVEYAp24YrzO3/0hmmwzBZQKapVxMHDS4/8zVu1isicdCp6B/nofgeb+B1EG5R0TiiC4+rrdlQ+8dHrWm01MPqaqFLif/b1N4+fbpUsNkq4pzWVLPbHXzt18YpjCEbZHy1MIh5JXLthtZ4y5Qi5S8rqtqbdoMEQ2476Rz++Z3Gz5fQbFCKwDPbmufZffvNMpcK1GjVNVDL5ibdajz9zvlrK/m4J15MpgTYHDi5OFg7Iet/ZyIt+se2om/bWfuy92xstyYdko1zi33jm3JkLtmmwXGpOCo7feOZc01apUnPxT1cy8Uia7ZkUHKMLV4RNSWuSGaLj6Ycf3LlpwZCKcMgXWWnKJ549bxqM8qjV528ROvJG/cgb9ZLFMxup1CmiNA/aiNtoR4QDC/pUGWTD8fSuxfIH7t/Wag+Gr/5EHnpt+ejJxojexsC8tm31nR9cNjiO8pbpxCPK66d8sx0sX9GKSplTsbJh2+p992zdvqXkSj10/h04w2e/f9l2dI51rghACDz48lLbVaOEHvmHLTkFtCz3u8knDEv5kZSmcpl/4P5tUtHwz3KOzbY8eGjJNFiOhzyIyDDYibea5y85hshZPEZ1S3ORxjHNHxVIBmNou+qWfXO37p+znSGbQmQa7NSZ9okzLdNkOtdaHYKzy0vu8dMtU4yEXbaYtmi3o5BDTZSg8GPEZ077eRBASnr3XZurZT6ckiIC02CvnKjXm57IW8AZglR07HTT768zQdc+zO0Y5RJ5wp6iSEkUSRlsSqXE33n7Rs/TYT965PV6cUfSj73Z9Bdv/ZtRmUqH5rx3vGdX+gTgmJLLz4ru3129YU/V8fRw20iGaLv6+FstPtrDHTYFjOGlJdcy+cY5RASlacOcYZms2PIIBDDN9TmwGG80tcOB6Hr69psW5mrGSmNwjxYRcI71hnf6bNvI1RvtGkdTsJNnWn/xxGnOO/0fKyXx2olGWhd1+ET02im31eMt2ZDIrEljUY40i21pHQ4CQMS33zwf9mOC46Vld7npcYa5R1VEIAReuOz86m8d6v2iZbJyKV1mzF9ISjuLMUeeJqIcI95HWIYjQyENpalW4Tfvm3O9gBwGEQmBZy/arbYqj5DHjL44w4WaMRAiZXI7ci2n0FOmIdvb5q8clHJRPhWRA/ki/2Dj7h2V7VtKntSBfZ4Y4pUVT2kSApXO5wMO7PGhnI6a5RWwYPD203XukEbYFESQkpptD3uOhHCGKw3vnts2LsyJRlMGphoR4cTp1tKKCwRytCnE1T3rtUpRpSuGQZxgb7X1Ea0ggidp2ybrJ//Bzt6+QQyh7aj77tysFAU+IP6ay03XVX/h4evKFh/x8SYCwXG54X3r7y/ANXBlhINFHnvM/WKIbVs+/IGdv/yJm5brLuesO12I6J+FD1w0YYiOo3/0h7Z/9IGdNPJjqJRemDO/9BfHH33yTMQG42sdjny9k2g/FxE8qbdush68d+vZC7brDfoW0TuQEaFly2Yrj5QGwuVl7w+/ekoIVpBvGxawBESzxac61oFZYYh1W/7oD23fu6O60vSEwAzvAHzU21Ca5mvGo0+eOfZms1YV+mqXjfUBhyayDPZj712USgNlSbfn8pAjgOPqv/rWGWRwjVzTDgdj2GzJ99y1+V1v3+R6ulLmwxPvejERqmWOuotDa6hW+NMHLx98eblS4teCbKwDOIjINNjJs+1P/9pBT1L/mVKQkjZvMP/9P7+1bHGlKWCPD8dWW/2H/3b48rIrRtlyQSAEnrlgM4Rr55p+OPxZaZ880xqomecvud24t8YYEgSHsgzBcdXzh64s1T0hMPvuUewcezEMJJrBMU18mAazzIDlVsbk5g2WaSAFs+G30CXBWa0iRl+VJaJrhwxYL0kwCiwVy0ApEgI4R8+jsOIGSndqbCh9LU1sLg7fBH93xK7r5LkHzpBFJt09bz25jxEVNbtBEwz+bcrgWEsBDZcQmTRhA5dU15gxuDqUI5fcg9Zx1dARAXA20+sejtSPOIInSWuK0A8hcL3En6Nvp512OLCQ2oehquBJHeFpEoEQzD+vfI2ox7B9pzHDMaIRD+uvFt2+D4NkxnGVf5AprJWFvxkqQ19AgnH3EszZN8JR35aNB+bkWhLxSXyF6H0TzsFxtZQaQ+ggv1kOA0i/XI8AguMYycjCIhZpgLLXIR3uSp+qDljEQdnhigaMYaMl3//Orf/qF27sLfPlh7JbN1lhXgUiKEXnLztpx11pmq+KP/nam//rkRPj2boxXKJ0uDjp8O6/JJUn0958tw7pOjm3QsAYPPzgjv27ayvNwfMHEQtv/hHqvTsqGTwnpej5Q0uCs2lMk4xF0bLDMdArxGc2l/1gAzu2GELLUW/bP3/3bRsvL7sAIPt/S0x/NQDH1Rlk4/Fnzr90dGVuXFs3cvZvcFRvFIrr8dbpijh0c92vdPfLD+99GsAOET1PP/TuxXKJL9cDSksnOeyS3CnzXycVffVbZ8YWA+dFRr6pSDHS58E0IFOWkfKXXq/fVfmJH9nROR6Cg8Phenp472Dvu1kmMwRLqGpaQ60inv7execPL1XKfFyyEVruLWpHfsERkMhNxCjnJ6nb4ddTau/O6ivH68MFAv1HfPdieff28nCpp1XfCo+ebJy75CQMPbSmSln80V+f8qS2TDGe1Hui7snhUBSUKxsJjmHt6LodARtlhwCKsCxa02pLX6pY/LsvXf7b5y8Oh6uc4XLD+6kP7vr8L9++0vAwqJlBuSQe+/bZ3/2TYxtqRpJzK34bHsPA6rhkI//fgvkYrNHgGPJJk2gKJi7NsNosExjDWjXgVhkCIrx13m60ZcQG9Ot2VqplUU1TUHacWzcisuYBwxsuGznmRnOBY9SYKuIYZ1c8Ih4vv97jqbOti5edHVvLAacWADTB5gWLc1CrPWOnK0intFowJocD8syQJjGEGBXgZBg48hsk1L3XTzVNI4gzRCn19q2laklM52afYeiTuKLjuVju4Af0S86awkkCPkP0JL346vJAW7XuL5KKtmwwF+YMFbl4O+JzwVZb+Kz9SVKHM61spHwCRxTKUaOVwO7Z2SxLUMIj/iQxERgCv//qSstWwykQP9E5XzN2LZZPn2ubRiHRh9Jk22qQWoYlkxUkG5ggwzH6BxU5KAdGxCND2bDVvyV0Swc8j4AXEFkmf+Nk4+SZ1vW7q7YbUE3QMtn+3dVnX7hUhHBoTbWKuPOWWm9fC8ax0ZKvn2xGTHHRodDo2eoc8hzDD3faPHqEePiDGF3G1T/5/vzhpVv3z7UdFShkB/bPFWFTOMNGW77/XVu/8G/vaLQ6EZPStFAzHvmb05/9jZfmqoYObVadKEiJaAMY0+ZtZPbY2AiN7nUYYURj22z5a7NPH7zouAHFfRDB9fTN++YWaoZUVMQTum9n1XF105Yt/09btmz53EtXwg5MJGkcNp4gqHg4KACBLssJn9doExu914E0lUrsxVdXXj/VsIa6ufoV5XZvL1+/uxpIz4hpQEOwW6+fIyKOyBAZoiFYq61eOd4wRPBJmUAyMnQPDfM2IKeKGPmEsgmfg7hGqVE8RfwKAhCMLTe8b37ngmWw4VcqTdUyv/u2jZ7SObLhn3vYvMHcv7fqerpTIoHAMtnx061jbzYtMyDHGk1G8pguIk7JK4PH8nqAMotHQuMCACrcKGiiksWeePb8pSV3uHUSAniS7r9zUyXXmnGI6Hj61uvnFjdb3XO8msgU7ODLS/Whni8Q3nQ4RkFTbsvN6yPmlgRLOOjRZ3L6V+pT8EEElsmPnW4++dzF4aVUxtB21IH987deP2fbKi/LggBa0313bjJ7arn43aKePnhR8EGbkr1decSPBLUrzwv/3OAI/tjpxSM2LRhhXwRn//eJ082gR1YpqlT4Q+9e9BTlVWDDk7R1o3X/Oza3V+Nnralk8VdPNF56baVs9TEa5jaN0sg+c+Zw3HD0GReMhj3gZcmdD9/VD4x4KyX+0mvLTzx7frhpo98458H7t+5eLEe0i04RxHJs2fI9d23eu6Psrr4hARgCH3/mXLMteX+n4+SuRnKDUlAEWwgcWlNfQizcl07qdKXkgwgMwb78VyevLHuiv3uSH9Aubik9/ODOtq1G73+jFFVK/OEP7FKq8yn8HoNvnbcff+Z8qafAi9YU67BnMCijGPcJwBGLbfB5J4wxLmHDMcyHJipb/LUTja88dqpWGdz7yRBbLfWxh3bddF1tRD44x3pTPvTuxTtvmW/ZsmtTyiX+6JNnzl60LdGJqCM80AwGZZyykT8cffMRKR6YxvlIzofSVKuKr3z15PdfWa5W+tqvIIJUemHe+Bf/eL9SlHkgGaLr6u1brE9+bN9ABHvyTOvPvvGmX/WcCJQK9UDj11AwmR9amGxAEYeaAm8xxjPFkfgYUAjOsO2o//ql1xxXC9ZnXBjDelM+8K5tH//wnqW6l+HMkn8bjqs/8/M37dletle9Dd8V/YNHTp675JgG0zrUce6vXIWxoVyMH9obpOSddOWLWxY8BTrXMsrY/dQYxQfmxAd01ncQcS2sPf5Wy3bUA/duG1iKQ0BP6vvu2HT8rdahoyvVskieyGYIiHil7n76Z/d//EN7VlbboStNC3PGt5+/+Fv/+2i5xMMEIykZoaY2yqDk7G0wMEQxcPTQkThyyYOP7suJoGzxg4eXNi2Y99y+qdmzM9n/LkP84XduffNs+8VXV8olzllMpS8E4Bw9Sc2W/NRP7//0z+5vtjrvqTVZBr+07Hzui4dWGpIjjomMvpRo3t5GgXAAYJA1Te58pE2OBSIiBHvme5f27arcftP8AB9Kk8HZg/cvIuILR5ZbtjINxllHfHyfANEvO4YMUWqqN+TCnPHvPnnLJz66t9lW/ss0AWcoBP7Kbx564fBStSzCnuC0ZIQZlDHIRuFw9A0Bxg1WH1PBPzTARywi/kFIInjquxdv2FM7cMMAH6g1ENF7795y14ENy3Xv9Hm73pKeR/7PkgalwJW6bSvb1fM148d/ePuvfvrA/e/YXG9KxhARNBFDrJT4f/rdI489dXahFnqkdhQyYmWjiI2xPhzZD1InEY++cDGohH5wcxYK/GtA+i92WBhDqUhw+NwvHvjI+7cv1z2ivrtSmqplQQRH3lj5ux9cfvn1+pkL9krDU5osk22YM3ctlu64ecO9d2zct6vqetp2O/vNlCLDYKbB/sv/eOUrj57ytyHGpiVyJ4OIdBHtpzhUrCLh8D9Y30JGcj4gqvlXKkQYgtTkSfrUT1//yY/tIwJ/Q2H3vrQmRCxZzDSY71W4niYCxrFkskqZM0TH1Y6rfJ/XT8HNVcVKQ37+94489tTZ+ZqhJ0EGFNMEqAtHgWalOyLRWxBCjQ8Om5qQUY47SM0YcoZPH7x05FjjbTfO79pWloqkJH+y/f97UtuOlkoLjpbJOycoCRxX267WGvxSuFqDabK5qjh4eOmzv/HSsy9cWggiY8DwIeJApisVGaGuRmE7hgr3OboYsqD5D+MjyagFDDfGOCII4CdPv/HMOc/TN+ytbt5gAoD0D7P4kTBDhn6HR9Cr/n9PIwssW7xaEWcvOL/zx8e+8D9fvXjFnRtaxInGIuIZSEtGoaeuCvc5shmXCP8jiYmJtjKcoSd1s62u31X50Pt3PHjftn27KqbBpCRPaaVIayBYZQU7kmMYyBm2beWz9di3z527aNcqgjHU/RlYiFS4UcnoT3kVJxtj8jl6U85979+HQnCJn4IQ8Um1XW07atOC8fabF+6+beOB/XO7FstzVVG2uBAMEbQm19NtW6005IkzrcNHV54/dOXlN+r1pqyUuSmYisSiUDKg4H6D44bDf2rXjiMMTnYOfED4VobAfd4MUSpqO0opKllsvmZs3mDOVQzLZIyBVNS21UrTu7zkNVrS9bQhsGRxzrDbFjQhE9FYZCBDF3yOdwJln5SmtT04A/0Pes7m984lDu8RocB/9U1MRK2LtciIQBEhQq0iEEATNVtyue4pTaT9RsbAEDhHzlnJYpUy9+uva6KRsIhxpCZPRu811ppgStNambkQPqD/9AoOb1AdWvelkEmKoKRXbPxdKJyjENh9CfWLUbSBz4BFhGBEkTHek+DjLhinB/joE4NQPiBcQsIQiaYkXFeSjn66gjsY9YKkZIy9hPsEqgn28dEvBgN8DJiYJIhEU5KElQw0JMcihSmZnDWZJBzJ+Qgcaor6d9jXMrKSvAgCJvvqOiIDJtiMR/f6p4n1I5iPIbnAuLgmGwFJmUiJxXSSAZPt1KQi+egNcWNMTKRRSQXKSECEfA/DvZxoJ2OyZMDE23gF8AGhJmbgDH6wH4pRIAQfa87GQYLXpcNiKMpVk65SNfny1n7BHYZZJCQKhsSKUYBRicciWjAIpqIj3VTUPicCDRTGRxJEYiQjL9OCWb4fg0UAGaT1NEzL1BTGj+Uj0MpAcFGySACwCLsS+sK0ZGiC6al4OEVdE/yU9mCIC6GJ1CQqkkgpMH8dCTkrHxPD6ClrVTh1LTV0oAsCg14I9K/4D6+ehE3hiIOf7axiLBZF7Pa7CuHomBiiwVqNQSoCQyVsIigZ1f3MhYkg33NqG11PaTMeAiBNnT18kQ5FICIDE1bE0McVlUiU8dDT3fJ2qjs1+avkDPuTmEFhSe9kRIOSDZeklc0gafkmn/4p74W8Dtp4aQIYRgRCV2MDnZJsk50diBAscHWH37pokb1OerwBaAKkoIKkGOpnJqGkECYguA61H46to9bp6wYOWM0bIsKwiMRlzYd7TVCeKMS5u5SgVNwMjpwcESAgCDA0iVMc+fZCg6jj3TT+5sXXLhwDvkhARJMSlPzTHdMdoKaAQ2kQDDy1Xlu9+xGNb9QxZaGceGhSDsrVwQQBCAZKg9AEjMFVcJHvRxBh59gZ5qIByUaTiGC9M9F7MQaaQBABIlxNV8fGr8kJQt79E6nj06bZkbwOHzbhSaiUgOFV+wk7gUnPMaReWDAWgrXw5mpGoU82EDgHxwbRPbx1LXxs6nJyLXzazN726kI3050iOLPhml0dJnwYNAEDAE+CIWDGxuyCToVu8KRvXxCkAsGuWrdjdqV1OATrHKxnACB152D1zLLMbIqPgdQAfgVjBHAlGGI2OLMLDAGu7ARxzPdOXTmzLLOrY1Nc2QlYOslRTeApMI2ZZbmmbYppgF8gDqAHDobgeGCKqy1bOruSX4hgCnC8NQOytqyiNHgKKhbomXhce5cmqFjgKVA956lYr71pu8AYGHw2VteeH8qBMWi7fX5n/4IsgeNBuTQTj2tONsolcLzBDQxswOo4HkgJtRkf1xIZtRJICY436HGy4WDGdgARrFnkcm1EKJYBiGA7AYmMgH0+hNB2oGwCm63GXe1kMAZlE9oOUFCUGgAHAigNjTZULMAZH1cvGcigYkGjDUoH72thYSGv0mC7ULNm+nHVakbNAtsFpUOTWywiJSIVtF2ozPi4GsmoWNB2Y8qaR+0t7vDhwFwZTGMWv1wlsYlpwFwZ2gkK3sdsPPftS6MNlujEtzMJWb+C4Uetllj1M+KWSuJPJXT50AQLFeB8JiHrUjA4h4UKaEpKBiQ88ea/UcsBS0DVAkXQskHTbIl/fWDBEGpl4Ai2C44ElvgsaIodPgzBleBKqFgwVwZXgut1VGS2ljuFRsSfsrIJpgCpYMXpfCX5lW77lw9B0wHOoGRArQxSgydB+l3iZpRMARMEwBAMAYbo7AZt2KB0FpnPsjeQIRBBy+nsALAMKJsgNUgJUoNfQ5MAZpyMCYjVofZX1IUAwUATeBLaDvgnGrM5ANk3jvoi4XjgeMAZGAJMAywEgM6eAKVBqdncFXtxDpwBQOf/RCAVNN3OFMS27i4Kjl5ENIHtAgFwBEQQAhiAYGAZMDsPU+CFoBRoDRrAcf3KQYAjM9G9/j9u5JObSshcbQAAAABJRU5ErkJggg==" />
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjogIk1vbiBCdWRnZXQiLCAic2hvcnRfbmFtZSI6ICJCdWRnZXQiLCAic3RhcnRfdXJsIjogIi4iLCAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwgImJhY2tncm91bmRfY29sb3IiOiAiIzIwMWYxZSIsICJ0aGVtZV9jb2xvciI6ICIjMjAxZjFlIiwgImljb25zIjogW3sic3JjIjogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBTUFBQUFEQUNBSUFBQURkdnZ0UUFBQVZYRWxFUVZSNDJ1MmRlM0JVMTMzSHo3bDdKYUVISUtSSUlHRTllQmlRWHhSc0EzRWRZN0NUT2pGK3hjbGs2cERNaERocHB1UDJMM3ZjdEU3L3lMVFRUdDFPV2lkdEVzK2tkZW9oTHM1TTR0cllJZlU0TnA3VWpvRmlIZ0x6a2dBSkpGbm9pWjY3MnIybmYreGsyYjMzdk84NTk2WHpHLzBCdTNkM3orTnp2Ny9mNzd3dWJHOXJCY2FNeVpxdDlkdnJGNWtXRHQrR3I4WUhJQmN4V290dUxBcWRZcXN0cFNFbStncWt0cWRzVlhRYmRPTEZrNnFPczMyaVk3aUp1eXo1N0VkYm1oNkRUc0lFU2E1RGJRbDBqUEFrRWlPNW5yVkY2VEhvR0NrcU5zdlFZd3dyUllvVktQSDAyQ2tvK3BGc0RpV1lJYzd1dHVjaFBWaFdFRkx6UGNtZ2lwOGhlNTdRNCtwc3BLS1h2VjhDWWNrUHhSb21Ub2JzWk5OVDZFNFVTRmU2ZnFYdzZ6RWxpWWNoTzVIMHlIQWowY1dRbDZmNGtzUmt5RTRTUFFMY0tPbEh4SXRVckVtaU0yUWxneDQ3QmUwVVJBamsvNGo5WGZqVDVjTVlQMUVvWWI3QUNjanRiUkJ6eTNjRERScmVyaGZHQ3RKOUdLSXBVNzdBK2NMSE90YTI0aXMveGFwRFZBSXlMcTQvS2JuaC9oSkNlV0trUmlRUnN1SklEeHNkVm45cjgyQ3NuNGd6UmxpR1l1YkNhQTRMK2ZKTkVuaytoRncrRWVQcEVNYXZ4ZFNwV1hHUkgxSFZZWXFOeS8zSWpmcndmQU94SkRGVUk2OEkyZkVXSGlRbU9WcUhFNHUvSEN0TytZSzVCWW1nUnZsQjdlaExrWjBZZEVqY0lJRkVUQ2dGazRRSjc5bzhHTVhGbzFsUjlsOTRlanpLVDNKVkxNL2kvcE1lOGFGL25GUU1UTEc5VlN2Q0tKcGV6STZ5OW1EUTRWQWRPalFhWFJoVm53cWx3Z29TUlkwS0RFVlRoNndJeWs4aFhoYWxoM3l2ODJrTUV2bmoreVpPUWNLSDJLV2ZpazVrWFN4Q2RnU0ZCKysyV09nSTZ3MVNKemprc0FnUjNzd1hHRUtXRk1Hb1I5WjIxT2pSaTA1NFBnekpZUlI1ZDJiSGx4NEJkSkNrcGtobllTVGw0Y2VJTGtYUlljaEtERDM0bUlNeEk2WXNDMk5jeDFFb1JOZGFYRWdVRllCQ2o2RGQ5SlEyc0N2ZDlRYWhtUDRnZDZ5bU5SMk1yMFhZMFFmM3hhNnF1Zk44VjdPRXlsQWhqcllqcHowaXdvTzQvUkFQTGtoa29CcVNaOElReGMxNUJ3dzlWK2FEWlI1M0ZnVmZaaWVISHZGRURQbVkybkI5RnNzVGtTUWNSakZseUk0RlBSTENnelJBdzhtVEZ5WkV3b2dzUmE3SU9ySU0yUkdreDZmd0lGbHVoTkNpck9Vby9KYUxKQXhHSWxLRXlmQWp3SkNkSkhwRTBmRWpScTdQNHFmZkVlTEZTTTZkUllBaEt5NzB1SE1XeEtZSElZU2x4ODhhSUFwUHhJa1VYREVRTmJOM1ZZNlc0WWVkbDFseG9ZY3VQSWluenpSd3cwK1N0MGhJUkZBank1QVZNRDJrRnZKRER5YzZBUnMvUm1vWkFzRXUvN0NEYjFhaGE1QUlPZ3BESE9YMUxZbGpTbU1qZDFUa212OHFUYzBneDNaWUdLQUcyVUhLRDQvekNwZWVGTis5bXhPUFZiMzlpaEFxanE4Uk9iSW1NUlNGZ05wT0hqMUM2S1NrMU43MUtVNmVNSk9tOFdmSURvWWVudEJIZ2g1cGRGSktvNFRDdC9HUTVCNGg5TGd6VlF5QlFCWitCS1JBaUxWOWdvY2UvOEtUMGh4ZDhwUGtIdDBwa2lKTVNDVEVVTERCa0JXQS9GRG1Ld0tqSjVXQ3FRQnpFNTZmYzJkVmxPd01jZVZsb1dUMWxtNTZPUE4yYVhxWUtYckE2QWo5dEh2OWhqaERvV2YxMmhYb1dwdHdoRDRTOUVRVEhWR01SQmtpaURlbTFYU1BaVmhhNVVjKzlDRzJ0UUE5SUVvbXpSQmczRjlraGdKeFpFR05BNmtJZlRqcDhZOU9VOE9DalIyMUsxdXEyNXFyR3VzV1ZDNUlWVldtSEFmTnBwM1pkRzU0TERNNGtoNFltdTNxbWV6cW1icllQODM1aS9uTFNQRjFTVkJjR2xNTEJkU0FPQ29RSzRCNDVDZHE5TlRYbHQrL3RlbmVMWTJOOVJXWWI3WmdtVzB0ckxZYjZpcldyVnhZZUgxNkpuZnN6UGpoazZQdkh4bTVNcHJtd1VnSFE4VXRqTTNJTktYMHNMMnRWY2VhNkJLQWNCcUxsNStRNkZsYVYvSDFMNno0MUsyZjhKbjNucjA0dWYvZ2xUZmZHeHlmbktOZlNjbnppOHRRUE14WVVqU0llUkZlZXhGaXJvU0s5OWpuc2RFQ0VDbDFaOUJUY3FVWVBkTG9XQkIrODRzckh0emVaRm5LNU41eDBBZkhSbDdmUDNEb3hLZ2NSbXlHTUlRUUdDcjVLcFVNNWJGSjFkWXVycW9BTTJtVkFKVjBCcEp4WHNIUXM3cWw1aCtldkhuVExYVlE2WWdiaExCbFdkWDJMWTNiTmpmTVpWRDNwU2xTeVMwTGt0N0NNb1FWb2VKL2xuekt3eENFd0ZHblFYbHMxQU5FaW42azgzWk45R3piMVBEZFA3dXhkbEdadmdCelVYWFpsdlYxTys1dXNpQThjMkhTd2ZVZUQwTitIUmtzaWVSVU1aVEhScjBMdzBZLzJOVGR2L09TcHVleCsxdSsrbEFiL1pycDJkeUJZeU1Iam85Mlg1b2FHSnFkbXNsQ0FLdXJVczBObGRlMzFkeDIwNUxOdHl3cHMzbkhRYTVPenIyODcvSXJiL1ZsY3c2bkw1TnpaRXdSVXVYRnRNUkFrdEVQN2tWOTlPemMwYnJ6d1ZiS0JXTVRjN3RmNjltN2Y0QStKRk5Sbm5yazN1WXYzWGRkNVlJVTUwLy8yMHZkcjc3ZHh4OFA4VHV5NENPaFBEWTZ4NEU0b3g4cGVxVHQwVTh2cDlQejV2dUQzMy94WENick1MOHFuY245MXh1OWI3dzc4QmVQcjkxNFE2MzhnQmpWM1hzVGUyeFd6MGpwdFkwSnFSeUpsb3grQWd4OU50MWM5L2dYVmxDSzk2OC82L3FuL3pqRFEwK3hiL3JMZis1ODVhMCtuNjFIcWhHUzJUREplRmZod0xTbFczNFliN0l5TDRYME5EZFdmdnNiYXluNTF2ZCtldmExZC9ybHF2dWpQZDIvZVBPeUpvWVlMWVA0eEExRlhvRUl4VVpxNVVlT0hzY0IzL25XT2txdzh1S3JQZi96M3NkK2F2cjh6OCsvZjJSRUIwTitSQWpwUFJOSkhVQ2tvV2ZsOGlObnV4NXRYM0ZkTmVuZHd5ZkhkdS90OGY4cmYvZjhxYUd4akxSejRZdUtGSWlRUWk5bUJTTS9FdUtxVUg3YW1xdStkTjkxcEhkbk04NnovMzVHU1gweldlY0h1N3NpSWtLaXZSQlJGMFliK3lIZlhtcno5aWNlVzBVSmZYYS8xak42TmFPcXByODdPdHg1OXFwV2h1Z2lqZlJrcjNvQjR2ZGZ3cXJyMis3WVVIL3ptc1dVSVorWDkxMVMrNHN2dkhJUkJHVUl5RGE3SWk5bTZhd2JFcm9WNkRlV3RQeDg3ZUYyeXJzdi8rcVM4cFhubldmSEwxeWUxcHFSY1VhS0FZVFNnVzV0NXJ4ZEZHcnZKOWZYdHpSVmt0NmR5enA3OS9mcnFLbW1yMlcwVEZDaXJoZ2c1dmdobjhQV0lqOWZmcUNGOHU2N0I0Y3ljNDZPWnQxL2NNai9iY0FwUXNnSGp2NjltS1ZKWktRMVU2SDhyRzZ0V2QxYVE3bmdyUThHTmQyWEUxTnpweTlNaENCQ1BMbVlVb0VLYmxlR2NMam5XMzUyM04xRWVYZDZObmY0NUppK2loOCtvZURMaGV1T2dzN0Z3andubXROL1NUYTlCZS9lMUVDNTRQOVl5d1Y5Mm9lbnh2VGZuRWlEcGdRTGtOcjlJZ3BCdW1ORC9ZSnlXdTBPYVFib1ZQY0VMWTJJUml2NTcwRkxaWDAwSkkzUy9tdnJiUTBNaGZoSXIwTE1aWjNCa1hTSUxjQVRCdmxuVWZOVWh1OEFTTmJnN1Rjdm9RZEFnOE5wM1lYbzdaOEd3VnV3WVZCb01aQTNBRkpZencwZGl5dW8vdXYwK1lrQTZuaHBZRWI3blJsMkdCVHBaNlpLcS9ldE55eWhYOURWT3hWQStYKzRwL3VIZTdxVnRFTXVxbzlOdFVBU2JlT050ZlFMTGw2ZUJzWU1RRmdyTDB1dFdGNU52NmFuM3dBVUFZRG9PM2pDT2lSMTdZb2E1dnhvMytETXZPcG16S3lxb21uNUlCUUkwUklFOWJTdFc3R1Fmb0dEd01SME5qbE1lT1BvQUdkVm8rdkNwQ1BvTmUwMTlBdEd4ek94d3lWcXh4M0ZJd3VqV01PU2l2LzgrOXZsbHZMVTE1YnZlLzVPdGVVWkdzM3NmUHFBaVlGaVl3L2Ywd3lqZEUvNjM5TmpBQXJPSUFCL2RPZlM2SlFublhGZS9VMi9BU2cyOXBrL1hGcFRGU0huKyt2ZmZweDFIQU5RYk95aDdjMlJ5b1plL3ZVbE1GOHRmZ0IxckZ5NHNxVTZPdVU1Y0h4a2FEUTlid0h5ZGJ3TDUwQ2kzRGlRWE9LNmJWUGowNCt2b1YvejR6M25mL2xXL0dKZTczU1k5d1FxNzlGQjNuT0RWQjBhbE1jbWFWTVpOVlhzbzNxbVo3UEEyRHhQNDBsV3pSRmN6NlFkMC9FR0lMeFZsTEZybE03a1RNY2JnUERHRXpuTnpTSFQ4UVlnUW4wNHhxZXh4MXdhU3hwQWNtdncrSjdZRXI5K210Y3JFcW01SlhRbG1UNXRqdU40UXp1cU05dGlyU3FTdzBjVW9Hd09YZXQ0enpCREtKT2RQSHZkYlR1WkMzbTVhRk45Y25UU21qS2RZUU5VWmtOZ3pBVFJXSnVaWmFmb3RnRm9uZ0FrRVRueUFKU3lZZ1pRWkNObzRQOTVZZExUWWNEZmpGamprb3FmeXE1STlHbC8rdDBqM1pjbXd3V0lGa0dESUNiQ1FEQnpZUkFTRXpHZjlsQklLeEkvNnA0SW1CN3BwQmY3K0pVb3VqQktJcVpKdlMwWTJvckVuKzhMZXVtUFF2K0ZsWitRQVZMN0ZFWE8rbno2am5CV0pGNFpUYjkzWkRnNk9ia1M4OW1EWVFiUjN1RkVYdjhWMG9yRVg3elpCNkprK0FBb1lWbVkvekRJcGVFZEt4ZUZzaUp4TnVPODluYlFBQW43cjJBRElLRGtxYzM4RDVualdab0lmSzlPZk9aYkhYZHVyS2RjTURLZWVleXBlT3pob3VSZndQZENST0J2R0ZwWkZsWXlvYUhIaXduZGlNeXpmNVlzS3MvbFlrbVBXditsNU5HRmdjWkFuRjdNcCtxZVlaMnZDeUZZV2w4QlltaU1sZ2x3RGpVSWdFUm5WVldKMEtudUNlYUNqZVZMSzVNaFA5d0JLSXcwUU5ocGVkRndUNVdsNTV6emx4Z0hrTFV2cndLSk1PSFVSUFhqbXdOeVlaQVBGL3J5SUg0UllwNGczdFljYVlEb1QzQ215MDlnK1ZjUUFIRXFKK1QyOTV3TUhUN0pPQU9hL2dpRUtOUERiRGZwWGdnWklINHZSbGRkcU9MRytmQ2pNZnJDb0ZVdDFTaWVLK3NoRlNVWXJQOENBWndQQkFITUR3aEJTRnVNREhITG1iRWZ5ZVVRKytuR0FCdzhQbkxuclo4Z1haQkt3VFh0Qzg5ZTFIdlk3OS84K1kyMzNlUStML1pRNStneno1M1FMVDhCaE0rYVhaaE9FZUp4Wk84ZUdxSmZzUEdHV3QwM3orbzJqS004Zm1aY3VsNUs1Q2U2QURGSEZDRVVyaURwSTh5MmZ2L0k4R3lhTmx4NCswMUx0TkpUdjdpOGRtRVpCaURDRTFWSk5mSWpQNlIzRlU2QjZ3eWlxU3FLRlNIc3dMUmNVRFNYUTI4ZnVFSzVvR1Bsd29yeWxMN2FyMStMZVZEcjlFenV4RG1CYVNQR3hBVkxmcUQrc1VYRkFFbUtFTXVSeVdWa3I3OURPelVzbFlKM2tZTWsvM1lyVHVFT2RvN3kxd1ZMRDBlN0JTYy8rc2VCT0VXSThLTFBZT2hjN3hUOXNZSGJ0elJvcWpkeTBKYjFkZDdYLy9mRFlaK2hEL2NOR0lUOGFBSEl2d2dwRElaK3RyZVg4dTRmckt0dHJOTXlLYmI1bHJycVNuZUdPNVBPZVFHU0QzMGlJRDhnaUpGb2ZoR1NjbVIwaGo0NE5rSjVBamVFNE9GN3RLeE4rK3hkeTd3djdqODRsQ3ZkbHM5REQ5TjVoU2cvdWdBaWlSQjJlbFhJa1ZFWUluWEdDNjljcEJUMS9xMU5OWldLQjhPVzFWZHNXWTlaa1BUcWIvcDRDa3lpaDZPaHFQZXFCdmtCQWMyRjhZc3RsR2VJZEVQLzd1ancwVlBFb1plS2N1c3JEN2FxcmU3T0I5dThoVHg2YXJ6NzkxTzhGTW5rb2tlcVBlT2tRRHdpeE9QSVZESDBnNWU2SElmWVp3OXNhMnBYTjdlNnFxWG1uaTJObUdqczlWN2w5RENjbDM3NUFjRXRLR1BkTkdvWmNuVlNiLy8wUzI4UXQrTllGbnh5MXhwRkR5YUJUKzFhNHkzYm9jN1JvNmZIS0c3TEp6MWh5WTllZ0hoRWlCa01TY1RVMkJ2OXhmKytlSzZIdUNGd2RXdk5FenRYKzYveUUxOWU1VjFwbE0yaEgrMDV6MW9nSmpCNFFhRW5ZUGtCUWU3S0FKRE5FSTlRQ3pGMHJkc2crTnNmbjU2ZUlVNXU3Tmk2N0l2M1hlZW5wbzkrWnZtT3Jaams2NlhYZXkvMlRjblJJeFQ2UUZ5cjZWNFZsS3F0WFZ4VkFXYjBuSlR0SUdCWmtJQ0ZaRERrWllqZVJnZ0JoSUJsd2NucDdMbWVxZTJiRzBuWGIreW9kUnh3L095NFJFMy8rSE10dXo3ZjduMzl6SVhKWjM5eW1oU0F1UXJQU1E4Nzg0SkJ5RThlRzcwQTVSbEtXVkJ0TUlScGE5Wjlsc2RvWUhoMmNpcExlU0w0K25XTDI1ZFhIejQ1em5OUVZkNXFxdXludjc3MmdXMU4zcmZHSithZStzZmprNFNIMjduSzdJY2VvR0hYVGxRQXlrZXA4c0ZRNmV2UUIwTjVqRDdxbnNnNWFFTkhMZW1hMXFhcXozNXFtZU9ncnQ2cG5FTnIvZkl5NjVGN2wvL1ZuNnpETHR1WVRlZWUrWmNUcEdGTUNqM1FEejBlNStWb1d6ZVh4MGJCeGtJZUkyMCtCTVZQOFN6ZFVsaFM4ZEpXUUc0c2tJc1NwajIybytWcmo3VFRyNWxKNXc0Y0d6M1VPZHJWT3prd2xKNmV5UUlJcWhmWXl4b1dYTjlXczZHamRzdjZPdExUNlROenpuZWVPNEZkbWkwZ1BEN28wUzAvNFBjYkN3TUNLR0NHZUREYXZybnh5VjNYbDJrNEwzRjhjdTZ2bnp0NXN1c3FjNnd2dnZRVUFBckNoVEdESVZGZnhneUplRHphK2N0VEJ6dEhiMW16ZURGdTJaZTBuVDQvOGUzdmRYcjNGU1dNbmtCaklHWXdKQkJUVTBNaWIxUkV6OUdHeHpMN2Z2dHhSWGxxN1lxRmx1OThOelBuN043YjgreFB6bHlkeXRMTDRDb3FaRldUNlA3Q0NIM0NpWUZFSFJuTmw3SGNHZGFqMFoxYWMyUGxycyszM1hWYmd4eEYyUng2KzRNckwvenl3dUJJbWk2QkdLV2svbCtVbnNEa0o0UVlTQ3REL0JoUlNGcGFYL0c1dTVydStXUWovODc1aTMzVDd4eTg4cXQzQjRiSE1uVFh5VVluVnZTRUNaQTBReEpTUk1HSVFsSkxVOVhHanRwVkxkV3R6VldOZFJWVmxhbktpcFRqZ05sTTd1cmszTUJRK3RMSE02ZTdKenJQamZjTnpqSkRMcXpiNWhlZWFOSlRBQ2ljUjlkbWM2aUVvYUpkWVlWOVpJVkdLZTVtOS9heDB2OURIRWI1L3NOaTVPcVl3aVc5L2RPOS9kTThnUnByQlNEZlF0NFkwbk5OQzBCSVJtZW9XSXJZREFGZWpPaUNwR3JhaUpRcDhOQUVhZmtFRWJTdzZBa1RJRHBETGluS3R5TkNaRVE4TzFzaHdha1Y5eTVTdDcyWjg4QUROY0lUR1hwQ0JraUlJUWtwS201bnhOSHJRanlKTHJxUUZwNG8weE0rUVA0WkFod1lNVW5pWjRLTExaSDNJTXVUUnBtZVNBQ0Vad2pRUWlKWEFrWEVpRW9TQUVCaDIwdnNTL2VEVGtUb0FkRjUyQXBtK1NLMU5TSHVWc1pIcVpEV3JjVi9vc1J3ZlJiaVZTY1o5RVJGZ2ZBNnhPSE92R001ZUE4R3VUUkg1ZG85S1BBeTdtYUlCejNSQXFqQVVBa1dWSGNtaHBFK0I4WUJvQ3AwQUlnUVBaRURxTUNRKzJncGp4VHhZMFJFeGR1bFNCa3V6S3ZZNk1TQm5pZ0NWR2dqdWp2emVqUVNSdHdlVEtVUGc3UmNEM3M5bTU1c0pCODdGMFdBT04wWlZvcUtld2dGbFlMeDRFZWNaSTJuOE1RQUlKbzc0OENJSWtnQmVqQmY2RVNmbnFnRFZPek8zQ2dRTUtJSUVtQ3RjMVdZaGRFbTUva0doYUtQVGp3QW9ra1JJRTFmNEFWSkNDYTEwQWloRXlONllnTVFUWXFvR0pGSUF1UzFIQXFKb1hFVGYzUmlCcEFjUmp3a0NkRWdFaVJCSVdjWk8zUmlDWkEwUnE0ZVJVQkxQN0ZQOVU0UU9qRUdpQmNqY21ibDdXa0pwQVFPZ1ljMDJZc3BPckVIaUkwUkVCajVVZjlJQUk2VFJtT05Ua0lBOG1KRWpJaTFEaVB5alFRVUlxMEVvSk1vZ0Z5OXdpQUorQjVHNU1NbHdkd2tFeUFaa3NScGtNanprOGROd2dHaWtNVExrejlpRXM5TkNVRERWMEh3ZXd2RElpa1BrM2ZVUjlWQTRueUFCb0Jyd05oZy9obTJqKzBVVlBJOTg4MXMwd1NHQmo5bW1TWXdaZ0F5RmpaQStUamFtREdoQ05vb2tERjFMc3lJa0RGUitURUtaTXdFMGNhaUE1RHhZc2FFL0pkUklHT3FYWmdSSVdQODhvTlhJTU9RTVU1NmpBc3pwaWNMTXlKa2pFZCthQXBrR0RMR3BJZmh3Z3hEeHBnckRSa3hrR0hJMENNVEF4bUdqSEd1Y3ViS3dneERoaDVmQUJtR0REMStBVElNR1hxd0pyYW92c0JRc3ZjQXpWdDBKSHBXZUZkRy9nY1N2NC9NQ0k4dWdJd1VHZUZSQUZDeEZCWC8xMWk4dVBIZmNYNDNGaForM2dqU1BKRWN4UUNSQk1uSVVnVEZSa2VuS043YTdDcWNTZnVqWUZwdll6dStSVGNXQmZ0L05CeW1pZGZvRXhjQUFBQUFTVVZPUks1Q1lJST0iLCAic2l6ZXMiOiAiMTkyeDE5MiIsICJ0eXBlIjogImltYWdlL3BuZyIsICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSJ9LCB7InNyYyI6ICJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQWdBQUFBSUFDQUlBQUFCN0drT3RBQUErYVVsRVFWUjQydTJkZVhSY1Y1WHV6NjBxalpZMVdyWmt4NWJqMkk2bk9CT1pBNGt6UTRDRW9adWhBNnpPQTFaZzBZVG04V2pvaHU3VkQwSVkra0gzNC9WcWhnRE5URUlnSkRnNEkzRkdFNGM0Y1d6SHMyekw4aUJacFhrc3FlcStQd1NLMEZCMTd6bG5uL0g3bHYrQTJIWHIxcm5uZkwrOTl4bHVzTFJwQ1lNZ0NJTDhVd3BOd0JpcnEwUWJRSkJmU3ZlaURmd0RBTHdlZ3FEWnJNQTNLcVQ4Zk15SUJTQUlBQ2o0SDUxM2hwUS9qeFplRDBGUWZpdVlZaDJULzYrVDF1RVVBSkRUUVJBa2tRcVRMV1hpZjd0a0tTNEFZTHJ2dy9RaENKTExnd21mY1lrRUZnTUF2ZzlCa0hvWXVFUUNLd0hnMjBRTkJFSG1rOEJHSTdJSkFQQjlDSUtNSllHTkNZRWRBSUQxUXhCa09BbHNUQWhNQjREenk3QWdDSEk0SVREY3Rjd0ZBS3dmZ2lEYkV3TERNV0FpQUdEOUVBUUJBd3FVTU5iOTA3MXdmd2lDck1mQTlGVkRBTURNMXUva1hqc0lnb0NCNlM1bmdvd29BYUhtQTBHUUR3d3dyU0trUHdOQXpRZUNJSDh3WUZSRlNETUFVUE9CSU1qUGJNQUVCbWdyQWNINklRanluQUVUVXdLNmJGQlBCZ0QzaHlBSTBwNEthQUFBM0IrQ0lNZ0VCaWd0QWNINklRaUNabVNBbG5LUXVnd0E3ZzlCRUdSVUtxQUlBSEIvQ0lJZzB4aWdBZ0FUZVEzY0g0SWdLRDhEcGh3dVRTcnlPUUI3MzVVRDJhdFVNcUM0N0ZnMlJOdENhakF3UGlWQTdaeTBBSUQ3UTFvc1BndzFmQ253QUZuSEFFSUF3UDBoT3RzTmRaaHQvaStkOFQ1QkJjaGtCbEFCQU80UHliTDcwQklMbmZFK3AvOGNJQUV5aHdFa0FJRDdROXlPSDdwbGo5Ti96cFRmQ3g1QUdoa2dId0J3Zjhobng0K0xCUEFBMHNnQXljdEE0ZjdRYktZLzhXZmNCQ2YrZUs0cFRUR2xvU0JvZ2dHTVlHMm9UQURBL2FIWmZCK21Md0lEdEF4RXhBQnBBSUQ3UTlPRGZaaStGQmdnTFlDSUdKQ3NycTZDKzBOU2ZEK1JDQktKd0JTdmwzNGJabmh2TXZHbmRzNkJxVjVxYUlTVmw3RHlFalkwSW1QWXluSi95RnZmbjRoWTdmWjM4VzlVUW9pSmRwNW9lY3diK3lrcGM4TFNWZ0VoL0lmdnUrUDFFdStUakFvZ2diY2FYeFFrUmFKekFDaisrT2I3VTRyN1ZFNDYrWS9Wb3Y4dDA2Y0swRkY5WUFDVFVYMFJBZ0RjM3pmcnAvSjlseHhmM3krZFFnSjBXakNBRUFBby9Yc1k4bE5ab2JlaWFRUWtCRjVKeElwRlMwQUkveEh5dy9UTmJCd2tCSjRrQVJveUFCUi9FUExEOUcyQkFSSUM1eG5BblFUdzdBT0ErN3RxL1RKWDhldTIrMUQySFFUYU53SkkrdjRrdGhHNEpaR2RBYkdYZ2FMMDc2VDFNeWtMT3RWNlNxajIrL0ovblFvOGhISmdNSEhPQk1QS1ViZkVzVE9BY3g4QXduOW5mRitDOWRON1NHaDgvV2pHT3lTa1FpaEtnc2tZQUFsc0YvZk9nSGh6QUNqK09HUDlrdzlvRTdJaEF0OEkvK0lnbkRDMGR2WkF4UThSZXdSVERwN0QwTENhQVN4K2hTYUZoa1BVYjBMSUgvb3hSeno1WjhyTUQ4UVNndkhPRUFTb0MzbW5HQmtBd24vZm8zNjVpeFNkaVBHTmF3R0JaNFJzd01Na0lDb0FNUGNMNjVmcmVuZ3V0QzBEREhpczZIWWRidzRBNGIrTjdzOXYvWkpDZnM4amZaM054ZnNFSjJNQVQ4UzZKQ0M2SXUwRFFQSEhVdXZuWDljdlpmK1JWcnVYZm1CUm9OVUo1VXdZY0YwRCt3YnNVcXh0QVpnRWRqbnExMkw5eW54ZjhSc0k4bjhkTlI0bVdsV0lCQ0VQQnJCdndHRVZMZ0VoL0xmTCt2bFBjUkJjVUVoYzVBbW5yYWswU3NwdVQwSTdDeFNGTURGZ2hhTFBCaU1EY01yOTFVZjlSSTd2d0R1RXAvOEV1Vm1DYUU0Z2xnMGdGZkFpQTBENGIxZmd6eE1KOHEwVklZajNuWCtEUE5FUEZIb1dYSDBBcVlBelNRQXlBT3V0bnlkZU5pUGtEejBPSXFmOGRpbkp3ZmlqVVpNUVlHTEEvUXdBNGIvNTdzOFRUdW9PK2QwTzg3VzNpV2hDRVArMmtRclltd1FnQTBEZ3J5TGtoOTF6TkpSZ1dzQ1pFTVNmRzVoZ0FGSUIrNXdFVFFEcnA3TitqYjR2L1p2VlI3a1RyUmNJcmZ4VWdRRlVoQ3pWckNVZzFIOGNjWCsrTlg5aTFSNWxSWjV3OWo5V2Y1ZjA5dVI4b0RGL0hqWVBtNmFDVlNCa0FEYTVmMnpyVnh2eWt6cSt5VkZscUNwakVNd0pPRmVPeHNrR3NFN1VoUXdBNGI5cDFrL3QvaUloUDFHOEgxcitPbUhTK3hkc2M1N0hIVE1Wd0RwUks1SUFaQUMrQi82Q3BSNS93bnlKUDAyaUwwNGM1YytkRU1USUJwQUt1R2N2YUFLVHJUK2V5YXF5Zm9tKzc2YzNUUG5WNGp3UUtRMVJZd0F6d3lacmhoSVE2ajl3Ly95VkJ5a09HREtjRFMyL05iZ2ZFRjFGQ0RQRDJwV25Db1FNd0ZEM045RDZFZXlyekF4RS9KS3ZMa1NYQ3FBY1pLN1ZvQW44Q2Z3NXJOOXUzNWY0M1lHMmUrZitacjY2RUE4R1VBNnlWbE5MUUtqL1dPUCtjYW9HSEtzK2hCZWVLeW55aEtyVzU0ZmFOZ0tJZnduSG80elhZU0xmSDhwQnVqUmJGUWdaZ0VIdWIwamdMeGoxRS9xaHNZRmpxQ0pqQ01VdXpGRVhDbGtvUFJWQU9jZ3MyMEVUMkJmNEcybjlOSzhGc1BhaFNsL29NKzNDZkplTWk0RjRGYUU0c3dJb0I1bWd2eWdCb2Y3ampQdkhyZmtJckI2UldnV3hmZmVYd3Q4bGNyRzRqenQyUlNneWlsQU9VcVlacTBBSnRJdGU5NDh4Rk9PNHZ6THIxMjltVnZOQTNzWFVZRUE2QTNDYXRFRVpBS1RlL2VVT2NZN0FYNXYxaDlnT0lMTVJSREJBa2dyRW1Sa0dBN1M1RUpwQWkvVXpwai93NTdBWU9aWUg1VytaUVBVMU9DWUdZc3dLWUVyQWlnd0FFd0QydW4rc3dKOXJVYUQ0bXdFMEJQdWh2RDk2N2x0dFFoQ3JZOFJMQlNKRENLa0FxYVpQQXlBRE1OWDlDUUovRFZHL2tsY0NxSXpPcHl0UThLMkIwQVhvc29Hb3FVQzArd2hERmdSWUlhcldrZEFFOXJvL2FjMUg3TTBBZHR1OTRDMEZkTitoNG4zdnIzbHg5RTRZRlFOZ0FBRGdyZnRMTC9zWVovMEVZOWJTTndGUThVQ0FCSEV4UUpVS0JKRytGd3hRSTZ3Q2d2di94WmZ6bmhBdGYzbTdNK3VEU0g1UnlQMmU1M2lmQzZXWElyRTB5RUFBWUFaWXYvdEhHNXJSSjk5aXp1bHB0bjUvVm9USy9LVktNQkM5STBYdG5CRzdPaGhBb0NuendNZ0FqSEYvcllHL0ZodnpmQ2VBdEovUGV4WHpVd0V3UUZFR0FEbmovdVNCdnp6Zmh5UzNTY2p4Y2dpcVZBQU1BQURnL3BMR1FKeXlqN0hXRDk5WDFFcjBHSWpJZ0tqbElEQkFvMDJoQ2N4M2Y3bld6L2lzWDhDT3RKbXB2SmNYQjRGcUF4TGRBeEIvN1dma043dkVXQ0FVYVhWUXRLVkJXQmNFQU1EOUpRVCthdnhiNVVpVmFQUnh2MElCR0lSSUVCTURzZjU1eEwwQ1lBQUFBUGZuY1VmTjdtK3E5U3V3ZTVHYm9VTUMvd3RoNG1OQUR3TUszU1FZSUYwSmhqV2c1cmwveFBwcG5FbTVXSnVHRmEweGoyNnlrMlY0SDZDK1d6VUxkcVAvMjRpZFVOYVVBT1lEeERWNUpTZ3lBQlBkWDJMZ3I2RG1RMlQ2YnZTS3lUOUVZbkxBWHhjS1NTcENLc3RCeUFOa3VoYWFBTzV2aVBVN1kvb3FZY0JURjZLcENJRUJBQURjbjl6OVNTcisrcXpmZWROWEF3TnFERVJuQUl1d09nZ01NRWZZQitDZys0ZVU3aStsMEc5TFFWOFpES1MwUmtoWjhZczFLeUFuMDhWOEFESUF1RCtIKzlOWnYzWHh2cFF2VkxZSFlLSjlSSEtDMk5rQVRTcUFQQUFBZ1B1YjZ2NXVXVDgxVnZKY240Z040ODFsSmdiQUFBQUFNczc5aVFKL3dWRkZzZzdTcEpFKy9XWWtJa0U4SWVEQmdMUVhmSUVCQUFEY1g4ejlOUWIrUmxtL1JaTUZrMjlWRmd3RUU0SjRHSkNhQ2tTWkZnWURBQURMM0YrS2ZUcnAvaEo5MzRFWllya3dFRXdJUXBwVVFFbzVTTlp4RVdCQVhHRVZFSS83Ri9BbVZlNGZFcmcvOXlJZk9ldFl3dGYrT0NhSlA0MjdxU21XaDBXOFpzSDdGVjhYTlBFdVNkZ1VBT0NGKzhzZDlCcXQzMVhUSi8yOUtqQVFwL09BQVFDQUYwTlg5QXFLM1YveVA1UnAvYjc1UGtVTGlHQkFlaXFnaUFIRUl4UUFnR1lPLzhVbmZnMTBmNzdBWDhUNjRmdlMyNFR2Y1lRRWZVa0ZBN0JCREFDQSt5dkwzS1dGblBCOTRsYml4b0JFWElBQkFBRGNYN2Y3MHdUK2d0WVBxV2swanNja054VUFBd0FBcDl4ZnZNdUx1MzhvMi8wNWJBVWh2MFVKQVcwcUlJTW9DaGpBTUNFTUFFZ1poTnJkWDJJVXB5RHdoKytia0JEd3BRSVNVd2J0REVBbkJBQkV3MzlyM0Y5dXBnL3I5eFVEaXN0QkNoaUFKQUFBb0hGL0p0cDNGYnMvYVEwQjFtODRCcWhTQVJNWVVPajZZQUFBRU52OUJidTJ2ZTRmTzJhRTlkdUFBWTVVd0JvR1lES0EyK2pRQkp5ZDBoTDNKdzM4emZmOXBJeGhuelg0ZUptSUwrR2EvSHlqSHlVVTlWeTRDS2YwRlB3bm91Y0Y1ZjJDaUsrckJBQ2dQd1VMSHJxLzFkYWZwSXp2WnJ1NE9XQ0loWUc0WjR1R3JqQUFSOFVCQU9UdUwyNmRocnUvSWRhZk5DQ2puM0lQMm5rUUZ3TTJNa0RrQzhBQUFLQ3crNHNPd3J6R2E2RDcyeEw0SjQydjRSckNnK2dlR2lzVk1JUUJrUTZPTGpUR3dRQUFnTmZqQklvL2F0emZzY0EvYWUzYzNjU2RxeWNCVVNvUWFVcEFPd013R1FBQWNJY0dwS1YvVWVQMnB1eVRkR3ZCeHVTZm94SUdzVklCbWVXZ0NLQ0k5M1lhMlF4QUVnQUFxSGIvVUhBWm02YXlqMHJyVDNxd1VFOXhXaEE5RlZCZkRzci85NWdRQmdEY2tZM3VyOHo2azE0dTBGWkpnbGdZc0lnQmtMaXdFWXc4L0JkMVVuZmRQNWtNa3Q1dnoxSFdDRkZmTVIxS2ZVY0E1Wkk1a2QxaDJCNk1ETUFJOXhkMzJwREpIdGpFN2cvVDE1VVFSSXlwbzVlREJFdjVUUGVFTUFwQnZtY0FoYU1BdmU0dmlSL1JBMzlTOTBmSXI3Mkpvai9pcUgyR3ZnL1Q1UUhNK3lNaVVBTFN0c0RSUVBlSDlmdURBYnNZNE5qWUJ3Qk1DZjkxRlgvOGNYOVl2NWxOWnhjRE1Ca0FBSmdWb2p2ai9uUmxIMWkvNGMwWThkRTd6d0JrQUFqLzQ2TEJIZmVIOVFNRFhqQUFTUUFBRU1QOXRWVWw3WFovV0wrTkdEQ0tBWG9TZWw4WmdCSlEvTDVDRi83YjdQNndmcXN4WUE0RFVBZ0NBSFNILzA2N1AwWFJIOWF2QlFQU0dWQjQ0Ykx0REVBU0FBQVFwYWkydUQ4Q2Y2UUNJajNFZkFZZ0NRQUFlTU4veXZNK3FaR2syUDFoL2E1aVFCMERxTVlMSjFzOFRBTDhBb0NOeFI5ajNSL09heG9HN0dNQUNrRUFnRUV5ci9oam9Qc2o4UGNrRmJDZEFTYm1KZ2JHeEFqL0pTU1ZOTDAvOGtCVjZ2NjJkNE81NWFtbWhlVU45YVVMNjBzWDFKVld6UzJxbWx0VVdaRXFLMGtXRlNXS2tvbGtNc2ptd3JHeDNGZzJ6SXptK2dmSEJvYXlBNE5qM1gyajZhNlJkRSttb3l0ejR0VFE4ZmJoa2RHY21SaVFkYUpjNFVQNTQ3eEpKdDhvNER6UHJjQ1k1WHQ1cEZlSHhPRTAwTUplVEh2YXN4Z2Q0UDRGVlpRSzFxMm9Xcit5YXVYU2lqTVdWMVJYRmtXSkZWTEo1UGovcnEwcW51MmY5ZmFQdHA0Y2FtNGRhRzRkT05neWNMQ2xmeXhuaEd1WXhnRHhRMFA1Ymk4ZkEranV5U29GUzV1VzFGVXl4bGk2MStQd243ZWVxTGY0bzh6OWJiVCtwb1hsbDU1VGQvSFp0U3VhS2hJSlJRZnVIejQyOE9yQjNsY1A5RzNmMjkzUm5kSGVDTEl3VURES2o1SUhCQUovSGZEZVhzQjczU0JnRGljQkU1NFBBRkNGLzNCL0xUcHRRZGwxbHkzWWNGRjlmVTJKM2p0cFN3Ky90THQ3MjY3dXJUczZoelBhaWtVK01DQW84TUVBQVBBYUFPckRmN2kvNnFKSElyajIwdmx2dnJKeCtaSUswKzR0bHd0ZlBkaTc1ZVhPWjdkMW5FeVBnQUdLR1lBa3dHc0FqQy9xa2g3K2F5eitxSEYvVzZ5L3FxTG9IZGN1ZXVNYkd1Yk9zV0JDcS9ub3dCTmJUejI1OVZSN2wyb1NTTUdBT0FPTUt3UUZCUzdvSkFQOEFvQkx4Uis0LzRRcTV4Uzk5ODJMYjd5aW9TaGwzMnJtM2MxOWp6elQ5c1RXZHBYVkliY1pnRUlRQUdCOCtBLzNsNkdpWk9KOU55MTUyelVMYmJUK3lSb2R5ejMzVXZwM1Q1M2N2cmNIRElqa3lFZ0NBQUM5NGI4dTl5OElBRS9jLy9yTEZ2enQyNWRXenkxeXFhTWVheDk2Y1BPSmg1NXVHeHpKT3NBQTBza0E5UXdBQUJEK1IvSlpqY1VmSDl6L3RQbGxuN3AxNWFwbGM1bWpHaDNML2Y0UHAzNzFTR3ZMeVNIbkdXRFdiTEJuU1lBdkFQQ2srT084KytleTRmdHVhbnJQallzOU9hZmw1ZDNkdjNyMDJBczd1OEFBSkFHa0FFaFdWMWVWbHpERzJOQ0lVME9vZ0ZNUVBFMk5wWCszM1g5K1RjbWRuMXgzMWNYejFlem5Na0VOOWFWWFhUVC9EYStiTnppVWJUN2FMK0c0aFdsS0pBTHhibVhtWklEMEphRkJ3QktKSU9jUUFpWTgzMWtBY1Bkdmt1SVBKWWtFaDNFeUdaaHNyQnN1clAvaTdXc2I2a3VaZjZxYVczVFplWFUzWE42UXpZWUhXZ2FraHdHSlJDQ09BZHJKQUpNS1FRQ0ErK0YvcURvMWlPTHZoTVVmdzhzK0gvdWI1YmUrWTZudFMzMEVOYWNzZGNGWnRUZGUwWmpMaGZzTzkxTmdRQzhERkNjQmZBeHdMQWx3SEFCUzBsc1R3bjl2M1g5T2Flck9UNjU3L2V2bU1ZZ3h4bGhwU2ZMOHRUVkVHRENhQVVnQ0tBSGc1aVF3My9TdjRybGZ1UDlzYXB4WCtwWC9lZGI4T2hXSCtXUkdjd2RiQnZZZDZUdldOblNzYmJpeko5UFZPOW8vT0RZNmxoc1Arc3BMaytXbHlmS3lWRjExY2RQQzhxYkc4cWFGNVVzWGxaZVdKSFcxVDNmdjZFODN0dnoyaVJOeXo3TVVuQmJXd2dENXM4RitUQVc3dkFwSThlSWZTMWYrR0F1QU01Zk8vZUx0YTZuUGRkaHpxTy81N1owdjdPemFlNmlQb3lteTJYRGRpcXFMMXRkY2VGYnRzc1Z6dERSVVczcjRoNzg1OHVoejdiSWVwYmtBWUdwbmd6MWdBQUJBNy80SS8rUHJnblUxLy96UjFYUkYvL2JPa1kyYlR6eTJwYjJ6UjlwWnpiVlZ4Vy9kMFBqRzF6ZFU2ZGliMW5KODhLNWZIZHE2UTg2Q1VSdVRBUGtNQUFBUS9wT0cvM0QvR1hYSjJYV2Z1MjBWMGUzdFA5TC80d2RhdHU3b0pMcjVYSTV0dUxEK1hXODhUVXRDc0dOZno3ZnViajU0ZE1CUEJpQUpBQUI4Q2Y5ZGRmL0x6NXYzang4K2sySkI2dEdUUTkrK3AvbVBsSnVxSnV2YVN4YmMrbzZtbXNwaXhRMFlobXp6MWxOMy9lcHd1bHQwT1FjZEE1QUVtQVlBcDFZQmlaejdMM3M0VW9YL1Ryci94ZXRyUDNmYkt1bnVQNXpKM1hYdm9hOTlmOS94OW1GbHY2VzVkZUEzangxUEJNSGE1WlVVRzdqeUdOUHBwODFwbUZmNjFCODdCQzhsdUNqSStTUWdhZjk2MEFuUHh6dUJHVit4aFh2dVY4VDlSWWFsc2U2L2ZtWFY1MjViTGQzOWQrN3YvZkozOTNaMDYzZ0JTeTc4NGYxSHRtenYvTnh0cStiWGx0alk4MFhlS2x6Z1BiMGk3NUdmL1VXK2VWN3hXL0MxeGo3TG15MDJpamQvRVNRaFRyci84aVVWWC9qNDJsUks1dTJGSWZ2WmcwYy85YlZYdExqL2hQWWQ3dnZnNTE5OFpsdmEwaEVqMG1kRStxcmFSRDAwNGo0QUFIRVZxUDhZRVA3ckt2MGI2LzUxMVNWMzNMNjJwRmhtSnh3ZXlYNyttN3QrZFA4UkUzNWdaalQzeFcvdC92NnZENE1CMGROY2l2RWwzUm1jT1pUUWp4S1FHZUUvdC9zN3FlS2l4SmMvdVU3dTBzbXVuc3hudnJIcnlQRUJvMzdwUFErMTlnNk0zWDdMY2hRaUp2ZjJ3SXptQ0ZrWWNOU1ZrQUVnL0pjYi9oTWwxTWFHLy8vNzc5WXNiaWlUZU1GVG5TTWZ1Mk83YWU0L3JvZWVQbm5IdC9mWXVIckV4RUlRa2dBQVFCYjgzUTcvalhYL0Q3M3o5SE5XVlV1OFlIdm55TzFmMnA3dU5uY3AyelBiT3U3NDFoNGIwenlpWG1ST3loc3l2NUp2endBUXFycVlZZUcveVV2KzMzSGRJb2tYN08wZi9kUlhkM1QyWmd6dmlWdTJwNzkxZDdPTlk0aTdMeG1WQkdoM0R3Q0FSSHoxSCs2ajMxU0dRdTdOQ3l5Y1gvYS9ibDBwOFlJam1keG52cjZydlhQWWlwOS8vKytQMy9mWWNiL3liSUhaWUhWM0V0L3AzYWdDdVo0QkdCLytlMVg4Q1VQMnp4OVpMWGZaejllK3Y2KzV0ZCtpTHZudGU1ci9zTDNUdXBHa3BSQ0VKQUFBSUFuL2laSldaUUdMamU3UEdQdm9lNVl0WFZRdThZSjNiMnA5Wmx1SGRaMzJ6dS91VFhkbnJMdHRMWVVnUThhVXEwbUFwNVBBb2FyVWdEdjhkOC85ejE5VGM5TlZDeVZlY05lQjNoL2NkOWpHN2plU3lkNzUzYjFlVFFoekY0S0l0dHlUZXdJQVlJTE55K3ltRE9KWGNWSGlVN2V1a0hqQmdhR3hML3pYSG5zYlpPZitubDgrM0dwQ24vZHQ2UE53MTkxV3RSc0EwcWQvRWY0VDZlTzNMSmQ3UU9ZM2YzcXd1eTlqZGUvOTdpOFBIVGsraUNUQTZpVEE5aXFRMS9zQUhJc0FUQzcrWEhQSmZJa1hmR0ZIMSthdHAyenZWTWxrOEg5L2N0RFNPOGVZUlFiZzJ2TVBRM1hmNzgvU3owUWkrTVQ3bDB1ODRFZ205Mi8vdmQrTnh0bDFvT2VaRjlQTUc1RWtBVXpKU0hlVUp4WURRRm45SjdTaFd4Z2JsSDNncHFaNnFVY2kvM1JqUzQvbHhaL0orcytmSDh5TTVwQUVVSVJhWEQ3dlZ4WEkwUXdBNGI4WmFxd3ZsYnZwOTJUSDhDOSsxK3BTRTNYMVp1N2UxTXE4RVpJQUFNQmZ6UGdXL24vOGx1VnlnNlB2M1hzNDRWeWYvZVZEclVQRFdTUUJEb3hFQUVDUmpLai9jSVlla3NOL1k5My9kZXRxemwxZExmR0NCNDhPUEczaHRxK0N5b3psSG5qaWhJMTN6dGYzVkI0T2dTcVFmeG1BbXZvUGRnd1Uwb2YvNm5TNUY3VDN6U29GZGZlbVZodG5BZ3dhMmJwSFBUSUFDT0gvYTdyK3NvWWxqVEpQZldodUhYaHhWNWVySFdOd2VPeDNUNTFFRXNEOGV6TVNBQkJiSnRkLzBIbkhoL2NIYmw0aTk1by9lYURGN1VhNzU2RmpzRDVEaHFRL1ZTQmtBRVprZ282Ri96ZGZ2YkMyU3VhKzM3YjB5SE12Tzc1ZXZyTm5aUHZlYmlRQkt1RUE0am9IZ0ZEbmxiU2MvR3pnSTNqM214Ykx2ZVI5angzem9lVWUzSHlTUVFUclFVT3AzUnNBc05HVVFvTzd1MVBoLzAxWEw2eXBsUG1xOTVGTWJ1UG1FejcwMGlmLzJORTNNSVlrQUk0QkFNd3F1UzhBVUZiLzhTVDh6MmJaWDk5d210eHJidDU2eXNiWHFmT014Z1I3YkVzN01nRCs4YUsxQ21Uak5JQmJHWURCOVI4VEFpNEZ1dTZ5K1hYVnhYS3Z1ZkZKTDhML2NUM3liSnVsZDY2eVQ2SUtCQUE0a3MwNWxoaTg2NDJTdy8rako0ZjJIK2xuM3VqUXNZR083b3cvdnhkVklBQWdodVJtV0piV2Ywdys5bG51Mm4vRzJHTmIycGhuZW02YnJldWRrcEtIcDMxVklPa2VCUUJvQ0JtVUpaaU9oZjl5ejMzN013QzhxNGsvc3kzdDFlOVY1Zk1xNG5uclJyUkRKYURRMlA3dFJmaGZYMXR5M3BwcXVkZmNlN2d2N1ZNOVpGd3Y3ZTRhR01wYWV2TkdKQUVldTQzSEFKajFTWVY0NmdyMHRxc1hTci9tVTMvczhMQWxrOGxnNjQ1TzlDZ1R4cW56MHdBMkFVRC9CSURVL3NaeEF3YS9paSs0L3ZJRzZSZDk1a1VmQWNBWWUzbDNqOVVBVXpNWVF5UGRnRmsxRFdCWkJtRG1CSUNWT2F4VVhYbkJ2RGxsU2JuWGJEMDUxSlllOFJNQWxwNEpRVFBrTFZ2QWFkZUlkNlVFRk5KbmNLai96SzQzdmw1KytMOWxlOXJiOWp6Wk1kemRONHArWmNKb0RXYzNGd2ZrNldGd3FQOUlWRzFWeWZvenE2UmY5dmxYdXBqSGVtVXZxa0JLb3pJL0Q0YkRhYUNFVVBlay9uUEQ1UXNDMld3YXllUjI3dS94dVN0dTM5T0Q4VWd4anBESld3a0F1VWNBK1JCU0tkTTFsOVJMdithT2ZiN2IzdzdMK1plMDh4V0pzcElKVythQm5jZ0FRc3Urd2lXU05TMmNzM0IrbWZUTHZyU24yM01BSEdvZHpHYjlDbmtrand2YmJBRUFrUDUwUW5RQWFsMTFVVDNGWlYvYTdUc0Fra25XY21LUVFVYjR2TE1EM2NjNUFEVUJ1TVRDcGNuWjlBWUNBQXhuY3MxSEIyQnRCMXJzYmdTSi9WYk5kSnFIUldaTUFrY0lKVkQvbVVXbkw1b3p2N1pFK21YM0h1cERiMlNNSFdqcDkyNE1LcWtDSVhHM0RBQm16Z0NqRzExMlhoM0ZaWGNkNk1YSVpJeDVkUTYyWXlQUmxubmdoS3NQMzVteW5jbjFuOHZQbXdjQTBLbjVhRDk2cnpFMjQyWTI0VjBKeUxvSkFHTlZXMVd5ZEZFNXhaVjNOd01BakRFMm5Na05EbWZSRGlySGxHL1RBSmdEVUFweWw3clhwZWZXVWx5MnEzZDBjQWl1OXljZGJ4OUNpR2J2ZUFjQVFBWm5kZUZaTlJTWDNYOEVNOENUQVRDTVJzRDRCUUE4N1ZmR2xsQnpPWGIybWRVVVY5NTNHRE9mVG1VQWF2b3dmTjVaQU9SYkFtVGtZL2RoQW1EOW1WVWx4U1NkQnpzQWtBRllOckptbXg2MllTR1FteG1BbVV1QVhPTENCZXRxaUs1OHFCVUFlRTNIL0pzRE1IYWtPTGtmT0lXT1pXeithUElTdW5OWFYxTmNOcGNMVDNRZzVuMU51dzcwM3ZEaFoyei9GY2xrWU9DNVJpRmp3U3d1RVhoemtCM21BSGlTTzgrVlRDU1dOMVZRWExtMWJRak5DMkVVQXdEb1VlYnFySldWQ1pvUTZlaEpBQURDcUFRQTdPMkZzNVNaWEpvQU9HZFZOZEdWV3dFQUtPOTRDVVA0UEFBQWFkWFpCQytBQkFBZ0NBQ1lLdXZXZ01xU3NUUEEyV3hJTkFIQU1BZUEvbXhyd2pKckhtUDRTdENFaTgvQy9TS01ScTFvbWx1VW91clRKMDRCQUpBQkh1TDZFWk11QTBBU3ZER3BOTFBXTEo5TGRPVmN5THI3UnRIQ2tMb0kzZnVHQVFEa0FjTVRBSnhSU1hUbGRQY0llaGVFc1FrQTJKczV1bDk5V3JXTUtnTm82d0FBb01LakJndUJBQURIWmV5TVdUSVJOTTRySmJyNHFTNEFBTDBhQWdBZ1U3VjhTUVhkTHZsMFZ3WXRERUVBQUdTb1ZwQXRBR1dNZFNBRGdDQUFBREkzQXlBRlFEY3lBQWhTcWhTYXdCOTk5a09ycnJoZ25yRzM5N25iVnJuZC9vODgyL2IxSCs1SFA0U1FBVVNqVTU1dHdGQk1WYzRwdXZ5OE9yU0RSdDI5cVJXTjRKc00zd3hzYlFrbzVsYTkwUHVkSUcvZDBJaGxHQnExZlUrUG4yOTNzZE5JNG04R3R0TktNQWNRRnpCNVVHOXVGOGpsd2h1dmJNQlRSZmp2U2xnZGYvOCthZ2tBZ0s0Y01KWW80dlFyTDZpdnFTekdzOUNsNCszRDIzWjNvUjNpOW0xVWdBRUFTSUp1dm1ZaEdrR2o3bjBZNFQ4RUFFQTYxTlJZVG5lQUQxUlFBMFBaQjU4OGlYYUFBQUJJZzk1MjdTSTBna1p0M0h3aXdEaURBQUJJdlVxTGsxZGRWSTkyMEtWY0xyejNrV05vQndnQWdEVG94aXNhaW92d2xMWHA2UmM3K2did2tnTUlBSUIwNkMwYkd0RUlHdldMVFFqL0lRQUEwcUVMMXRVMGtKM2VEQlhVN3VhK1E2MzlhQWNJQUlBMDZPYXJzZnBUcCs1NUNLcy9JUUFBMHFHR3VwTHoxdFNnSFhUcFZOZklscGZUYUFjSUFJQjBoUC9YTEFwdzlvOCsvZXFSNDJnRUNBQ0FOQ2lWQ0s2N2RBSGFRWmVHTTdrSG5nQUFJT09OQWszZ3BNWnk0ZHR2M3lMeGdxdVhWWDdqTSt2cGJ2aEwzOTd6MUlzZGVIQVFoQXdBTWs0VjViU3hRdDlnRm8wTVFRQUE1Q01BQm9mRzBNZ1FCQUJBSm1ydUhHb0FJQU9BSUFBQThqTURHQVlBSUFnQWdMek1BSVpHQUFBSUFnQWdMek9BekNnQUFFRUFBR1NreWt1VHBOY2Z5K0x0ZnhBRUFFQkdpdlJNYWJ6NkZZSUFBTWhjRlJVUkhpc3hNcHBEQzBNUUFBQVpxbFNTc0t0a01nQUFCQUVBTGlydWlXeFpJNnZoeVFSaEJwQkJCdUNINHZadG5HWUlBT2l5N1ZqL2VieXp1dHhiazBuQ1h6YzZCZ0JBc2NBUXhCeTRlWWN1QU9DUVFRZXhRZ24wQ2hOaXNWRmtBSkJaUnBMSE1aeXlFcU1CTUpZTmtRUDZBQUNzQVlVY0hqZ21kMitVZ0tDSWdSSWhBWEpZQndwQkFBQmtyRWc5T2tDaUIwRUFBR1NzU05OWTBpVkdFQVFCQUpDUVNPZHBpMUlBQUFRQkFCQmp6TWl0QUtSTDlWTXA5RVAwYWdnQXNGeXoxYklkS0hGbmtBRkFxa2RUdkZFR0FRQksrcVdYdjNxRUZnRG9oeERHSmdCZ1ZLZEJiNW9NQU1yamVvcUswQThoRFlNY1F6emg0ck4ydGc2alVjT1ViK3dxUmdrSU1zcEQ0bTREQmdDSWxHOHpzTk9tWWRxTUdXa0drTUF5VU5mbCtBendyTk1WcHU5eVIrb05SUkwxTzN1eFJBU0NBQUFIa2tjM0MxRER4QURBU2xBb3luakJFaUFBd05pRXora01ZSmoyd0U3UzQ2WWhqRW9JQUVDZjR0Zmc4Qmd0QU5BVElZeGlBRUJQWG1uazNScFZGaDhjcGkwQllSN1lZWms1d1JQM1RRQUFnRVhJTi9FWld0MnhCZ2FKQVlEYUxtVDJTQWxjVENXQ3BVMUw2aW9aWXl6ZGErNWRwcExCcktjUmg3UDk1NW4vSWd4alhTYlA5Zk1wRE9OOSsyeVNXeG4vN0lkV1hYSEJQUGdMdDNLNThLLy8vdm4rb1RFMEJXa0d3RGNESEhkSEovVzd3RXhlQXpyaCthaThTczRmamMyZHF5cUtMaisvRGc5T1JFKyswQUgzMTlpSHRZOUg5d1FBK05LejNyS2hFY2Z1QytxZWgxclJDQmkvQUFENkNlKzNhT3FPWVJqZWVFVURucktJWGozWWUrallBTnJCalRFQ0xuZ0tBRVhkeTdCcHJDc3VxSytwTEVaM0Z3di9qNkVSdEk3Y1FNbTNBQUJPaE83T1RObExLYUhlZlBWQ09JaUlUbldPL0dGN0d1MmdwZmVhWVROdUhpaHFCd0R5SFFsbkhIcU0wOUtGNVd2T3FJUVppZWplUnhEK1d4Y0U2czFYVEQ4R3pwVU1RRUUzQ2lUM0RNVjYyeldMOEhCRk5EeVMzYmo1Qk5wQmpXOHFLUTlBSGdQQXVta0FrVHk2ckNTNTRhSjZkSFFSYlhxNkxadkRZYVZLK3kzZGFESXFPQU1BU0NQNmdQNHJUTmViM3RCUWpQZHRDU2dNMmIwUFkvV25oWW03VlU0Q0FKamVCU3dOTk42eW9SRWVJYUl0TDZmVFBSbTBnMzBCdUcyMkFBRGtrNW56d0labjB4ZXVxMm1ZVndwbkVSRTJmNm5zc2M2UWJNeVNuNC9pQUNIUnRlOEd1Qm5UdjJJNmVIUmd6NkUrdElOdVB3Mk1IZVBJQUh4UE5nTlZOeEEzcEdxWVYzcnU2bXAwY1JIOUV1Ry9xdkNmYjBnR1Jub0NBR0JLNkM1ejlzYTIvbkh6MVF0eHhMS0l1bnBITjc5d0N1M2dlUzRmT0wyWTFESUFLSEEwTjZwQXFXVGl1a3NYd0FkRTlKdkhqNk1SREJqeWx0Vi83SXE2N0hnZndDUmZrL1ppQUNidjNRQjUvMmJXZHdPdytLOEhZTHJmbmZ2MzcxOXgvZVZVWExuajIzdWVmckVEbG1lNzVOWi84Z0NBNCtVQUhHOEJjK2sxQUJQeTZIMEFQbGVCcEd2ZmtYNjZpOCt2SzRGN1FrYU4wOEQxTVovQVU3Y3JoOVc3dXU0QUtRQnFBUUFmdzM5bFk4Y0h0M0VmQUdaT0F3U20vaGJKQUdqcEQ4a0FWQThBK0JtdkIwWVBVcmRIdEdVQUdKTWNYeWpxUk00a0FkbGNlS3h0aU9qaURYWFlzNGJ3WDNqVUJFcDhRSlZIQVFCU0lucHp1V3hkeUxDN21XcGpWR005QUlEd0g3NEJBQWc4TVkxWFV0bFpOQ1lCcng2a1dpNVdWcG9zSzBuQ0V4SCttejQ4SGVLQ2ZRQ1FleWlRcFZVZ2pkcDFnSEM5Y0FPU0FFaGt2R2l0LzFoMEJKQ2pHWUNkMlJ4ZkY5U1ZCTFNjR0J6SjVJZ3VmdHI4TW5pZlArRS82ajhBZ0FISm9hbzAwNWtrWUhjelZSS3d1TEVjWmdybEh5bW8vd0FBdWdQd3dJQjcwSmNFdkxLM2h3d0F5QUFRL3F1elpoeVdaU1VBK0tZQk9ISTZ3NmVDZGVubFBWUUFXSUlNQURKZ1NQSjRoWVVUQU1nQURNcHRMVW9DWGozUU96cEdNZzJ3dUFFWmdPL2hmNEN3SEFDd0lCTU1QRTRDQXJiN0lNbHVnT0tpeFB4YUxBU0M0bzhzM2FNZUFGQXFrNnRBUGlRQmY5elZSWFRsTXhiUGdkTWgvTmNYRFhwVS8yRW9BYW51WENhTlF4RzlzSU1LQU1zQUFLZmQzKzJSQ0FEWTJpSGtSaDdjNjBGdHFYOGVPamJRM1RkS2NlVVZUUlVZbGk1SFRiemhmNkRxTnJ6Q2pNVUFNS0lLNUhFUzhDSk5GZWpNMCtmQ0pSSCtTeG1mcVAvNG1nRWdDYURYODlzN0tTNWJVMWxVT2FjSURvdndIK0UvQUdBdlRkd1B5djZ3dlpQb0c1RUVvS2Q1TW1hMUsyWDEzWTlsdzN4dkNaNDl5d3RaS0xPamhYSC81azhoejJ5dkN3NEN4dmZlbFd3MlZQYlM0TXhZYnZ2ZW52UFdWRXUvOHJvVmxTL3M3TVRnWkl4OTdMMW52UG5LUnI3UC9zdi9lL1g1VitRM0k3ZjdrNFQva3JOMnYrby9ybWNBVXF0QUNDaW02NWx0Sk85d1g3ZWlFbTA3cnVWTCtLZkVkKzdyOGJiZEFxNHg3dUhnVC9qYVB4VFYrOVhQQktoTXo1L2RscVo0UStUS3BSWFpMTXlmTWNaT1A0MXpVV3pMaWNHQllmbU5pUEFmQURCTGNsOFB3RXlhZ3pXZkFUMzlveFR2aHlsS0pkYWNnV2tBMWpDdnRLU1ljNFR1SUFqL0tkemZsakUxMjlXc3J2OTRrQUVvVzloRGtBUm9HYXR4OWZpV2Rvckxua3N3dFdDZFJPby9PL2IxV3RHaktNSi8vWnVKQVFEems0QThHWi9pZ01YcUphR2JYemlWeThtM2h2TUJBTWFXTCtIZkZMM0RtQWtBYzg1OXl6dkQ1OTMwcng4WmdBMUpBRkhTcWlZSkdCek9ibnUxVy9wbFY1OVJpVk1oMTYybzR2dGdSOWRJdWlkalF2Z3Y4Z3dSL2dNQTFHZ3c1ZkZhWFFoNjVOazI2ZGRNSllQWHJmVTdDUWpaS3Q3OUVOdWx2ckZIUy9ISFR4OEFBRGlsY2lyWW9pUkFEUU9lZnJHamYzQk0rbVV2T3J2V1ovOWZjMFpsS3NYNTRDVnUwaGJwUDBhRi81ais5VGdEa0ZyN3N5c0pVQktxc3NmL0lIOHErS0t6dkFiQTJhczQ2eis1WExoMWgrbmI2T3dJL3oxSUROd0JnQU5KQU5Gc3NJSWtZTk5USjZWZnM3NjJaT2tpZjQrR1huOG1Kd0IyN084ZHpzaDVYeHRSK0YvUS9SSCtBd0J1SmdHdUZvSU9IeC9jZTBqK084SmVmLzQ4UDkwL1lHek5HWnpib2JlOG5EYlovVW5IQ01KL0FNRG9KRUF3TlRhWkFmYzlkbHo2TmE5NG5hY0FPSDl0RGZjV01Da0FvSFAvZ0FZT3lzSi9BTUJjRmFnQ3FRMHR1TytDcmp4S3lvQW50clozOTBwK1JjeHBEV1ZMR3NzOUhKYVhubHZIOThIV2swTnQ2UkZqK3dsUjhVZnArSFdvL29NTW9IQW1hTnJ4Y0lKMElCM2JHNTg4SWYyeTExNHkzOE1PZWNrNW5CUGd6d21ILzRJOVJFdTR6UmYrQnpqZzBUMEErSkFFR011QSt4OC9QanFXazN2TnF5NzJEZ0RMbDFUVVZCYnpmZll4c1pNNVNOMGY0VDhBZ0NUQVpRYjBEWTQ5L0l6a1RXRjExY1hucnFyMnFpdStnWGZtNDBETFFNdUpRUWZkSCtFL0FHQnNFbURGRzRPVjZaNU5yZElQaUg3TGhrWi9HakNYRGEvaHJYcFJiTWsySkRwVE44SjhDditSQVVoSUF1ajZybzFKUUh2WHlKTXZuSko3ell2UHJ2WG5MY0VYcnErdHJlS3AvMlJ6NGVQUHQrdnFEd1lXZnhEK2V3MEE2Wk5SS0FSRjFJOGZPQ0kzQ1Vna2dyZGU1VXNTY1AzbEMvZysrUHdyblFPOEIzSjRWZnd4eEU4QUFFSVZ5TlFVaHdhQllNK3pqQUhIMm9lZjJDcjVaSWkzYm1qMElXWXJMMGxlY2pibkF0QkhubTNYMGdjSVYvMHpSak1jT1VNNTkrby96TzBTRUYvZk0yMDJtRG8yeVdaRDZSajQ0VytPeUgxSlFHVkYwWFdYTFdDdTYwMVhOUEFkQUpmdXlXelpubGIvNk1Yallpdm1mZ084RTlpZkpJQ2tLd2RDOTZMZzVDeTVER2hManp3c2UwTHkzVzlhbkhVeEJIdE5JWHY3dFl2NFB2cnJSNDhGV3A4NFg3L2wvbXVTOGVCZitNK2Nud1RtV3c2a2VEYVk2WjRNb0hDRUg5eDNaSGhFNWt2SkcrdEwzZDRVZHQxbEMvaW1mNGRHc2hzM24xVC9yR2xMLzRybmZnTWZ3My9IQWFBZTJxUmR4UzRHOVBhUDN2MVFxOXdXdU9XdFMzTHVKZ0YvZGNOcGZCLzgzVk1uUnpKWnhVK1p0dlN2YjVSNUZmNHpINWFCS2s0QzZBcEJnbU5TUFFQdTN0VGEwU1h6eFlRTDU1ZTkrVW8zbHdOZGVrN2Q0b1l5bnVlVkMzLzF5REdqM0YrQ2lmTVdmeEQrQXdBcTBHMW1JY2cwQnVSeTRYL2QzU3kzNWQ5L1UxTlIwclZCR1liaEI5KzVsTyt6VDc3UTBSbjU5YjlxM04vQTRnL0NmMzh6QUlva2dLNS9POGFBWjdkMXZMaXJTK0tqcks0c2V0OU5UWTcxejV1dlhyUndQay80SDRic0Y3ODc2by83QzhSZENQOTlCWUFJd0VsbWd5VU1Ra1VNa0dJWi8vR1RnM0pQaUh2N3RZc2E2MHVkNlorbHhZbGIzcktFNzdPUFB0Y1c1ZkFmV1k5UzNQMjFCSGtpbTN2Y0R2OTl5UUNJVGdmaTN4WWdIT2FvWVlDVXNMRTlQZnlUM3g2VitEUlR5ZUNUSDFqaFRPZjgyN2N0blRzbnhmSEJrVXp1Qi9jZFVaYk1TWEYvb25GQmNsSkw0TDc3TTV3RkpKUThhazExTFdMQXp4ODh1djlJdjhTSGN0YktxcmM0TVJ1OFpubmxXNjlheVBmWit4NDcxdFdiZ2ZzVGpWOVA1QXNBMUNjQmpqRkF4RW9TQ2ZhVjcrMGJHNU1aVDMzd25hY3ZxQ3V4dWsrbWtvbFAzN3FTN3huMTlJLysvTUZXdWtkbWtmc2ovQWNBNUlUNmZFRUVYZG5US0FZSWhwT3RKd2QvK01BUmlZMVRVcHo0L0VkV001c0g2VzN2WHRZd2ozTXk0OGNQdEl5TVpxa0RmMFh1VDNaN2VPYzdBQkE1Q2FCSkpBUDZrV0VMQTM3NVVPdjJQVDBTSCtqeUpSVWZlYzh5UzN2anBlZld2Zm1LQnI3UEhtd1orTzN2VDlqaS9vS0RSSDN4eDUvd0h4bUFuTDZtdHhDa25nSGNGdk9sNys3cDdaZjU0dmlicmxwNGpZWG5RelF0TFArSC8zRW1keHp6MWUvdERSS1NIdzJkKzl0Vi9FRUdnQ1NBSjZEd2lnSGNZV1pQMytoWHZyZFA3dHNDUHZHK0ZhdE9uMnRSSjV4VGx2ckMzNjB0S2VZY2VqOS84T2lSbVpaK3lqM0t5WGIzUi9nZlVjbnE2cXJ5RXNZWUd4cng0Z2ZuUXBaTUJMdzlVay9rWUNZRHdwQ0ZJVXNrNGwzMHhLbmhJR0RyejZ5U0ZzSWtnc3ZQbi9mY1MrbmVnVEh6dTE4aUVYenBFK3RPUDIwTzM4Y1B0UTdjK1oyOVV6cEVOaHZLWmFvaTl5Y0RRTUI3WFgvY2Y4THpVUUtTbGg3U0pRSEdNb0N2N1BERDN4eDUvcFZPaWZkUVVaNzZ5cWZPbWw5bit1NndSQ0s0OHhQcjFxMm81R3pxWFBqVjcrMmIzQlVvM3VWZ3Uvc1RqVzVYNVNNQWJDd0V5V1VBQlFaaVpKM0o0TTd2N0cwOU9TVHhCdXFxaXIveG1mV045V1htanJSRWNNZnRhODlleFovNi9Paitsa1BIQnZqYVBLTDFPK0QrS1A0QUFMUkpnQU1NMEo0S0RHZXkvL1R2dTNxa1RnaVBNMkQ1a2dvRE8xUnBTZkxPVDZ3N2QzVTE5eFdlZXpuOXM0MHRHZ04vRjl3ZjRmLzBhTXkzT1lCeEZaZ0owTmhYYkdZQWl6TXhNREEwdG1Odjc5VVh6MC9LTzkyenRDUjU5Y1h6RHg4YmJHMGJNcWV6TmRhWC9aOVBuN1dpaVo5TVIwOE8vZU0zZG9haC9ISy9hZTVQQ0lBQTRmOXJtdkI4VHdFUWlRRmFrZ0Q3R1JBZEErbnV6SkhqZzI5NFhiM0UyMGdsZ3lzdXFDOHVUbXpiMVczQ2FZN25yNm41OGlmWDFWVVhjMTloY0RqNzZhL3RTSGRuUWhxRDhzTDlHZVorQVlCcFNnZ2tBUzR4UUNNR2pwNGNha3NQWDNKT25jUjdDQUsyYm5ubCtXdXJYOXJUTXpDa2JXbFFVU3B4Mjd1V2ZlVGR5NHFMRWlKdCtLWHY3Tm01djVmSSt1SCs0MWZPZVZiOEJ3Q2lKUUYrTUlCUkhtaFJFQVBOclFOOUEyTVhuRlVqOTN2cmEwdmU5SWFHVENiMzZzRSs5YW5BT1dkV2YvbVQ2ODViVXkzNDFYZmRlK2locDl0MEJmNmV1TCtIYzc4QXdHdEpnSzVDZ1Q4TUtJaUJ2WWY3aG9hejU2K1Z6SUJVTWpoL2JjMkdDK3RQZG93Y2ExYzBLOURVV1A3eFc1YmYrbzZsYzhwVGdwZjZ5UU10UDN2d0tFbmZzOHI5R1dYeFp6d1FCQUE4QlVBdTFGWUlNcE1CdWpDd3U3bXZwMi8wd3JOcXBYOXBaVVhSaG92cUwxcGYyOVU3ZXVURVVJTHNCelkxbG4vc2I4NzQ2SHZPV0xLd1hQeHE5ejdjK3IxZkg2YXdmcmkvNStIL1pBQUVTNXVXMUZVeXhsaTZsM21yVkRJb01NTVc1di9MTUwvck1mNXJzeWdIWGtidndoRVhrWVJLQnNYMDlUL1hYN2JnRSs5ZlFRZWg5dlRJeGlkUFBQNkhVK2x1YWZGT1dVbHl3MFgxMTEyMlFPS0pGQnMzbi9pUEh4OHdQUENQR24rSXZnTVY3aTlmRTU0UEFPaG5RT0UrNkM0RHBtUGc0dlcxbi8zd0t1NmpjaUpxejZHK3JhOTB2ckN6YTkraC9pRCtWMld6NGJMRmM4NVpWWDN1NnVyejExWVhwV1RlN1VQUHRIMzl2L2RKYjM4RDNaK2g5QThBK0FBQVN4bWdFZ09UU2JDaXFlS0xIMTliTmJkSXdaZG1Sbk1IV3ZvUEhCbG9iUnM2MWpiVTFadnA2aDBkR0J6TGpPV3kyYkM0S0ZGV21pd3JTWmFWSnV0clNoWXRLRnUwb1BTMEJXVXJsODdsZTQ5alFkMjlxZld1ZXc5cHNYNjczQjhBQUFEQUFINEdHSXVCY1JMVTE1VDg2OGZXTEZzOHg1L3VGNGJzVzNjMy8vclJZNFpiUDl6ZkpRRDRQZ2s4V2FTclFpVU1xa0RhbkhEc2NFL3RRcWt3WlAyRFk0OCsxOVk0dit6MFJWNHdZSEFvKzYvLytlcGpXOXBkY1A4QUU3K21DNnVBWmxiaFZhRjZGd1ZGQzZ3Q0puL2tVeThRbXE1c05uejZ4WTcrd2JGelZsY25FeTRmNDNMaytPQS9mSDNuN29OOUVxMmZxT3dqNWZXUGV0MmZlYm51RXdDSW1nUWtFb0tCdkg0R3NKZ01NRFlWWUl6dGFlN2I4bkxuK2pPcnFwVk1DYWpYSTgrMS9jczNYKzNzeVdnSi9CVVgvY25kSCtFL0FDRE9BTkp6NGd4a2dPR3BRRmZ2Nk1QUHRwVVVKMWN2cXd3Y3lnUjYrMGYvN1FmN2Y3YnhxS3lqUFlrQ2YzUGNuNkg0QXdDWXo0Q0NRWXF4RERBV0E5bHMrTWRkWFMvczZGcTFiRzVOWmJFRGZlelpiZWwvK3ZkZGU1cmxsSDNpV2ovY0h3QUFBUEtKZERKQU1RT0lVZ0gxR09qb3pteDY2dVRBME5pcVpYTkZUbGpUcStQdHcxKythKzlQTjdZTWoyUVZXejlINE8rTSt6T1UvZ0dBV0VsQTRja0FTeGhBbWdvb3hrQVlzbGNQOW0xNnVxMjBKTEdpcVNKaFZVbW9mM0RzUi9jZitjcGQrNDdPOUZaM0JkWXZQL0Mzd2YwUi91Y0JBUFlCNUpQZ3pnQW12RG1BUlZ6YUg2MXZ4eDBCSEM4ZlVibGpZTUc4MHZmZXVQaTZ5eGFra3FaallIQW9lLzhUeCsvWjFOby9LT0Y0YWc3cXhUM3kwQ2IzWnlqK3hCWTJnbm5LQVBjd01MKzI1QjNYTGJyaDhvYnlzcVNCL2FlekovT2J4NDgvOFBzVFV0NU1ZSkQxdy8wQkFFOEFVTmpSREdFQVdTcGdQZ2JLU3BMWFhiYmd6VmMyTERWajQxZ1lzbGYyOWZ6MmlSUFBidXVRWWtBS3JGOXU0RytJK3pNR0FBQUExRW1BRWdZd3JlVWdQZ2FvSjhIeUpSWFhYREwveWd2clJkN0NLS0xtMW9ITno1LzYvZlB0YldrSnMycmNjeHg2M1QrUThkTUM0ZjNFQ1A4QkFEREFSd3dFQVZ1NWRPN0ZaOWRldEw1MitaSUs2cW5pb1pIc3p2MjlXMS9wM0xLOXM2MWpXTlpQTU03NjRmNEFBQmhnQndNb1V3RVJERERsUjh0VmxLZldMcTg4YTJYVnlxVVZ5eGJQcWFxUXNLTTRERmxyMjlEK0kzMzdEL2Z2UE5DNy8zQi9OaWR0TTVmQVozaytyTGpzQS9jSEFNQUFzeGlnQlFQcVNmQ25ybDlkdktTeHZMRyt0TEcrZEVGZGFkWGNvcXFLb3NxS1ZGbHBNcFVNaW9vU3lVU1F6WVZqWStGWU5qYzRuQjBZSE9zYkdPdnFIVTEzajNSMFpVNmNHaDQvT0Rvem1wT2Jzb2g5bk5MNjRmN3VBaUNGdG9nN1VBVnRLMkJCZmdaRStZb2dvbVZIL1hmUi8rRU12c09OZ1FrdlVFbUNkSGNtM1oxNWFiY3AzVW40Q2dGdlA3VFQvZW1iMUNzbDBBVFJOUjVXaU93UWp0akxBNG5IUEFReEJuREFPZVNDUUd6WWplOXA4bWZvU3ZtOTNNMGUwSFFlUmU2UFpUOEFBQmpBTTVLbHU0TnNERXgyUnZkZ0lQR25xYkIrSmpsdWdQdWJLWlNBZUJoUWVPdHBoSktLbEZvUUl5Z0hNZDZLME9TS1JDaGMxcGxzR2FHZGcxb3V4a1RUTElKL0hVaHFoMERTNmlLNFB3Q2dqZ0VGWEVrU0E2TFlYd3dHc0JpekFvd1hBMHg0ZXNCZUdGRGtMZ1phUDVNVStNdHlmMHo4QWdCdU1vQkZuaFptTkttQU9BWWtrbUJHVDlHSUJOSlNsWVNTR3MwSEFubU5BL2NIQU1BQU9Rd2dTZ1hFTVNBOUlZaHVORksrVVAyRWhMSFdEL2NIQUNBbkdLQVBBM1FrTU1HNzlmbytxZlhEL2QwVFZnRkpZRURoN2k1cFBBUVVDenFEMkhZaDdsTEJuNFgrSTdFMUF1TEFIKzZQREFEU253ZEVyR3pRcFFKU3NvSHBNVzhZZWpTWTVjS1BlQit3VE91SCt3TUFZSUFRQXhoRk9VZ3JCanlCQVVYR0U5Qi9CdTRQQUVBV000REZ4VURJYVJBU1I2UXpNQ0FxY3dWS1BobkUrSmx3ZndBQURKREhBQmJoMkxoWTVTQkdXUkdpU0FobTgxRERlVUE5c2VHeTljUDlBUUJmR01CVXB3S012aUpFaW9FOERxc1JDU3Juc1FOVm56UXo4SWY3QXdBT01ZQnBLQWN4dm9xUUFBWklTVkRRaGFYdVB0TzJZRW5oSnVCNC94enVEd0JBQmpHQU1acFVRQ3lxVjBrQ2MxeGJzKzl6ZlY1NjRBLzNOMS9ZQjBESWdFampKTnFpNllnbDFJRDAxRSt4TFFDQnBEMEVia3RDS3dXMGV6dWlCLzV3ZndBQURKQVdla1ZuZ01rWUFBa0kyNFRlK2hWUCtjTDlBUUF3SVA2NGlua0VBdi9SOHBKSTRDY01Bcm0rVDFuellkTExQbkIvTTRRNUFCVU1pRG9md0tTdEVHWHhad1VZWDVsZTBxSWZqVk1GNm4xZis3WE10MzY0UHpJQS8vSUFBMUlCL2pmTVNqSzJ3TG5NZ09RWDhWNHJnUHREeUFCMDVRR1JRdkpvYTNRaXJnNkttd3BJeUFha2h2RlQ3TUlLU3dpTXZIVGNqOFlNSFdTV2ZSamU3UVVBdU1xQVNHdjJJek9BUlNzSHNUaDdCVVF4d0FnTE90TU5STHRQQk1aL0I4ZW41UWYrY0g4QUFJckhBS1k1RldEaUZYNzYwbjRlVndtVmZJdkpiQ0cxZmtaUTlvSDdBd0JnQUhrcW9Cb0RUTThrcjYxVENJR2VhNUJZUDl3ZkFJQ21NNEF4Rm1scEVJdXhiVGQ2S2lDQ0FSdEpBTitYYVAxRTdnL3IxeUtzQXRLSmdSaExnK1J1ditRZCtURnZKOEpWUE44U0pxOFJBaVh1SDZPREJYQi9BQUNLd0FDNUswVGpCV2d4ZHc3THg4QVVIL1ROOStWZGpNLzZ0WmQ5NFA1NmhSS1FmZ1pJbnhKZ01XY0ZHRmRGYU1wSWx6T0liVnoxS1JYZWFpNUpXUE5oS1BvREFGQk1CckJZVXdMTU9Bd3dvdHErdlR3SURMMndDZGJQVVBZQkFLQVpVNEdvL2h2blFPZFlrOE9DR0dDa0w0UXhjQmNBc2QxcnRINEUvZ0FBcElFQk1jcEJaS21BTEF5UVczUiswN0YrSTRDY2J6YkUrdUgrQUFCVW1BRXNlamtvZmlyQWh3RUxTR0NZYTF2cSs3R3RuNkhzQXdCQU5La0FZL0pUQVQ0TWlDY0VVNHdDTmtBS0xBT3RINEcvbWNJeVVLTlRnUmdqT1NBZTdYOGV5WUdrL1VwNEp3eEZhd2dzNm9YN0l3T0F6R05BdkhJUWZTckFaTlNGWnJNUlQweENPdmtDb1ZOQ0NkOGNqN0lQQUFDSllpQkdPVWdoQnBpTXVsQWViM0hNTm9qU0haT3RINEUvQUFEcFNBVll2TWxoS1JpUVN3SUhrZ1BTQWxjZ2VrQTA3UXNrRWZnREFKQmxxY0JrWHpDS0JIbjh4NmR0QUpwOEg0RS9BQUFaeFlCNHIzYmgycGNsa2hCUWt5Q2lOWVVLdjh0dzMxZGovWEIvQUFCU3dRREdXTHhVUUJNR1ZKTEFLTDgyeC9kaC9SQUE0RElHNGhtckpneE04YklRTGtGcytpcXRuNkhpRHdCQXVqQVFPeFZnc2VlSHA3aEpLRnhjMFpnV3dQY1IrRU1BZ0lPcEFLT3ZDRWxNQ0daMFBhOTRFSkFjRUEzcmh3QUFqekhBVXhGaW1oT0NHVDNSU1JnRU5QTVNLbjEvNG9mQStnRUF5RGdNOEZTRVpDUUVja2t3bzFkYWg0U0FlQm82WUtKclFybC9GTndmQUlDTVRnVVVZNENPQkxZZ0lWQzE2aWlROHZwZ1dEOEVBQUFEMGpHZ2dBUVJQVmM2SGdLdEMwc0RKdWtRUGxnL0JBQUFBOVFZVUVrQ0EvM2FMTitIOVVNQWdMY1lHTjg4ekk4QmVTVFFCUU5QVFoveGI0ZWJ3Q2ZjSHdDQUhFa0YrQS92bFBlZVg3MXBnUysrRCt1SEFBQ0lCQU95U2VBdER3SkdzaGVBLzZPd2ZnQUFBZ1lVazJDNkd6b01nNEJSN1FVUStqU3NId0NBZ0FGTzM1RyszbWFhbjFtS2hFREJrWFN3ZmdnQWdMZ3h3TGhYQ2xFbUJGR2MxQ2dxQklxUEh4WGZESUFWUGhBQUFESEJCYU96dVJLOXNlVDNYT2w0Q0xTZk1DMXJSU2lzSHdJQW9Ed1lZT0licWVqVEF0UDkya2pmaC9WREFBQlVBQU55RWdJZGFRRk1IeUUvQkFCQWhpVUVnSUZhMDBmSUR3RUFrSGtKQVdCQWFmb0krU0VBQUxJa0laak5CeDAyTHNxSkNZVDhFQUFBcVVzSUdOR1p6Qzd4UU1GT0FQZytCQUJBRHBJZ2o0Y2E2SFdLZHdMQTl5RmhKUmhqNlY3R0dLdXJSR3RBUENRWS94TUViUHlQT3JmTi84ZUJiNXpGOThmL1RMUThPaUVVUytOV1AyNzd5QUFncXB5QTZYMXBWK0JPMjA3R0tod2ZraWdBQUtJaWdVRXdnT2xERUFBQWFVd0xKanNhWUZEUTlPSDdFQUFBdVprV0FBWXdmUWdBZ0h5SEFmdkxNcEVQUElEalF3QUFCRVhpZ2UxSW1MNHNDbzRQR1FlQWRDK3JxMlIxbFg5YUd3UkJodkJnUmlTWVNZVVpsOERDN2lHak5Ia05LRElBeUVva3pFWUZhanprMytVQXI0ZHN6UUFneUFFcVJNUUQwWmRDRUFBQVFhYmpBWUtnY1NYUUJCQUVRYjREQUNjQ1FSQUVPYXdwTThESUFDQUlncEFCUUJBRVFRQUFCRUVRNUIwQU1BMEFRUkRrcEtaUEFDQURnQ0FJUWdZQVFSQUVlUTRBVklFZ0NJSWMwNHoxSDJRQUVBUkJ5QUFnQ0lJZ0FBQlZJQWlDSUdjMFcvMEhHUUFFUVJBeUFBaUNJQWdBWUtnQ1FSQUVPYUU4OVI5a0FCQUVRY2dBa0FSQUVBVDVGUDRqQTRBZ0NFSUdBRUVRQkFFQUUwSVZDSUlneUZJVnJQOGdBNEFnQ0VJR2dDUUFnaURJcC9BZkdRQUVRUkF5QUNRQkVBUkJQb1gveUFBZ0NJS1FBU0FKZ0NBSThpbjhqNTBCZ0FFUUJFR0d1Ny9rRENBNlR5QUlnaUM5aW03WGliZ1hSUklBUVJCa2JQZ2ZLMWpISkRBRVFaQ25pZ2NBSkFFUUJFRnVoUC84R1FBWUFFRVFaSlQ3azJjQURMUEJFQVJCUm9yRG5CUGNYNE1rQUlJZ3lKRHdueTgwNXl3QmdRRVFCRUZXdXo4VFh3VUVCa0FRQkdsMGZ4SHhBd0NUQVJBRVFkb2xZc1VKOFM5R0VnQkJFS1FsL0JjTXhFVkxRR0FBQkVHUWplN1BKTzRFQmdNZ0NJS1V1YjhVU1FBQUpnTWdDSUlVUzRyeEppVGVDcElBQ0lJZ0JlRy9yTEJiV2drSURJQWdDTExJL1puYzAwREJBQWlDSUZ2Y24way9EaG9NZ0NBSXNzTDlHY1g3QU1BQUNJSWc4OTJmRWIwUUJneUFJQWd5M1AwWjNSdkJ3QUFJZ2lDVDNaK1J2aElTRElBZ0NETFcvUm4xTzRIQkFBaUNJRFBkbnlsNEtUd1lBRUVRWktEN3F3REFaQVlBQXhBRVFmbXRYNW43S3dMQTVCOERCa0FRQk9VSi9KbkNBOVlTeW40YkdBQkJFR1NPK3pQR1VpcC80WlJhRUk0UmhTQUkwbUw5cWpNQXBBSVFCRUhtdUw4ZUFJQUJFQVJCMnQyZktTNEJUV2NBeWtFUUJNSDZkU21odHhXUUNrQVFCUGYzRkFCVEdBQU1RQkRrdHZXYjQvNU1Zd2xvT2dQRzJ3VVZJUWlDSEk3NmpmSzNoRGtObE81RlJRaUNJSmZkZjdMTEFRQ3paZ01NRlNFSWdweXdmcU5xUGxPVU1yREpVQkdDSU1pWnFOOWtCMHNaMjN6QUFBUkJzSDVQQVRBYkJrQUNDSUlNOTMxYmJDcGxSY3RPZWFrQUVnSUlnbUQ5dmdCZ1NyTWlJWUFnQ0w3dkZ3RHlKd1FnQVFSQjZuM2ZhdWRKMmZzWXBtOGFBQWtnQ0lMdmV3R0FLQ1FBRENBSWttajZqbGxLeXFXbk5lTkdZZ2ZxZEJBRWFYUjhoNjBqNWVSVG5QeW9wanhSNTVFT1FaQ2cxL3ZqRENubkgvT1VSempqVThlWkV4QUVlUmdMcHZDQUFRQUlndGY3cVJTYUFGMEJnaUEvOWY4QmxseEtNSXUvMm1vQUFBQUFTVVZPUks1Q1lJST0iLCAic2l6ZXMiOiAiNTEyeDUxMiIsICJ0eXBlIjogImltYWdlL3BuZyIsICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSJ9XX0=" />
  <meta name="theme-color" content="#0e0f13" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Mon Budget" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, deleteField }
      from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDi5L92rZkehT514a5-JDqjTdOMc1_Ee8o",
      authDomain: "monbudget-207b8.firebaseapp.com",
      projectId: "monbudget-207b8",
      storageBucket: "monbudget-207b8.firebasestorage.app",
      messagingSenderId: "686570690847",
      appId: "1:686570690847:web:9634102ee6e5481a12f82a",
      measurementId: "G-66CK2ZJB89"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    //  Expose Firebase to app 
    window._fb = { auth, db, doc, getDoc, setDoc, onSnapshot, deleteField, signInWithEmailAndPassword, signOut, onAuthStateChanged };
  </script>

  <!-- React + Babel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    .tabbar-btn { -webkit-tap-highlight-color: transparent !important; -webkit-touch-callout: none; user-select: none; -webkit-appearance: none; appearance: none; color: var(--text-sub); transition: color 0.2s; }
    .tabbar-btn:focus { outline: none; }
    .tabbar-btn:focus-visible { outline: none; }
    .tabbar-btn:active { opacity: 1 !important; background: none !important; color: var(--text-sub) !important; }
    .tabbar-btn.active { color: var(--gold) !important; }
    .tabbar-btn.active:active { color: var(--gold) !important; }

    :root[data-theme="dark"] {
      --bg: #0e0f13; --surface: #16181f; --surface2: #1e2029; --surface3: #252733;
      --border: rgba(255,255,255,0.07); --border2: rgba(255,255,255,0.12);
      --gold: #c9a84c; --gold-light: #e8c96a; --gold-dim: rgba(201,168,76,0.15);
      --green: #4caf82; --green-dim: rgba(76,175,130,0.15);
      --red: #e05c5c;   --red-dim: rgba(224,92,92,0.15);
      --text: #f0ece4;  --text-muted: rgba(240,236,228,0.45); --text-sub: rgba(240,236,228,0.25);
      --header-bg: linear-gradient(160deg, #1a1c25 0%, #12131a 100%);
      --header-text: #f0ece4; --header-muted: rgba(240,236,228,0.45);
      --header-input-bg: rgba(255,255,255,0.08); --header-input-border: rgba(255,255,255,0.12);
      --header-btn-bg: rgba(255,255,255,0.06);   --header-btn-border: rgba(255,255,255,0.15);
      --tab-bg: rgba(14,15,19,0.94); --select-bg: #1e2029; --colorscheme: dark;
      --shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    :root[data-theme="light"] {
      --bg: #f4f2ee; --surface: #ffffff; --surface2: #f0ede8; --surface3: #e8e4de;
      --border: rgba(0,0,0,0.08); --border2: rgba(0,0,0,0.14);
      --gold: #96680e; --gold-light: #b8832a; --gold-dim: rgba(150,104,14,0.10);
      --green: #1e7a48; --green-dim: rgba(30,122,72,0.12);
      --red: #b83232;   --red-dim: rgba(184,50,50,0.10);
      --text: #1c1a16;  --text-muted: rgba(28,26,22,0.52); --text-sub: rgba(28,26,22,0.34);
      --header-bg: linear-gradient(160deg, #2c2a26 0%, #1c1a16 100%);
      --header-text: #f0ece4; --header-muted: rgba(240,236,228,0.5);
      --header-input-bg: rgba(255,255,255,0.08); --header-input-border: rgba(255,255,255,0.15);
      --header-btn-bg: rgba(255,255,255,0.06);   --header-btn-border: rgba(255,255,255,0.18);
      --tab-bg: rgba(244,242,238,0.94); --select-bg: #f0ede8; --colorscheme: light;
      --shadow: 0 4px 20px rgba(0,0,0,0.09);
    }

    :root { --radius: 16px; --radius-sm: 10px; --text-sub: rgba(240,236,228,0.25); --gold: #c9a84c; }
    html, body, #root { height: 100%; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; transition: background 0.3s, color 0.3s; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
    .scroll-row::-webkit-scrollbar { display: none; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; color: var(--text); background: transparent; border: none; outline: none; }
    input::placeholder, textarea::placeholder { color: var(--text-muted); }
    button { cursor: pointer; font-family: 'DM Sans', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }

    @keyframes fadeUp  { from { opacity:0; transform:translateY(14px); } to { opacity:1; transform:translateY(0); } }
    @keyframes slideIn { from { opacity:0; transform:translateX(-10px); } to { opacity:1; transform:translateX(0); } }
    @keyframes scaleIn { from { opacity:0; transform:scale(0.96); } to { opacity:1; transform:scale(1); } }
    @keyframes spin    { to { transform: rotate(360deg); } }
    .fade-up  { animation: fadeUp  0.4s ease both; }
    .slide-in { animation: slideIn 0.3s ease both; }
    .scale-in { animation: scaleIn 0.25s ease both; }
    .spinner  { animation: spin 0.9s linear infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef, createContext, useContext, useCallback } = React;

//  Helpers 
function genId()   { return Math.random().toString(36).slice(2, 10); }
function fmtEur(n) { return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(n||0); }
function fmtDate(s){ return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}); }
function mKey(s)   { return s.slice(0,7); }
function nowMKey() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
}
function isEven(mk){ return parseInt(mk.split("-")[1],10) % 2 === 0; }
function dBack(n)  { const d = new Date(); d.setDate(d.getDate()-n); return d.toISOString().split("T")[0]; }

//  Template variable resolver 
// Supported variables: $month, $Month, $mm, $year / $Year / $yyyy
function resolveTplVars(str, monthK) {
  if (!str || !monthK) return str;
  const [yyyy, mm] = monthK.split("-");
  const date = new Date(Number(yyyy), Number(mm) - 1, 1);
  const monthLower = date.toLocaleDateString("fr-FR", { month: "long" });           // fvrier
  const monthUpper = monthLower.charAt(0).toUpperCase() + monthLower.slice(1);      // Fvrier
  return str
    .replace(/\$Month/g, monthUpper)
    .replace(/\$month/g, monthLower)
    .replace(/\$mm/g,    mm)
    .replace(/\$yyyy/g,  yyyy)
    .replace(/\$Year/g,  yyyy)
    .replace(/\$year/g,  yyyy);
}

//  Default data 
//  UI Feature flags 
// Mettre  false pour revenir  l'ancien comportement (header normal non-sticky)
const COMPACT_STICKY_HEADER = true;

const DEFAULT_CLEANUP_DAY  = 10;
const DEFAULT_AUTO_CLEANUP = true;
const DEFAULT_SAVINGS_HISTORY = [];
const DEFAULT_SAVINGS_SNAP_DAYS   = [1, 15];
const DEFAULT_SAVINGS_SNAP_ACTIVE = true;
const DEFAULT_CARD_DEBIT_DATES = {}; // { [accountId]: { [monthKey]: dateString } }
const DEFAULT_SHOW_FUTURE_TX = true;
const DEFAULT_ACCOUNTS = [
  { id: genId(), name: "Compte courant", type: "checking", balance: 0 },
];
const DEFAULT_TPL = {}; // { [accountId]: { even:{items:[]}, odd:{items:[]} } }
const emptyAcctTpl = () => ({ even: { items: [] }, odd: { items: [] } });
const SAMPLE_TX = [
  { id:"s1",  title:"Salaire",               amount:2800,   type:"income",  date:dBack(1),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s2",  title:"Allocations familiales", amount:320,    type:"income",  date:dBack(5),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s3",  title:"Loyer",                  amount:950,    type:"expense", date:dBack(2),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s4",  title:"Courses",                amount:187.50, type:"expense", date:dBack(3),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s5",  title:"Netflix",                amount:17.99,  type:"expense", date:dBack(4),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
];

//  Demo data 
const DEMO_EMAIL    = "demo@monbudget.fr";
const DEMO_PASSWORD = "Demo1234!";
const DEMO_ACCOUNTS = [
  { id:"da1", name:"Compte courant",   type:"checking", balance:0, cardName:"Visa Premier" },
  { id:"da2", name:"Compte joint",     type:"checking", balance:0 },
  { id:"da3", name:"Livret A",         type:"savings",  balance:8500,    savingsSubtype:"available" },
  { id:"da4", name:"PEL",              type:"savings",  balance:24000,   savingsSubtype:"blocked"   },
  { id:"da5", name:"Assurance vie",    type:"savings",  balance:15750,   savingsSubtype:"blocked"   },
];
const DEMO_TX = [
  // Mois courant  da1
  { id:"dt01", title:"Salaire",          amount:3200,   type:"income",  date:dBack(2),  accountId:"da1", pointed:true  },
  { id:"dt02", title:"Loyer",            amount:1100,   type:"expense", date:dBack(3),  accountId:"da1", pointed:true  },
  { id:"dt03", title:"lectricit",      amount:68,     type:"expense", date:dBack(5),  accountId:"da1", pointed:false },
  { id:"dt04", title:"Courses Leclerc",  amount:143.20, type:"expense", date:dBack(4),  accountId:"da1", pointed:true  },
  { id:"dt05", title:"Courses Lidl",     amount:54.80,  type:"expense", date:dBack(6),  accountId:"da1", pointed:false },
  { id:"dt06", title:"Netflix",          amount:17.99,  type:"expense", date:dBack(7),  accountId:"da1", pointed:true  },
  { id:"dt07", title:"Spotify",          amount:10.99,  type:"expense", date:dBack(7),  accountId:"da1", pointed:false },
  { id:"dt08", title:"Restaurant",       amount:62.50,  type:"expense", date:dBack(8),  accountId:"da1", pointed:false },
  { id:"dt09", title:"Essence",          amount:85,     type:"expense", date:dBack(9),  accountId:"da1", pointed:true  },
  { id:"dt10", title:"Pharmacie",        amount:23.40,  type:"expense", date:dBack(10), accountId:"da1", pointed:false },
  { id:"dt11", title:"Virement pargne", amount:300,    type:"expense", date:dBack(3),  accountId:"da1", pointed:true  },
  // Mois courant  da2
  { id:"dt12", title:"Salaire conjoint", amount:2400,   type:"income",  date:dBack(2),  accountId:"da2", pointed:true  },
  { id:"dt13", title:"Crche",           amount:480,    type:"expense", date:dBack(4),  accountId:"da2", pointed:true  },
  { id:"dt14", title:"Activits enfants",amount:95,     type:"expense", date:dBack(6),  accountId:"da2", pointed:false },
  { id:"dt15", title:"Abonnement salle", amount:29.99,  type:"expense", date:dBack(8),  accountId:"da2", pointed:false },
  { id:"dt16", title:"Remboursement CB", amount:120,    type:"income",  date:dBack(10), accountId:"da2", pointed:false },
  // Mois prcdent  da1
  { id:"dt17", title:"Salaire",          amount:3200,   type:"income",  date:dBack(33), accountId:"da1", pointed:true  },
  { id:"dt18", title:"Loyer",            amount:1100,   type:"expense", date:dBack(34), accountId:"da1", pointed:true  },
  { id:"dt19", title:"Courses",          amount:198.60, type:"expense", date:dBack(35), accountId:"da1", pointed:true  },
  { id:"dt20", title:"EDF",              amount:72,     type:"expense", date:dBack(36), accountId:"da1", pointed:true  },
  { id:"dt21", title:"Mutuelle",         amount:135,    type:"expense", date:dBack(37), accountId:"da1", pointed:true  },
  { id:"dt22", title:"Prime",            amount:500,    type:"income",  date:dBack(38), accountId:"da1", pointed:true  },
  // Mois prcdent  da2
  { id:"dt23", title:"Salaire conjoint", amount:2400,   type:"income",  date:dBack(33), accountId:"da2", pointed:true  },
  { id:"dt24", title:"Crche",           amount:480,    type:"expense", date:dBack(34), accountId:"da2", pointed:true  },
  { id:"dt25", title:"Vacances",         amount:640,    type:"expense", date:dBack(36), accountId:"da2", pointed:true  },
  // Mois courant  da1  oprations carte Visa Premier
  { id:"dt26", title:"Amazon",           amount:67.90,  type:"expense", date:dBack(3),  accountId:"da1", pointed:false, isCard:true },
  { id:"dt27", title:"Fnac",             amount:129.00, type:"expense", date:dBack(5),  accountId:"da1", pointed:false, isCard:true },
  { id:"dt28", title:"Zara",             amount:84.50,  type:"expense", date:dBack(8),  accountId:"da1", pointed:false, isCard:true },
  { id:"dt29", title:"Resto Le Zinc",    amount:48.00,  type:"expense", date:dBack(11), accountId:"da1", pointed:false, isCard:true },
].map(t => ({ ...t, pointed: t.pointed || false }));
// Date de prlvement dmo : le 5 du mois prochain pour le mois courant, le 5 du mois courant pour le mois prcdent
const DEMO_CARD_DEBIT_DATES = (() => {
  const now = new Date();
  const pad = n => String(n).padStart(2,'0');
  const curMk  = `${now.getFullYear()}-${pad(now.getMonth()+1)}`;
  const nextM  = now.getMonth() === 11 ? 0 : now.getMonth()+1;
  const nextY  = now.getMonth() === 11 ? now.getFullYear()+1 : now.getFullYear();
  const nextMk = `${nextY}-${pad(nextM+1)}`;
  const prevM  = now.getMonth() === 0 ? 11 : now.getMonth()-1;
  const prevY  = now.getMonth() === 0 ? now.getFullYear()-1 : now.getFullYear();
  const prevMk = `${prevY}-${pad(prevM+1)}`;
  return {
    da1: {
      [curMk]: `${nextY}-${pad(nextM+1)}-05`,  // prlvement mois courant  le 5 du mois suivant
    }
  };
})();

const DEMO_SAVINGS_HISTORY = [
  { id:"dsh1", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-2); d.setDate(1);  return d.toISOString().split("T")[0]; })(), available:7800,  blocked:37500, auto:true,  note:"" },
  { id:"dsh2", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-2); d.setDate(15); return d.toISOString().split("T")[0]; })(), available:8100,  blocked:37500, auto:true,  note:"" },
  { id:"dsh3", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-1); d.setDate(1);  return d.toISOString().split("T")[0]; })(), available:8300,  blocked:39000, auto:true,  note:"Versement PEL" },
  { id:"dsh4", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-1); d.setDate(15); return d.toISOString().split("T")[0]; })(), available:8500,  blocked:39000, auto:true,  note:"" },
  { id:"dsh5", date: (() => { const d=new Date(); d.setDate(1); return d.toISOString().split("T")[0]; })(),                             available:8500,  blocked:39750, auto:true,  note:"Intrts assurance vie" },
];

//  Firebase helpers 
const fb = () => window._fb;

function fbSubscribe(uid, onData, onError) {
  const { db, doc, onSnapshot } = fb();
  const ref = doc(db, "budgets", uid);
  return onSnapshot(
    ref,
    snap => onData(snap.exists() ? snap.data() : null),
    err  => {
      console.error("[fbSubscribe] Firestore error:", err.code, err.message);
      if (onError) onError(err);
    }
  );
}

async function fbSave(uid, data) {
  const { db, doc, setDoc } = fb();
  await setDoc(doc(db, "budgets", uid), data, { merge: true });
}

//  Auth Context 
const AuthCtx   = createContext(null);
const ThemeCtx  = createContext({ theme:"dark", toggle:()=>{} });
const useTheme  = () => useContext(ThemeCtx);

//  useStore 
function useStore(uid, email) {
  const isDemo = email === DEMO_EMAIL;
  const [ready,        setReady]       = useState(false);
  const [transactions, setTx]          = useState([]);
  const [templates,    setTpl]         = useState(DEFAULT_TPL);
  const [accounts,     setAccounts]    = useState(DEFAULT_ACCOUNTS);
  const [cleanupDay,   setCleanupDay]   = useState(DEFAULT_CLEANUP_DAY);
  const [autoCleanup,  setAutoCleanup]  = useState(DEFAULT_AUTO_CLEANUP);
  const [savingsHistory,    setSavingsHistory]    = useState(DEFAULT_SAVINGS_HISTORY);
  const [savingsSnapDays,   setSavingsSnapDays]   = useState(DEFAULT_SAVINGS_SNAP_DAYS);
  const [savingsSnapActive, setSavingsSnapActive] = useState(DEFAULT_SAVINGS_SNAP_ACTIVE);
  const [cardDebitDates,    setCardDebitDates]    = useState(DEFAULT_CARD_DEBIT_DATES);
  const [showFutureTx,      setShowFutureTx]      = useState(DEFAULT_SHOW_FUTURE_TX);
  const saveTimer = useRef(null);
  const loadedRef = useRef(false);      // true once Firestore first snapshot received
  const lastSaveAt = useRef(0);         // timestamp of last local save, to ignore echo
  const hasReceivedData = useRef(false);// true once we've received a non-null document
  const trustedRef = useRef(false);     // true only after Firestore confirmed real data  persist is blocked until then

  //  Subscribe to Firestore in real-time 
  useEffect(() => {
    if (!uid) return;

    // Reset all safety flags when uid changes (re-mount / auth oscillation on iOS)
    loadedRef.current       = false;
    hasReceivedData.current = false;
    trustedRef.current      = false;

    const unsub = fbSubscribe(uid, data => {
      // Ignore echoes of our own saves (within 8 seconds)
      if (loadedRef.current && Date.now() - lastSaveAt.current < 8000) return;

      if (data) {
        hasReceivedData.current = true;
        trustedRef.current = true; // Firestore confirmed real data  persist is now allowed

        // SAFETY: never fall back to SAMPLE_TX / DEFAULT_ACCOUNTS if the field is simply
        // missing or empty  that would silently overwrite real data on the next persist.
        const safeTx    = Array.isArray(data.transactions) ? data.transactions : [];
        const safeAccts = Array.isArray(data.accounts) && data.accounts.length > 0
                            ? data.accounts
                            : DEFAULT_ACCOUNTS;

        setTx( safeTx.map(t => ({ ...t, pointed: t.pointed || false })) );
        setTpl( (() => {
            const t = data.templates;
            if (!t) return DEFAULT_TPL;
            // Migrate old format { even:{items:[]}, odd:{items:[]} }  per-account
            if (t.even || t.odd) {
              const firstCheckingId = safeAccts.find(a=>a.type==="checking")?.id;
              return firstCheckingId ? { [firstCheckingId]: { even: t.even||{items:[]}, odd: t.odd||{items:[]} } } : DEFAULT_TPL;
            }
            return t;
          })() );
        setAccounts( safeAccts.map(a => ({ ...a, balance: a.balance || 0, savingsSubtype: a.savingsSubtype || "available" })) );
        setCleanupDay(data.cleanupDay || DEFAULT_CLEANUP_DAY);
        setAutoCleanup(data.autoCleanup !== undefined ? data.autoCleanup : DEFAULT_AUTO_CLEANUP);
        setSavingsHistory(data.savingsHistory || DEFAULT_SAVINGS_HISTORY);
        setSavingsSnapDays(data.savingsSnapDays || DEFAULT_SAVINGS_SNAP_DAYS);
        setSavingsSnapActive(data.savingsSnapActive !== undefined ? data.savingsSnapActive : DEFAULT_SAVINGS_SNAP_ACTIVE);
        setCardDebitDates(data.cardDebitDates || DEFAULT_CARD_DEBIT_DATES);
        setShowFutureTx(data.showFutureTx !== undefined ? data.showFutureTx : DEFAULT_SHOW_FUTURE_TX);
        snapDaysRef.current   = data.savingsSnapDays   || DEFAULT_SAVINGS_SNAP_DAYS;
        snapActiveRef.current = data.savingsSnapActive !== undefined ? data.savingsSnapActive : DEFAULT_SAVINGS_SNAP_ACTIVE;

      } else if (!loadedRef.current && !hasReceivedData.current) {
        // Document truly absent (brand new account)  initialise with sample data.
        // SAFETY: double-guard  only runs if we have NEVER received real data from Firestore.
        const initTx      = isDemo ? DEMO_TX      : SAMPLE_TX;
        const initAccts   = isDemo ? DEMO_ACCOUNTS : DEFAULT_ACCOUNTS;
        const initHistory = isDemo ? DEMO_SAVINGS_HISTORY : DEFAULT_SAVINGS_HISTORY;
        const initCdd     = isDemo ? DEMO_CARD_DEBIT_DATES : DEFAULT_CARD_DEBIT_DATES;
        setTx(initTx);
        setAccounts(initAccts);
        setSavingsHistory(initHistory);
        setCardDebitDates(initCdd);
        trustedRef.current = true; // New account  we just wrote the initial data, persist is allowed
        fbSave(uid, { transactions:initTx, templates:DEFAULT_TPL, accounts:initAccts, cleanupDay:DEFAULT_CLEANUP_DAY, autoCleanup:DEFAULT_AUTO_CLEANUP, savingsHistory:initHistory, savingsSnapDays:DEFAULT_SAVINGS_SNAP_DAYS, savingsSnapActive:DEFAULT_SAVINGS_SNAP_ACTIVE, cardDebitDates:initCdd, showFutureTx:DEFAULT_SHOW_FUTURE_TX });

      } else {
        // Document disappeared AFTER we had data  do NOT reinitialise.
        console.warn("[useStore] Firestore returned null after data was loaded  ignoring to protect existing data.");
      }

      if (!loadedRef.current) {
        loadedRef.current = true;
        setReady(true);
      }
    },
    err => {
      // Firestore error (permissions, network)  do NOT reinitialise, just unblock loading
      console.error("[useStore] Firestore subscription error:", err.code);
      if (!loadedRef.current) {
        loadedRef.current = true;
        setReady(true);
        // trustedRef stays false  persist remains blocked
      }
    });
    return () => unsub();
  }, [uid]);

  //  Auto-save to Firestore (debounced 1s) 
  const persist = useCallback((tx, tpl, acct, cd, ac, sh, ssd, ssa, cdd, sft) => {
    // SAFETY: never write to Firestore before we've confirmed real data from the server.
    // This prevents wiping data on iOS PWA reload when Firestore cache is empty.
    if (!uid || !ready || !trustedRef.current) return;
    if (saveTimer.current) clearTimeout(saveTimer.current);
    saveTimer.current = setTimeout(() => {
      // Clean undefined values that Firestore rejects
      const cleanTx = tx.map(t => {
        const clean = {};
        Object.keys(t).forEach(k => { if (t[k] !== undefined) clean[k] = t[k]; });
        return clean;
      });
      lastSaveAt.current = Date.now();
      fbSave(uid, { transactions: cleanTx, templates: tpl, accounts: acct, cleanupDay: cd, autoCleanup: ac, savingsHistory: sh, savingsSnapDays: ssd, savingsSnapActive: ssa, cardDebitDates: cdd, showFutureTx: sft });
    }, 1000);
  }, [uid, ready]);

  //  Auto-cleanup 
  const doCleanup = (cdd) => {
    const currentKey = nowMKey();
    setTx(prev => {
      const filtered = prev.filter(t => {
        if (mKey(t.date) >= currentKey) return true;
        if (t.isCard && t.accountId) {
          const debitDate = cdd[t.accountId]?.[mKey(t.date)];
          if (debitDate && mKey(debitDate) >= currentKey) return true;
        }
        return false;
      });
      return filtered.length !== prev.length ? filtered : prev;
    });
  };

  useEffect(() => {
    // SAFETY: do not run cleanup before Firestore has confirmed real data
    if (!ready || !autoCleanup || !trustedRef.current) return;
    const today = new Date();
    const currentDay = today.getDate();
    if (currentDay >= cleanupDay) {
      doCleanup(cardDebitDates);
    }
  }, [ready, autoCleanup, cleanupDay, cardDebitDates]);

  //  Persist on every state change 
  useEffect(() => { if (ready) persist(transactions, templates, accounts, cleanupDay, autoCleanup, savingsHistory, savingsSnapDays, savingsSnapActive, cardDebitDates, showFutureTx); },
    [transactions, templates, accounts, cleanupDay, autoCleanup, savingsHistory, savingsSnapDays, savingsSnapActive, cardDebitDates, showFutureTx, ready, persist]);

  //  Actions 
  const add    = tx  => setTx(p => [{ ...tx, id:genId(), pointed:false }, ...p]);
  const remove = id  => setTx(p => p.filter(t => t.id !== id));
  const update = (id, u) => setTx(p => p.map(t => {
    if (t.id !== id) return t;
    const updated = { ...t, ...u };
    delete updated._tpl;
    return updated;
  }));
  const togglePointed = id => setTx(p => p.map(t => t.id===id ? {...t,pointed:!t.pointed} : t));

  const addTplItem    = (accountId, parity, item) => setTpl(p => {
    const acct = p[accountId] || emptyAcctTpl();
    return { ...p, [accountId]: { ...acct, [parity]: { items: [...acct[parity].items, {...item, id:genId()}] } } };
  });
  const removeTplItem = (accountId, parity, id) => setTpl(p => {
    const acct = p[accountId] || emptyAcctTpl();
    return { ...p, [accountId]: { ...acct, [parity]: { items: acct[parity].items.filter(i=>i.id!==id) } } };
  });
  const updateTplItem = (accountId, parity, id, updates) => setTpl(p => {
    const acct = p[accountId] || emptyAcctTpl();
    return { ...p, [accountId]: { ...acct, [parity]: { items: acct[parity].items.map(i => i.id===id ? {...i,...updates} : i) } } };
  });
  const applyTemplate = (monthK, accountId) => {
    const parity = isEven(monthK) ? "even" : "odd";
    const acct   = templates[accountId] || emptyAcctTpl();
    const items  = acct[parity].items;
    if (!items.length) return;
    if (transactions.some(t => t._tpl===monthK && t.accountId===accountId)) return;
    setTx(p => [...items.map(item => {
      const day = String(item.day || 1).padStart(2, '0');
      return {
        ...item,
        id:      genId(),
        date:    monthK+"-"+day,
        accountId,
        _tpl:    monthK,
        // Resolve template variables in title and note
        title:   resolveTplVars(item.title, monthK),
        ...(item.note ? { note: resolveTplVars(item.note, monthK) } : {}),
      };
    }), ...p]);
  };

  const addAccount    = ()          => { if (accounts.length>=15) return; setAccounts(p=>[...p,{id:genId(),name:`Nouveau compte ${p.length+1}`,type:"checking",balance:0}]); };
  const removeAccount = id => {
    if (accounts.length<=1) return;
    setAccounts(p => p.filter(a => a.id !== id));
    setTx(p => p.filter(t => t.accountId !== id));
    setTpl(p => { const next = {...p}; delete next[id]; return next; });
    // Explicitly delete the template field in Firestore (merge:true won't delete missing fields)
    const { db, doc, setDoc, deleteField } = fb();
    setDoc(doc(db, "budgets", uid), { templates: { [id]: deleteField() } }, { merge: true });
  };
  const updateAccount = (id,updates)=> setAccounts(p=>p.map(a=>a.id===id?{...a,...updates}:a));
  const moveAccount   = (id, dir) => {
    setAccounts(p => {
      const type  = p.find(a => a.id === id)?.type;
      const group = p.filter(a => a.type === type);
      const rest  = p.filter(a => a.type !== type);
      const idx   = group.findIndex(a => a.id === id);
      const newIdx = idx + dir;
      if (newIdx < 0 || newIdx >= group.length) return p;
      const newGroup = [...group];
      [newGroup[idx], newGroup[newIdx]] = [newGroup[newIdx], newGroup[idx]];
      // Rebuild full array preserving relative positions of the other group
      return p.map(a => {
        if (a.type === type) return newGroup.shift();
        return a;
      });
    });
  };
  const updateCleanupDay  = day  => setCleanupDay(day);
  const updateAutoCleanup = val  => setAutoCleanup(val);
  const cleanupMonth  = () => doCleanup(cardDebitDates);

  //  Card debit dates actions 
  // cardDebitDates: { [accountId]: { [monthKey]: "YYYY-MM-DD" } }
  const setCardDebitDate = (accountId, monthKey, dateStr) => {
    setCardDebitDates(prev => ({
      ...prev,
      [accountId]: { ...(prev[accountId]||{}), [monthKey]: dateStr }
    }));
  };
  const clearCardDebitDate = (accountId, monthKey) => {
    setCardDebitDates(prev => {
      const acct = { ...(prev[accountId]||{}) };
      delete acct[monthKey];
      return { ...prev, [accountId]: acct };
    });
  };

  //  Savings history actions 
  const addSavingsSnapshot = (entry) => setSavingsHistory(p => [{ ...entry, id: genId() }, ...p].sort((a,b) => b.date.localeCompare(a.date)));
  const updateSavingsSnapshot = (id, updates) => setSavingsHistory(p => p.map(e => e.id===id ? {...e,...updates} : e));
  const removeSavingsSnapshot = (id) => setSavingsHistory(p => p.filter(e => e.id !== id));

  const snapDaysRef        = useRef(DEFAULT_SAVINGS_SNAP_DAYS);
  const snapActiveRef      = useRef(DEFAULT_SAVINGS_SNAP_ACTIVE);
  const cardDebitDatesRef  = useRef(DEFAULT_CARD_DEBIT_DATES);
  useEffect(() => { snapDaysRef.current       = savingsSnapDays;   }, [savingsSnapDays]);
  useEffect(() => { snapActiveRef.current     = savingsSnapActive; }, [savingsSnapActive]);
  useEffect(() => { cardDebitDatesRef.current = cardDebitDates;    }, [cardDebitDates]);

  //  Auto-snapshot on configured days 
  // Runs once after Firestore data is fully loaded (loadedRef) to avoid
  // triggering with default values before real config is available.
  useEffect(() => {
    if (!ready || !loadedRef.current) return;
    if (!snapActiveRef.current) return;
    const savingsAccounts = accounts.filter(a => a.type === "savings");
    if (savingsAccounts.length === 0) return;

    const today = new Date();
    const d = today.getDate();
    if (!snapDaysRef.current.includes(d)) return;

    const pad = n => String(n).padStart(2, "0");
    const dateKey = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(d)}`;
    if (savingsHistory.some(e => e.date === dateKey)) return;

    const available = savingsAccounts.filter(a => a.savingsSubtype !== "blocked").reduce((s, a) => s + (a.balance || 0), 0);
    const blocked   = savingsAccounts.filter(a => a.savingsSubtype === "blocked").reduce((s, a) => s + (a.balance || 0), 0);
    addSavingsSnapshot({ date: dateKey, available, blocked, auto: true, note: "" });
  }, [ready]);

  return { ready, transactions, add, remove, update, togglePointed,
    templates, addTplItem, removeTplItem, updateTplItem, applyTemplate,
    accounts, addAccount, removeAccount, updateAccount, moveAccount,
    cleanupDay, updateCleanupDay, autoCleanup, updateAutoCleanup, cleanupMonth,
    savingsHistory, addSavingsSnapshot, updateSavingsSnapshot, removeSavingsSnapshot,
    savingsSnapDays, setSavingsSnapDays, savingsSnapActive, setSavingsSnapActive,
    cardDebitDates, setCardDebitDate, clearCardDebitDate,
    showFutureTx, setShowFutureTx,
    isDemo };
}

//  Magic Word Hash (SHA-256  le mot n'apparat pas en clair) 
const DEMO_MAGIC_HASH = "eef0c396c1a2c19d3119217a759fad0d6ab57465cb9241e80277378bfd970236";

async function hashString(str) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
}

//  Modale Mot Magique 
function MagicWordModal({ onSuccess, onClose }) {
  const [word, setWord]       = useState("");
  const [error, setError]     = useState("");
  const [shaking, setShaking] = useState(false);
  const inputRef              = React.useRef(null);

  React.useEffect(() => { setTimeout(() => inputRef.current?.focus(), 80); }, []);

  const handleCheck = async () => {
    const hash = await hashString(word.trim().toLowerCase());
    if (hash === DEMO_MAGIC_HASH) {
      onSuccess();
    } else {
      setError(" Ce n'est pas le bon mot");
      setShaking(true);
      setTimeout(() => setShaking(false), 500);
      setWord("");
    }
  };

  return (
    <div style={{
      position:"fixed", inset:0, background:"rgba(0,0,0,0.75)", backdropFilter:"blur(4px)",
      display:"flex", alignItems:"center", justifyContent:"center", zIndex:9999, padding:24
    }} onClick={e => e.target===e.currentTarget && onClose()}>
      <div style={{
        background:"var(--surface)", border:"1px solid var(--gold)",
        borderRadius:"var(--radius)", padding:32, maxWidth:360, width:"100%",
        boxShadow:"0 0 40px rgba(212,175,55,0.15)",
        animation: shaking ? "shake 0.4s ease" : "fadeInUp 0.25s ease",
      }}>
        {/* Icne */}
        <div style={{ textAlign:"center", marginBottom:20 }}>
          <div style={{
            display:"inline-flex", alignItems:"center", justifyContent:"center",
            width:64, height:64, borderRadius:"50%",
            background:"linear-gradient(135deg, #2a2208, #3d3010)",
            border:"2px solid var(--gold)", fontSize:28, marginBottom:12
          }}></div>
          <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:22, color:"var(--gold)", margin:0 }}>
            Accs restreint
          </p>
          <p style={{ fontSize:13, color:"var(--text-muted)", marginTop:6, lineHeight:1.5 }}>
            Entrez le mot magique pour accder au mode dmo.
          </p>
        </div>

        {/* Champ */}
        <input
          ref={inputRef}
          type="password"
          value={word}
          onChange={e => { setWord(e.target.value); setError(""); }}
          onKeyDown={e => e.key === "Enter" && handleCheck()}
          placeholder="Mot magique"
          style={{
            width:"100%", fontSize:15, padding:"11px 14px", boxSizing:"border-box",
            background:"var(--surface2)", border:`1px solid ${error ? "var(--red)" : "var(--border)"}`,
            borderRadius:"var(--radius-sm)", color:"var(--text)", marginBottom:8,
            textAlign:"center", letterSpacing:"0.15em"
          }}
        />
        {error && <p style={{ fontSize:12, color:"var(--red)", textAlign:"center", marginBottom:8 }}>{error}</p>}

        {/* Boutons */}
        <div style={{ display:"flex", gap:10, marginTop:4 }}>
          <button onClick={onClose} style={{
            flex:1, padding:"11px", borderRadius:"var(--radius-sm)",
            background:"var(--surface2)", border:"1px solid var(--border)",
            color:"var(--text-muted)", fontSize:14, fontWeight:600, cursor:"pointer"
          }}>Annuler</button>
          <button onClick={handleCheck} style={{
            flex:2, padding:"11px", borderRadius:"var(--radius-sm)",
            background:"linear-gradient(135deg, var(--gold-light), var(--gold))",
            border:"none", color:"#0e0f13", fontSize:14, fontWeight:700, cursor:"pointer"
          }}> Entrer</button>
        </div>
      </div>

      <style>{`
        @keyframes fadeInUp {
          from { opacity:0; transform:translateY(16px); }
          to   { opacity:1; transform:translateY(0); }
        }
        @keyframes shake {
          0%,100% { transform:translateX(0); }
          20%     { transform:translateX(-8px); }
          40%     { transform:translateX(8px); }
          60%     { transform:translateX(-6px); }
          80%     { transform:translateX(6px); }
        }
      `}</style>
    </div>
  );
}

//  Login Screen 
function LoginScreen({ onLogin }) {
  const [email,       setEmail]       = useState("");
  const [password,    setPassword]    = useState("");
  const [error,       setError]       = useState("");
  const [loading,     setLoading]     = useState(false);
  const [demoLoading, setDemoLoading] = useState(false);
  const [showMagic,   setShowMagic]   = useState(false);

  const doLogin = async (credentials) => {
    const em = credentials?.email || email;
    const pw = credentials?.password || password;
    setError("");
    if (credentials) setDemoLoading(true); else setLoading(true);
    try {
      const { auth, signInWithEmailAndPassword } = fb();
      await signInWithEmailAndPassword(auth, em, pw);
    } catch (err) {
      setError("Email ou mot de passe incorrect.");
    } finally {
      setLoading(false); setDemoLoading(false);
    }
  };

  const handleSubmit  = () => doLogin();
  const handleDemo    = () => setShowMagic(true);
  const handleMagicOk = () => {
    setShowMagic(false);
    doLogin({ email: DEMO_EMAIL, password: DEMO_PASSWORD });
  };

  return (
    <>
      {showMagic && <MagicWordModal onSuccess={handleMagicOk} onClose={() => setShowMagic(false)} />}
      <div style={{ minHeight:"100vh", display:"flex", alignItems:"center", justifyContent:"center", padding:24, background:"var(--bg)" }}>
        <div style={{ width:"100%", maxWidth:380 }}>
          <div style={{ textAlign:"center", marginBottom:36 }}>
            <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:38, color:"var(--gold)", letterSpacing:"-0.02em" }}>Mon Budget</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginTop:6 }}>Connectez-vous pour accder  votre budget</p>
          </div>
          <form onSubmit={e=>{e.preventDefault();handleSubmit();}} style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:24, display:"flex", flexDirection:"column", gap:16 }}>
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.07em", display:"block", marginBottom:6 }}>Email</label>
              <input type="email" value={email} onChange={e=>setEmail(e.target.value)}
                placeholder="votre@email.com" autoComplete="email"
                style={{ width:"100%", fontSize:15, padding:"10px 14px", background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", color:"var(--text)" }} />
            </div>
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.07em", display:"block", marginBottom:6 }}>Mot de passe</label>
              <input type="password" value={password} onChange={e=>setPassword(e.target.value)}
                placeholder="" autoComplete="current-password"
                style={{ width:"100%", fontSize:15, padding:"10px 14px", background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", color:"var(--text)" }} />
            </div>
            {error && <p style={{ fontSize:13, color:"var(--red)", textAlign:"center" }}>{error}</p>}
            <button type="submit" disabled={loading || demoLoading} style={{
              padding:"13px", borderRadius:"var(--radius-sm)",
              background: loading ? "var(--surface3)" : "linear-gradient(135deg, var(--gold-light), var(--gold))",
              border:"none", color:"#0e0f13", fontSize:15, fontWeight:700,
              opacity: loading ? 0.7 : 1,
            }}>
              {loading ? "Connexion" : "Se connecter"}
            </button>

            {/* Separator */}
            <div style={{ display:"flex", alignItems:"center", gap:10 }}>
              <div style={{ flex:1, height:1, background:"var(--border)" }} />
              <span style={{ fontSize:11, color:"var(--text-sub)", fontWeight:500 }}>ou</span>
              <div style={{ flex:1, height:1, background:"var(--border)" }} />
            </div>

            {/* Demo button */}
            <button type="button" onClick={handleDemo} disabled={loading || demoLoading} style={{
              padding:"12px", borderRadius:"var(--radius-sm)",
              background:"var(--surface2)", border:"1px solid var(--border)",
              color:"var(--text-muted)", fontSize:14, fontWeight:600,
              opacity: demoLoading ? 0.7 : 1, display:"flex", alignItems:"center", justifyContent:"center", gap:8
            }}>
              <span style={{ fontSize:16 }}></span>
              {demoLoading ? "Chargement" : "Voir la dmo"}
            </button>
          </form>
        </div>
      </div>
    </>
  );
}

//  Loading Screen 
function LoadingScreen() {
  return (
    <div style={{ minHeight:"100vh", display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center", gap:16, background:"var(--bg)" }}>
      <div className="spinner" style={{ width:36, height:36, border:"3px solid var(--border2)", borderTopColor:"var(--gold)", borderRadius:"50%" }} />
      <p style={{ fontSize:14, color:"var(--text-muted)" }}>Chargement</p>
    </div>
  );
}

//  App 
function App() {
  const [user,       setUser]    = useState(undefined); // undefined = checking, null = not logged in
  const [tab,        setTab]     = useState("dashboard");
  const [showForm,   setForm]    = useState(false);
  const [formAccount,setFormAcc] = useState(null);
  const [theme,      setTheme]   = useState(() => localStorage.getItem("budget_theme") || "dark");

  const store = useStore(user?.uid, user?.email);

  const INACTIVITY_LIMIT = (user?.email === DEMO_EMAIL ? 15 * 60 : 8 * 60 * 60) * 1000; // 15min demo, 8h normal
  const ACTIVITY_KEY     = "budget_last_activity";

  // Update last activity timestamp on any user interaction
  useEffect(() => {
    const touch = () => localStorage.setItem(ACTIVITY_KEY, Date.now().toString());
    const events = ["mousedown", "keydown", "touchstart", "scroll", "click"];
    events.forEach(e => window.addEventListener(e, touch, { passive: true }));
    return () => events.forEach(e => window.removeEventListener(e, touch));
  }, []);

  useEffect(() => {
    const { auth, onAuthStateChanged, signOut } = fb();
    return onAuthStateChanged(auth, async u => {
      if (u) {
        // Check inactivity on auth state change (app open / tab focus)
        const last = parseInt(localStorage.getItem(ACTIVITY_KEY) || "0", 10);
        const elapsed = Date.now() - last;
        if (last > 0 && elapsed > INACTIVITY_LIMIT) {
          await signOut(auth);
          localStorage.removeItem(ACTIVITY_KEY);
          return;
        }
        // Record activity on fresh login
        if (!last) localStorage.setItem(ACTIVITY_KEY, Date.now().toString());
      } else {
        localStorage.removeItem(ACTIVITY_KEY);
      }
      setUser(u || null);
    });
  }, []);

  // Also check inactivity when tab regains focus (fixes iOS Safari background freeze)
  useEffect(() => {
    const checkInactivity = async () => {
      if (!user) return;
      try {
        const last = parseInt(localStorage.getItem(ACTIVITY_KEY) || "0", 10);
        if (last > 0 && Date.now() - last > INACTIVITY_LIMIT) {
          const { auth, signOut } = fb();
          await signOut(auth);
          localStorage.removeItem(ACTIVITY_KEY);
        }
      } catch (e) {
        // localStorage may be blocked in iOS private mode  ignore silently
      }
    };

    // iOS Safari: visibilitychange is the most reliable event when returning from background
    const onVisibilityChange = () => {
      if (document.visibilityState === "visible") checkInactivity();
    };

    // Fallback for desktop browsers
    const onFocus = () => checkInactivity();

    // pageshow fires on iOS when navigating back (bfcache restore)  critical for iOS
    const onPageShow = (e) => {
      // e.persisted = true means page was restored from bfcache (common on iOS)
      if (e.persisted) checkInactivity();
    };

    window.addEventListener("focus", onFocus);
    window.addEventListener("pageshow", onPageShow);
    document.addEventListener("visibilitychange", onVisibilityChange);

    return () => {
      window.removeEventListener("focus", onFocus);
      window.removeEventListener("pageshow", onPageShow);
      document.removeEventListener("visibilitychange", onVisibilityChange);
    };
  }, [user, INACTIVITY_LIMIT]);

  useEffect(() => {
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("budget_theme", theme);
  }, [theme]);

  if (user === undefined) return <LoadingScreen />;
  if (user === null)      return (
    <ThemeCtx.Provider value={{ theme, toggle:()=>setTheme(t=>t==="dark"?"light":"dark") }}>
      <LoginScreen />
    </ThemeCtx.Provider>
  );

  if (!store.ready) return <LoadingScreen />;

  const handleOpenForm = (account=null) => { setFormAcc(account); setForm(true); };

  return (
    <ThemeCtx.Provider value={{ theme, toggle:()=>setTheme(t=>t==="dark"?"light":"dark") }}>
      <div style={{ display:"flex", flexDirection:"column", height:"100vh", maxWidth:480, margin:"0 auto", background:"var(--bg)", transition:"background 0.3s" }}>
        {store.isDemo && (
          <div style={{ background:"linear-gradient(90deg,#c9a84c,#e8c96a)", padding:"8px 16px", display:"flex", alignItems:"center", justifyContent:"center", gap:8, zIndex:50 }}>
            <span style={{ fontSize:14 }}></span>
            <p style={{ fontSize:12, fontWeight:700, color:"#0e0f13", letterSpacing:"0.04em" }}>MODE DMO  Les modifications sont visibles par tous les visiteurs</p>
          </div>
        )}
        <div style={{ flex:1, overflowY:"auto", paddingBottom:80 }}>
          {tab==="dashboard"     && <Dashboard    store={store} onAdd={handleOpenForm} onGoSavings={()=>setTab("savingsStats")} />}
          {tab==="transactions"  && <Transactions store={store} onAdd={handleOpenForm} />}
          {tab==="settings"      && <Settings     store={store} user={user} />}
          {tab==="savingsStats"  && <SavingsStats store={store} onBack={()=>setTab("dashboard")} />}
        </div>
        <TabBar tab={tab === "savingsStats" ? "dashboard" : tab} setTab={setTab} />
        {showForm && <FormModal store={store} account={formAccount} onClose={()=>setForm(false)} />}
      </div>
    </ThemeCtx.Provider>
  );
}

//  TabBar 
const TAB_ICONS = {
  dashboard: (
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round">
      <rect x="3" y="3" width="7" height="7" rx="1.5"/>
      <rect x="14" y="3" width="7" height="7" rx="1.5"/>
      <rect x="3" y="14" width="7" height="7" rx="1.5"/>
      <rect x="14" y="14" width="7" height="7" rx="1.5"/>
    </svg>
  ),
  transactions: (
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round">
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="12" x2="21" y2="12"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  ),
  settings: (
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
  ),
};

function TabBar({ tab, setTab }) {
  const tabs = [
    { id:"dashboard",    label:"Tableau"    },
    { id:"transactions", label:"Historique" },
    { id:"settings",     label:"Rglages"   },
  ];
  return (
    <div style={{ position:"fixed", bottom:0, left:"50%", transform:"translateX(-50%)", width:"100%", maxWidth:480, background:"var(--tab-bg)", backdropFilter:"blur(20px)", borderTop:"1px solid var(--border)", display:"flex", justifyContent:"space-around", padding:"10px 0 16px", zIndex:100 }}>
      {tabs.map(t => (
        <button key={t.id} onClick={()=>setTab(t.id)} onTouchStart={()=>{}} className={`tabbar-btn${tab===t.id ? " active" : ""}`} style={{ display:"flex", flexDirection:"column", alignItems:"center", gap:3, background:"none", border:"none", padding:"4px 16px" }}>
          {TAB_ICONS[t.id]}
          <span style={{ fontSize:10, fontWeight:500, letterSpacing:"0.04em" }}>{t.label}</span>
        </button>
      ))}
    </div>
  );
}

//  PageHeader 
function PageHeader({ title, onAdd, children }) {
  if (COMPACT_STICKY_HEADER) {
    return (
      <div style={{
        position:"sticky", top:0, zIndex:50,
        background:"var(--header-bg)",
        backdropFilter:"blur(20px)",
        borderBottom:"1px solid var(--border)",
        padding: children ? "8px 16px 8px" : "8px 16px",
        display:"flex", alignItems:"center", gap:8,
      }}>
        <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:18, letterSpacing:"-0.02em", color:"var(--header-text)", flex:1, margin:0 }}>{title}</p>
        {children && <div style={{ flex:2 }}>{children}</div>}
        {onAdd && (
          <button onClick={onAdd}
            style={{ display:"flex", alignItems:"center", gap:4, padding:"5px 12px", borderRadius:20,
              background:"var(--gold-dim)", border:"1px solid var(--gold)",
              color:"var(--gold)", fontSize:12, fontWeight:600, flexShrink:0 }}>
            <span style={{ fontSize:14, lineHeight:1 }}></span> Ajouter
          </button>
        )}
      </div>
    );
  }
  // Mode original (COMPACT_STICKY_HEADER = false)
  return (
    <div style={{ background:"var(--header-bg)", padding:"16px 20px 18px", borderBottom:"1px solid var(--border)" }}>
      <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:28, letterSpacing:"-0.02em", color:"var(--header-text)", marginBottom:children?14:0 }}>{title}</p>
      {onAdd && !children && (
        <button onClick={onAdd}
          style={{ display:"flex", alignItems:"center", gap:6, padding:"7px 14px", borderRadius:20,
            background:"var(--gold-dim)", border:"1px solid var(--gold)",
            color:"var(--gold)", fontSize:13, fontWeight:600, marginTop:12 }}>
          <span style={{ fontSize:16, lineHeight:1 }}></span> Ajouter
        </button>
      )}
      {children && (
        <div style={{ display:"flex", alignItems:"center", gap:8 }}>
          <div style={{ flex:1 }}>{children}</div>
          {onAdd && (
            <button onClick={onAdd}
              style={{ display:"flex", alignItems:"center", gap:6, padding:"7px 14px", borderRadius:20,
                background:"var(--gold-dim)", border:"1px solid var(--gold)",
                color:"var(--gold)", fontSize:13, fontWeight:600, flexShrink:0, alignSelf:"flex-end" }}>
              <span style={{ fontSize:16, lineHeight:1 }}></span> Ajouter
            </button>
          )}
        </div>
      )}
    </div>
  );
}

//  MonthTabs 
function MonthTabs({ months, selected, onSelect }) {
  return (
    <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2 }}>
      {months.map(m => (
        <button key={m} onClick={()=>onSelect(m)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:selected===m?"var(--gold)":"var(--border)", background:selected===m?"var(--gold-dim)":"var(--surface2)", color:selected===m?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}>
          {new Date(m+"-02").toLocaleDateString("fr-FR",{month:"short",year:"2-digit"})}
        </button>
      ))}
    </div>
  );
}

//  TxRow 
function TxRow({ tx, deletable, onDelete, onEdit, onTogglePointed, clicked, onToggleClicked, delay=0, isCard=false, displayDate=null, accountName=null }) {
  const handleTogglePointed = (e) => {
    e.stopPropagation();
    onTogglePointed();
    onToggleClicked && onToggleClicked(null);
  };
  return (
    <div className="slide-in" onClick={()=>deletable&&onToggleClicked&&onToggleClicked(tx.id)}
      style={{ display:"flex", alignItems:"center", gap:12, padding:"12px 16px", background:clicked?"rgba(128,128,128,0.04)":"transparent", transition:"background 0.15s", animationDelay:`${delay}s`, cursor:deletable?"pointer":"default" }}>
      <div style={{ width:38,height:38, borderRadius:10, flexShrink:0, background:tx.type==="expense"?"var(--red-dim)":"var(--green-dim)", display:"flex", alignItems:"center", justifyContent:"center", fontSize:18, position:"relative" }}>
        {tx.type==="expense"?"":""}
        {tx.pointed && <div style={{ position:"absolute", top:-2, right:-2, width:14, height:14, borderRadius:"50%", background:"var(--gold)", display:"flex", alignItems:"center", justifyContent:"center", fontSize:10, border:"2px solid var(--bg)" }}></div>}
      </div>
      <div style={{ flex:1, minWidth:0 }}>
        <p style={{ fontSize:14, fontWeight:500, whiteSpace:"nowrap", overflow:"hidden", textOverflow:"ellipsis" }}>
          {tx.title}
          {(tx.isCard || isCard) && <span style={{ marginLeft:6, fontSize:10, color:"var(--gold)", background:"rgba(201,168,76,0.12)", padding:"1px 5px", borderRadius:4, fontWeight:600, border:"1px solid rgba(201,168,76,0.25)" }}> carte</span>}
          {tx._transferFrom && <span style={{ marginLeft:6, fontSize:10, color:"var(--green)", background:"var(--green-dim)", padding:"1px 5px", borderRadius:4, fontWeight:600 }}> report</span>}
          {tx._tpl && !tx.pointed && <span style={{ marginLeft:6, fontSize:10, color:"var(--gold)", background:"var(--gold-dim)", padding:"1px 5px", borderRadius:4, fontWeight:600 }}>modle</span>}
        </p>
        <p style={{ fontSize:11, color:"var(--text-sub)", marginTop:1 }}>
          {fmtDate(displayDate || tx.date)}
          {accountName && <span style={{ marginLeft:6, fontSize:10, color:"var(--text-muted)", background:"var(--surface3)", padding:"1px 5px", borderRadius:4, fontWeight:500 }}>{accountName}</span>}
        </p>
      </div>
      <p style={{ fontSize:15, fontWeight:700, flexShrink:0, color:tx.type==="expense"?"var(--red)":"var(--green)" }}>
        {tx.type==="expense"?"":"+"}{fmtEur(tx.amount)}
      </p>
      {deletable && clicked && (
        <>
          {onTogglePointed && <button onClick={handleTogglePointed} style={{ background:tx.pointed?"var(--gold)":"var(--gold-dim)", border:"none", borderRadius:8, width:28,height:28, display:"flex", alignItems:"center", justifyContent:"center", color:tx.pointed?"#0e0f13":"var(--gold)", fontSize:14, flexShrink:0, fontWeight:700 }}></button>}
          {onEdit          && <button onClick={e=>{e.stopPropagation();onEdit();}}   style={{ background:"var(--gold-dim)", border:"none", borderRadius:8, width:28,height:28, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--gold)", fontSize:14, flexShrink:0 }}></button>}
          <button onClick={e=>{e.stopPropagation();onDelete();}} style={{ background:"var(--red-dim)", border:"none", borderRadius:8, width:28,height:28, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--red)", fontSize:14, flexShrink:0 }}></button>
        </>
      )}
    </div>
  );
}

//  DeleteModal 
function DeleteModal({ tx, onCancel, onConfirm }) {
  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
      onClick={e=>e.target===e.currentTarget&&onCancel()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
        <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Supprimer la transaction</p>
        <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
          Voulez-vous vraiment supprimer  {tx.title}  ({fmtEur(tx.amount)}) ?
        </p>
        <div style={{ display:"flex", gap:10 }}>
          <button onClick={onCancel} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
          <button onClick={onConfirm} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>
        </div>
      </div>
    </div>
  );
}

//  CardPanel 
function CardPanel({ account, sel, cardTxM, cardTotal, cardDebitDate, isDebitNextMonth, debitMonthName, store, onAddCard, onEditTx, onDeleteTx, clickedTxId, setClickedTxId }) {
  const [editingDate, setEditingDate] = useState(false);
  const [draftDate,   setDraftDate]   = useState(cardDebitDate || "");
  const [showAllCard, setShowAllCard] = useState(false);
  const CARD_LIMIT = 3;

  // Sync draft when month changes
  useEffect(() => {
    setDraftDate(cardDebitDate || "");
    setEditingDate(false);
  }, [sel, account.id, cardDebitDate]);

  const commitDate = () => {
    if (draftDate) {
      store.setCardDebitDate(account.id, sel, draftDate);
    } else {
      store.clearCardDebitDate(account.id, sel);
    }
    setEditingDate(false);
  };

  const monthLabel = new Date(sel + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" });

  return (
    <div className="fade-up" style={{ background:"var(--surface)", border:"1px solid rgba(201,168,76,0.3)", borderRadius:"var(--radius)", overflow:"hidden" }}>
      {/* Header */}
      <div style={{ display:"flex", alignItems:"center", gap:10, padding:"12px 16px", background:"linear-gradient(90deg, rgba(201,168,76,0.08), transparent)", borderBottom:"1px solid rgba(201,168,76,0.15)" }}>
        <span style={{ fontSize:20 }}></span>
        <div style={{ flex:1 }}>
          <p style={{ fontSize:13, fontWeight:700, color:"var(--gold)" }}>{account.cardName}</p>
          <p style={{ fontSize:11, color:"var(--text-muted)" }}>Carte  dbit diffr  {monthLabel}</p>
        </div>
        {cardTotal > 0 && (
          <div style={{ textAlign:"right" }}>
            <p style={{ fontSize:16, fontWeight:700, color:"var(--red)", fontFamily:"'DM Serif Display',serif" }}>{fmtEur(cardTotal)}</p>
            <p style={{ fontSize:10, color:"var(--text-muted)" }}>{cardTxM.length} dpense{cardTxM.length>1?"s":""}</p>
          </div>
        )}
      </div>

      {/* Debit date row */}
      <div style={{ display:"flex", alignItems:"center", gap:10, padding:"10px 16px", borderBottom:"1px solid var(--border)", background: isDebitNextMonth ? "rgba(224,92,92,0.04)" : "transparent" }}>
        <span style={{ fontSize:14, flexShrink:0 }}>{isDebitNextMonth ? "" : ""}</span>
        <div style={{ flex:1 }}>
          {editingDate ? (
            <div style={{ display:"flex", alignItems:"center", gap:8 }}>
              <input
                type="date"
                value={draftDate}
                onChange={e => setDraftDate(e.target.value)}
                style={{ fontSize:13, padding:"4px 8px", borderRadius:6, border:"1px solid var(--gold)", background:"var(--surface2)", color:"var(--text)", colorScheme:"var(--colorscheme)" }}
              />
              <button onClick={commitDate} style={{ padding:"4px 10px", borderRadius:6, background:"var(--gold)", border:"none", color:"#0e0f13", fontSize:12, fontWeight:700 }}></button>
              <button onClick={()=>setEditingDate(false)} style={{ padding:"4px 8px", borderRadius:6, background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text-muted)", fontSize:12 }}></button>
            </div>
          ) : (
            <div>
              {cardDebitDate ? (
                <span style={{ fontSize:12, color: isDebitNextMonth ? "var(--red)" : "var(--text-muted)" }}>
                  Prlvement prvu le <strong style={{ color: isDebitNextMonth ? "var(--red)" : "var(--text)" }}>{fmtDate(cardDebitDate)}</strong>

                </span>
              ) : (
                <span style={{ fontSize:12, color:"var(--text-sub)", fontStyle:"italic" }}>Date de prlvement non dfinie</span>
              )}
            </div>
          )}
        </div>
        {!editingDate && (
          <button onClick={()=>{ setDraftDate(cardDebitDate||""); setEditingDate(true); }}
            style={{ padding:"4px 10px", borderRadius:6, background:"var(--gold-dim)", border:"1px solid rgba(201,168,76,0.3)", color:"var(--gold)", fontSize:11, fontWeight:600, flexShrink:0 }}>
            {cardDebitDate ? " Modifier" : "+ Dfinir"}
          </button>
        )}
      </div>

      {/* Card transactions */}
      {cardTxM.length > 0 && (
        <div>
          {(showAllCard ? cardTxM : cardTxM.slice(0, CARD_LIMIT)).map((tx, i) => (
            <div key={tx.id}>
              {i > 0 && <div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
              <TxRow
                tx={tx}
                deletable
                clicked={clickedTxId === tx.id}
                onToggleClicked={id => setClickedTxId(clickedTxId === id ? null : id)}
                onDelete={() => onDeleteTx(tx)}
                onEdit={() => onEditTx(tx)}
                onTogglePointed={() => store.togglePointed(tx.id)}
                delay={i * 0.03}
                isCard
              />
            </div>
          ))}
          {cardTxM.length > CARD_LIMIT && (
            <button onClick={() => setShowAllCard(p => !p)}
              style={{ width:"100%", padding:"9px 16px", background:"var(--surface2)", border:"none", borderTop:"1px solid var(--border)", color:"var(--text-muted)", fontSize:12, fontWeight:600, cursor:"pointer", textAlign:"center" }}>
              {showAllCard ? " Voir moins" : ` Voir les ${cardTxM.length - CARD_LIMIT} autres dpenses`}
            </button>
          )}
        </div>
      )}

      {/* Empty state */}
      {cardTxM.length === 0 && (
        <div style={{ padding:"16px", textAlign:"center" }}>
          <p style={{ fontSize:12, color:"var(--text-sub)" }}>Aucune dpense carte ce mois-ci</p>
        </div>
      )}

      {/* Add button */}
      <div style={{ padding:"10px 16px 14px", borderTop: cardTxM.length > 0 ? "1px solid var(--border)" : "none" }}>
        <button onClick={onAddCard} style={{ width:"100%", padding:"9px", borderRadius:"var(--radius-sm)", background:"rgba(201,168,76,0.06)", border:"1px dashed rgba(201,168,76,0.4)", color:"var(--gold)", fontSize:13, fontWeight:600, display:"flex", alignItems:"center", justifyContent:"center", gap:6 }}>
          <span style={{ fontSize:15 }}></span> Dpense carte
        </button>
      </div>
    </div>
  );
}

//  Dashboard 
function SavingsBalanceRow({ account, balance, store }) {
  const [editing, setEditing] = useState(false);
  const [draft,   setDraft]   = useState("");
  const inputRef = useRef(null);

  const startEdit = () => {
    setDraft((account.balance || 0).toString());
    setEditing(true);
    setTimeout(() => { inputRef.current?.select(); }, 0);
  };

  const commit = () => {
    const val = parseFloat(draft.replace(",", "."));
    if (!isNaN(val)) store.updateAccount(account.id, { balance: val });
    setEditing(false);
  };

  const onKeyDown = (e) => {
    if (e.key === "Enter")  commit();
    if (e.key === "Escape") setEditing(false);
  };

  return (
    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 12px", background:"var(--surface2)", borderRadius:"var(--radius-sm)" }}>
      <div style={{ display:"flex", alignItems:"center", gap:8 }}>
        <span style={{ fontSize:13, fontWeight:500 }}>{account.name}</span>
        <span style={{ fontSize:10, fontWeight:600, padding:"2px 6px", borderRadius:6, background:account.savingsSubtype==="blocked"?"var(--red-dim)":"var(--green-dim)", color:account.savingsSubtype==="blocked"?"var(--red)":"var(--green)" }}>
          {account.savingsSubtype==="blocked"?" Bloque":" Disponible"}
        </span>
      </div>
      {editing ? (
        <div style={{ display:"flex", alignItems:"center", gap:6 }}>
          <input ref={inputRef} type="number" step="0.01" value={draft} onChange={e=>setDraft(e.target.value)} onBlur={commit} onKeyDown={onKeyDown}
            inputMode="decimal"
            style={{ width:110, fontSize:14, fontWeight:700, fontFamily:"'DM Serif Display',serif", textAlign:"right",
              padding:"3px 8px", borderRadius:6, border:"1px solid var(--gold)", background:"var(--bg)", color:"var(--gold)",
              outline:"none" }} />
          <button onMouseDown={e=>{e.preventDefault();commit();}}
            style={{ background:"var(--gold-dim)", border:"none", borderRadius:6, width:24, height:24, color:"var(--gold)", fontSize:13, flexShrink:0, cursor:"pointer" }}></button>
        </div>
      ) : (
        <span onClick={startEdit} title="Cliquer pour modifier"
          style={{ fontSize:14, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:balance>=0?"var(--green)":"var(--red)",
            cursor:"pointer", borderBottom:"1px dashed", borderColor:"transparent",
            transition:"border-color 0.15s" }}
          onMouseEnter={e=>e.currentTarget.style.borderColor="currentColor"}
          onMouseLeave={e=>e.currentTarget.style.borderColor="transparent"}>
          {fmtEur(balance)}
        </span>
      )}
    </div>
  );
}

function SynthCardPanel({ entry, sourceTxs, clickedTxId, setClickedTxId, store, onEdit, onDelete }) {
  const LIMIT = 3;
  const [showAll, setShowAll] = useState(false);
  const sortedTxs = [...sourceTxs].sort((a, b) => b.date.localeCompare(a.date));
  const visible = showAll ? sortedTxs : sortedTxs.slice(0, LIMIT);
  return (
    <div className="fade-up" style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>
      <div style={{ display:"flex", alignItems:"center", gap:10, padding:"12px 16px", background:"var(--surface2)", borderBottom:"1px solid var(--border)" }}>
        <span style={{ fontSize:18 }}></span>
        <div style={{ flex:1 }}>
          <p style={{ fontSize:13, fontWeight:600 }}>Prlvement {entry.cardName}</p>
          <p style={{ fontSize:11, color:"var(--text-muted)" }}>Dpenses de {entry.sourceMonthName}  prlev le {fmtDate(entry.debitDateStr)}</p>
        </div>
        <p style={{ fontSize:15, fontWeight:700, color: entry.total >= 0 ? "var(--red)" : "var(--green)" }}>{entry.total >= 0 ? "" : "+"}{fmtEur(Math.abs(entry.total))}</p>
      </div>
      {visible.map((tx, i) => (
        <div key={tx.id}>
          {i > 0 && <div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
          <TxRow
            tx={tx}
            isCard
            deletable
            clicked={clickedTxId === tx.id}
            onToggleClicked={id => setClickedTxId(clickedTxId === id ? null : id)}
            onTogglePointed={() => store.togglePointed(tx.id)}
            onEdit={() => onEdit(tx)}
            onDelete={() => onDelete(tx)}
            delay={i * 0.04}
          />
        </div>
      ))}
      {sortedTxs.length > LIMIT && (
        <button onClick={() => setShowAll(p => !p)}
          style={{ width:"100%", padding:"9px 16px", background:"var(--surface2)", border:"none", borderTop:"1px solid var(--border)", color:"var(--text-muted)", fontSize:12, fontWeight:600, cursor:"pointer", textAlign:"center" }}>
          {showAll ? " Voir moins" : ` Voir les ${sortedTxs.length - LIMIT} autres dpenses`}
        </button>
      )}
    </div>
  );
}

function Dashboard({ store, onAdd, onGoSavings }) {
  const [sel,              setSel]            = useState(nowMKey());
  const [selectedAccountId,setSelectedAccount] = useState("all");
  const [editingTx,        setEditingTx]      = useState(null);
  const [deletingTx,       setDeletingTx]     = useState(null);
  const [clickedTxId,      setClickedTxId]    = useState(null);
  const [cardFormAccount,  setCardFormAccount] = useState(null); // accountId for card add form

  const months = useMemo(() => {
    const today = new Date();
    const Y = today.getFullYear(), M = today.getMonth(), D = today.getDate();
    const fmt = (y,m) => `${y}-${String(m+1).padStart(2,'0')}`;
    const result = [];
    if (!store.autoCleanup || D < store.cleanupDay) {
      const pm = M===0?11:M-1, py = M===0?Y-1:Y;
      const pk = fmt(py,pm);
      const cdd = store.cardDebitDates;
      const currentKey = fmt(Y,M);
      const hasNonDeferredTx = store.transactions.some(t => {
        if (mKey(t.date) !== pk) return false;
        if (t.isCard && t.accountId) {
          const debitDate = cdd[t.accountId]?.[mKey(t.date)];
          if (debitDate && mKey(debitDate) >= currentKey) return false;
        }
        return true;
      });
      if (hasNonDeferredTx) result.push(pk);
    }
    result.push(fmt(Y,M));
    const m1=M===11?0:M+1, y1=M===11?Y+1:Y;
    result.push(fmt(y1,m1));
    const m2=m1===11?0:m1+1, y2=m1===11?y1+1:y1;
    result.push(fmt(y2,m2));
    return result;
  }, [store.cleanupDay, store.autoCleanup, store.transactions, store.cardDebitDates]);

  // Helper: get next month key
  const nextMonthKey = (mk) => {
    const [y, m] = mk.split("-").map(Number);
    const nm = m === 12 ? 1 : m + 1;
    const ny = m === 12 ? y + 1 : y;
    return `${ny}-${String(nm).padStart(2,'0')}`;
  };

  // Separate card transactions from account transactions
  const allTxM = store.transactions.filter(t => mKey(t.date) === sel && (selectedAccountId==="all" || t.accountId === selectedAccountId));
  // Regular (non-card) transactions for the selected month/account
  const txM    = allTxM.filter(t => !t.isCard).sort((a, b) => b.date.localeCompare(a.date));
  // For income/expense display totals: include everything (vision globale)
  const balance = txM.filter(t=>t.type==="income").reduce((s,t)=>s+t.amount,0)
                - txM.filter(t=>t.type==="expense").reduce((s,t)=>s+t.amount,0);

  // For a specific account: get its card info
  const selAcct  = store.accounts.find(a=>a.id===selectedAccountId);
  const hasCard  = selAcct?.type==="checking" && selAcct?.cardName;
  const isSavings = selAcct?.type==="savings";

  // Card transactions for selected account + month
  const cardTxM = hasCard
    ? store.transactions.filter(t => t.isCard && t.accountId === selectedAccountId && mKey(t.date) === sel)
        .sort((a, b) => b.date.localeCompare(a.date))
    : [];
  const cardTotal = cardTxM.reduce((s,t) => s + (t.type==="expense" ? t.amount : -t.amount), 0);

  // Card debit date for this account + month
  const cardDebitDate = hasCard
    ? (store.cardDebitDates[selectedAccountId]?.[sel] || "")
    : "";
  // Determine if card debit is next month
  const isDebitNextMonth = cardDebitDate && mKey(cardDebitDate) !== sel;
  const debitMonthName = cardDebitDate
    ? new Date(cardDebitDate + "T00:00:00").toLocaleDateString("fr-FR", { month: "long" })
    : "";

  // Balance always includes card total (deducted in the month expenses occur)
  const balanceWithCard = balance - cardTotal;

  // Check if a synthetic "Prlvement carte" transaction should appear for this month
  // (i.e., previous month had card transactions with debit date in THIS month)
  const synthCardEntries = useMemo(() => {
    if (selectedAccountId === "all") return [];
    const acct = store.accounts.find(a=>a.id===selectedAccountId);
    if (!acct?.cardName) return [];
    // Look at previous month's card debit dates for this account
    const entries = [];
    // Check all months to see if any debit date falls in 'sel'
    const cdd = store.cardDebitDates[selectedAccountId] || {};
    Object.entries(cdd).forEach(([sourceMk, debitDateStr]) => {
      if (!debitDateStr) return;
      if (mKey(debitDateStr) === sel && sourceMk !== sel) {
        // This month's display should show a synthesis line from sourceMk
        const sourceTxs = store.transactions.filter(t => t.isCard && t.accountId === selectedAccountId && mKey(t.date) === sourceMk);
        const total = sourceTxs.reduce((s,t) => s + (t.type==="expense" ? t.amount : -t.amount), 0);
        if (sourceTxs.length > 0) {
          const sourceMonthName = new Date(sourceMk + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" });
          entries.push({ sourceMk, debitDateStr, total, sourceMonthName, cardName: acct.cardName });
        }
      }
    });
    return entries;
  }, [store.transactions, store.cardDebitDates, store.accounts, selectedAccountId, sel]);

  // synthCardEntries impact the balance of the month where the debit actually occurs
  const synthTotal = synthCardEntries.reduce((s,e) => s + e.total, 0);
  const displayBalance = balanceWithCard - synthTotal;

  // Income/expense display totals: include all transactions + synth card debits

  const expns  = allTxM.filter(t=>t.type==="expense").reduce((s,t)=>s+t.amount,0) + Math.max(0, synthTotal);
  const synthIncome = Math.max(0, -synthTotal); // crdit carte diffr (solde positif)
  const income = allTxM.filter(t=>t.type==="income").reduce((s,t)=>s+t.amount,0) + synthIncome;

  const nextMk = nextMonthKey(sel);
  const nextMonthName = new Date(nextMk + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" });

  // Transfer balance:
  // - Prlvement carte ce mois-ci  carte dj solde  on transfre displayBalance (carte dduite)
  // - Prlvement carte mois suivant  la ligne synthse est dj en nextMk  on transfre AVANT dduction carte
  const cardDebitInNextMonth = hasCard && cardDebitDate && mKey(cardDebitDate) === nextMk;
  const transferBalance = cardDebitInNextMonth ? balance : displayBalance;

  // Check if a transfer transaction already exists for this account+month combo
  const TRANSFER_TAG = "__transfer__";
  const transferExists = selectedAccountId !== "all" && store.transactions.some(
    t => t.accountId === selectedAccountId && t._transferFrom === sel
  );

  const [showTransferConfirm, setShowTransferConfirm] = useState(false);

  const accountBalances = useMemo(() => {
    if (selectedAccountId!=="all") return { checking:[], savings:[] };
    const checking=[], savings=[];
    store.accounts.forEach(acc => {
      if (acc.type==="checking") {
        const at=store.transactions.filter(t=>mKey(t.date)===sel&&t.accountId===acc.id&&!t.isCard);
        const inc=at.filter(t=>t.type==="income").reduce((s,t)=>s+t.amount,0);
        const exp=at.filter(t=>t.type==="expense").reduce((s,t)=>s+t.amount,0);
        // Card expenses always deducted in the month they occur
        const cardExp = acc.cardName
          ? store.transactions.filter(t=>t.isCard&&t.accountId===acc.id&&mKey(t.date)===sel)
              .reduce((s,t)=>s+(t.type==="expense"?t.amount:-t.amount),0)
          : 0;
        // Also subtract synth card debits falling in this month (from previous month's card expenses)
        const acctCdd = store.cardDebitDates[acc.id] || {};
        const acctSynth = Object.entries(acctCdd).reduce((s,[mk,ds]) => {
          if (!ds || mKey(ds)!==sel || mk===sel) return s;
          const txs = store.transactions.filter(t=>t.isCard&&t.accountId===acc.id&&mKey(t.date)===mk);
          return s + txs.reduce((ss,t)=>ss+(t.type==="expense"?t.amount:-t.amount),0);
        }, 0);
        checking.push({account:acc, balance: inc-exp - cardExp - acctSynth });
      } else {
        savings.push({account:acc,balance:acc.balance||0});
      }
    });
    return {checking,savings};
  }, [store.transactions,store.accounts,store.cardDebitDates,sel,selectedAccountId]);

  const checkingBalance = accountBalances.checking.reduce((s,a)=>s+a.balance,0);
  const savingsBalance  = accountBalances.savings.reduce((s,a)=>s+a.balance,0);
  const parity   = isEven(sel) ? "even" : "odd";
  const acctTpl  = (store.templates[selectedAccountId] || emptyAcctTpl());
  const hasTpl   = acctTpl[parity].items.length > 0;
  const applied  = selectedAccountId!=="all" && store.transactions.some(t=>t._tpl===sel&&t.accountId===selectedAccountId);

  const handleTransfer = () => {
    // Remove any existing transfer from this month for this account
    const existing = store.transactions.find(t => t.accountId === selectedAccountId && t._transferFrom === sel);
    if (existing) store.remove(existing.id);
    // Create new transfer transaction in next month
    const day = "01";
    store.add({
      title: `Solde report`,
      amount: Math.round(Math.abs(transferBalance) * 100) / 100,
      type: transferBalance >= 0 ? "income" : "expense",
      accountId: selectedAccountId,
      date: nextMk + "-" + day,
      note: `Report du solde de ${new Date(sel + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" })}`,
      _transferFrom: sel,
    });
    setShowTransferConfirm(false);
  };

  return (
    <div>
      <PageHeader title="Mon Budget" />
      <div style={{ padding:"16px", display:"flex", flexDirection:"column", gap:14 }}>

        {/* Month tabs */}
        <MonthTabs months={months} selected={sel} onSelect={setSel} />

        {/* Account tabs */}
        <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2 }}>
          <button onClick={()=>setSelectedAccount("all")} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:selectedAccountId==="all"?"var(--gold)":"var(--border)", background:selectedAccountId==="all"?"var(--gold-dim)":"var(--surface2)", color:selectedAccountId==="all"?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> Tous les comptes</button>
          {store.accounts.filter(a=>a.type==="checking").map(acc=>(
            <button key={acc.id} onClick={()=>setSelectedAccount(acc.id)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:selectedAccountId===acc.id?"var(--gold)":"var(--border)", background:selectedAccountId===acc.id?"var(--gold-dim)":"var(--surface2)", color:selectedAccountId===acc.id?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> {acc.name}</button>
          ))}
        </div>

        {/* Parity + template */}
        {selectedAccountId!=="all" && !isSavings && (
          <div style={{ display:"flex", alignItems:"center", gap:8, flexWrap:"wrap" }}>
            <span style={{ fontSize:11, fontWeight:600, padding:"3px 10px", borderRadius:20, background:isEven(sel)?"var(--gold-dim)":"var(--green-dim)", color:isEven(sel)?"var(--gold)":"var(--green)", border:`1px solid ${isEven(sel)?"var(--gold)":"var(--green)"}` }}>Mois {isEven(sel)?"pair":"impair"}</span>
            {hasTpl && !applied && <button onClick={()=>store.applyTemplate(sel,selectedAccountId)} style={{ fontSize:11, fontWeight:600, padding:"3px 10px", borderRadius:20, background:"var(--gold-dim)", border:"1px solid var(--gold)", color:"var(--gold)" }}> Appliquer le modle</button>}
            {applied && <span style={{ fontSize:11, color:"var(--text-sub)" }}> Modle appliqu</span>}
          </div>
        )}

        {/* Balance card (individual account) */}
        {selectedAccountId!=="all" && (
          <div className="fade-up" style={{ background:displayBalance>=0?"linear-gradient(135deg,#1e2a1e,#162216)":"linear-gradient(135deg,#2a1e1e,#221616)", border:`1px solid ${displayBalance>=0?"rgba(76,175,130,0.3)":"rgba(224,92,92,0.3)"}`, borderRadius:"var(--radius)", padding:"16px", position:"relative", overflow:"hidden" }}>
            <div style={{ position:"absolute", top:-15, right:-15, width:80, height:80, borderRadius:"50%", background:displayBalance>=0?"rgba(76,175,130,0.06)":"rgba(224,92,92,0.06)" }} />
            <div style={{ display:"flex", alignItems:"flex-start", justifyContent:"space-between", gap:12 }}>
              <div>
                <p style={{ fontSize:11, fontWeight:500, color:"rgba(240,236,228,0.5)", letterSpacing:"0.08em", textTransform:"uppercase", marginBottom:6 }}>Solde {selAcct?.name||""}</p>
                <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:28, color:displayBalance>=0?"#4caf82":"#e05c5c", letterSpacing:"-0.02em" }}>{fmtEur(displayBalance)}</p>
              </div>
              {!isSavings && sel <= nowMKey() && (
                <button
                  onClick={() => setShowTransferConfirm(true)}
                  title={`Reporter le solde vers ${nextMonthName}`}
                  style={{ flexShrink:0, marginTop:2, padding:"6px 11px", borderRadius:8,
                    background: transferExists ? "rgba(201,168,76,0.15)" : "rgba(255,255,255,0.07)",
                    border: transferExists ? "1px solid rgba(201,168,76,0.5)" : "1px solid rgba(255,255,255,0.15)",
                    color: transferExists ? "var(--gold)" : "rgba(240,236,228,0.6)",
                    fontSize:12, fontWeight:600, cursor:"pointer", whiteSpace:"nowrap",
                    display:"flex", alignItems:"center", gap:5 }}>
                  <span style={{ fontSize:14 }}></span>
                  {transferExists ? "Report " : nextMonthName.split(" ")[0]}
                </button>
              )}
            </div>
          </div>
        )}

        {/* All accounts breakdown */}
        {selectedAccountId==="all" && (accountBalances.checking.length>0||accountBalances.savings.length>0) && (
          <div className="fade-up" style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:16, animationDelay:"0.05s" }}>
            {accountBalances.checking.length>0 && <>
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:12 }}>
                <div style={{ display:"flex", alignItems:"center", gap:10 }}><span style={{ fontSize:24 }}></span><p style={{ fontSize:14, fontWeight:600, color:"var(--text)", letterSpacing:"0.04em", textTransform:"uppercase" }}>Comptes courants</p></div>
                <p style={{ fontSize:22, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:checkingBalance>=0?"var(--green)":"var(--red)" }}>{fmtEur(checkingBalance)}</p>
              </div>
              <div style={{ display:"flex", flexDirection:"column", gap:8, marginBottom:accountBalances.savings.length>0?16:0 }}>
                {accountBalances.checking.map(({account,balance})=>(
                  <div key={account.id} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 12px", background:"var(--surface2)", borderRadius:"var(--radius-sm)" }}>
                    <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                      <span style={{ fontSize:13, fontWeight:500 }}>{account.name}</span>
                      {account.cardName && <span style={{ fontSize:10, padding:"1px 6px", borderRadius:4, background:"rgba(201,168,76,0.12)", color:"var(--gold)", fontWeight:600, border:"1px solid rgba(201,168,76,0.25)" }}> {account.cardName}</span>}
                    </div>
                    <span style={{ fontSize:14, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:balance>=0?"var(--green)":"var(--red)" }}>{fmtEur(balance)}</span>
                  </div>
                ))}
              </div>
            </>}
            {accountBalances.savings.length>0 && <>
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:12 }}>
                <div style={{ display:"flex", alignItems:"center", gap:10 }}><span style={{ fontSize:24 }}></span><p style={{ fontSize:14, fontWeight:600, color:"var(--text)", letterSpacing:"0.04em", textTransform:"uppercase" }}>Comptes pargne</p></div>
                <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                  <p style={{ fontSize:22, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:savingsBalance>=0?"var(--green)":"var(--red)" }}>{fmtEur(savingsBalance)}</p>
                  <button onClick={onGoSavings} style={{ padding:"5px 10px", borderRadius:8, background:"var(--gold-dim)", border:"1px solid var(--gold)", color:"var(--gold)", fontSize:11, fontWeight:700, whiteSpace:"nowrap", flexShrink:0 }}> Stats</button>
                </div>
              </div>
              <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
                {accountBalances.savings.map(({account,balance})=>(
                  <SavingsBalanceRow key={account.id} account={account} balance={balance} store={store} />
                ))}
              </div>
            </>}
          </div>
        )}

        {/* Income / Expense (non-card) */}
        <div className="fade-up" style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
          {[{label:"Revenus",val:income,color:"var(--green)",bg:"var(--green-dim)",icon:""},{label:"Dpenses",val:expns,color:"var(--red)",bg:"var(--red-dim)",icon:""}].map(c=>(
            <div key={c.label} style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:"16px" }}>
              <div style={{ display:"flex", alignItems:"center", gap:6, marginBottom:8 }}>
                <span style={{ width:26,height:26, borderRadius:8, background:c.bg, display:"flex", alignItems:"center", justifyContent:"center", fontSize:14, color:c.color, fontWeight:700 }}>{c.icon}</span>
                <span style={{ fontSize:12, color:"var(--text-muted)", fontWeight:500 }}>{c.label}</span>
              </div>
              <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:22, color:c.color }}>{fmtEur(c.val)}</p>
            </div>
          ))}
        </div>

        {/*  Carte  dbit diffr panel  */}
        {hasCard && (
          <CardPanel
            account={selAcct}
            sel={sel}
            cardTxM={cardTxM}
            cardTotal={cardTotal}
            cardDebitDate={cardDebitDate}
            isDebitNextMonth={isDebitNextMonth}
            debitMonthName={debitMonthName}
            store={store}
            onAddCard={() => setCardFormAccount(selectedAccountId)}
            onEditTx={tx => setEditingTx(tx)}
            onDeleteTx={tx => setDeletingTx(tx)}
            clickedTxId={clickedTxId}
            setClickedTxId={setClickedTxId}
          />
        )}

        {/*  Synthetic card debit entries (from previous month)  */}
        {synthCardEntries.map(entry => (
          <SynthCardPanel
            key={entry.sourceMk}
            entry={entry}
            sourceTxs={store.transactions.filter(t => t.isCard && t.accountId === selectedAccountId && mKey(t.date) === entry.sourceMk)}
            clickedTxId={clickedTxId}
            setClickedTxId={setClickedTxId}
            store={store}
            onEdit={tx => setEditingTx(tx)}
            onDelete={tx => setDeletingTx(tx)}
          />
        ))}

        {/* Recent (non-card) */}
        <div className="fade-up">
          <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:10 }}>
            <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", letterSpacing:"0.06em", textTransform:"uppercase" }}>Rcents</p>
            <button onClick={()=>onAdd(selectedAccountId==="all" ? null : selectedAccountId)} style={{ background:"none", border:"none", color:"var(--gold)", fontSize:13, fontWeight:600, padding:0, cursor:"pointer" }}>+ Ajouter</button>
          </div>
          {txM.length===0 ? <EmptyState text="Aucune transaction ce mois-ci" />
            : <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>
                {txM.slice(0,15).map((tx,i)=>(
                  <div key={tx.id}>
                    {i>0&&<div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
                    <TxRow tx={tx} deletable clicked={clickedTxId===tx.id} onToggleClicked={id=>setClickedTxId(clickedTxId===id?null:id)} onDelete={()=>setDeletingTx(tx)} onEdit={()=>setEditingTx(tx)} onTogglePointed={()=>store.togglePointed(tx.id)} delay={i*0.04} accountName={selectedAccountId==="all" ? store.accounts.find(a=>a.id===tx.accountId)?.name : null} />
                  </div>
                ))}
              </div>}
        </div>
      </div>

      {editingTx && <FormModal store={store} transaction={editingTx} onClose={()=>setEditingTx(null)} />}
      {deletingTx && <DeleteModal tx={deletingTx} onCancel={()=>setDeletingTx(null)} onConfirm={()=>{store.remove(deletingTx.id);setDeletingTx(null);}} />}
      {cardFormAccount && <FormModal store={store} account={cardFormAccount} isCardTransaction onClose={()=>setCardFormAccount(null)} />}

      {/* Transfer confirmation modal */}
      {showTransferConfirm && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setShowTransferConfirm(false)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:8 }}>Reporter le solde</p>
            <p style={{ fontSize:13, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
              Une transaction <strong style={{ color: transferBalance>=0 ? "var(--green)" : "var(--red)" }}>
                {transferBalance >= 0 ? "revenu" : "dpense"} de {fmtEur(Math.abs(transferBalance))}
              </strong> sera cre le 1er {nextMonthName} sur le compte <strong>{selAcct?.name}</strong>.
              {transferExists && <span style={{ display:"block", marginTop:8, color:"var(--gold)", fontSize:12 }}> Un report existe dj pour ce mois  il sera remplac.</span>}
            </p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setShowTransferConfirm(false)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              <button onClick={handleTransfer} style={{ flex:2, padding:"10px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:14, fontWeight:700 }}> Confirmer le report</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

//  Transactions 
function Transactions({ store, onAdd }) {
  const [search,        setSearch]      = useState("");
  const [filterType,    setFilter]      = useState("all");
  const [filterAccount, setFilterAcct]  = useState("all");
  const [editingTx,     setEditingTx]   = useState(null);
  const [deletingTx,    setDeletingTx]  = useState(null);
  const [clickedTxId,   setClickedTxId] = useState(null);

  const filtered = useMemo(()=>store.transactions.filter(t=>{
    const q=search.toLowerCase().trim();
    if (q) {
      const matchTitle  = t.title.toLowerCase().includes(q);
      const matchNote   = (t.note||"").toLowerCase().includes(q);
      const matchAmount = String(t.amount).includes(q) || fmtEur(t.amount).toLowerCase().includes(q);
      const dateFr = t.date ? t.date.split("-").reverse().join("/") : "";
      const matchDate   = (t.date||"").includes(q) || dateFr.includes(q);
      if (!matchTitle && !matchNote && !matchAmount && !matchDate) return false;
    }
    if (filterAccount !== "all" && t.accountId !== filterAccount) return false;
    if (!store.showFutureTx && !search.trim()) {
      // Masquer les transactions futures (date strictement > aujourd'hui)
      const today = new Date(); today.setHours(0,0,0,0);
      const txDate = new Date(t.date + "T00:00:00");
      if (txDate > today) return false;
    }
    if (filterType==="card") return !!t.isCard;
    if (filterType==="all") return true;
    return t.type===filterType && !t.isCard;
  }),[store.transactions,search,filterType,filterAccount,store.showFutureTx]);

  const grouped = useMemo(()=>{
    const map={};
    filtered.forEach(tx=>{if(!map[tx.date])map[tx.date]=[];map[tx.date].push(tx);});
    return Object.entries(map).sort((a,b)=>b[0].localeCompare(a[0]));
  },[filtered]);

  // Show card filter button only if any account has a card
  const hasAnyCard = store.accounts.some(a => a.cardName);
  const checkingAccounts = store.accounts.filter(a => a.type === "checking");

  return (
    <div>
      <PageHeader title="Transactions" />
      <div style={{ padding:"12px 16px 0" }}>
        {/* Type filters */}
        <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2, marginBottom:8 }}>
          {[["all","Tout"],["expense","Dpenses"],["income","Revenus"], ...(hasAnyCard ? [["card"," Carte"]] : [])].map(([v,l])=>(
            <button key={v} onClick={()=>setFilter(v)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:filterType===v?"var(--gold)":"var(--border)", background:filterType===v?"var(--gold-dim)":"var(--surface2)", color:filterType===v?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}>{l}</button>
          ))}
        </div>
        {/* Account filters */}
        {checkingAccounts.length > 1 && (
          <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2, marginBottom:8 }}>
            <button onClick={()=>setFilterAcct("all")} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:filterAccount==="all"?"var(--gold)":"var(--border)", background:filterAccount==="all"?"var(--gold-dim)":"var(--surface2)", color:filterAccount==="all"?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> Tous les comptes</button>
            {checkingAccounts.map(acc=>(
              <button key={acc.id} onClick={()=>setFilterAcct(acc.id)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:filterAccount===acc.id?"var(--gold)":"var(--border)", background:filterAccount===acc.id?"var(--gold-dim)":"var(--surface2)", color:filterAccount===acc.id?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> {acc.name}</button>
            ))}
          </div>
        )}
        {/* Search bar */}
        <div style={{ display:"flex", alignItems:"center", gap:8, background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", padding:"9px 14px", marginBottom:0 }}>
          <span style={{ color:"var(--text-muted)", fontSize:16 }}></span>
          <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Titre, montant, date, note" style={{ flex:1, fontSize:14, color:"var(--text)", background:"transparent" }} />
          {search && <button onClick={()=>setSearch("")} style={{ background:"none", border:"none", color:"var(--text-muted)", fontSize:16, cursor:"pointer", padding:0, lineHeight:1 }}></button>}
        </div>
      </div>
      <div style={{ padding:"12px 16px 16px" }}>
        {grouped.length===0 ? <EmptyState text="Aucune transaction trouve" />
          : grouped.map(([date,txs], gi)=>(
            <div key={date} className="slide-in">
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", margin:"14px 0 6px 4px" }}>
                <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em" }}>{fmtDate(date)}</p>
                {gi===0 && <button onClick={()=>onAdd(filterAccount==="all" ? null : filterAccount)} style={{ background:"none", border:"none", color:"var(--gold)", fontSize:13, fontWeight:600, padding:0, cursor:"pointer" }}>+ Ajouter</button>}
              </div>
              <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>
                {txs.map((tx,i)=>(
                  <div key={tx.id}>
                    {i>0&&<div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
                    <TxRow tx={tx} deletable clicked={clickedTxId===tx.id} onToggleClicked={id=>setClickedTxId(clickedTxId===id?null:id)} onDelete={()=>setDeletingTx(tx)} onEdit={()=>setEditingTx(tx)} onTogglePointed={()=>store.togglePointed(tx.id)} accountName={filterAccount==="all" && store.accounts.length > 1 ? store.accounts.find(a=>a.id===tx.accountId)?.name : null} />
                  </div>
                ))}
              </div>
            </div>
          ))}
      </div>
      {editingTx  && <FormModal store={store} transaction={editingTx} onClose={()=>setEditingTx(null)} />}
      {deletingTx && <DeleteModal tx={deletingTx} onCancel={()=>setDeletingTx(null)} onConfirm={()=>{store.remove(deletingTx.id);setDeletingTx(null);}} />}
    </div>
  );
}

//  Settings 
function Settings({ store, user }) {
  const { theme, toggle } = useTheme();
  const checkingAccounts = store.accounts.filter(a => a.type === "checking");
  const [activeParity,       setParity]          = useState("even");
  const [activeAccountId,    setActiveAccountId] = useState(() => checkingAccounts[0]?.id || "");
  const [showAdd,            setShowAdd]          = useState(false);
  const [editingTplItem,     setEditingTplItem]   = useState(null);
  const [editingAccounts,    setEditingAccounts]  = useState(false);
  const [showCleanupConfirm, setShowCleanupConfirm] = useState(false);
  const [cleanupMessage,     setCleanupMessage]   = useState({ text: "", canDelete: false });

  // Keep activeAccountId in sync if accounts change
  React.useEffect(() => {
    if (!checkingAccounts.find(a => a.id === activeAccountId) && checkingAccounts.length > 0) {
      setActiveAccountId(checkingAccounts[0].id);
    }
  }, [store.accounts]);

  const acctTpl     = (store.templates[activeAccountId] || emptyAcctTpl());
  const tpl         = acctTpl[activeParity];
  const totalIncome = tpl.items.filter(i=>i.type==="income").reduce((s,i)=>s+i.amount,0);
  const totalExpense= tpl.items.filter(i=>i.type==="expense").reduce((s,i)=>s+i.amount,0);

  const handleCleanupClick = () => {
    const currentKey = nowMKey();
    const cdd = store.cardDebitDates;
    const toDelete = store.transactions.filter(t => {
      if (mKey(t.date) >= currentKey) return false;
      if (t.isCard && t.accountId) {
        const debitDate = cdd[t.accountId]?.[mKey(t.date)];
        if (debitDate && mKey(debitDate) >= currentKey) return false;
      }
      return true;
    }).length;
    const toKeep = store.transactions.filter(t => {
      if (mKey(t.date) >= currentKey) return false;
      if (t.isCard && t.accountId) {
        const debitDate = cdd[t.accountId]?.[mKey(t.date)];
        if (debitDate && mKey(debitDate) >= currentKey) return true;
      }
      return false;
    }).length;
    const currentName = new Date().toLocaleDateString("fr-FR", { month:"long", year:"numeric" });
    let msg;
    if (toDelete === 0 && toKeep === 0) {
      msg = `Aucune transaction antrieure  ${currentName}.`;
    } else if (toDelete === 0 && toKeep > 0) {
      msg = `Les ${toKeep} transaction(s) du mois prcdent sont des dpenses carte  dbit diffr  elles seront conserves jusqu' ce que leur prlvement soit pass.`;
    } else if (toKeep > 0) {
      msg = `Supprimer ${toDelete} transaction(s) antrieure(s)  ${currentName} ? Les ${toKeep} transaction(s) carte  dbit diffr seront conserves jusqu' leur prlvement.`;
    } else {
      msg = `Supprimer ${toDelete} transaction(s) antrieure(s)  ${currentName} ?`;
    }
    setCleanupMessage({ text: msg, canDelete: toDelete > 0 });
    setShowCleanupConfirm(true);
  };

  const confirmCleanup = () => {
    store.cleanupMonth();
    setShowCleanupConfirm(false);
  };

  const handleLogout = async () => {
    const { auth, signOut } = fb();
    localStorage.removeItem("budget_last_activity");
    await signOut(auth);
  };

  const [resetting, setResetting] = useState(false);
  const handleDemoReset = async () => {
    if (!window.confirm("Rinitialiser les donnes dmo ? Toutes les modifications seront perdues.")) return;
    setResetting(true);
    try {
      const uid = user.uid;
      await fbSave(uid, {
        transactions: DEMO_TX,
        templates: DEFAULT_TPL,
        accounts: DEMO_ACCOUNTS,
        cleanupDay: DEFAULT_CLEANUP_DAY,
        autoCleanup: DEFAULT_AUTO_CLEANUP,
        savingsHistory: DEMO_SAVINGS_HISTORY,
        savingsSnapDays: DEFAULT_SAVINGS_SNAP_DAYS,
        savingsSnapActive: DEFAULT_SAVINGS_SNAP_ACTIVE,
        cardDebitDates: DEMO_CARD_DEBIT_DATES,
      });
      // Reload page to reinitialize store state cleanly
      window.location.reload();
    } catch(e) {
      alert("Erreur lors de la rinitialisation.");
      setResetting(false);
    }
  };

  return (
    <div>
      <PageHeader title="Rglages" />
      <div style={{ padding:"16px", display:"flex", flexDirection:"column", gap:20 }}>

        {/* Apparence */}
        <Section title="Apparence" icon="">
          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"14px 16px" }}>
            <div style={{ display:"flex", alignItems:"center", gap:10 }}>
              <span style={{ fontSize:22 }}>{theme==="dark"?"":""}</span>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>{theme==="dark"?"Mode sombre":"Mode clair"}</p>
                <p style={{ fontSize:12, color:"var(--text-muted)" }}>Thme de l'interface</p>
              </div>
            </div>
            <Toggle checked={theme==="light"} onChange={toggle} />
          </div>
          <div style={{ borderTop:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center", padding:"14px 16px" }}>
            <div style={{ display:"flex", alignItems:"center", gap:10 }}>
              <span style={{ fontSize:22 }}></span>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>Transactions futures dans l'historique</p>
                <p style={{ fontSize:12, color:"var(--text-muted)" }}>
                  {store.showFutureTx ? "Affiches  toutes les transactions apparaissent" : "Masques  seules les transactions passes et du jour apparaissent"}
                </p>
              </div>
            </div>
            <Toggle checked={store.showFutureTx} onChange={()=>store.setShowFutureTx(!store.showFutureTx)} />
          </div>
        </Section>

        {/* Comptes */}
        <Section title="Comptes bancaires" icon="">
          <div style={{ padding:"14px 16px" }}>
            <p style={{ fontSize:12, color:"var(--text-muted)", marginBottom:12, lineHeight:1.6 }}>
              Grez vos comptes (max. 15). Les soldes pargne  sont saisis manuellement.
            </p>
            <div style={{ display:"flex", flexDirection:"column", gap:10, marginBottom:12 }}>
              {/* Comptes courants */}
              {store.accounts.filter(a=>a.type==="checking").length > 0 && editingAccounts && (
                <p style={{ fontSize:10, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em" }}> Comptes courants</p>
              )}
              {store.accounts.filter(a=>a.type==="checking").map((acc)=>(
                <AccountRow key={acc.id} acc={acc} store={store} editingAccounts={editingAccounts} />
              ))}
              {/* Comptes pargne */}
              {store.accounts.filter(a=>a.type==="savings").length > 0 && editingAccounts && (
                <p style={{ fontSize:10, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em", marginTop:4 }}> Comptes pargne</p>
              )}
              {store.accounts.filter(a=>a.type==="savings").map((acc)=>(
                <AccountRow key={acc.id} acc={acc} store={store} editingAccounts={editingAccounts} />
              ))}
            </div>
            {!editingAccounts ? (
              <button onClick={()=>setEditingAccounts(true)} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--gold-dim)", border:"1px solid var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600 }}> Modifier les comptes</button>
            ) : (
              <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
                {store.accounts.length<15 && (
                  <button onClick={()=>store.addAccount()} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--green-dim)", border:"1px dashed var(--green)", color:"var(--green)", fontSize:13, fontWeight:600 }}>+ Ajouter un compte ({store.accounts.length}/15)</button>
                )}
                <button onClick={()=>setEditingAccounts(false)} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:14, fontWeight:700 }}> Terminer</button>
              </div>
            )}
          </div>
        </Section>

        {/* Modles */}
        <Section title="Modles rcurrents" icon="">
          <div style={{ padding:"12px 16px 8px", borderBottom:"1px solid var(--border)" }}>
            <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.6 }}>Oprations rcurrentes par compte, pour les mois pairs et impairs.</p>
          </div>

          {/* Slecteur de compte */}
          {checkingAccounts.length > 1 && (
            <div style={{ display:"flex", gap:6, overflowX:"auto", padding:"10px 16px", borderBottom:"1px solid var(--border)" }}>
              {checkingAccounts.map(acc => (
                <button key={acc.id} onClick={()=>setActiveAccountId(acc.id)} style={{ flexShrink:0, padding:"5px 13px", borderRadius:20, border:"1px solid", borderColor:activeAccountId===acc.id?"var(--gold)":"var(--border)", background:activeAccountId===acc.id?"var(--gold-dim)":"var(--surface2)", color:activeAccountId===acc.id?"var(--gold)":"var(--text-muted)", fontSize:12, fontWeight:600 }}> {acc.name}</button>
              ))}
            </div>
          )}

          {/* Slecteur pair/impair */}
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8, padding:"12px 16px" }}>
            {[["even","Mois pairs","2,4,6"],["odd","Mois impairs","1,3,5"]].map(([k,l,sub])=>(
              <button key={k} onClick={()=>setParity(k)} style={{ padding:"10px 12px", borderRadius:"var(--radius-sm)", border:"1px solid", borderColor:activeParity===k?"var(--gold)":"var(--border)", background:activeParity===k?"var(--gold-dim)":"var(--surface2)", textAlign:"left" }}>
                <p style={{ fontSize:13, fontWeight:600, color:activeParity===k?"var(--gold)":"var(--text)" }}>{l}</p>
                <p style={{ fontSize:11, color:"var(--text-muted)", marginTop:2 }}>{sub}</p>
              </button>
            ))}
          </div>

          {/* Totaux */}
          {(totalIncome>0||totalExpense>0) && (
            <div style={{ display:"flex", gap:8, padding:"0 16px 10px" }}>
              {totalIncome>0  && <span style={{ fontSize:11, padding:"3px 8px", borderRadius:12, background:"var(--green-dim)", color:"var(--green)", fontWeight:600 }}> {fmtEur(totalIncome)}</span>}
              {totalExpense>0 && <span style={{ fontSize:11, padding:"3px 8px", borderRadius:12, background:"var(--red-dim)",   color:"var(--red)",   fontWeight:600 }}> {fmtEur(totalExpense)}</span>}
              <span style={{ fontSize:11, padding:"3px 8px", borderRadius:12, background:"var(--surface2)", color:"var(--text-muted)", fontWeight:600 }}>{fmtEur(totalIncome-totalExpense)} net</span>
            </div>
          )}

          {/* Lignes du modle */}
          {checkingAccounts.length === 0
            ? <p style={{ padding:"12px 16px", fontSize:13, color:"var(--text-sub)", textAlign:"center" }}>Aucun compte courant configur</p>
            : tpl.items.length===0
              ? <p style={{ padding:"12px 16px", fontSize:13, color:"var(--text-sub)", textAlign:"center" }}>Aucune opration rcurrente</p>
              : <div>{tpl.items.map((item,i)=>(
                  <div key={item.id}>
                    {i>0&&<div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
                    <TplItemRow item={item} onDelete={()=>store.removeTplItem(activeAccountId, activeParity, item.id)} onEdit={()=>setEditingTplItem({item, parity: activeParity})} />
                  </div>
                ))}</div>
          }

          {/* Bouton ajouter */}
          {checkingAccounts.length > 0 && (
            <div style={{ padding:"10px 16px 14px" }}>
              <button onClick={()=>setShowAdd(true)} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--gold-dim)", border:"1px dashed var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600 }}>+ Ajouter une opration rcurrente</button>
            </div>
          )}
        </Section>

        {/* Nettoyage */}
        <Section title="Nettoyage automatique" icon="">
          <div style={{ padding:"14px 16px" }}>
            {/* Toggle activation */}
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:14 }}>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>Nettoyage automatique</p>
                <p style={{ fontSize:12, color:"var(--text-muted)", marginTop:2 }}>
                  {store.autoCleanup ? "Actif  les transactions des mois passs sont supprimes automatiquement" : "Inactif  aucune suppression automatique"}
                </p>
              </div>
              <Toggle checked={store.autoCleanup} onChange={()=>store.updateAutoCleanup(!store.autoCleanup)} />
            </div>

            {/* Slecteur de jour (gris si dsactiv) */}
            <div style={{ opacity: store.autoCleanup ? 1 : 0.4, pointerEvents: store.autoCleanup ? "auto" : "none", transition:"opacity 0.2s" }}>
              <div style={{ display:"flex", alignItems:"center", gap:12, marginBottom:12 }}>
                <div style={{ flex:1 }}>
                  <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:6 }}>Jour de nettoyage</p>
                  <select value={store.cleanupDay} onChange={e=>store.updateCleanupDay(parseInt(e.target.value,10))}
                    style={{ fontSize:15, fontWeight:500, width:"100%", padding:"10px 12px", background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", color:"var(--text)" }}>
                    {Array.from({length:31},(_,i)=>i+1).map(d=>(
                      <option key={d} value={d} style={{ background:"var(--select-bg)" }}>{d===1?"1er":d} du mois</option>
                    ))}
                  </select>
                </div>
                <div style={{ padding:"12px 16px", background:"var(--gold-dim)", border:"1px solid var(--gold)", borderRadius:"var(--radius-sm)", textAlign:"center" }}>
                  <p style={{ fontSize:10, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:2 }}>Actuel</p>
                  <p style={{ fontSize:24, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--gold)" }}>{store.cleanupDay}</p>
                </div>
              </div>
              {(store.cleanupDay === 29 || store.cleanupDay === 30) && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginBottom:12 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le nettoyage automatique pourrait ne pas fonctionner en fvrier, qui ne compte pas de jour {store.cleanupDay}.
                  </p>
                </div>
              )}
              {store.cleanupDay === 31 && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginBottom:12 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le nettoyage automatique pourrait ne pas fonctionner certains mois  avril, juin, septembre, novembre et fvrier ne comptent pas de 31e jour.
                  </p>
                </div>
              )}
            </div>

            <button onClick={handleCleanupClick} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:13, fontWeight:600 }}>
               Nettoyer les mois prcdents maintenant
            </button>
          </div>
        </Section>

        {/* Snapshots pargne */}
        <Section title="Snapshots pargne" icon="">
          <div style={{ padding:"14px 16px" }}>
            {/* Toggle activation */}
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:16 }}>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>Snapshots automatiques</p>
                <p style={{ fontSize:12, color:"var(--text-muted)", marginTop:2 }}>
                  {store.savingsSnapActive ? "Actifs  l'pargne est enregistre automatiquement" : "Inactifs  aucun snapshot automatique"}
                </p>
              </div>
              <Toggle checked={store.savingsSnapActive} onChange={()=>store.setSavingsSnapActive(!store.savingsSnapActive)} />
            </div>

            {/* Slecteur des jours */}
            <div style={{ opacity: store.savingsSnapActive ? 1 : 0.4, pointerEvents: store.savingsSnapActive ? "auto" : "none", transition:"opacity 0.2s" }}>
              <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:10 }}>
                Jours de snapshot  {store.savingsSnapDays.length} slectionn{store.savingsSnapDays.length > 1 ? "s" : ""}
              </p>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(7, 1fr)", gap:5 }}>
                {Array.from({length:31}, (_,i) => i+1).map(day => {
                  const selected = store.savingsSnapDays.includes(day);
                  const toggle   = () => {
                    if (selected) {
                      store.setSavingsSnapDays(store.savingsSnapDays.filter(d => d !== day));
                    } else {
                      store.setSavingsSnapDays([...store.savingsSnapDays, day].sort((a,b)=>a-b));
                    }
                  };
                  return (
                    <button key={day} onClick={toggle}
                      style={{ padding:"7px 2px", borderRadius:7, border:"1px solid", fontSize:12, fontWeight:600, textAlign:"center",
                        borderColor: selected ? "var(--gold)" : "var(--border)",
                        background:  selected ? "var(--gold-dim)" : "var(--bg)",
                        color:       selected ? "var(--gold)" : "var(--text-muted)",
                        transition:  "all 0.15s" }}>
                      {day}
                    </button>
                  );
                })}
              </div>
              {store.savingsSnapDays.some(d => d === 29 || d === 30) && !store.savingsSnapDays.includes(31) && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginTop:10 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le snapshot automatique du {store.savingsSnapDays.filter(d => d === 29 || d === 30).join(" et du ")} pourrait ne pas se dclencher en fvrier.
                  </p>
                </div>
              )}
              {store.savingsSnapDays.includes(31) && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginTop:10 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le snapshot automatique du 31 pourrait ne pas se dclencher certains mois  avril, juin, septembre, novembre et fvrier ne comptent pas de 31e jour.
                    {store.savingsSnapDays.some(d => d === 29 || d === 30) && ` Les jours ${store.savingsSnapDays.filter(d => d === 29 || d === 30).join(" et ")} pourraient galement ne pas se dclencher en fvrier.`}
                  </p>
                </div>
              )}
            </div>
          </div>
        </Section>

        {/* Donnes */}
        <Section title="Donnes" icon="">
          <div style={{ padding:"14px 16px" }}>
            <p style={{ fontSize:13, color:"var(--text-muted)", marginBottom:4 }}>{store.transactions.length} transactions  synchronises sur Firebase</p>
            <p style={{ fontSize:12, color:"var(--text-sub)", marginBottom:12 }}>Connect en tant que {user.email}</p>
            {store.isDemo && (
              <button onClick={handleDemoReset} disabled={resetting}
                style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"rgba(201,168,76,0.1)", border:"1px solid var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600, marginBottom:10, opacity: resetting ? 0.6 : 1 }}>
                {resetting ? " Rinitialisation" : " Rinitialiser les donnes dmo"}
              </button>
            )}
            <button onClick={handleLogout} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:13, fontWeight:600 }}>
               Se dconnecter
            </button>
          </div>
        </Section>
      </div>

      {showAdd && <TplAddModal onClose={()=>setShowAdd(false)} onSave={item=>{store.addTplItem(activeAccountId, activeParity, item);setShowAdd(false);}} />}
      {editingTplItem && <TplAddModal item={editingTplItem.item} onClose={()=>setEditingTplItem(null)} onSave={updates=>{store.updateTplItem(activeAccountId, editingTplItem.parity, editingTplItem.item.id, updates);setEditingTplItem(null);}} />}

      {showCleanupConfirm && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setShowCleanupConfirm(false)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Confirmation</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>{cleanupMessage.text}</p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setShowCleanupConfirm(false)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              {cleanupMessage.canDelete && <button onClick={confirmCleanup} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

//  Small components 
function Section({ title, icon, children }) {
  return (
    <div>
      <div style={{ display:"flex", alignItems:"center", gap:6, marginBottom:8 }}>
        <span style={{ fontSize:14 }}>{icon}</span>
        <p style={{ fontSize:12, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em" }}>{title}</p>
      </div>
      <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>{children}</div>
    </div>
  );
}

function Toggle({ checked, onChange }) {
  return (
    <button onClick={onChange} style={{ width:48,height:26, borderRadius:13, background:checked?"var(--gold)":"var(--surface3)", border:"none", position:"relative", transition:"background 0.25s", flexShrink:0 }}>
      <div style={{ width:20,height:20, borderRadius:"50%", background:"#fff", position:"absolute", top:3, left:checked?25:3, transition:"left 0.25s", boxShadow:"0 1px 4px rgba(0,0,0,0.3)" }} />
    </button>
  );
}

//  AccountRow 
function AccountRow({ acc, store, editingAccounts }) {
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const sameType  = store.accounts.filter(a => a.type === acc.type);
  const idx       = sameType.findIndex(a => a.id === acc.id);
  const isFirst   = idx === 0;
  const isLast    = idx === sameType.length - 1;
  const canDelete = store.accounts.length > 1;
  const txCount   = store.transactions.filter(t => t.accountId === acc.id).length;

  const handleDeleteClick = () => {
    if (!canDelete) return;
    if (txCount > 0) { setShowDeleteConfirm(true); }
    else { store.removeAccount(acc.id); }
  };

  return (
    <div style={{ background:"var(--surface2)", borderRadius:"var(--radius-sm)", padding:"12px 14px" }}>
      {!editingAccounts ? (
        <div style={{ display:"flex", alignItems:"center", gap:10 }}>
          <span style={{ fontSize:20 }}>{acc.type==="savings"?"":""}</span>
          <div style={{ flex:1 }}>
            <p style={{ fontSize:14, fontWeight:500 }}>{acc.name}</p>
            <p style={{ fontSize:11, color:"var(--text-muted)" }}>
              {acc.type==="savings"
                ? (acc.savingsSubtype==="blocked" ? " Bloque  " : " Disponible  ") + fmtEur(acc.balance)
                : "Compte courant"}
            </p>
          </div>
        </div>
      ) : (
        <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
          {/* Nom + boutons ordre + supprimer */}
          <div style={{ display:"flex", gap:6 }}>
            <input value={acc.name} onChange={e=>store.updateAccount(acc.id,{name:e.target.value})} placeholder="Nom du compte"
              style={{ flex:1, fontSize:14, padding:"8px 10px", background:"var(--bg)", border:"1px solid var(--border)", borderRadius:8, color:"var(--text)" }} />
            {/* Boutons dplacement (uniquement si plusieurs comptes du mme type) */}
            {sameType.length > 1 && (
              <div style={{ display:"flex", flexDirection:"column", gap:3 }}>
                <button onClick={()=>store.moveAccount(acc.id,-1)} disabled={isFirst}
                  style={{ padding:"3px 8px", borderRadius:6, background:"var(--surface3)", border:"1px solid var(--border)", color:isFirst?"var(--text-sub)":"var(--text)", fontSize:12, opacity:isFirst?0.3:1, lineHeight:1 }}></button>
                <button onClick={()=>store.moveAccount(acc.id,1)} disabled={isLast}
                  style={{ padding:"3px 8px", borderRadius:6, background:"var(--surface3)", border:"1px solid var(--border)", color:isLast?"var(--text-sub)":"var(--text)", fontSize:12, opacity:isLast?0.3:1, lineHeight:1 }}></button>
              </div>
            )}
            <button onClick={handleDeleteClick} disabled={!canDelete}
              style={{ padding:"8px 12px", borderRadius:8, background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:13, fontWeight:600, opacity:canDelete?1:0.4, alignSelf:"stretch" }}></button>
          </div>
          {/* Type courant / pargne */}
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6 }}>
            {[["checking"," Courant"],["savings"," pargne"]].map(([type,label])=>(
              <button key={type} onClick={()=>store.updateAccount(acc.id,{type})}
                style={{ padding:"8px", borderRadius:8, border:"1px solid", borderColor:acc.type===type?"var(--gold)":"var(--border)", background:acc.type===type?"var(--gold-dim)":"var(--bg)", color:acc.type===type?"var(--gold)":"var(--text-muted)", fontSize:12, fontWeight:600 }}>{label}</button>
            ))}
          </div>
          {/* Sous-type pargne (disponible / bloque) */}
          {acc.type==="savings" && (
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6 }}>
              <button onClick={()=>store.updateAccount(acc.id,{savingsSubtype:"available"})}
                style={{ padding:"8px", borderRadius:8, border:"1px solid", borderColor:(acc.savingsSubtype||"available")==="available"?"var(--green)":"var(--border)", background:(acc.savingsSubtype||"available")==="available"?"var(--green-dim)":"var(--bg)", color:(acc.savingsSubtype||"available")==="available"?"var(--green)":"var(--text-muted)", fontSize:12, fontWeight:600 }}> Disponible</button>
              <button onClick={()=>store.updateAccount(acc.id,{savingsSubtype:"blocked"})}
                style={{ padding:"8px", borderRadius:8, border:"1px solid", borderColor:acc.savingsSubtype==="blocked"?"var(--red)":"var(--border)", background:acc.savingsSubtype==="blocked"?"var(--red-dim)":"var(--bg)", color:acc.savingsSubtype==="blocked"?"var(--red)":"var(--text-muted)", fontSize:12, fontWeight:600 }}> Bloque</button>
            </div>
          )}
          {/* Carte  dbit diffr (comptes courants uniquement) */}
          {acc.type==="checking" && (
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.06em", display:"block", marginBottom:4 }}> Carte  dbit diffr</label>
              <div style={{ display:"flex", gap:6, alignItems:"center" }}>
                <input
                  value={acc.cardName||""}
                  onChange={e=>store.updateAccount(acc.id,{cardName:e.target.value})}
                  placeholder="Nom de la carte (ex: Visa SG)  laisser vide si aucune"
                  style={{ flex:1, fontSize:13, padding:"8px 10px", background:"var(--bg)", border:"1px solid var(--border)", borderRadius:8, color:"var(--text)" }}
                />
                {acc.cardName && (
                  <button onClick={()=>store.updateAccount(acc.id,{cardName:""})}
                    style={{ padding:"7px 10px", borderRadius:8, background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:12, fontWeight:600, whiteSpace:"nowrap" }}>
                     Retirer
                  </button>
                )}
              </div>
              {acc.cardName && <p style={{ fontSize:11, color:"var(--text-sub)", marginTop:4 }}>Les dpenses carte apparatront dans un panneau ddi sur le tableau de bord.</p>}
            </div>
          )}
          {/* Solde (pargne uniquement) */}
          {acc.type==="savings" && (
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.06em", display:"block", marginBottom:4 }}>Solde</label>
              <input type="number" step="0.01" value={acc.balance||0} onChange={e=>store.updateAccount(acc.id,{balance:parseFloat(e.target.value)||0})} placeholder="0.00"
                style={{ width:"100%", fontSize:14, padding:"8px 10px", background:"var(--bg)", border:"1px solid var(--border)", borderRadius:8, color:"var(--text)" }} />
            </div>
          )}
        </div>
      )}

      {showDeleteConfirm && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setShowDeleteConfirm(false)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Supprimer le compte</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
              Le compte  {acc.name}  contient <strong style={{ color:"var(--red)" }}>{txCount} transaction{txCount>1?"s":""}</strong> qui {txCount>1?"seront galement supprimes":"sera galement supprime"}.
            </p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setShowDeleteConfirm(false)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              <button onClick={()=>{store.removeAccount(acc.id);setShowDeleteConfirm(false);}} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function TplItemRow({ item, onDelete, onEdit }) {
  const [hover, setHover] = useState(false);
  return (
    <div onMouseEnter={()=>setHover(true)} onMouseLeave={()=>setHover(false)}
      style={{ display:"flex", alignItems:"center", gap:12, padding:"11px 16px", background:hover?"rgba(128,128,128,0.04)":"transparent", transition:"background 0.15s" }}>
      <div style={{ width:36,height:36, borderRadius:9, flexShrink:0, background:item.type==="expense"?"var(--red-dim)":"var(--green-dim)", display:"flex", alignItems:"center", justifyContent:"center", fontSize:16 }}>{item.type==="expense"?"":""}</div>
      <div style={{ flex:1, minWidth:0 }}>
        <p style={{ fontSize:14, fontWeight:500, overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap" }}>{item.title}</p>
        <p style={{ fontSize:11, color:"var(--text-sub)" }}>
          Le {item.day||1}{(item.day||1)===1?"er":""} du mois
          {item.note ? `  ${item.note}` : ""}
        </p>
      </div>
      <p style={{ fontSize:14, fontWeight:700, flexShrink:0, color:item.type==="expense"?"var(--red)":"var(--green)" }}>{item.type==="expense"?"":"+"}{fmtEur(item.amount)}</p>
      {hover && <button onClick={onEdit} style={{ background:"var(--gold-dim)", border:"none", borderRadius:7, width:26,height:26, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--gold)", fontSize:13, flexShrink:0 }}></button>}
      {hover && <button onClick={onDelete} style={{ background:"var(--red-dim)", border:"none", borderRadius:7, width:26,height:26, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--red)", fontSize:13, flexShrink:0 }}></button>}
    </div>
  );
}

function EmptyState({ text }) {
  return <div style={{ textAlign:"center", padding:"40px 20px", color:"var(--text-muted)", fontSize:14 }}><p style={{ fontSize:32, marginBottom:10 }}></p>{text}</div>;
}

function Field({ label, children }) {
  return (
    <div style={{ background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", padding:"10px 14px" }}>
      <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:5 }}>{label}</p>
      {children}
    </div>
  );
}

//  TplAddModal 
function TplAddModal({ onClose, onSave, item }) {
  const isEditing = !!item;
  const [type,setType]=useState(item?.type||"expense");
  const [title,setTitle]=useState(item?.title||"");
  const [amount,setAmount]=useState(item?.amount?.toString()||"");
  const [day,setDay]=useState(String(item?.day||"1"));
  const [note,setNote]=useState(item?.note||"");
  const [error,setError]=useState("");
  const handleSave=()=>{
    if(!title.trim()) return setError("Veuillez saisir un libell.");
    const amt=parseFloat(amount.replace(",","."));
    if(isNaN(amt)||amt<=0) return setError("Montant invalide.");
    onSave({title:title.trim(),amount:amt,type,day:parseInt(day,10),note});
  };
  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
      onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", overflow:"hidden" }}>
        <div style={{ background:"var(--surface2)", padding:"16px 20px", borderBottom:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
          <p style={{ fontSize:17, fontWeight:600 }}>{isEditing ? "Modifier l'opration" : "Opration rcurrente"}</p>
          <button onClick={onClose} style={{ background:"transparent", border:"none", color:"var(--text-muted)", fontSize:18 }}></button>
        </div>
        <div style={{ padding:"16px 20px", display:"flex", flexDirection:"column", gap:12 }}>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6, background:"var(--surface2)", borderRadius:"var(--radius-sm)", padding:4 }}>
            {[["expense","Dpense","var(--red)"],["income","Revenu","var(--green)"]].map(([v,l,c])=>(
              <button key={v} onClick={()=>setType(v)} style={{ padding:"9px", borderRadius:8, background:type===v?c+"22":"transparent", border:`1px solid ${type===v?c:"transparent"}`, color:type===v?c:"var(--text-muted)", fontSize:14, fontWeight:600 }}>{l}</button>
            ))}
          </div>
          <Field label="Montant">
            <input value={amount} onChange={e=>setAmount(e.target.value)} placeholder="0,00" inputMode="decimal"
              style={{ fontSize:22, fontFamily:"'DM Serif Display',serif", width:"100%", color:type==="expense"?"var(--red)":"var(--green)" }} />
          </Field>
          <Field label="Libell">
            <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Ex: Loyer, Salaire" style={{ fontSize:15, width:"100%" }} />
          </Field>
          <p style={{ fontSize:11, color:"var(--text-sub)", marginTop:-6, paddingLeft:2 }}>
            Variables disponibles : <span style={{ fontFamily:"monospace", color:"var(--gold)", opacity:0.8 }}>$month</span>  <span style={{ fontFamily:"monospace", color:"var(--gold)", opacity:0.8 }}>$Month</span>  <span style={{ fontFamily:"monospace", color:"var(--gold)", opacity:0.8 }}>$mm</span>  <span style={{ fontFamily:"monospace", color:"var(--gold)", opacity:0.8 }}>$year</span>
          </p>
          <Field label="Jour du mois">
            <select value={day} onChange={e=>setDay(e.target.value)} style={{ fontSize:15, width:"100%", background:"var(--select-bg)", color:"var(--text)" }}>
              {Array.from({length:28},(_,i)=>i+1).map(d=>(
                <option key={d} value={d} style={{ background:"var(--select-bg)" }}>{d===1?"1er":d} du mois</option>
              ))}
            </select>
          </Field>
          <Field label="Note (optionnelle)">
            <textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Commentaire" rows={2} style={{ fontSize:14, width:"100%", resize:"none", lineHeight:1.5 }} />
          </Field>
          {error && <p style={{ color:"var(--red)", fontSize:13 }}>{error}</p>}
          <button onClick={handleSave} style={{ padding:"13px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:15, fontWeight:700 }}>{isEditing ? "Enregistrer" : "Ajouter"}</button>
        </div>
      </div>
    </div>
  );
}

//  FormModal 
function FormModal({ store, account, transaction, onClose, isCardTransaction=false }) {
  const isEditing = !!transaction;
  // Determine if this is/was a card transaction
  const startAsCard = isCardTransaction || (transaction?.isCard === true);

  const [type,     setType]     = useState(transaction?.type||"expense");
  const [title,    setTitle]    = useState(transaction?.title||"");
  const [amount,   setAmount]   = useState(transaction?.amount?.toString()||"");
  const [selAcctId,setSelAcctId]= useState(transaction?.accountId||account||store.accounts.find(a=>a.type==="checking")?.id||"");
  const [date,     setDate]     = useState(transaction?.date||new Date().toISOString().split("T")[0]);
  const [note,     setNote]     = useState(transaction?.note||"");
  const [asCard,   setAsCard]   = useState(startAsCard);
  const [error,    setError]    = useState("");

  // Check if the selected account has a card
  const selAcct = store.accounts.find(a=>a.id===selAcctId);
  const acctHasCard = selAcct?.type==="checking" && selAcct?.cardName;

  // If account changes and new account has no card, reset asCard
  useEffect(() => {
    if (!acctHasCard) setAsCard(false);
  }, [selAcctId, acctHasCard]);

  const handleSubmit = () => {
    if (!title.trim()) return setError("Veuillez saisir un libell.");
    const amt = parseFloat(amount.replace(",","."));
    if (isNaN(amt)||amt<=0) return setError("Montant invalide.");
    if (!selAcctId) return setError("Veuillez slectionner un compte.");
    const txData = { title:title.trim(), amount:amt, type, accountId:selAcctId, date, note, isCard: acctHasCard ? asCard : false };
    if (isEditing) store.update(transaction.id, txData);
    else store.add(txData);
    onClose();
  };

  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"flex-end" }}
      onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:480, margin:"0 auto", background:"var(--surface)", borderRadius:"24px 24px 0 0", border:"1px solid var(--border)", borderBottom:"none", padding:"0 0 32px", maxHeight:"90vh", overflowY:"auto" }}>
        <div style={{ display:"flex", justifyContent:"center", padding:"12px 0 0" }}>
          <div style={{ width:36,height:4, borderRadius:2, background:"var(--border)" }} />
        </div>
        <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"14px 20px 16px" }}>
          <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:22 }}>{isEditing?"Modifier":"Nouvelle transaction"}</p>
          <button onClick={onClose} style={{ background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:8, width:32,height:32, color:"var(--text-muted)", fontSize:16, display:"flex", alignItems:"center", justifyContent:"center" }}></button>
        </div>
        <div style={{ padding:"0 20px", display:"flex", flexDirection:"column", gap:14 }}>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6, background:"var(--surface2)", borderRadius:"var(--radius-sm)", padding:4 }}>
            {[["expense","Dpense","var(--red)"],["income","Revenu","var(--green)"]].map(([v,l,c])=>(
              <button key={v} onClick={()=>setType(v)} style={{ padding:"9px", borderRadius:8, background:type===v?c+"22":"transparent", border:`1px solid ${type===v?c:"transparent"}`, color:type===v?c:"var(--text-muted)", fontSize:14, fontWeight:600 }}>{l}</button>
            ))}
          </div>
          <div style={{ background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:"14px 16px" }}>
            <p style={{ fontSize:11, color:"var(--text-sub)", fontWeight:600, letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:6 }}>Montant</p>
            <div style={{ display:"flex", alignItems:"baseline", gap:6 }}>
              <span style={{ fontSize:24, color:"var(--text-muted)", fontFamily:"'DM Serif Display',serif" }}></span>
              <input value={amount} onChange={e=>setAmount(e.target.value)} placeholder="0,00" inputMode="decimal"
                style={{ fontSize:34, fontFamily:"'DM Serif Display',serif", flex:1, color:type==="expense"?"var(--red)":"var(--green)" }} />
            </div>
          </div>
          <Field label="Libell"><input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Ex : Courses, Salaire" style={{ fontSize:15, width:"100%", padding:"0 2px" }} /></Field>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
            <Field label="Compte">
              <select value={selAcctId} onChange={e=>setSelAcctId(e.target.value)} style={{ fontSize:14, width:"100%", background:"var(--select-bg)", color:"var(--text)" }}>
                {store.accounts.filter(a=>a.type==="checking").map(a=><option key={a.id} value={a.id} style={{ background:"var(--select-bg)" }}> {a.name}</option>)}
              </select>
            </Field>
            <Field label="Date"><input type="date" value={date} onChange={e=>setDate(e.target.value)} style={{ fontSize:14, width:"100%", colorScheme:"var(--colorscheme)" }} /></Field>
          </div>

          {/* Card toggle  only shown if account has a card */}
          {acctHasCard && (
            <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", padding:"12px 14px", background:asCard?"rgba(201,168,76,0.06)":"var(--surface2)", border:`1px solid ${asCard?"rgba(201,168,76,0.3)":"var(--border)"}`, borderRadius:"var(--radius-sm)", transition:"all 0.2s" }}>
              <div style={{ display:"flex", alignItems:"center", gap:10 }}>
                <span style={{ fontSize:18 }}></span>
                <div>
                  <p style={{ fontSize:13, fontWeight:600, color:asCard?"var(--gold)":"var(--text)" }}>Imputer sur la carte</p>
                  <p style={{ fontSize:11, color:"var(--text-muted)" }}>{selAcct.cardName}  dbit diffr</p>
                </div>
              </div>
              <Toggle checked={asCard} onChange={()=>setAsCard(!asCard)} />
            </div>
          )}

          <Field label="Note (optionnelle)"><textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Commentaire" rows={2} style={{ fontSize:14, width:"100%", resize:"none", lineHeight:1.5 }} /></Field>
          {error && <p style={{ color:"var(--red)", fontSize:13 }}>{error}</p>}
          <button onClick={handleSubmit} style={{ padding:"14px", borderRadius:"var(--radius)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:16, fontWeight:700, boxShadow:"0 4px 20px rgba(201,168,76,0.35)", marginTop:4 }}>Enregistrer</button>
        </div>
      </div>
    </div>
  );
}

//  SavingsStats 
function fmtSnapshotDate(dateStr) {
  const d = new Date(dateStr + "T00:00:00");
  const day = d.getDate();
  return `${day===1?"1er":day} ${d.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}`;
}

function Variation({ value }) {
  if (value === null || value === undefined) return <span style={{ color:"var(--text-sub)", fontSize:12 }}></span>;
  const pos = value >= 0;
  return (
    <span style={{ fontSize:12, fontWeight:700, color: pos ? "var(--green)" : "var(--red)" }}>
      {pos ? "+" : ""}{fmtEur(value)}
    </span>
  );
}

function SavingsSnapshotModal({ snapshot, defaults, onClose, onSave }) {
  const isNew = !snapshot?.id;
  const [date,        setDate]        = useState(snapshot?.date        || new Date().toISOString().split("T")[0]);
  const [available,   setAvailable]   = useState(snapshot?.available?.toString() || defaults?.available?.toString() || "");
  const [blocked,     setBlocked]     = useState(snapshot?.blocked?.toString()   || defaults?.blocked?.toString()   || "");
  const [note,        setNote]        = useState(snapshot?.note        || "");
  const [error,       setError]       = useState("");

  const handleSave = () => {
    const avail = parseFloat(available.replace(",","."));
    const bloc  = parseFloat(blocked.replace(",","."));
    if (isNaN(avail) || avail < 0) return setError("pargne disponible invalide.");
    if (isNaN(bloc)  || bloc  < 0) return setError("pargne bloque invalide.");
    if (!date) return setError("Date requise.");
    onSave({ date, available: avail, blocked: bloc, note, auto: false });
  };

  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.75)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
      onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:420, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", overflow:"hidden" }}>
        <div style={{ background:"var(--surface2)", padding:"16px 20px", borderBottom:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
          <p style={{ fontSize:17, fontWeight:600 }}>{isNew ? "Nouvelle entre" : "Modifier l'entre"}</p>
          <button onClick={onClose} style={{ background:"transparent", border:"none", color:"var(--text-muted)", fontSize:18 }}></button>
        </div>
        <div style={{ padding:"16px 20px", display:"flex", flexDirection:"column", gap:12 }}>
          <Field label="Date">
            <input type="date" value={date} onChange={e=>setDate(e.target.value)} style={{ fontSize:14, width:"100%", colorScheme:"var(--colorscheme)", color:"var(--text)" }} />
          </Field>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
            <Field label="pargne disponible ()">
              <input type="number" step="0.01" value={available} onChange={e=>setAvailable(e.target.value)} placeholder="0.00" inputMode="decimal"
                style={{ fontSize:15, width:"100%", color:"var(--green)" }} />
            </Field>
            <Field label="pargne bloque ()">
              <input type="number" step="0.01" value={blocked} onChange={e=>setBlocked(e.target.value)} placeholder="0.00" inputMode="decimal"
                style={{ fontSize:15, width:"100%", color:"var(--red)" }} />
            </Field>
          </div>
          <Field label="Note (optionnelle)">
            <input value={note} onChange={e=>setNote(e.target.value)} placeholder="Ex: rebalancement, intrts" style={{ fontSize:14, width:"100%" }} />
          </Field>
          {!isNew && (
            <div style={{ display:"flex", gap:8, padding:"10px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8 }}>
              <span style={{ fontSize:14, flexShrink:0 }}></span>
              <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                Cette modification ne porte que sur ce snapshot historique. Les soldes actuels de vos comptes pargne ne seront pas affects.
              </p>
            </div>
          )}
          {error && <p style={{ color:"var(--red)", fontSize:13 }}>{error}</p>}
          <button onClick={handleSave} style={{ padding:"13px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:15, fontWeight:700 }}>
            {isNew ? "Ajouter" : "Enregistrer"}
          </button>
        </div>
      </div>
    </div>
  );
}

function MiniSparkline({ data, color, width=80, height=32 }) {
  if (!data || data.length < 2) return null;
  const min = Math.min(...data);
  const max = Math.max(...data);
  const range = max - min || 1;
  const pts = data.map((v, i) => {
    const x = (i / (data.length - 1)) * width;
    const y = height - ((v - min) / range) * (height - 4) - 2;
    return `${x},${y}`;
  }).join(" ");
  return (
    <svg width={width} height={height} style={{ display:"block" }}>
      <polyline points={pts} fill="none" stroke={color} strokeWidth="2" strokeLinejoin="round" strokeLinecap="round" />
    </svg>
  );
}

//  SavingsChart 
function SavingsChart({ rows }) {
  const [tooltip, setTooltip] = useState(null);
  const W = 440, H = 180, PAD = { top:16, right:16, bottom:36, left:56 };
  const innerW = W - PAD.left - PAD.right;
  const innerH = H - PAD.top  - PAD.bottom;

  // rows are newest-first  reverse for chart (left=oldest, right=newest)
  const sorted = [...rows].reverse();

  const allVals = sorted.flatMap(r => [r.available||0, r.blocked||0, (r.available||0)+(r.blocked||0)]);
  const minV = 0;
  const maxV = Math.max(...allVals, 1);

  const xOf = i => PAD.left + (i / Math.max(sorted.length - 1, 1)) * innerW;
  const yOf = v => PAD.top  + innerH - ((v - minV) / (maxV - minV)) * innerH;

  const makePath = (vals) => vals.map((v, i) => `${i===0?"M":"L"}${xOf(i).toFixed(1)},${yOf(v).toFixed(1)}`).join(" ");
  const makeArea = (vals) => {
    const top  = vals.map((v, i) => `${i===0?"M":"L"}${xOf(i).toFixed(1)},${yOf(v).toFixed(1)}`).join(" ");
    const base = `L${xOf(vals.length-1).toFixed(1)},${(PAD.top+innerH).toFixed(1)} L${PAD.left.toFixed(1)},${(PAD.top+innerH).toFixed(1)} Z`;
    return top + " " + base;
  };

  const availVals = sorted.map(r => r.available||0);
  const blocVals  = sorted.map(r => r.blocked||0);
  const totVals   = sorted.map(r => (r.available||0)+(r.blocked||0));

  // Y-axis ticks (4 ticks)
  const yTicks = [0,1,2,3].map(i => minV + (maxV - minV) * i / 3);

  // X-axis labels: show up to 5 evenly spaced dates
  const xLabelIdxs = sorted.length <= 5
    ? sorted.map((_,i)=>i)
    : [0,1,2,3,4].map(i => Math.round(i * (sorted.length-1)/4));

  const handleMouseMove = (e) => {
    const svg = e.currentTarget;
    const rect = svg.getBoundingClientRect();
    const mx = (e.clientX - rect.left) * (W / rect.width);
    if (mx < PAD.left || mx > W - PAD.right) { setTooltip(null); return; }
    const ratio = (mx - PAD.left) / innerW;
    const idx   = Math.round(ratio * (sorted.length - 1));
    const row   = sorted[Math.max(0, Math.min(idx, sorted.length-1))];
    const cx    = xOf(Math.max(0, Math.min(idx, sorted.length-1)));
    setTooltip({ row, cx, idx });
  };

  return (
    <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:"14px 0 0", marginBottom:16, overflow:"hidden" }}>
      <p style={{ fontSize:11, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em", padding:"0 16px", marginBottom:8 }}>volution de l'pargne</p>
      <div style={{ overflowX:"auto" }}>
        <svg width={W} height={H} viewBox={`0 0 ${W} ${H}`} style={{ display:"block", minWidth:300, width:"100%" }}
          onMouseMove={handleMouseMove} onMouseLeave={()=>setTooltip(null)}>
          <defs>
            <linearGradient id="gradAvail" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor="#4caf82" stopOpacity="0.25"/>
              <stop offset="100%" stopColor="#4caf82" stopOpacity="0.02"/>
            </linearGradient>
            <linearGradient id="gradBloc" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor="#e05c5c" stopOpacity="0.18"/>
              <stop offset="100%" stopColor="#e05c5c" stopOpacity="0.02"/>
            </linearGradient>
            <linearGradient id="gradTot" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor="#c9a84c" stopOpacity="0.15"/>
              <stop offset="100%" stopColor="#c9a84c" stopOpacity="0.02"/>
            </linearGradient>
          </defs>

          {/* Grid lines */}
          {yTicks.map((v,i) => (
            <g key={i}>
              <line x1={PAD.left} x2={W-PAD.right} y1={yOf(v)} y2={yOf(v)} stroke="rgba(255,255,255,0.05)" strokeWidth="1"/>
              <text x={PAD.left-6} y={yOf(v)+4} textAnchor="end" fontSize="9" fill="rgba(240,236,228,0.35)" fontFamily="DM Sans,sans-serif">
                {v>=1000?`${(v/1000).toFixed(v%1000===0?0:1)}k`:Math.round(v)}
              </text>
            </g>
          ))}

          {/* Area fills */}
          <path d={makeArea(totVals)}   fill="url(#gradTot)"   />
          <path d={makeArea(availVals)} fill="url(#gradAvail)" />
          <path d={makeArea(blocVals)}  fill="url(#gradBloc)"  />

          {/* Lines */}
          <path d={makePath(totVals)}   fill="none" stroke="#c9a84c" strokeWidth="1.5" strokeDasharray="5 3" strokeLinejoin="round" strokeLinecap="round"/>
          <path d={makePath(availVals)} fill="none" stroke="#4caf82" strokeWidth="2"   strokeLinejoin="round" strokeLinecap="round"/>
          <path d={makePath(blocVals)}  fill="none" stroke="#e05c5c" strokeWidth="2"   strokeLinejoin="round" strokeLinecap="round"/>

          {/* X axis labels */}
          {xLabelIdxs.map(i => {
            const r = sorted[i];
            if (!r) return null;
            const d = new Date(r.date+"T00:00:00");
            const label = `${d.getDate()}/${d.getMonth()+1}/${String(d.getFullYear()).slice(2)}`;
            return (
              <text key={i} x={xOf(i)} y={H-6} textAnchor="middle" fontSize="9" fill="rgba(240,236,228,0.4)" fontFamily="DM Sans,sans-serif">{label}</text>
            );
          })}

          {/* Tooltip crosshair */}
          {tooltip && (
            <g>
              <line x1={tooltip.cx} x2={tooltip.cx} y1={PAD.top} y2={PAD.top+innerH} stroke="rgba(255,255,255,0.15)" strokeWidth="1" strokeDasharray="3 3"/>
              <circle cx={tooltip.cx} cy={yOf(availVals[tooltip.idx])} r="4" fill="#4caf82" stroke="var(--surface)" strokeWidth="1.5"/>
              <circle cx={tooltip.cx} cy={yOf(blocVals[tooltip.idx])}  r="4" fill="#e05c5c" stroke="var(--surface)" strokeWidth="1.5"/>
              <circle cx={tooltip.cx} cy={yOf(totVals[tooltip.idx])}   r="3" fill="#c9a84c" stroke="var(--surface)" strokeWidth="1.5"/>
            </g>
          )}
        </svg>
      </div>

      {/* Tooltip info box */}
      {tooltip ? (
        <div style={{ padding:"10px 16px 12px", borderTop:"1px solid var(--border)", display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:8 }}>
          <div>
            <p style={{ fontSize:9, color:"var(--text-sub)", fontWeight:700, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:3 }}>Disponible</p>
            <p style={{ fontSize:14, fontWeight:700, color:"#4caf82", fontFamily:"'DM Serif Display',serif" }}>{fmtEur(tooltip.row.available||0)}</p>
          </div>
          <div>
            <p style={{ fontSize:9, color:"var(--text-sub)", fontWeight:700, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:3 }}>Bloque</p>
            <p style={{ fontSize:14, fontWeight:700, color:"#e05c5c", fontFamily:"'DM Serif Display',serif" }}>{fmtEur(tooltip.row.blocked||0)}</p>
          </div>
          <div>
            <p style={{ fontSize:9, color:"var(--text-sub)", fontWeight:700, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:3 }}>Total</p>
            <p style={{ fontSize:14, fontWeight:700, color:"#c9a84c", fontFamily:"'DM Serif Display',serif" }}>{fmtEur((tooltip.row.available||0)+(tooltip.row.blocked||0))}</p>
          </div>
        </div>
      ) : (
        <div style={{ padding:"8px 16px 10px", borderTop:"1px solid var(--border)" }}>
          <p style={{ fontSize:11, color:"var(--text-sub)", textAlign:"center" }}>Survolez le graphique pour voir les dtails</p>
        </div>
      )}
    </div>
  );
}

function SavingsStats({ store, onBack }) {
  const [showModal,    setShowModal]    = useState(false);
  const [editSnapshot, setEditSnapshot] = useState(null);
  const [deleteSnap,   setDeleteSnap]   = useState(null);

  const history = store.savingsHistory; // sorted desc by date

  // Compute variations
  const rows = useMemo(() => {
    const sorted = [...history].sort((a,b) => b.date.localeCompare(a.date)); // newest first
    return sorted.map((entry, i) => {
      const prev = sorted[i + 1]; // older entry
      return {
        ...entry,
        varAvailable: prev != null ? entry.available - prev.available : null,
        varBlocked:   prev != null ? entry.blocked   - prev.blocked   : null,
        total: (entry.available || 0) + (entry.blocked || 0),
      };
    });
  }, [history]);

  const totalAvailable = store.accounts.filter(a=>a.type==="savings"&&a.savingsSubtype!=="blocked").reduce((s,a)=>s+(a.balance||0),0);
  const totalBlocked   = store.accounts.filter(a=>a.type==="savings"&&a.savingsSubtype==="blocked").reduce((s,a)=>s+(a.balance||0),0);
  const totalSavings   = totalAvailable + totalBlocked;

  // Sparkline data (oldestnewest)
  const sparkAvail   = [...rows].reverse().map(r=>r.available||0);
  const sparkBlocked = [...rows].reverse().map(r=>r.blocked||0);

  const handleSaveNew = (entry) => {
    store.addSavingsSnapshot(entry);
    setShowModal(false);
  };
  const handleSaveEdit = (entry) => {
    store.updateSavingsSnapshot(editSnapshot.id, entry);
    setEditSnapshot(null);
  };

  return (
    <div style={{ minHeight:"100vh", background:"var(--bg)" }}>
      {/* Header */}
      <div style={{ background:"var(--header-bg)", padding: COMPACT_STICKY_HEADER ? "8px 16px" : "16px 20px", borderBottom:"1px solid var(--border)", ...(COMPACT_STICKY_HEADER ? { position:"sticky", top:0, zIndex:50, backdropFilter:"blur(20px)" } : {}) }}>
        <div style={{ display:"flex", alignItems:"center", gap:12 }}>
          <button onClick={onBack} style={{ background:"var(--header-btn-bg)", border:"1px solid var(--header-btn-border)", borderRadius:8, padding: COMPACT_STICKY_HEADER ? "4px 10px" : "6px 12px", color:"var(--header-muted)", fontSize:13, fontWeight:500 }}> Retour</button>
          <p style={{ fontFamily:"'DM Serif Display',serif", fontSize: COMPACT_STICKY_HEADER ? 18 : 26, letterSpacing:"-0.02em", color:"var(--header-text)" }}>Statistiques pargne</p>
        </div>
      </div>

      {/* Content */}
      <div style={{ padding:"16px" }}>
        {/* Summary cards */}
        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:8, marginBottom:16 }}>
          {[
            { label:"Total pargne", value:totalSavings, color:"var(--gold)", spark: sparkAvail.map((a,i)=>a+(sparkBlocked[i]||0)) },
            { label:"Disponible",    value:totalAvailable, color:"var(--green)", spark: sparkAvail },
            { label:"Bloque",       value:totalBlocked,   color:"var(--red)",   spark: sparkBlocked },
          ].map(c=>(
            <div key={c.label} style={{ background:"var(--surface)", borderRadius:10, padding:"10px 12px", border:"1px solid var(--border)" }}>
              <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:4 }}>{c.label}</p>
              <p style={{ fontSize:16, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:c.color, marginBottom:4 }}>{fmtEur(c.value)}</p>
              <MiniSparkline data={c.spark} color={c.color} />
            </div>
          ))}
        </div>
        {/* Add button */}
        <button onClick={()=>setShowModal(true)} style={{ width:"100%", padding:"11px", borderRadius:"var(--radius-sm)", background:"var(--gold-dim)", border:"1px dashed var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600, marginBottom:16 }}>
          + Ajouter une entre manuellement
        </button>

        {/* Chart */}
        {rows.length >= 2 && (
          <SavingsChart rows={rows} />
        )}

        {/* Legend */}
        <div style={{ display:"flex", gap:12, marginBottom:12, flexWrap:"wrap" }}>
          <span style={{ fontSize:11, color:"var(--green)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ width:10,height:10,borderRadius:2,background:"var(--green)",display:"inline-block" }}/>Disponible</span>
          <span style={{ fontSize:11, color:"var(--red)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ width:10,height:10,borderRadius:2,background:"var(--red)",display:"inline-block" }}/>Bloque</span>
          <span style={{ fontSize:11, color:"var(--gold)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ width:10,height:10,borderRadius:2,background:"var(--gold)",display:"inline-block" }}/>Total</span>
          <span style={{ fontSize:11, color:"var(--text-sub)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ fontSize:10 }}></span>Auto</span>
        </div>

        {/* Table / Cards */}
        {rows.length === 0 ? (
          <div style={{ textAlign:"center", padding:"60px 20px", color:"var(--text-muted)" }}>
            <p style={{ fontSize:36, marginBottom:12 }}></p>
            <p style={{ fontSize:15, fontWeight:500, marginBottom:6 }}>Aucune entre pour l'instant</p>
            <p style={{ fontSize:13 }}>Les entres sont cres automatiquement le 1er et le 15 de chaque mois, ou vous pouvez en ajouter manuellement.</p>
          </div>
        ) : (
          <div style={{ display:"flex", flexDirection:"column", gap:10 }}>
            {rows.map((row, i) => (
              <div key={row.id} className="fade-up" style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden", animationDelay:`${i*0.03}s` }}>
                {/* Date + actions header */}
                <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 14px", background:"var(--surface2)", borderBottom:"1px solid var(--border)" }}>
                  <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                    <span style={{ fontFamily:"'DM Serif Display',serif", fontSize:15, fontWeight:600, color:"var(--gold)" }}>{fmtSnapshotDate(row.date)}</span>
                    {row.auto && <span style={{ fontSize:10, padding:"2px 6px", borderRadius:4, background:"var(--gold-dim)", color:"var(--gold)", fontWeight:600 }}> Auto</span>}
                    {row.note && <span style={{ fontSize:11, color:"var(--text-muted)", fontStyle:"italic" }}>{row.note}</span>}
                  </div>
                  <div style={{ display:"flex", gap:6 }}>
                    <button onClick={()=>setEditSnapshot(row)} style={{ background:"var(--gold-dim)", border:"none", borderRadius:6, width:24,height:24, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--gold)", fontSize:12 }}></button>
                    <button onClick={()=>setDeleteSnap(row)} style={{ background:"var(--red-dim)", border:"none", borderRadius:6, width:24,height:24, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--red)", fontSize:12 }}></button>
                  </div>
                </div>

                {/* 2-column data */}
                <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:0 }}>
                  {/* Available */}
                  <div style={{ padding:"12px 14px", borderRight:"1px solid var(--border)" }}>
                    <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:4 }}>Disponible</p>
                    <p style={{ fontSize:18, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--green)", marginBottom:4 }}>{fmtEur(row.available||0)}</p>
                    <Variation value={row.varAvailable} />
                  </div>
                  {/* Blocked */}
                  <div style={{ padding:"12px 14px" }}>
                    <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:4 }}>Bloque</p>
                    <p style={{ fontSize:18, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--red)", marginBottom:4 }}>{fmtEur(row.blocked||0)}</p>
                    <Variation value={row.varBlocked} />
                  </div>
                </div>

                {/* Total */}
                <div style={{ padding:"8px 14px", borderTop:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center", background:"rgba(0,0,0,0.02)" }}>
                  <span style={{ fontSize:11, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em" }}>Total pargne</span>
                  <span style={{ fontSize:15, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--gold)" }}>{fmtEur(row.total)}</span>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* Modals */}
      {showModal    && <SavingsSnapshotModal defaults={{ available: totalAvailable, blocked: totalBlocked }} onClose={()=>setShowModal(false)}    onSave={handleSaveNew} />}
      {editSnapshot && <SavingsSnapshotModal snapshot={editSnapshot} onClose={()=>setEditSnapshot(null)} onSave={handleSaveEdit} />}
      {deleteSnap   && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setDeleteSnap(null)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Supprimer cette entre</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
              Supprimer l'entre du <strong>{fmtSnapshotDate(deleteSnap.date)}</strong> ? Cette action est irrversible.
            </p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setDeleteSnap(null)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              <button onClick={()=>{store.removeSavingsSnapshot(deleteSnap.id);setDeleteSnap(null);}} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

//  Mount 
// Wait for Firebase to initialize before mounting React
function waitForFb(cb) {
  if (window._fb) cb();
  else setTimeout(()=>waitForFb(cb), 50);
}
waitForFb(()=>{
  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
});
</script>
</body>
</html>

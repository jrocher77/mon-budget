<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Mon Budget</title>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADdUlEQVR4nL2XT2gVRxjAfzMxkkQl7QtJk1QTSrDSHko0GqiEilBoXyVQ6EWaVCitF9NS8GBziiBGPIgURJKTilawPYqQ0ouokGptUrF/sGraNNqoCW/x1fzBvrwdD7uzO9l9u/teaPxgD9ndmd/v++Z7kx1BIFI1jSp47/8MKzMpzL9XBOFDxze1LadAugdlSngCGp7uGR1JmiRVXR75zMrmYsc6DF9ClALXYNuOXiUpRaKIZlmZSSGKgQfBMXxcfqKIZsroqcJwW/lwpcKXlrOVLxu3XACxAqnqcgfswk2wd9+4QiLu/TiJSAFzkK3C4EIVCD4zlypKYkXBuxrsZu5l5U7uVKJQIwjvPSmFI+FmoHuiKAGv9AbDhJeVwYc7mnmn4yVS1SuZtp7y5/1ZLl6bZvjnDAt55Um4fHCXItiUiU2oS2tmvr/ndTq3N3Dk5B069wxzcPAW6+qr6NvzGu1vvFhwXFSEBApl78so0m/Vs7W1hq9O3+XHXyzmn+b5bexf+o79bvRKeLBuymAvxPaAmYVSjtTO9Dqs7H9c+mkaZfvvjk/OcvfvGQ8mUYDwlkIUboF4gWA0N1axtr6SH25ksPM6M4UUAmXDp30jSBENW7KAEHD68BYa6yoBeLO1hitfb/Oe53I2H3xxlccz8f8HliygFHz05XXef/tlPu9q4eyFCQbP/QX4FQAQiS0djpKG6OZSyoeZ8FLLDwkVEAJ3Q1GcOtROY10FAN2dTXR3NgHwx/gTdveNeiKOFAhXJq4BCwpY2ZzzUwns/7t6r9PUUMWJ/jau3bToPfqr9xs3M9fwYEhXpuSNyMxi4sEc/zyaZ8MraxCCRRfAyf7NvNtRHxoXFwUFrGwOKQXm9q0n++a7+7ywppzt7bVOVu71avNqGmorGL6R8eBJ2UNCD0gpnKXAWQYpBUOXH9KxsYbPulqYnctz83aWlqZV7PtkAwPnxpiZW/DgQvjwqIgU8HrBzUBvelIKDgzcYud7a9n78XpS1St5MDXPt0P3+H54alHZTW7Ul1FsBUwJ3ZRCwELe5sz5Cc6cn1j0vrneZuZx34eJTagH657QWQWb0My6WDgUuRPqScxqREWx4JIEIkVi3ik2ShJYKiQupJWZFOme0ZHlPpKZYR5MJDgHxuclYcJBf8a68XwOpz48JKAlllMgeDx/BlYuBVBY1RiQAAAAAElFTkSuQmCC" />
  <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,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" />
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjogIk1vbiBCdWRnZXQiLCAic2hvcnRfbmFtZSI6ICJCdWRnZXQiLCAic3RhcnRfdXJsIjogIi4iLCAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwgImJhY2tncm91bmRfY29sb3IiOiAiIzBlMGYxMyIsICJ0aGVtZV9jb2xvciI6ICIjMGUwZjEzIiwgImljb25zIjogW3sic3JjIjogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBTUFBQUFEQUNBSUFBQURkdnZ0UUFBQVlsa2xFUVZSNDJ1MmRlM0JVMTMzSHo3bTdRbHE5SHhZZ2dRQ0JlZGtZYkxBTFRyR3hJUy9IR050NVRGckh6U1RVU1RzZHA5TS9uRWs5YlRyVGRETHRqTnVremFPVGRDWnRpSU05Y1ZJUDlTUEJ3L2dCam9NTkdMQjRDNFJBU0FLRTBPb3RyZlp4K3NmQ2F2ZmU4L2lkYzg5OXJlNFovYUhkdlh2MzNuTSs5L3Q3bkJldXJtbEFqcFZvdEJTRnhldVNTaVVjYkdKSGlXbHRqb2J0NTNucDdIV1FwNmhlYmt6RWRQYW13dmJ6dkZnYVJTZEoyS1lKTTZFVEVoTVVubkl0WlJNamRZQ3k2T1RvRHRFSnFDeGxHMDRaSXhXQTh0RUp1U2ttUVZMQVNCcWdIRDBoT2tXR2tScERjZ0JGbzZXaDhCUzlGRWt4QkFVb0ZKNVFpcWpGQ09rSlMyR1FuOHBLRVRBSkxGYWdHVUpQZlUySjdGY0docEtoRGdrQUtrcDZxS3dRSWgvQjRtS21Dc2dRRDZCaW9zY0VqUUl1Q2tnRkhTWUlRMHlBaW9PZUhEY09FUVBrS2Jna0NSbmlBUlJjZWxTNFVTQU16d2lTc2hqSUFSUlFlaVM0Y1VpUWNIR1N4R0dJQWxBUTZjbWlJK0RHWlN1R3hTUUZDQ01XUTFHcTYxTTg2SUNoSWZKOFlUNGpoQWRUOW9LekZ4OGdqS0xSVWhORFpnVUtrUHp3MENINmNkR0FGRU9XZ3FKR1ZCRXFBQ2dvOUtpaFE5eTFZVHlZQW91UmxhR0FEVGxWUUFmSWphNUVvdlYzS1NRUkNrWUJOV3JUQ3VSeitaRkZSOGlOOXN3UUZwc3ZYQVJxWkJJaEk5akNReWowRUVSWTlCQXkvYWU5Q0U5T3Z6RHFMWkNDcklTdjNXcWZCMTg4ZEdDU1F5UUNNVjFCZXNHUG1wU0pidG9zUnMzbkZpMFhqaGttYVFvQVBaWkhsaVU1ZktVaGxqODV2UUYvblhVWmxNdTIzcHIvcENnMzNzUHZKcXkrcHNSYzlUQjBPSFpFR1JkWnBEZ0dUaGFqN0xkOGE4NXdkVTJEMzl4bnB2Q0liQmJiK1hEZGhvbU9zbnJjRkJjYis5ZXp6cm5TaGcrRlIwaVA5YWxsUE54Y3NYSEZockUrdEY0d1hZcDg3MWtiZnFPSGI3YWswUEdWRFZQRXlQZm16UEFiUFh6aFVVUUhCZzJSK1lPZVN4VWp2aFQ1aHlFanVQUklvQU1qeG80RkV4d0h3eWlJREVVcUt1czg5NkROOU1pakEzZUhYZWdQd3pLZllaRi9iWGF1ODE2VmwwVW1FaGxQbW14d0pOUGFIQjBlTTZLKzB4NFpldURvUUxnaE12bHB6TzY1SUJ5U3JBbER5NUdFRkRCRUVER25ISEdCRG5rYmx4bkZRdy9iV0JBMk1mbEZ6b1FCdmt2QWhwV29talBQYlprUkNIcE1iaWFoMGdOemZwU0pnZk1FOWNTNFdXakxMZnVVSWNPSDlKaENXVm5oWWJpb1ltanllME9GZnhDWXhCakpTQkVsd3ZjQlE0WVA2WkV6V3pCMElNUklTZzZnK3gyT2tabzU4d0ZEUmxEb01kZTc2Tm5sb09QRWlBNWVCeHdESXc1V1ZuUG1XNGFNb05BakpUejBObk5zSkJEa1Y2eVhKQ1ZGdm1YSWNKa2VwaWRvZ3g0Z09pNFhPRVo2R1VMdTlwZEYzYTlXcVdPSUREb0t2K1hhL1Jha2Rnakp6eVNaVTBHRnIvUHlQdVlVRWVzWE1TNUdCUUlhTDIvcHNSK0N3WjhjdUJRUmRsem11U0V6aW84ZXFUWldJOFBPdDRxTUljTWRlaUN1andJOUpwY0MzcHg2SFdxcHM1a3poS1piME1lUU84NlFTejRRRWMyOGdkQWpGQjc3SGhpUUtDemo4VUE4RlVJSXp5VVMrVVBtL2pJWG5TSERCZm5oOUZlNFJnOWtsTFRVVWpDUUVkQlNOUFBNR1VDSHZESmtodFAwQU9OMlpYb0FIUXZ5bzExbDlSVThVa3hvemhScXcxdEQ1cmdKbTY0VGdPdWpRSSs4M2JTZFptQ2JLTnFVNVJ1bjVGaVRBbU9VWjh0TU5xdndoY2lRM1R6WWFVTm1PQ28vNnE0UHM2N1Y2V0VQbExZWGhpSFFEOEd2RmpKTUFPUlF1MkxJM0VvazZuQjlnUFNBaGl4eVQ3R2d1WHp0eXRyRkxSVUxtOHRuMTVmRnlpTGxzVWdtUXlZVG1jbEUrdnJnVk45QTRrci9aRWZYYUVmWDJNWEw0NWtNUldTb0k4VTRVc1RTSVNMcFVDT3VZZ1VHSUlqOHVFQVBrZUZtYm1QWnc1dWFQcjVoOXV3R3lrVHZpSUZMb2taVlJiU3h2blRGNHFyYysrTVQ2YmIyb2NNbjQvdVBEdlQyVFpnWUVRNDQxTVZRZmcxVEl6S0h4aTdpK29abUo4WkVGd0JFMDFpNi9EaEtEM3RRUjh2YzJKOS92dlcrZGJmWWRCZk9YaHpkZS9EYW5qLzA5Y2NUSmt3d3lJa3lmNVR2RDFGUGgybGZMQUFJVDMrcUY2QXNObzRBeEFyZEJmUVVIQ2xIajRMd1pOOG9LNDE4L1F1dDJ6WTNHWVkydWM5a3lBZHRBNi92dmZKKzI0RHBaNEVZaVJuQzlITlNHQ280bFU2R3N0ZzQ3d01SRmVPbGt4NTJOOWx0UzZxZi9mcnllWE5pbWdNVEE5OTdaOE85ZHpiMDlFMzhabmZQRzMrNG1waktVSTBPeTV4eDRqSnBRK2F3SnhTSmxWZlZWUm1ESXhtbjVBZm9oQWp6SERyb3lYLzFxWTF6dnZPTjIydXJIY3lSVkZlVWJGaFR2L1dCcG1nRWQzU05KVk5FVFlmc0dqSm5aZ0psc2RGdndxamVEelYwdDIrOGVQUndVOVZmZVh6aGx4OWR5TCtSOGNuMGdiYUJBOGZpNTd2SHJ2UlBqazJrTU1JVjVaSG14dGpTaFpWM3I2cGJ2N3F1SkFyTmd3eVBKbC9hM2JQcnpkNkpSQnJJa0pvaEsvaVdoU0dOVnN3UkgwalIrNkc5NlJ3OTJ6Kzc2TWx0Q3poM01UaVMzUGxxMTJ0N3IweE1wam50V2wxWjh2akhtNy80NmZteHNnaXdmdjd6eGZQL3U2Y0hya05VaG15S2tDNkduUGVCZ042UEVqMWNYNHBIejU4KzNNS25aOC8rdmg4K2YyNTRMQ1Uwd1VNanlSMjdMdjUyMzVXL2ZXcjUydHRxWlJOaUVPZUU2Z3hSbzNxdlBDR2RtV2hGNzhlMjY4UGl4VHFiYk9PNlc1NzZmQ3ZuOG43OFFzZDNmM0thUTQvMUszM1hFODg4MTdicnpWNEUvdzQ5VlNGUmFRVFpxR2V0aVduRGFma1JQNGJjeU1zT1BhWmZiSjFmOGV6WGxuTVNNTi9mY2ZiWGIvUW94ZTNvMzM5eDd1VTlQUTR4SktnWkFxTEtvVlVCSEIvT1FmVis3TWlQR2owbFVlUGJmN21DNDZ3OC8wclhLMjlmdG5PblA5elpzZi9vZ0JNTTJSRWhwNWRYMXdZUUsvV3NYWDZrNk1uMWEyNy8zS0xXK1JXc1V4MCtPZmcvTDErdys2Z1E5TS8vZGJwL2NBcHFYQWhSVUFjdElxVFJpaG51eUkrQ3VNS2ZSUTQ5MmJKc1VlVVhQejJmOWV1VFU1bm4vcnM5WXhsbVNpMkNXSDBzOWFPZEhYRDdpd2l4YytORWF5djQxSVR4Y2ovc3gwdk9lSWtPZVBxSkpSelhaK2VyWFpldlRRSXBFUjcyem9Gcng4OE9TekFrYjhnRVZ5Z1R2Zm9GSUxqOWtsWmR5YURkZXNDRDZ4dnZXRmJEU2ZtOHRMdGJiYVVPRmtZLzMzVlI1ZG15V1JXeTFhN0ppam1vUUVEM0dlajlTQm12L0tUWlZ4OWJ4RG50Uzcvcm5reWtyWlVNWHhyUml0R2g0L0VMUGVOT0dESlpUOUVGVjlyVnFjM0F4OFZtdkpaL3dLYTdHMXVhbUgybHlWVG10YjJYcmR6d2Y1MjFCa2oreS96VEtoc3kyWnF4SStwZUFpVE1IOElNdHJyOEVQYWtoUzg5MHNJNTdiNkQvVU1qU1dSamtVMldGTzA5MkE5Wjlad1FEU0traklzV0syWTRKRExLbWdtVkg1SHJRd2hhdGJUNjFnV1ZuTE85K1VHZllGbGdrUTBqakRILzF3WVNaeTZNU0lrb2dnRmg0MWwxUktDY1R5UVNWWGNQK2lBeTM5ejZRQlBuaStPVDZRL2E0aUQ3SkRxR3l0RGhFNE1PM1oyVUZYTTZGdk55alVTZy9WS1FINFJRUlN6eXdCODFjczcyNFlsNE1wVmhLb21rRGJNc0NVV09uQjZVOWVTUXBGV3liOFc4QjBqdmZCR2lRNXl5YjM3c3JvYXlXYnk3TzNRaXptbE02S0ljYkNrNmZYNUVJUUp3b3BZY2JVRkRaNnM3RURSQ001Q1c0emZkM2NnLzg1RlRneFFDQkdzZTBqNWxNRFE4bXV3YlNHaThJNDJKbGZ4c2tLOU5tSDBIQ0JoOG1VcFphZVNlTytyNERsQlg3N2gxSHhQNEpRZ24vQ09FTGwwZWwzOElpWDFNM0hTRFBQT0JyQTZRL1Z4QXJ0eTFzcWFVYTcvT2RJNWtNanlqQU1raXNsYzh1bEc2cjB6SVhybjBrK20xRytUcmJiK0paT0NaTzM3ZGJYWDhJenN1amJIb0lhTDJaazZyc015VStONk9zOS9iY2RZNnB3STRYejEzUHBkWHJRdE1GT2FRL1VJSXJiMjlsbithaXplN0dnUUw0SXZETHdSWXZFWnk0M28vck8xWUhBb2thUXB2L0ZOZFdkSTZyNEwvcmE3TDQwalV2VzlxZUd5WitvNjVPc1FmaFp6N2lpc1QyUDJxUVB3WlBGNDlTTXRiSzRXQzM5czNRYmdyeU5CVzdlU3QwS3VsNzlNVlo0QVNpTm1KNUEwM1JZSVdJT2luYlVWckZmK0FERUg1NHdhSkNCME9SZ1FXQnpuTGhOV1BkckZYMWI4K0VDMEZBS3FRWllzcStRZkVoNlpTS1dKSEo0aDgzNmVpcStkN3Z5aVFQaEFoYU42YzJDLys1UjYxMktTaGR0YTd2OXlrOTVMNjQxTmYrSnYzMHhraWRSY21OOGpQMFZheFJHRTN5Mk5ibW4xVjF5L3Y2VW1sQ1FJWTZ5SXJnUVNvZEpieHFZMXovSE05aWFuTUsyOWREbG9BUG9NQit1UWZ6NmtzOTVIeGZlUDNWNGRHazJoR2xrQUM5T2ptWmw4NVpDKzkwWTFtYWdrZVFLdVgxeXh1cWZEUDlSdzROaUFjUWwvRUpYaFJXTnVab2MxZjJjZUtjaCs2Yis2M25sckdQOE5QZjlYNXkxZTcrQjR1YTQ2SDVSMk1abll4aXV4K0tzdkZTL1dNVDRvWDM2Q3hnc0pTL0FCVkFKeHI2eHB2VkNFcFhOeUpDbG5JVlBBN1U4MFJmb240a1VoTTNaaEppRVhKZmlBaGVBYXJWTEVwVUNRaWJzTmtrdGlYRThIeDJNb1dEZ0h5UzhHWStlZ2JnSFpLcFROVzhWQy9HQWZ1SWdUSUVVb2dGUXpic2NXdVR5UDBtWFRkdlAvWmNnTWdEQkIyWFJVMFBkV0w0L2RGbUpzUVlJejVHSmtPd0RENzVld0RabDI5MVpVTDBBRFF3RkJ5dWpJdFM4dDY4dEJNSlFFQVJRMXprTVdsaFBVbUJzdVA1dzRRWitGZm02ditCajRLeTBWU0dDTkNVRzVUQVU0cGlVNGpQcjNMcWNYOENhU0lSUS9zNmNjdWlrVG9STk9jQTBiRlU1Y0d0eWdRM2EzQ3NPYkVBSG9VNUFjSDA1YzJna0FMOURIRkdBUlF4TUNJblNUa1lJVDV5OHRqYUdoV1RPa2x1MXNkQU1mVkE5ZWxwMHp3WXd4c25UYzd0a04xUktMTjhsZmZPWHFzZlFoSUR6OWV3MXdGNGdERTg2RHB3WXArSHlpTGplRzJoR0E5SjMzVW94R0pwODZQSEdzZndsaHN1U1R6QXZyVXh0MzBrcUdSRWtUZE1jOEJLK2JoaU1SZjcrNDJ0d2ZtdkZLM3kwNDBQMVYrUEFaSTd5Nkt3UHY1eE1lOEdaRjRMWjU0NThBMUlEM3daS05zSytwVkZKc3Q2S1VUTGR0UGxEdklxeEdKTCsvcG5SNDVqODErajVBZXNWQlJIUnBBZXNsREo5dHhnT3k3UWFhMldMM01teEdKazFPWlY5L3V2VUVLMTJ5eDZGR1FIMm14Y2IxL0xhcGZWY2dOYzZ1MnpGUitjbzk2K3JiMm9TM2IzODJQMEV5VGxQL3ByMi9mdUxhQks5cFRqMzlqZjBHc1oxdEVwZWl4SXovS1FHQm5PamcwS0ZCQmg0WXpWb3orSVMycGlCRTYwem5DLzlHNjZsbXpTaUxBM0ErU3lBbGhXWHI0d1Jld2U4VE9jQUQ3THF5clBoRFFpc0ZHMmpDLzBuNWhSRmh4Y3hwS0tiMWRBSkpZeDNBZUFERTk0Q0FPd3lJM04xMGl3MGxjNUhwVjdZaFEvcituejQ4SUovaGx0L3BtYVFabS8xRXZHMGdQODMwYjhnTjJRTEd2QWFKMnk4dTZlNHFlaDZVcVI4WlNuZDFqL0RNc21sY09KSURmaWxMUUM4MmJyYXFRclhaTlcrKzZaTUtnMlROdVg2blFEODBkY1Bqa0lQOTZGamFYVTJrQWpnZUNNSWQ1S1NMQlU4Ry9mZUF3QVhjeTlRNTNaU0FzclNnS1FhL0ZrQjArR2VmL0luOExCTXd1YXFrSGJOdDRLVGhNc3EzZ01VQndLOFpYWFlsR1lqTjA1TlFnZjJEUWtwWUsvakt1ZHJRVzh4S01kbzBYNXFJRVRGL3FzbC9JaFFGbHVZU1FNTUZEWURraDVpaXd2QStta3BtRHh3WTJycnVGOVhPUkNGNjJxQ3JicWU2RXBjNlc1NTY1NCs1VjV2VmlEeDJQZit2ZmpySG8wU1UvTHJqUERwc3dKMFdJNlF6bGZiRHZVRC8vSkd0dnE5WGxKV1JWeDJxMmJsMUlNWlRIMm9lazZORXVQLzRGU0poUnRKbmdrV0pvLzlIcjFxMEk4OHM5cStxc0ZzZW13Y28zVzAyTlpiVlZsTVVyaitYdHFJb2w3MVJMdWtpai9YTFlpZWFxS1BVWnBDYW1JUTFzWldoOE12MjJxZWU4c0t4Y1hGVmRXV0tTRU5CdnNRL085M2pXTEtkczFEbytrVDV4YmhpdUNJWFRxMEZqeCtqdXMyTjJURE5BaWlJa01tUVF6OERLME92djhQYWRqRVR3L1RRbktaOFA2aCtMWU5NbjYxWlJWc3MvZUR5ZTdjL0hrcEVYQmd1Um0vTGpmQjRJS0VMTWlGYzkxNEl3UHRVNWVvYmJyYkY1UXlPMjkzQ3lNdFFsVWJ4aFRiMzErUGVPWEFmU3czeVc0TmJmbGE0Ti9RRFpGeUZsWjhqNjNSZGV1OFM1a2p0WDFNNmZHME9pemdvV05KaHQ0TmF2cnErSW1TUGNpVVQ2dlNQWHNkSjljWXlYaC9LRDNNaEV3MFZJeVpEeEdYcnZ5SFhPOG1FWW84ZTJOSFA0QUhhSFdSM3FoKzZmYXoxZzc4SCtSS0ZmRHdvUlJDaDVLRDlPQWNRU0lXcjNxcFFoNDlRNE5YMUhDUHI1cm91Y1MzMTRVMU45elN5OU1YekwzTmlHTlpRQlNhKzgxY3NQMy9qMEFDcUsrNnc2SUQvSXBiNHdpVTRKZFlaWVV2VHVoLzBmbldZbURFdG5HWCsyYllGeUZFWTkvc2x0QzYzdmYzUjZxUDNDcU5RdE1PbFJxczhnS1JCRWhDQ0dUQXRER0tFZnZkaVJZYThoLzhpRFRVdnpNbjVxVVZqdW15c1dWMi9aTU52NjRRdXZYOUpPajhCNE9TOC95TDBCWlZLOTY3WVpNbjNhZVduc3hkOHlWK0kxRFB6TTltVWxVZFdxeUNPckpHcDhjL3N5NjdVZE9oNy84RVNjejU4ZGVyeVNIMmNCZ29nUXhuTDNDMDh3bWo1OS92OHVudXNhWlIxODY0TEtwNSs4VlNJbnpWQ2twNyswSkgra1ViYWswdVFuditxRVh5MmtPeGt6bjBOWDVRZTVPU3NEWVRGREVLR1dZaWgzUUNwTnZ2dlRNK01Uek02TnJadm1QckcxUld6QTJETHlKNStadjNVVEpmaDY4ZlZMRjN2SDFPaVJjbjB3cmRhY0hoVVVpWlZYMVZVWmd5TVpKODQra2NqRXlpSU1MQlNkSVN0RFFJeUdSNVBudThjMnI1L05Pbjd0eWxxTWNKdDhGejFHNk12YkZtei83Q0xyUiswWFJwLzcyUm1XQTJZT0htSDBpQ012N0liOFpMRnhGcUFzUStVTWhwU2RJVXBkaTVPNUNHUFVmWFZpZkNMTjJSRjh6WXFheFMyVkg1MGU0bmZFNXFlRjZxcExudjNhaWtjZWJMSWVOalNTL09hL0hoc2RUNEg4ZlJ2MHNCSS9qaG92bHdCQ0NNWEtJdXJPRUhqMkp6QUNQM1YrSkowaGQ2MnNaUjJ6b0tuOG9mdm1Jb1E2ZThaU0tjTEpKWmJISXAvNzVQeS8rNHNWMUdFYms0bjAzLy9IQ1ZZYWswTVB0a09QeFhoWkY4WFdDNURkNVYyQXBXQVZHR1JhNUlXK0pTRnplMUxhRnFlRkw4WFg4OFRXbHE4K3ZraWtuZWtEYmZGRHgrTWRsMGF2OUNmR0oxSUlvNHF5Nk56R3NxVUxLKzlhV2J0aFRUMXJXT05VTXZQdEg1eWdEczJXRUI0YjlEZ3RQK2ptOGk0dUFlUXlReENNTnErZi9jejJwZXJSTzdzTWpTYi80UWNuVDNZTUMzTjl3YVVuQjVBYkprem9ETW5hTWdTWWppNjBhSjA5WXdlUHgxY3ZxNm1wS3RGNG0yYzZSNTc5L25IcnZLSWlvOGRWSDBqb0RFbjQxRnlYeU9vVjhXTzA2NE5UdTM5L3RYUldaSGxybFdFNzNwMUtabmErMXZYY3o5cUh4MUw4YTdDdUZjeS9UYWI1ODhMMThSSWdlRlRQU3pDS3BJaXFSaXc4MG1seTZFVDhyUSt1MWRlVUxHeXVVS01vbFNadnZuL3RIMzk4Y3YvUmdla0IvNWl1T25EaFVhREhOZmx4MjRsV2NJWjQvaERsTldWU0IydWZXNVo3TktlaDlEUDNOMjI1ZC9hY2hsTGd2VnpzSFgvbjRMWGY3YnR5L2VaRzlCaTgzSjF3aUoyZjZmSEFpYmJQa0JBalFzZUY2VTZ6UG1scEtsKzdzblpKUzhXQzV2TFo5YVhsc1Vpc05KTEpvTW1wOVBCbzhrcC9vdnZxeEpuekk4ZlBEZlgyVFFwZEx0YjBleGxaOVIwOU9ZQzhXV2g4WUNoWndGRGUvQzdUd2tLbXFXSG02V09GcnpFTm8yejdVVEV5TlV6dWtFdVh4eTlkSG9jNGFncExJRWdKajIvcHlSWFBscmd6ZDdVVytrT2N6akw2b2l5OE42YWREK0ZhQ1BBL1BqZDBWd3gyOFd4ZkVQdU5IdVR0R29rY2hxeXh2V0JKZWU0TUcycnI2dDIvZ245YURCTWV6SGI4TVJzMEQrbEJucTlVRDJkSVFZcVFhQ0N6MnNJSjhPOWlEanJLWnN0UDlDQS9iTGJDOFljZ0xoR3lla1UwZHhwekhXMk95NktpUmpLZllaRm41bWQ2a0UvMnlxRG9FTmNsRXU5dXdWWWVxUms4VXREd1RvdEJ2cHJWYkdGMjV0UVA5Q0QvYkxaQ0diNG9ZODRRMkZpd1doM2JJQVlMandOY0ZGeDQvRU1QOHRWdVBRb015V0dFNVpoUW14M0cvMFVXT2dHbEIvbHR1NmNzUTNCekpvZVJjd1lNY0hJNE9ueXo1U3Q2a0EvM0M4dldqbENLNEJoaHVPRFlzV0ZZU29rQTZOQ0VCeUYvMFlQOHVlVmx0bzdNM1IyV05jeXNpK0ZucTVnb2hXQ2k4RWxiSUFhZEx1ZGpzK1ZyQllLYk0vcFR5eDNGNFowRjR5d3BSQk1lZjV1dFlBREVNMmNBakpCb3dvWXJGb3gzR1VKMGZHdTIvRzdDcU9iTWJKc3NDY05jWTFEdDJvMlBpRHNXakE4dWFLa28vNk1UQUFVU1NCRXp5NEl4ZTFWNCtDSUtDdENJVmpIREdCYlpCNFVlRktCOTQ1bFNoT2pkRnl4Qllva0VJVHBsUml3NWlEZEZMaERvQkF3Z05Zd2dKRW5SSU9Na1lTbGpHVGgwQWdtUU1rYW1GaVhxZTh5cFFsTjA2QVFZSUNoRzdNeVB0YVVWa0pKWUJKNjdHRmxBMFFrOFFHS01UQzFITk5GZ0Q1cWlRYWRJQUxKaXhQU0l3VEE1QkUyK3AxVUU2QlFWUUtaV0VaQkViV21pSDVjaTVxWTRBVkloU1o0R2hUaS8rTGdwY29BNEpFRjVza2RNMFhNemZjdlZOUTNSYUtuN2N3czlMQ2FZbEpHaXBvNW1BalRvNXF6Q1ZDb1JSVE92VU51WVNwWENlV1phaVlaVkVOSmdweGhoRllRbEJDZ3NuZ0tVU2lVNmUxT3R6YUU1QzR1Y0J4MHFVRmowbWJCUWhNSUNseDh6UUZrNUNrdFlnQ1VIVEdqQ3dxTEpoSVd1ZEZpazNPZFFnY0tpVllGQ0VRcUxyUHpRRlNoa0tDekM0SXNKVUJpT2hRVVNmUEVVS0RSa1lZRVlMNTRUSFRJVUZnZzlnaWdzWkNnc3dwR0dCdC9haFF5RjlQQTlZMFBvTVlVTWhmU29LRkRJVUVnUEpDb1haNkpEaGtKNmJBRVVNaFRTd3ltNHVxWUJmdmJzQktBc1RHRmRGeDg2MlphVlNpYkxBWlJsQ0JMZGhhVzRoVWNkb0h5R1Fpa3FKdUZCU2gxWktnQlpNUXBKQ2lnM2R0Q3hDMUErUnFFZ0JWUnlrTzN1YzdzQVVUSEtsWkFuWDRtTnFWRzBqTHpRQTVDVkpPcWxoOFdUWW5xTTlZN1kwUXdRbjZld2VGSWNIZVAxLzRlcWNBY1Uwb1FxQUFBQUFFbEZUa1N1UW1DQyIsICJzaXplcyI6ICIxOTJ4MTkyIiwgInR5cGUiOiAiaW1hZ2UvcG5nIn0sIHsic3JjIjogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBZ0FBQUFJQUNBSUFBQUI3R2tPdEFBQkluMGxFUVZSNDJ1MTlkNVJkVjMzdTN2ZmU2VTB6bzVGbTFDVkx0cG83THRqR2NzTVVBelloQmQ0QzhrSllXVUFTekNPOGhQY0NZZVZSREVsZVNNTExndEFTUW92Qk5HTmo0NEp0WElSbFhHUlpWdGRZMHFpTXBKblI5SGJubnZmSHdIZzg1ZDV6OXY3OWRqdmZ0K1lQZSttZWMvYlpaKy92KzMyLzNXUjlRN05JUFhLNUNsUUNBS1FLK2Z3b0tpRUhyaGRDckY2U1ExTUFnRlNoL1JoVVFjamdIY0FNeGdmWEF3QXd2eXJrVTZVSFlRckFkTktQdy9nenZqb0FBTUVqS1RNRUtRYmhDRUJNMGdmWEF3Q2dvQXBCaW9IM0FsQ1M5OEg0QUFBUTZrRklTdUN4QUV4Ui8reVBCTklIQUlCYkRLWjR4bDhaOEU4QXdQc0FBRUFKVWljQTgxRS9lQjhBQU90SzRLTU0rQ0VBazlRUDNnY0F3QmNsOEVJR1hCY0FVRDhBQUpDQjFBbkFiT29IN3dNQTRKY1NPQzRETGdvQXFCOEFBTWhBNmdRQTFBOEFBR1FnalFJd2cvMUIvUUFBQkNZRHJtbUFFd0tBd0I4QUFGaUJOQXBBTGxjQjZnY0FJSVV5WUYwRGJBb0FjajRBQUtSWkJxeGJnUXpZSHdBQXdDU202RzZTQUMyZVNHakhBVXhQKzRENkFRQ0FGYkRpQTdJVmxkV0dxVCtUeVlIOUFRQUF6dlFYR3VzeVFvakd1a3pmWUNhVHlSVUtFeVlMWURRRmhMUVBBQURBZE5oTkI1bExBU0h0QXdBQU1CK3NwSU1NT1FDd1B3QUFRRXdyWU13SHNJOEJJT2tQQUFBUUIrYUhCSGhUUU5PVC9xQitBQUNBT0pqT21henBJRVlCQVBzRHR0RFVVTVp4Mis3ZWNkUXRFSklHY0FrQTJCK3dTUEZSeE5OYkpPUUJDRW9EV0FRQTdBOXdjejBUeFpQTEExUUJjRmtENkFVQTdBL1EwcjJEWEsrakNwQUV3QjBOSUJZQXNEK2d5ZmhlMDcyQ0pFQVBBSXNhUUNrQVlIOEFqQTg5QUR6U0FESUJBUHNESUgySUFlQ1hCbEFLQU5nZktNTDdJSDFsTVlBU0FETTB3QzBCQVBzRElIMklBZUNkQmhBSUFOZ2ZtTTc3cnBBK2VUR2tXMklBSllBRzZHdEFqb3I5QWZDKzMveXUvMFFqQ2pGVnoxTTFEeVZJclF5MEg5TWRETkRpN3VsYjFpSDhCKytIdy9XRTVXUlRCU2hCYXRGK0xEOFZkdWR5RlRvYW9KVUNRdklIdko5cXhsZnBjSnozUm5Zb1pRNUFhQ2VDMUFVQTdKOUM2dWZpL2RTT0ZmUG93YVFTUUFhZ0FhVnBYSlA5QVlUOElIMmFTcUFUZzhtUGhkUlFlbVJBZVRCQTVVUXdwUDVUUXYxTkRXVlJKQ2IveVBodTZnOWdycHlwYnpmNUtWSEI0V0U2L2FvZElxYVNBa0x5QnlFL0luMXpJSElHR0NFSTJBRUkxVVJRWWdFQSs0ZE4vY0h3ZmtSZEFtbDlJUUNwRWtBR29BRWk2UmdBVXYrZ2ZuZElQekw3dk9LUE15RVBSQU1HMDBjSUlBT0J5VURTd1FCRk5rZjRId3p2RTFBL1B3OUh6aWVTNWl3aG95cEV1a3FBZ2VLUU1IMWxRREk3R0Q4RmhPUVBxTjhNOVVmaGpodHdTWUxlWFRFOEVJd0RFQWtUUVhGRlEyMklHUWlUK2huNE9VckhZUEgwMTZRVUF6MURNTmtZcEVSZUtCREVYeDRjMXdFZy9BZjEwMUowaE9sQnJPWkE5V1p3QTZreUFiSFdBV0RzMTNmcW54cm1WV1Ivd3NucHY1MmVqdS9DV3pPcW4yeXFrV0QxZ05jeUVETm5rMndoR01KL1R3Ti9SZW9uV3BjVXZid21DYnh2dHJwVXYrQjBHY0FYOFFoSkticDBDZ2pKSDkrcFg1RTRLSWpNSm8xU1AxeGFYUVpBa3lDUzZpK09qSkJmRGtERVN3UWhzUVBxSjZaK1k3eHYrQVNDNG8vamxvZXBXdFZTZ2toRkJyQnVJR0NVY0FBSS8wSDlqdkMrZDZkTGNrdUNyaWVBRzRBSlVOc01EbkNXL2JWeS9hcTh6NUhjajZLWmY5NkIreFYwYTE1amJBQURBNmx3QUFqL0F3LzhOU2lKSTk1UDFRbnlIUDVBeXhOSWxmTERDdmh1QWpBR0FPcTNSdjFSaXVjRXpYaDNFajJZL0RTS01wQndlQUFEQTJFZ1cxRlpqZkRmWC9aWFRQaUE5MVBnREJTVklQbEYxWlhaNGRFQ3ZwMXJPTk5mYUt6TE5OWmwrZ1l6aGNJRUhBQUNmMnZVRDlKWHFDaE5NVkEwQk1sbkNrMk5Dc0FLZUlmY2ZPRS9xZ2JVcjAvOUZubWYvTW5tbHdGTTFaN1VtdmxwUWdhUUVYS2Q2T2ZaSFdqZVdVREkvd1RDL21xVFBmUW05aGlidWhQTi8rZjFzOGpyVS9HREpudzlMQjUyRFpNRVhtUWpIMHdEOVluOWs3RkFjbkxTbkZuSXl2dFdtTmUxc21uV3NPTDNUZkkrbUNmcUYrYVlCb3JoMzBBQy8rU0pBczFNQlRtckJ0WFRtRzZyTmZOVDhyMEQ1b202Z3lMelFlRUEwaDc0NjRmOFRLRjBZR0I2TlgxREFDdVFadVJtaC8rb0ZGOERmMU5SUHlIcHAzTnlVRVJ0RG5TR2l4T1BFaWNaSDhZRUliZm9mdFpRY0thSVgwQjlnZjJaUXY1UXczenJ0YUg4Z1ZRR0JwS0lFNnlBUlJRWkNrWUt5RkgyVDlDVGplUjg5S2svQXUrYnFpSzFqOFdYRVVJNnlGMVBNTU1nb0VZQ0R2elZlSjgyM1dHYVVLa2dyWlZkK2NscWVTR1ZqQkRTUVI0eC9pdXpRRE1kQVBJLzNyQi9vaEc1NUZHLzlzUnpJOEYrWkdwK2ZtUnRJWUQrUXhRK1piSUdrOFFLQ0tTRGJHQytMQkJTUUE2eGY3SzBEMXZnVDBMOWh1amVFUmdwbUJVWklQZGJTQWU1WlFoUUJmNEYvcHpVcjUreVlNbURlQWZ5aVQ2emJxeDJ5OGxQTEdXeUpoUTNJeFI3Z2hEU1FZN2c1ZDFBc2Y0ckpQWTNSdjNVQjhHazQ2dExKMjRtRTY4RGs3UmxrbEpVWVNkUlU1aHpjMUNrZ0N5elAwZmFKeEg3YTB3Y0pOd2hPbVhUZzBqZlYvbE9TVDk5c2xHQjJBVkFPc2dpSUFDVzJaKzJpeWNkN0xWSi9aZ1dTbG9KT2pLUVNBT2kyRzB4dmd4QUEyd0JZd0IycUY4SSs0Ry9Bc1hRVUI1UXZHYWs2WHNvREF3a0dCWEFrSUREK00wWUFBWUF2R1ovRDZqZkJ1Lzd2QXlBNXFrS04wZzBNQkJYQmpBazRBWm1Ed01nQmVRcSswZjA3SzgwRVZDUFJ2bVRQTmFYQVpoNE43MGJKTHNrU1NPaFRRZGhsWUI1UUFCY1pmOTQzUzhSKzV1amZqWjJkSEFsZ0lraTZkMWFUUWJpYTBBQ0dZQUdRQUJTeS81eFl5dmJnYjg2MVRCUVlPVGhhREZqbVRWdW12UTZMaXNRNzduUUFBaEFhT3hQMVVPU3NyODU2azhyNDF0NEk0TXlZRjREQktZR21VSzJvcklhSThCT3NMOXQ2bGRuSWlKQ1N4dWs3UnNsdWs0bVdBUkdOakpjalRGaGFzd1lCNFlEQVB1cm5ReEFFTkNtZkNVQTJldXIzc1Y5S3dBZndBMElRR2pzbnpCMXE3QkROQm52QThSMUVnbk84OTRUTkMxb0FBUUE3RS9HL3ZFbldyaE0vZUI5UTdYRUx3TXhOU0NLMTdpaEFSYUJsY0Flc0Q4dDlRczE2dGVnSTJ0a1NuZDRzWlNtbDRMcHJndU9FbDhjKzJTWEJDdUhZNjBaanZIZ1NRM0FPbUVJQU5oZk4vQTN3OThtZVorUTZKTSt3b0F3YUNsQlFobEk5UE1vZ2daNEQ2U0FiTEIvNUFQN201cG9xTURGTTJEeGM1c3NqTEZKdWh6cElKSkNJaGRFam14TmJTUG1nSnBtZi9lcDM2V28zeTdGYTRMSklrZ2pWOG9FcnhuemhsTC9xWmdicW9ucE0wSGhBQUpuLzRpZi9WbjIzbkVqd0hmMlJkVHJuR2RoSUxFVmdBOHdCUWhBNE96UG1tS2c1ZjFnU04va0N4cVl6UVVOZ0FBQXJyQi9rcm5ZSGxCLzhLUnY1c1c1WlNDK0JrUlVVUTQwQUFJQTlsY08vSk94djNIcVR5ZnBjOWRHeERuTGl6WWRCQTF3QkpnR0dpRDc4MUcvUHRNWjUxYUNteGhiQXpCVlB6cER4NGtYQUNTNUlPWmFnVGd6UkVtbWgySnVLQndBMkQ4NVIwZGNnNEhGZzF3K2xwL3Z6NHY3YzFSWHhEWUNCQjhBQVFDY1kvOG9FZnVib242V0NUQ21XTmg2WWZScmoya09XTXpiUWdNZ0FHQi9yZFlmZTFTTm5nOUlxSitEWngwSFIxR055Z0NwRlloVEQ5QUFDSUJuN0UvU09lS3dQMlZBYitSNEFNcVpMZjZRdnBsWDBLeGJKaXNRc3g0TWFJREFXWklRQURQc1g2SkJtMkovanJTUGN1QlBNNC9GZjlJMzhHcktWYzB4UFl3cUhhU3ZBVGhQR0FLUUx2WW5kL1MycUQ5VTBtZDlYeE15UUowT2dnWkFBTHp2dXJwM01NeitIUGtCSXVwUEcrOXoxSUNPREpCYkFVTWF3TnhESVFEQTNPRy8vc0N2Zyt5dkZ2aHJKYU5Uei92a2RhTDJPU0tHdG1SQ0F6QWdEQUVBK3h0ejdtUWhKM2lmdVphVVpZQlFMcUFCRUFDd3YyMzI1d244TmFrZk1GTnBDcCtKMWdwQUF5QUFRYkcvZnBQWFovK0ltdjBWYUFVaHYwZUdnTmNLVUNpS0FRMFFHQkNHQUpCMFF1dnNUeGpGR1FqOHdmc3VHQUkxSzBCb0dheHJBQm9oQkVBMy9QZUcvV21kUHFnL3JUSmdPQjFrUUFOZ0FpQUFQT3d2ZE51dVlmWm56U0dBK2gyWEFTNHI0SUlHbExvL05BQUNrSmo5Tlp1MnYreWZPR1lFOWZzZ0F3cFd3QnNOd0dDQUtuQWVnR3FqOUlUOVdRTi9MN1ptMDRleDh3Q1VYekIrQ2FNb2luL1lRTnlUQW1LY0VsRHlKeVdQRUNoeGZrRFJCOFE1bndBT0FIZzVXRWdoK3llS0VGMkwrcTJjQitDcEcyQ3hBczc3QUNTQ0lBQW0yRjhRdEhJNzdPOFg5YnZBeGE3cFFWSVo4RkVEZEI0QURZQUFsR1ovM1U1WXRBMDZ5UDVKQS84ME03NFhKV1N5QW81b2dQNW1RZEFBQ0lCRy85Rm9uV2JZUDBySS9vNEgvdjZ1SnJOWWNpWXJFS3RwV2RjQXJBeUFBQ2lIQnF5cGY5Mk9Fd2xCSWlGSzdHOHJsQTRqcExEeU90YlNRZFFObFZ3RFlBSWdBS2JaUDRxME81VWc2MVR4dmI5SjJrckQxaEdHM3pIK3M4eW5neUk5OVlJR1FBQjg2dlpPc2I5VDFKL09MWU5Ndm5VaUdmQklBd0FJZ0FmaFArdkVCajcyZDRxWU5PdFA1eStNU29qL1RjMFBDMnRFVGpBQkVBRFAyVisvNzhjK21EdHloUDJaZ2w4bUJqY2pER1lNQVhrNnlFRHJoUVpBQUhqWlg2ZUZzck0va1g0NGt2YWh2Yi9oVU4zTTA5MzVCR1Fhb04yRytUUkFwSDVXS0J5QXZXVkU3ckcvNDlSdmwvRk5sczJBRFBpbEFZSDFmUWlBSytHL3JlUlBldGhmbjh2Y1pId0RaV2FWQWI4MEFJa2dDSUJiSVhvdzdNL0hNcHAzOXBIM09kN0MrZ2NLWGdQZ0FCRCtKKzNWNGJDL2E5UWZCdStUdnhlckRLUkNBMkFDSUFBSjJEK3l4eE0rczcvNlVlYUI4ajd0bXpMSmdGTWFZTWZRcDFVRGNCNUE4cmJDRi83N3pQN0t2TS8vTmZVZXdyYVIvRlN4cE5JTDBaWXJ6bzc1TWM4U0tIMDZRUEc5KzR0ZVhyeWNPbWNHd0FFZy9JL1RhYjFuZjVZNStKRkNUVEt3UDhlMi9meEhBYWhWQmNkSExEMXgyWWdQUUNJSURzRFI4RDhBOW5lQitsMko3cW1lU3hHTnh6MSt5N1lWY044SDZCVUxEaURONFQvelh1U3NrbVNZL1ZXT0p0ZG5memVQQmFBclZhUnlpaWY5bHpYa0E3ajZpMklzbGtJVGtDNEI4REg1NHl6N0c2Vit2M2FNMHk2dG1nejRwd0ZJQkVFQVhPcTNMTDBsTVBaUHlteGExTy83VHFGNjVZOFNIL0JBL0tHOTFnQVh2WWw3U05FWUFGLzR6OVQ2WTNkVW8reHZvcGR4TW41VFEvbktKZFd0TFpWTFdpb1hOMWMyMUpVMTFKWFYxK2FxS3JKbFpabXliQ2FibFJPRktKOHY1Q2Vpc2ZIQ3dGQitjSGhpY0NoL3BuKzhxMmUwcTNmc2RNL1k4VlBEeDA2T0RBemxFNzlSOHRSMTByRUI5Zng0OGx2RkhBOG8vWVlNTTNkS3pBZ3FaUUs2ZThjaEFBai9TN00vNDJKOWI5ay80bjVBRWxSWFpUZXZhemp2N0lhelY5V2V0YngyUVgxcGc1L0x5bHcyT3lVWTgvMnNiMkM4NDhUd3dZN0JneDJEQnc0UEhqZzhNRHc2d2FRRWlXVEFOUTNnRzNsVm54V0swZUJVQ1lETzJLOHlaWEVuZjR5eHY0L1V2M1psN1JVWE5GOStmdE82bGJXWkRFdGZyNjh0MjdpMmJPUGErcW1YZU9ubzRJc0grbDdjMzc5OXo1bmpwMFpLdnpLYkRCQk9FREtoQVk3TkNFcVBDWUFEY0RINWt5TDJwNmIrMWN0cWJyeHk4YldYdGJRMFZoaHVLbEtLMWN0cVZpK3J1V2xMbXhDaXMydmsyVjFubnRsNVp0dU83djdCUEswTUdMWUNqbXRBOGY0ckVlb1hhYlJOelV0V0w4a0pJZHFQNVVOOVNhYXBuMUVFOW5lRitpc3JzcSs5WXRHYnJtbGJ1NkxXdGVaWEtFUXZIdWpiK2x6MzQ4K2NQbkppdUppQUpPMjlzWldKU3VGSy9VRHFsbGtxL21PUkowdlZtMG9wUWpVQlU1d2Z2Z0JNVHVwU0V3QTE5dWNXQURQc3p4WDRVNGY4Q3hzcjN2YmFwVys0dXJXdXhnTTdlL0RJNEVQYlRqMnk3ZFRSa3pSS0VQK25KREtncndGTUFxQ3VBYkxFRFlQVWdDbk9UMFVLaUp6OXRRZ3hJUGFQbU80Yjd6WUxHeXYrMjV1VzM3U2x0U3pueld6bU5jdHIxaXl2K2VPM3JkcDFzUCsreHpvZjJuWnlqdXhRa3NSTm9sRUJnZ2s3MnJrZzV4SkJSVWNDWk9qWm84QWRnSFBoZjJyWlA0b0lTMVZUbFh2WHpTdmVlc01TajZoL1Rvem5DMDg4Mi9Xelg1NTRlbWZQSERYRVlBVjg5d0V3QVhBQWxzTi9XK3h2SnJ5bVovOG9JaXlQbE9KTjE3VDkwZStzV2xBWHduTE5zbHhteXlVdFd5NXBPWHB5K082SGo5LzdhR2Z2d1BqTWw0L0gyWkZMUGtDM3RFV2ljdFVaUVRBQnFYTUE1c04vaThrZlkreHZpL3FGRUd1VzFYemtQV2V2WDFNWGFtOGN6eGQrOGF0VFA3aXY0OENSUWVYUVBjN3ZEUGdBVzRNQk1BRndBTmJDZjdDL2Zwbm12QzZYbGUrNmVlVTdibHFleTRZY2o1WGxNcSs3YXZIcnJscjgzSzR6UDdqLzZOYm51bDZ1amRpeGFCd3JZTUFIc0E0R3FKVUtKbUEyc2xYVmRZMTFHU0hFbWY1Q2VPRS9ZOElsMFMyWlUvOXVzWDlFdkJwczJlS3EyejY4K2JyTEZ6R3Q1M0lRclMyVjExMjI2SnBMVzBaSEN5OGRIU3hFaWFOM016N0F6Y0VBOGltaFVvcXF5dXp3YURnTU9jWDV3UXBBVldWVzlZd3FodVFQcHhKcHFvTUxnWCtSaTE1MzFlSlAzYnFwdGFWU3BBOE5kV1ZYWHRUOCtxdGFJeUhhTzRieUU0bTNrVEFnQTVxSm9CS0ZkQ2tSQkFFSVAveVBURnVET09USW1QeXhIdmdYdVNpWGxiZStlOTE3M3JiSzk2ayttcWlweWwxeWJ0Tk5XOXFrRUFlT0RDYVZBZmMxd0xBSlVOT0F3RXhBNEFLZ0hQNnJVUlZmK0I4dyt4ZS9vckcrL0xZUGIzN05xeFlLUUFnaFJHVkY5dUpOalRObElBMGFBQlBBS1FCaHpnSlMyL3ZCOE5UUDFMSi95Wit2WEZMOXViODRkMUd6aWMxOHhzWUxCdzRQN2ozVWY3UnorR2puU0hmdldFL2YrTUJRZmp4ZkdNOFhLaXV5MVpYWjZzcHNkVld1ZVVINXlpWFZLOXVxVnk2cFhyVzB1cklpYTZ0NW4ra2IvL1pkaDMvNjBQSHhmQ0hsR2tDL0xDQWRPME9FdkJXRThzNC85TmwvaDJmK1JDU25FRWYwcThIT1BidmhVN2R1NHQ3WFlYZDcvNVBidTU5Nm9XZFBlLy9MU1pYWXlHWGw1blVObDUzWGVPbTVUV3VXMTFocDU1MWRJOS80OGFIN256aFpLTVNhcDFMeUY2bEtCQ21iZ0RBMEFBTEF6LzQraC8vazdCL3p0MWRlMVB3M0g5akFsL1EvMlQxNjE4UEhIOWg2c3NSZXpVblExbEw1bG12YjN2Q2ExZ1liYTlNT0h4djY2Zy9hSDMrbUszQU5NSmtJZ2dBZy9HY04vOEgrYzJMTEpTMGZlOS82TE05TS8zMkhCcjU1NStISG4rMHFGRmptMUpibE10ZGUydklIYjFobXhSRHMyTnY3cGRzUDdtNGZTS2NHd0FRb0MwQm9nOEJWbFNxWldjTlRQMW5wMnluMmoxL2E2eTVmeE1UK1IwNE0vLzNYOS83cmR3NGVPamFVcVBZU1VXR2hFQjA0TXZqVGg0K2Y3aG5iY0ZaZGxka1Jnc1hObFcrOHVtMUZXL1hlUXdNbEQ2cTBxQUZobUlBQWhvTERuQVhFZE95WEV0RnloZitXMlQ5aVdSSnc5YXNXZnV4OTY4blhlWTJNRmI1NlIvdHRYOTd6MHRFaHFudVdKTWU5aHdaKyt0RHhqSlNiMXRaTGcwdElKNCtqYVYxWStkQ1RKNFZtd2wxUEE0STNBZFgrendlZDRueWNDS1pJWWNwanZ6cnNIMFVzNzJLWC9WKzF1ZkZqNzl0QXp2NHY3T3Y3N0ZmMmRIUU84eldKK1pobGFHVGl5OTl2MzdxOSsyUHZXNytvcWNKT3c1VmEreXpvN0grZ3VVV0VVQ3Aza1RkS3c2N095a2pORWh2RGk3OFlUSWd2N0I5RkNZcTZjVzM5SnorNEtaZWo3S0JSSkw1ejk1RVBmbVk3T2Z2UCthYnp2ZStPdmIzdi9malRqejNUNVZ6d0V0ZUpXbXFyUmxuQnNRd3ZCRUFaSmZJL0RvVC9Pc2tmajlnL2ZqOXZXMVQxNlZzM1ZaUlROc0tSMFltUGYySG5sNy9YempUWVcxSU1wcU4vTVAveGY5bjU5UisrQkEySWIzTTUraGM1TTVUWWE4QWZwQ01GNUViNHI4eitsazBKTmZ0UC9xcXVKdmZaRDIrbW5UclowenYyMGMvdjNOUGViL1U3L3VZL3B0SU8zN3p6Y045Zy90WjNycldRaU5ET0JmRzFkdWxHWGtadGkxQTRBSVQveE9HL0ZUTk94Zjd4MHo2VHY4cG01Zi81ODQzTFc2c0lQOW1wN3RFLysvUjJ1K3cvWDUzODVNRmpuLzYzM1FvcnpxejdBQmNUUVRBQkVBQXE4UTg3L0RmRy9qRzc5TlFQMy84SGF5NVl2NER3VFU5Mmo5NzZtZTFIbVpQK3lqSVFSZUxCWDUzODlKZDJSMDdPSGViVEFBY3RyOHM4QUFHd2t1T3dHWmp3aFZHdXNmOFVycjk4MGR0dVhFcjRVZm9HeGoveWR6dU8wUzN1WlNMaGg3YWQrdEx0QjYwOTNvWUdPR1VDckxNSEJJQUZhdmtmbG1PL3FFTWhhMEVTRy91dlhsYnpQOTl6Tm1GSlI4Y0tILzNIblllUEQzblJWbSsvcCtOSER4eHorWnVhZkt4aEV4Q1JqZ1dHa1FVSzNRRTRILzY3bVB5aFkvL29sYzhxTDh2OHpmczMwRTc3K2Z1djczM3hRSjlIVGZJTDM5ci9xKzNkRG1xQWc0a2dtQUFJQUV2NDcxNmNaTTUzbTJUL0dmakFPOWFzV2xwTkcxQS9zUFdrWHkyMkVJbmJ2cktuNjh4WWVqUWdnRDRWcWdsSTZTQndaTW9hS0lmLzFsTC9iT3gveFFYTk4xKzNoTERXZCs3disvTDMyMzFzZnIzOTQ3ZDlaVThVdWRrMVRHc0Fod213endrUUFOZmJjdEptbWdwaEpCZ2JqdWFxcTdxYTNFZmVzNDZ3cElQRCtVOStjZmZFaEsrZjVkY3Y5SHovNXgxMjJud1VmbHNtbmc4YWJvWDVMUURrdzcrcER2K0oySDlPZlBDZGF4dnJ5d2xyL1F2ZlBuRGk5SWpYcmZjcjMyOC9kSXgrN0RyUzFnQ1lnRVF2NVhVV0tOWHJBQUtMQUp4bC95c3VhTDdoMVlzSTMvU3BIVDMzUHRycGU2TWF6MGYvOHEwRGxveWNpd1BDS2V5ekVBQ0h2bjhVbVh1KzRhbWZGdG0vcWpMN29YZXZKWHlYMGJIQ1Avekh2dVFmTnpFTU5OS25kL1k4OWpUTGJuSGNHdUNRQ1JCR2VucWdldUt4QUJqTC8wUStOQXRXdnRMWlR1NFBiMTdaUXJvbDhyZnZPdHdaSS9tanorWm05T0JmdjN0Z2JMd1FYcE53SWRSVDR2bDBaWUVDZFFBSS8rbkNmeDMyWDdXMG1uYlI3NG5USS8vMXM0NDRsTTFBZVN3M1AzNXE1UFo3T3JqNmdkNkduekFCd1pzQWpBRVlsUm56L2R3aSt3c2hQdmpPdFRuU1V4Ni9kc2RMTStKbHcwa2Jqb2QrLzk2TzRaRUo3elRBQ3hNQWhDa0FUdVIvVkxtRHRrZXA5MFB0SGx6OCtpc3ZhcjV3d3dMQ3FqdHdaUERCWDUyY3djSU9xSzl1TWZvRzgzYytkTnpSQ0lMaE9wT2JReUFMbEQ0SFlDYi80OE9LZ1lpVEZvcmZQSnVWZi9KN3EybGY1K3MvZktrUUNmUHhmaUpQb0hiNTdmZDBNSTBFNkF1OUgrM1pkcStIQXdEY0N2OVprejhsQzN2VDFXMHIyaWgzZlRqWU1majRNNmNqNTJjZ3FzbEFkKy9ZejM1NXdtYUliellSNU00T2NTbUhsd0xnY3Y3SGo4Ykx6UDdsWlprL3ZHVUZiWkcvZGVkaGo1aEJRUWErZCs5UnkvTjJmS2pmeU5BbGFja0N3UUU0NFFSTmgvL005WG5MOVV1YUdpalgvWFoyalQ2MDdaUStkOFQvTXk4RHgwNE9iOTl6eGtmbU5UMTJSZGZvWVRhQ0U0REk1cDJzN1B6c1ZQZ2ZSYUt5UFBQMk55Nm5MZktQSGppcWNNaTdEcWNUNmtIODczNzN3eWVzZm5sWEdKRjhQbWprSk1OQUFFenFncnZmeldqNHo1ejhFVUxjZlAyU3hucEtMenc2VnJqcjRlUHh1eWR0RkU5eTI1aFc0SkZmbis0ZnpMTVNsSTRHZUdBQzBzRVlxUllBMmdNQWpPVi92QmphMG1UL0tCSmx1Y3p2djM0WmJha2UzbmFxSkMxeWtENzVzMHEyZ2JIeEFzbnhCaUhzNUtNb0tUWkZ5TWRoZ0xBY2dNUDVIMk5NSFZucStwUDN2dkhLUmMwTHltbnZmTmNqeDEzZ2ZaS25sN1FDOXozdXdDWjNCazJBbDkweklHK1FpaFJRZVBrZjE4TC95V3VsRkgvd0J1THcvOGlKNGVmMzlNNUh2dTRFSGtsbFlMNS8ydDNlZjVyaXNMQW9pRllIM29BQXZBSzBEc3ZUL0E5SCtLL1Ava0tJS3k1b3BwMzdMNFI0WUd1bnk5U3ZYTEQ1bWtRVWlTZWU2YUlxajNyamQ4QUUrSmdGSXVjb0NJQ0ZrTUdZd1F4Z1gvWHByMEM3Nzl0dkJlQ2srOVN2SmdQenBZTWVlNmJMWWt2MnBVZTdtYVQxYmw1cFFDbWd5Tm4yN1hmNEh4UEwyNm91MnJpQXR1cjJ2TlRmY1dMWUl5NVRhSXl6bThlenUzb0doeWVNdE14QVRVQ0syU2JGQWpEdmw0clMvdFUxZWxGOGluanI5VXZJQy83TFg1OG1EdndOTGdOTFpBV20vKzk0UHRxMm85dUpOdXZwUXFuSVNmYUFBR2pDL2dBQWFYdUwzRGl6UGxJLzAvamwvNjZzeUw3dXFsYnlMLzdZMDZjSk5peFZZSFk2UFZEVGdPZDI5WnJoUS9VRGZrMDFiRFB4V0dxSEFUeHpBRzRPQUhqcFlVay94RFdYTEt5cHl0SStvdVBFY1B2UkljVlBTTHlsZzlZTlkxNDN2YW00dkNlRThaYm0yUVJPdjNwOEtDbWdpTi9CUmQ2OWZlbjJTR1VwM3ZBYSt2Qi82L1l1bFlxSStPdWFMVnlkSXJ1WGpnNmQ2Ujkzd2dRb2pRUzQzU1dTM2lueThQM1RKZ0QyVk5xRi9JL2QybHV5cU9xOGN4ckluL0xrOHoySkkzU1QvSkw4aVlrMFlNN1ZEd0gzcjhDeVFCQ0FrSXlFRSs3VmtmQi85bFd2djJxeGxNUXZOVHBXZUc3M0dTZENmdElDeE5lQTdidDdqYlVUeDAyQWQxa2dDQUE5YUxjQVNyTmxJY2NOcjI0aHYrZU92YjBsVHNqeWRpbHdGR3RYcFdqSHZsNjBXSC9mM1pkeDRDQWNRT1RaSTZMSWZoZWtDdi9QV1YyM1pGRVZlZG1mTFI3K1I5NjN3NUsvYmU4WW1waUlhRDg3aHdsd3QxLzRSZ3NRQVBLdkV3WGZBS3dmcW5IZFpTMGM3L1hzcmpNY2dYOFV4Zm96WmdXS1lHeDg0dkR4b2ZBYWpKL2hYN0IySm8xakFHWUNjTUxFcGRLZVJmUkxmMmRmSmFXNGxrRUFSc1lLdXcvMlUvVjFCV2JYRlFNaURkaC9lTkJrQ3ljM0FhUTdMVWZCTUFNRXdGbkhZQ0xHOEhWeDVWekZYcis2YmxGVEJmbXo5clQzNTJkblA2TEVCZFlONTNYdVEvR1Y5eDhlUURQajZOSVlCL1pNQU53Y0FmYlUvQkl1Sjc3eW9tYU85OXE1djI5bXNaSUg3eHpjbE96TzhZcGQ1Q2Y3RGcwWWJqYlc1Mko2MmhQbnJFa3Z4b0g5ZHdBR2xvQjVGeE5SODk5ODk3dnFvb1hzQXBDUStzMThrV1F5b1BxVGcwY0dUTGNjNmpzR2sxUUpkVGxZNmxKQTNnMEFPQnRHTFZsVXRXcHBOVWRKZGgzc1MxUW1ZOVN2K0ZCVkRlanBHeDhhbVhEaFc3dlJjekVNQUFIdzNFV0d0QUw1aWd1Yk9LcW9wMi84ZE05WUl2YjNJSjVRMVlCako0Y050N2VVck1qRk1BQUVJTkNXb3RTQkZLNjU5TnhHanVMdk85UWZsekVqSitLMXVNVlFLdXF4a3lOdXRXdnZJbVF3UFFRQWpvSDhidVZsbWZQUFdjRHh5bnRmR29qSi9zb2ZqdU1zQUJJTmlLZ2RRR0N0RGp5ZlJnRW9OZ1hJeWM5dUlGa1oyZWFDODg1cHFDaG5hVHdIand3cWx5b082ZFArbUZzRDlCMkFzWkE5Q3FKbkViNjVGeE9Cd25RQWJrNEJpbHpkakZ6aG1rczJOeks5UVh2SFlQSDNpeEx1dXFPL3NEZkorWTdFWC9rb3B3TndOZ3ZrS3M4SGFETnlxZkk3a1ZkVHVhdzc4U0tYWExoaEFjY3JGd3JSNGVQRCtxL0F0T0dCakYxdnhiWkhqVXJjYVBxLy8vcUZuaTN2Zm1UNnY4cmtPNitXS0EvUkpjYnVSdmhOcFQrbGhRTnd5TnlsdkZBMVZibTFLMnM1N3R6Uk9UeWVMK2l3UCtzbW9VbU8rZFg2aEVYWGFrWG9Ma0VVQ3dJQVhYREFNaWhjYys3WjlSbWVFT25JaVdGTjluZm42MnRxZ05NdDJVa1JBczlEQUZ3ZzRjaWZMcVBZeHk5WXY0RHBvUjBuaHBVN3Yva0R3V3pSV1pTQ0ZibnpabXNqOER3RUFMRGEvODluT0FDeWlBQkVHZ2tUdXlHbkZ5WWdHTTBBQWhRQTcrYUErdFg5RkI1U2xwTk1Bd0JDaUk3T1lRUHNIODBQcHpUQXFZd1c1RVNoRXQyZkNab0w4VnRFQVRkQjY5MTEzY3E2c2h6WEpJbmpwNGFaMkQ4bXVVLy9XY3o1TnFVbTliRE1Lb21pS09sMElET1RXNkxZYzZVY0Q3L21yS3RJUkZJRU5VTUlLU0JoK2NScjMwS3NqV3ZybU81Y2lNVEpybEZ5TFZRTDdSTmRHTEcwUDdmYm9GL3hGQTRHZ0FENEZZTTcyMVUzbmxYUFZNNnVNNlBUejRHSnRKbFJtZm9WYm1MK1NOMG9yUXV5UXVxYkVJQ3d0TUdyS1VCcWhWcS9oc3NCZEo0ZXBXVi93MnlycmdHUmx5M0JsdnhnSWhBRUlIZ2hjZlRwTlZYWnRvV1ZUTTg5MVJNci94TmozRFhpNElnNHQrWDRibEVLMmhVQUFRQThpTlRXcnFqbEcwanNtandHUUk4cHVNTkRuZnVuaEFIQjh4QUFJTXpnYWgzYkJGQWh4T2tZRHFCVW1zWE1vVkVSUGYxRjlDVkJTQTlBQUNBTmxEeTFsbFVBem93SmpUUHJUYktoc2dZNGUrcDZCSkpQSldSVDg1TFZTM0pDaVBaamVRZkxwN0FRTE9rNmdLVFRRQlhXNkNmZXZ6NXhVV1A5eXlmK2RPT1dTeGFpMGR2Q2ZZOTNmdktMdTR2bDBHVGlmMUhZSEhTK0syVEMzeGY1TjVWYkpTcnEvRGRLK2c4eWNTMGx1NUdVb3J0MzNMV21PTVg1VGp1QVl1d1BKTVRDeG9xckxtcEdQVmpFN2ZkMG9CSlNhTUZkWGd6c2JRcUlPL3dQRG0rNXRpMmJsZWlRdHJCOWQrL2Vsd1lFL1RFUENKRTRpS1FJWXdSRkpSZ0RTQ293WG5iRlhFN2VkRTBydnFxLzRUOW9QbVpmaTFDREVBRFhQQ0RyNytQZ21rdGFHdXZMOFMxczRkakprY2VmT1EyYWQ2RXZBQkNBb0x4cW5GNXl5dzFMVUlFV2NjZlBPd3BSaUx3MjM2d0hmSElJQU9CSTkxeTNzcFp2QXgrZ0pBYUhKKzUrNUlTL0VRYkNjQWdBNERIZSt0cWxxQVNMdU92aDQwTWpFNXd5SHlYOFBiNEpBQUZJQitwcnk2NjdyQVgxWUF1RlFuVEhmVWRaSTNRQWdBQUFjK09tTGEzbFpmaksxdkRvMDZkUG5CcEpFSWFENWdFSUFFQUNLY1dicjIxRFBWakVmOTF6RkpVQVFBQUFDN2ppd3VaV3R0MmJnWkxZZGJCL3g5NWUxQU1BQVFBczRKYnJNZnZUSnI1M0wvWitBQ0FBZ0Ewc2I2MjZhR01qNnNFV1R2V01QdlRrS2RRREFBRUFiSVQvTnl5VjJQdkhIbjV3MzdIcFJ4d0RBQVFBTUlTcWl1eU5WeXhHUGRqQ3lGamh6b2VPb1I0QXg1RkRGUVNKNGRHSk4zL2c4YVI3b0JaWkluVGhoZ1dmLytoNWZBWCt6TC90dnVmUnppUkZaVi85bEh6emVoZ3VBQTRBQ0JHMTFieXhRdi9RQkNvWkFDQUFRQm9GWUdpWTkwQTZxck9vQUFBQ0FLUU9kVFhjQWdBSEFBQVFBQ0NkRGlEaGRtbUVaK0dTaFA4WUFBQWdBQUFjZ0NLR1IrY1dBRnBhamNQU3RFd09XUUFnQUFBY1FBbU1qUnRLQVJYbmQyTngvTHdQZ21JQUJvRnBvRUFzVkZkbVdlOC9NbG93OWk2VDVEdGpZcWo3S1J4SUF3QUJBSGlaY2I3NThxeDdTa2VSR0JzdkpDK3RqRFFPTnlGa2ZMc0RBRW1manRFS1lBcElBUVZPNkZTeFpGa1pJMjJNRm1WL2YvbEtCbEZhQ0FZRUFIQ1lUWXgwMEZ5V3NhbU1qUldFdDNOdldPY2plUnBpUURJZ0FJQmliM2VUSGJJWnhtSXA1SDlTSnZMb0N3QUV3SUd1S04yT1Joa0ZJTXY0ZHVQNWdqSXhPcHQvbHliYVkycURxdVRWamhvTVNnRG1KV2laS0pSQXEzQWhGaHYvclFOUWU0b3REVkI3THZFNkF3VEpQTW9xRXpLTXAxVGl0QUIwOTQ2amVhZEJBT0xzbXgvR2dDcVF3bzdUM1RzT0FRRDhKbnJKeVdtRktOSXV0alJlVWRSUGxEYS9MNUJPUUFCU1MraW1PVG9tbVJaaEtPbU1CaFIvbHFUbVh3TXZoam1nRUFBZ09KcW5BK3ZwaHZHbkdMbWdBY3JzVDg3eGxnY0FJQTRRQU1Cb2o3UDM2SEhPbVpwbE9VbEZMTnljcUhQL2xCQW1aQUVDQUhnY1dzMzVkTmFwK3JsY2duWW9TNWRmY3NoQW5OdHlmRGNaZExzQ0lBQWhFYmYwcU9rbkt0U1lRUWRRc3Nha3hyZmdDL3hMcGFmY2pabWxvNzNKanNtREFBQkJPVnlTL2pMS0t3Q1pwTVdPcVFINlpCSHpKcEwvRTVqblFlK1lGc29BQWFCck5KN05QT2N0N3VnWXB3QW9iVFVxNDFhTVZGMnhGZmRDeWRMKzNHNkRmb2tEMW9IT2d3QzNnNVpDUmlLYXM4VnlUbVUwMTVJakk3MTdSbDJOakRJZTJGS2VrekdMb1Z3YjA2bTh5Q2JTS2p1NzJhQktaM2VnQzROU3JheUdnUU9ZQThVV0F3Y3QzNjUxVjFZSGtNbklURVp4K0VTcTFPMjhNTTMrRG9UL01xRDI3SnpEY0hzWnNFQUtLQ1hRNzM3RG83eEhOcGJsMUxlN2xtNzFlaHIyVDBrSUFrQUFBcU5hR1VaM21sSGdFV1lCU0RRVGRFNHVOVm5CQmg1SHV3R3E3ODFQNTkwQkNJQ1hydGxNekJiem11RVIzaTM3aTI4M0hmUE5uTXFaZUJIK1M0TXRMYVc5RWdJQXBnK2dVRU1qZVY0QnlKUktpTWZXQU1sWjgyYlkzOU5qSnlTS0JRSHcwbGVHRTlCVDNtMzZKVU1qdkNtZzN3d0NTNXBYa0F6bnNVaXFxalkrcEtINTZWMXJ5ZHk2a0tva1U1Z0M0T1pzTFJNTml5MExORGpFTEFBeFo5ekx4RElnOVRnaUtmV3pmbVhpNWMydXRtTlhCU05BWmZCZ0hVQjM3M2hUUTluY1U3Zk56SXBQM2tzajVoVUhhdS85aVQvZHVPV1NoVzUrNVIvODgrWHVOOFZDSWZyOS8vRmtaOWVvT20zNUVQNGJsUk43K3NmOTV1N1BBUlVZQTNDNXVkUDIzb1dORlZkZDNJd1BwNE5IbmpwdGtmMk4wWitQK1IvaytTRUFhRm5GT3R5YnIyMkx2KzArTUNlK2QyL0huUFZOd3Y2R2c5K1E1djlBR1NBQXFZdm9FOTBwbDVNM2JXbkZWOWJCaXdmNlh0alhwL2hCcFowV2FHejQxN3M5cTZFTEtSVUFRODNMc1VCcHl5VXRqZlhsYU81NjRmOVJsY0NmZ3YxZENmOHQ5MXdaREQ5QUFOamJjakJEOWxJU1hIUEw5VXZBNERvNDFUMzY4TFpUaWFuZkt2dExCd2FVZytGVEdlaUdvbjRJUUxFdDRaeVRIdWNLc0c1bDdjYXo2a0hpT3JqanZxT0ZRcFNZK3FXTHJjakhNK3U5TXpSZVRBRVNHQU9JMVl3OFh4VHoxaHVXNHVQcVlHUjA0cTZIajF2aEpJZkNmMmY5cmtwNkFFaXhBSGczREtDVEJhcXZMYnYyc2hZMGRCM2M4MmhuLzJDU25UQWt6UThOczcra1B0V01jc29EQmdBZ0FNbmxuMy9Kb3ZQbTk0MVh0NWFYd2VlcEk0ckVIVC92U1BBOWJMTy80UmFiaHZ5UEROY3pCRUVOMHJOSFNGTnpUcVVVYjc2MkRTU3VnNjNQZFIwNU1VemVTQmgzckpNcUQ1WFNmcE0xay84SlN2M1NJd0J1amdPYjB6aWxkNy9pZ3ViV2haVWdjUjNNdWZoTE0vQ1BjWktNVEdlTERhYTNlakVDTERBSXpLcm9oaEtYOC8vVExSaisxY09CSTRQUHZIaUdpdnBqTmpDZFptTTQvRGRtWlJHMVF3QWNEVStrcVFJa3ZXUjVhOVdGR3hhZ2lldmcrL09GLzBvYmpWcGtmL2Y3VjBwV0lFTUFqSWJCbEtNMzByTzN2K1g2SlRnK1R3YzlmZVAzUDNGU00rUTN4djdLVDNjOC9MZmVXMlhRazBrOUV3QURqT1pqRm1nMnFpcXlOMTZ4R0NTdWd4OC9lR3c4WDNoRnZLOUsvUWJZUDFTeDl5Ny80OWVIeUhsVTFzbURBUWkvRTlXbS9XcTc4eXNVb01nbE04b3dQRHJ4NWo5OTRqZi9VK294UmY1OXhyOTg5TDNudk80cUxsMzU5TC90dnUveHpwSmwwRUtVa0Nja1Fkc3dRSFBGcnlaZitrdCt6OER5UDc2TUFJczBqQUdrSkF2RTFMcG5YTG4zMEFCZk1SYzFWK2hFMEFtaThaSi9kSTl5bWYyRHRSWFNTZmFBQVBqeTFaMzJzRXJUUElyMzVQZ0YzTThxQUUwVndZaXZ0TlE4S09sZEtmdFBmWmlNOVA0RFF3Q2NDV2NaUDY1MDlWMW9hMlAvNFFHK3d5NWJpZ3FBWURqcW5hbTY0Z2YrK2dUSEdQNjczYU9OZGRLd0xaTm5Ba0NiWEpPbUdwSHZKbURxSDRkR0pvNTJEak45M05ibXlwaGZ3TTFlSm8wSC9qcnNIMno0YjJvRXdneEhRUUJJZXFhN3V1ekwzTzJwZjl4MXNKK3BBRzB0bFltNnVYU29nU1Vyak92c244cjI3eGR2UUFCNFBaNmJCcFBWQk1URWl3ZjZtRjZxcWpMYjFGQ2VpQnlsVlNXUVN0UnZnUDM1N2k1dEZjbXA3aG1RTHZnbkFMU2JBbm1hQmJKb0FuYnU3K01yUUd0THBWcGRtVlFDNVdkUnRZR1N0L0VsL0tldks2djVINCsyQUFyVUFmanA1c2gzYjljeEFTVTE0R0RINE9oWWdha3FsaTJxMG95VUpZOFlhTjZXS3ZEWDUwQXAxUnVXTk5pR3dSZ1FBTXZ1VE5MM1BUZWFsSjRHRkNhaVhRZTVUTUR5dG1yQ0d0T1ozRSs0TU1EWUZBQlc5bmNuL0VmK0J3SmdPd0NYRHBSQjJRUm80L2s5dld3Q1VNVVhPOHNrZjFSRVpwTDliVVZXcm9ULzBxZjZoQUNvUTIwWVFNSFRPVDRVYk1zRVBMZWJTd0JXdk5JQjhER3BnUmlXdk1Ec3FYOHZocWtNWGFKeS9xVjNBd0J3QUE1NVc5TW1RRU1EWHR6Zjk1dGQwc2dkUUd0VkppTk5zcW92MUcrWC9VMkcveEpoT1FUQUF5ZG9LZjFpMG83TVZ5MWo0NFZkQjFoV0E1U1haWll0cm9yRHNLN1JCRitwNHR5U2RkcVBIKzNaZHErSEFCaUZ5MWtnZDB3QW4rWC85YzRlcGk5NzF2SWFpN0cySXlFL0lmdXp0Z1QzdzMva2Y5TG5BSHdKc0kzUUJGTWk2S2tkWEFLd0pyWUF6QWk5VFlxQm1ZZVNzTDlyeVord2V5SUV3TmNHUWJ5TmlWa1RvRlVaU2hxdzk2WCtNLzBzSWMrNmxiVnU4ckpocFhHYy9WbUNGWU9GUWY3SGV3RndJZ3VVamoxVlp0ODhpc1RUUEZtZ2MxYlhrZk8xNHBveTdUc28xN1loOW5lMXZWSDFUK1IvMHVvQVlBSklUY0NjUDNseWV6ZkhkMnVzTDF0VWFsOW9mVGFQQTVlRm5JYjlFZjZuTy93WEdBTUk2ZXRyYlEyZlhBTit0YjE3WW9MbGNBQXFFK0JmTS9PRS9iMDd4d0tZRHptdlN6OTVTbkRpazNXRmpBZ1BtcDMvUk9EaVp3VkxLYU41aXE1OFhuSHhDMHVjWFJ6anFkTi9NakNVMzc2bjk2S05DOGcvNitaMTlZOCtmUnJVTDRUNGkvKys3azNYdEtuZDh4UC83OFhINXF0R0crelBFdjRUdS9aMDVYOUNkd0NrV2FCVUJCUUpmY0JqejdEUTlPWjE5V0QvU2F4ZG9UNGsvc0xlWG84RGVMYXVqL3hQYWdTQVZPclYyb2Y1a1FBRFp3Uk9QZUx4WjdvNFRvZzhlMVZ0V1M0ZFJ4WEo0bkd4V0wyc1J1M09oNDhQcVUzVFF2aWZLbmpmeldpUEJ4QkJISmJFUFJndzlhdFQzYU1jNThPVTVUSWJ6d3A4R0NET1ZKOFZiZFVWNVlvOWRJZFMrQzl0TkVndit0UjhkL002LzVNQ0IyQnNZZytEQ2VCcjZJUWE4T0RXa3h6bHY1QmhhTUVwOW84RG5melBqcjE5anJDLzBHai9IRDNPTG9kQUFGd3hBVVVjbitHQXhmQ1VVRUtLa2xJOC9OU3BRb0UrRFhSeG9BSVFjNDcvYndXZ1J2bEJjemdBOXlhMkdwNXJXM1NFTDNYRHYrbHdBRDZZQUNiVHFqc1lFTy9CdmYzano3eDRodnlqYlRpcnZxb3ltMXJxbi94QW05YzFxRDNyZE0vb2lkTWppYjZtZzhrZmhQOFFBRzVwa002d2czdUpvTmpkOTc3SE84bExuc3ZLVjIxYWtKUTBuZVg5cE5RdmhTZ3Z5NnhYWFEreGZjYUpQWmJZMzBxYjk1b0hJQUNLTURrVTdKRUpNS01Cano1OWVtQW9ULzVOTHp1L1NTMTI5alRrbi9GRk5wNVZuOHNwdnZZckZtbmJZMytud244TS82YllBWkRtL3Z3eUFRUWV0MVRCeHNZTEQvNktmaWo0c25PYk5FTnBYMEwrNllIL0ZNNWZyNWovS1JTaWJUdTZTZGcvdk5hZWpBRlNZQXpDRVlBQVRBRFRhTERtWVZKeGJuSFBMMCtRZjlDV3BvbzU5NFJ3VXdsMFNqWG5LY1RubmFNb0FEdjI5ZlVQNWtuWW42blZTWjJDSWZ5SEFQaHJBdHhNQk9scndMNURBM3ZhNmM4SWU4M0ZDK053cmkweDBDL0FmQWZRVjVSbk5wNmx1Qng2NjNOZExyTS9heDlCK0E4QmNOb0VhRnBqbHpYZ1J3OGNJNi8vTGE5YWFJeUx6VCtveUEwdTN0U292QVJzNjNOZExyTy81QkVIUHc2dWdRQ3dva1FXeUd4b29kSDNySjB2R0VzRDVybkxROXRPbnVrajlzWExXcXNVem9lWnp0RmFtUm1pKzh3WjlSZS8weFVYTnF2ZHZPUEVjRWZuaUVYMjEyemJycHk5VVhSL2ptRHlQM0FBcFoyZ2E5dkQ2Ujd3cmE4Qjg5d2xuNC91ZXVRNCtmdSs5dFdMeUNQM21IOGNyQkp6bitaWFg5Q2s5b2duSnZNLzl0amZTcml0RnY1TDdCZ2RuZ0Nrd1FRNHF3RS9lZkRZZUw1QVc0dlhYYjRvQUFzdmt6UzlEV2ZWTjlhWHF6M29nYUk3YzlobGY0VC9FQUNZZ0pBMW9MdDM3T2VQRVM4S2ExNVFQbU0rcUhlOG4vUmJYUjE3NUdNRzloOGVQSEJrTUVEMlIvZ1BBWERXQkhoeFlqQ0hSUDJtaDcyeXJyOTNUd2Y1QnRGdnZyWk5qVW45NHYxSjVMTHlCdFdzVjVFbDJYNnpuY2swYkpyQ2Z6Z0FBaFBBMTNidG1vQUV2V3Zhdlk2ZUhIN2txVk8wMytYeTg1c1dObGJvYzZ2THZEOGxwcGVlMTlUVW9KTC9tU2hFRHo1NVV2azdocGY4UWZpZmFnRWdUeHluTUJHa3BnSGZ2UE1RclFuSVpPUmJybXViajIzdGRtV1NZa3ozVWErN2FySGFUWjU4dm52T1dWaCtzNy9xaFNhN1B3VEFPWlJ3YW9aREE5M2U1WThHU0NtRWVPbm8wRVBiaUhlR2VNdTFiVVhteFJzV0E4TEh6VWloTmRTV3ZmcDh4UW1nOXoxKzBrZjJaKzA3aWZ1NDFHQVZDRUFZSnNDMTBXQURIVGpPbUhBaUsvQ05IeCtpUFNTZ3ZyYnN4aXNYeDZ6UDJYOGtYRStyTVhOVyt4dTN0S3B0QU5mVk83WjFlMWZTVDZZLzI1VjFOUnhIK0s4VzRVbWNDWndlRThEU2xQVzI1RFN3Y3hhdEZlam9IUGs1OVI3UmIzL2o4bXhXS244YXRUK21xcDZ6dHN0eW1kOTU3VksxZS83dy9xUDVmR1F5OE5jM3I2WExhWGdKVHZyQ2Z4SDhJTERhZENERG84SEM5bUFBdlFZSThlOC9PalF5T2tINEtkdGFLcWtXaGRscWlzVWo3aHV2WEt3Mi9EczhPbkhYd3lmTXN6OXY2dC93Mks5TVkvZ2Z1QUNZRjIzSnl5Q3VhRUNjUjNXZEdidjkzZzdhR25qblcxYmtzdjUxeDFoSk5pbCs3L1hMMU83L3MxK2VtRHlQUWZyRC9zNzJzbFNGL3lJTjAwQU5td0MrUkpBTEhUdFJhVysvcCtOMHp4amhwMXl5cU9wTjE3UUZFL0pQeDlXdmFsbmVXcVh3bElsQzlJUDdqc1p2UHlZYkNVZjRyM3g4RGNML05Bb0FrM1M3bVFoeVRRTkd4d3BmdlAwZ2JjMi8rK2FWTlZYdW5oV3N0cFZRTGlmZis3dXIxSjc0eUZPbk83dEduV0ovQjVNL0NQL1Q2d0E0VEFCZisvWk9BNHIvOE9GdHA1N2UyVVA0S1JmVWw3M3I1cFhXVHdMUUovM3B1T1g2cFVzV3FZVC9VU1QrNjJkSDBzUCtHbkVYd3YrMENvQ09nTE9NQmhOMFFrTWFRR0lGL3ZsYkIyaDNpUHVkMXk1ZHNhUjZUdjQxODFGb24xaFhrM3ZubTFlb1hYdi9FNTBINTkvOFIrRlRjck8vbFNCUFozRlAyT0YvV2h3QTArNUE2c3NDdE1NY014cEFZZ1dPZGc1LzY2ZEhDTDltTGlzLy9JZnI1aXNZN2NiT0JyYUovcU8zcnFxcnlTbGNPRHBXK1BjZkhUS1dHQ0ZoZjZaK3diSlRpd3lmL1FYMkF0SXlqMWF0cm1zYVVLVFkzNzM3eUw1REE0UWY1ZHl6Rzk1Nnc5SkVyNkQyeDQzek55eDR5M1ZMMUs3OTBRTkhUM1dQZ3YyWittOUtrQllCTUc4Q0F0TUFIU3N3VVlnKzk3VzkwMWNxNmVPOXY3dDZtZEswR1djaUMxbFZtZnZMOTV5dDlvMTZCOGEvZTNjSHlTZnpuZjBSL2tNQWFFSjl0U0NDOGZ3OGx6UWdxUldZOGR2MmpzRnYzSG1Jc0hJcXlqTWZmLytHc3B4dkRYaWF1WGpmMjllMExxeFV1ODAzN3p3OE9KeDM0YU1Uc0Q5YjhYRG1Pd1FndGduZ01aS1N2MmU0cVFHelplQzdkeC9adnJ1WDhJT3VYVkg3L25lczhZNzNKN0hsa29WdjJ0S3Fkck1EaHdkLytvdmp2ckMvWmljeG4veEpUL2dQQjBEVDF1d21nc3hyZ0pvTVJKSDR6RmQyOXcxUWRxMmJyMXZ5aHF0YkhXNVJjdzhtckYxUjgxZC9mSTdhTGZNVDBkOTliYy9FWEh2dDBZNWJVTEcvWDhrZk9BQ1lBSldBSWxVYW9IQzNTUms0M1RQMnVhL3RwVDB0NEVQdlduZnUyUTFlOFA0a0Z0U1ZmZkxQTnhYWjNibzR2bnYza1RuUGZUVDhmUjFuZjRUL0VBQWxEZUJwVldhY2lYa05VSkNCSjdkM2YvdXV3NFRGeU9Ya3AyN2R0SHBaalJPTVg2cFNLc296Zi90bkd4YzFWNmc5cDcxajhOcy9QY3dhK0p0amY4YitvaWdzYVdOL2dSUVFZYlBsTXdIT2FvQWErM3pqeDRlZWZMNmJzQXkxMWJuUGZlVGNwYTNWRGpMK0RQYS83VU9iTjYrclYzdm1SQ0g2dTYvdHpVOUVmTlJ2bFAyUi9JRUF1R2dDTklJTFh6VEE3b0Y1VVNSdSsvS2VqaFBEaEFWb2Jpai8vRWZQVzdHa2huNHlQOUVDZ1lyeXpLZHYzWFQrZXZWczFYLys1UEQwNVJSV3ROeDk5a2Z5QndMQWF3SUMwQURyVm1CZ0tQL1gvN1N6bDNSQWVGSUROcXlwaThYZ1poZUQxZFhrYnZ2UTVnczNMRkMrd3hQUGRYM250Nmt6V3hMdVBmc2ovSitGYkZWMVhXTmRSZ2h4cHIrUW50Y2VIaTFVVjJaZGJDcythMEFpYnVvZnpPL2MxM2Y5NVl1eWRGdjhWMVprcjc5ODBlSGp3NGVQRDduVDJGYTBWZi9mdnp4MzNjcGE1VHNjT1RIOHZ6Ly93dmg0eExRKzJSMzJaeFFBaWZEL1pVeHhma29GSUpZR1dERUIvbXRBZkJrNDFUMTY1TVR3MWE5cUlTeEdMaXUzWE5KU1dabDlibGN2N1hRak5WeCtYdE5uUDd5NWVVRzU4aDJHUmliKzh1OTNkSjBaNC90WTRiTy93Tmd2QkdBV3FqUk1RRWdhWUZFR0RoMGJPdFV6K3VvTG1ta25zRzllVzMveHBnWFA3KzNySDh6YmFsM1ZsZGtQdk9Pczk3OTlUWG1aZXFJMWlzUm52cno3aFgxOUZuVTZiUGFmdlBQd2FMcllEd0lRendTa1F3TUU2NFlXcFZobS8rSEJ3ZUdKUzg1dHBIMXVTMVBGRzY5dXplZWpQZTM5QmVOVzRKSk5qWi85OE9hTE5pN1FyTml2M3RGKzc2T2R0Z0wvbExCL0NzZCtJUUF2bXdCYmU1aW5Sd05LeXNDdWcvMmpZNFdMTnhGclFDNHJMOTdVZU8ybExaTzVKdTZ2T2ZtM2Rubk5oOTY5N2oxdlcxVlRuZE84NTdmdVBQeWR1NDh3ZlE2UDJGOXdKbjhtQTBFSVFFb0ZZSGkwWUNzUjVLWUcySktCbmZ2NytnZnpsNTdiUlA3USt0cXlheTlydWVLQzV0NkJmRWZuTU5YQWdIemxueERpck9VMUgzelgyZys4NDZ6cDU5VW80NDZmZDN6dGh5K1pOMlRwWWYvVWh2L1RCVUEyTlM5WnZTUW5oR2cvbGhkcFJWTkRXUWxlaUlyL1k3Ri9Mc2s0a2RZL3gvekpWR0dpZUQ4elVlMnpuM0xUbHRZUHZYc2Rud2lkN0JxOTY1SGpELzdxMUluVEkxUkdyYTRtZCsxbExUZGV1WGo5NmpxcWN0NzE4UEYvL3VaK3h3UC91UEdIN2htb1lIOTZUSEUrQk1DK0JwUW0yM0ExWVBhRHJycW8rWC85eVhybHJYSmlZbmQ3LzdibnU1OTZvV2R2KzhCRThpRUNLY1dhNVRVWHJGOXc0WVlGRjI5YVFMc3I5YjJQZGY3amYrd2xyMzhIMlY4ZzlROEJTSU1BZUtvQkptVmcrck0ybkZYM3FROXVhcWdyTS9EUXNmSEMvc01EK3c4TmRuUU9IKzBjN3VrYjYra2JIeHpLaitVTEV4TlJlVm1tcWpKYlZaR3Rxc3kyTkZZc1hWeTFkSEhsc3NWVlo2K3FVenZIc1NSdXY2ZmpxM2UwVzZGK3Y5Z2ZBZ0FCZ0Fhb2E0Q3pNakQ1dUxhV3lyLzlzNDFybHRla3AvbEZrZmpTN1FkL2VQOVJ4NmtmN0IrU0FLUjlFSGc2V0dlRkVuUXFTVFltbkRqY016dFJTa294TUpTLy80bk90a1ZWcTVlbVFnT0doaWYrOWw5ZmZHRHJ5UkRZWDJMZzEzVmdGdERjS0QwcjFPNmtvSGlCbFJUMFBkL01JZW5UTVRFUlBmcjA2WUdoL0FVYkZtUXpJVy9qY3VqWTBGLzk0d3U3RHZRVFVqOVQyb2ZrK0VlNzdDOVNPZThUQWhEWEJGU3A3Zy9oamdhSWhCcmdyQlVRUXV3KzJMLzF1ZTd6em1sWVlHUkl3RHp1ZTZMekUxOTRzYnQzekVyZ2J6anB6ODcrQ1A4aEFQb2F3THBQbklNYTRMZ1Y2T2tiLy9uam5SWGwyUTFyNm1WQVRxQnZZUHdmL24zZmQrNDZNakZCTThiQ0ZQaTd3LzRDeVI4SWdQc2FVREpJY1ZZRG5KV0JpWW5vMXp0N250clJzMzVOWFdOOWVRQnQ3UEZudXY3Nm4zYnVQa2lUOWtsSy9XQi9DQUFFb0JoWUJ3TU1hd0NURlRBdkE2ZlBqTjN6eXhPRHcvbjFhK3AwZGxpemkyTW5Sejc3MVQzZnZ1dnd5T2lFWWVwWENQeURZWCtCMUQ4RUlKRUpLRDBZNElrR3NGb0J3eklRUmVMRkEvMzNQTnBaV1pGWnQ3STI0MVZLYUdBby81OC9PZlM1cis0OVFuRmNnUUwxMHdmK1ByQS93bjhJZ0tJR1ZITU9DTHVzQVVsRFJjTXlNRHBXMkxhajUvNnRKeXNyc3F1WDFXU2NueU0wTkR4eHgvMUhQL1hGM2MvdU9sUFEzcHRVb2FvVGYwMlAyRjhnK2FNdUFGZ0lWZ0thcThPRTlnSXhFWE41VjJ4V1NVby9VZkpsWUNZWGppMXFxbmpialV0ZmYxVnJkVlhXd2ZiVDNUdjI0d2VQM2ZtTDQ0UERCUDFMUVdLNXFCL3M3ek93RWppQkFKUm1ORWMwSVBidkZQalpjUm1vcXNqZWVPWGlOMTNUdXNxTmhXTlJKSjdmMi92VGg0NC8vc3pwUE1Va0h3UFVUeHY0TzhMK1FrQUFJQURjSnNDSUJ0QmFBVE1hWUY0SjFxNm92ZUhWaTY2NXRFWG5GRVlkSE93WWZQakpVNzk0OG1SbjE2Z1YzbmVCL1NYRnEwbnQ5Y1FJL3lFQTBJQTB5b0NVNHV4VmRaZWYzM1RaZVUxclY5UnlEMDRNajA2OHNLOXYyL1BkVzdkM2Q4YmVhTm8vNmdmN1F3Q2dBWDVvQUtjVjBKRUJZWHhydWRycTNLYTE5ZWVlM1hEMnF0bzF5MnNhYWdsV0ZFZVI2T2djM25lb2Y5OUxBeS9zNzl2M2tzcWUwclM4cjBiOXduamFCK3dQQVlBR3VLVUJWbVRBdkJKTW9ubEIrWXEyNnJhV3lyYVd5c1hObFExMVpRMjFaZlcxdWFyS2JDNHJ5OG95Mll5Y0tFVDVmSlNmS0F5TlRBd081ZnNIOHoxOTQxMW5Say8zakIwL05USzVjZlRZT09Xc09hbTd2SnlUK3NIKzRRcEFEbldSdEtOcTBwWVVzcmdHeEhtRWpFblpjWDhYLzRkejhJNnlERXh4Z1VrbDZEb3oxblZtN05sZHJqUW43VHRJMVhib0ovdnpWMm1xa0VFVnhNZGtXS0d6UWpobUs1ZUUyenpJQkIxWUtuWTVLZlc2M2VURTl2UjBYWkwzVmE1MnlkTjRETEUvcHYxQUFLQUJLajJabkIyb1pXQTZNNFluQm9TdlpvTDZCWEhjQVBhSEFBU2xBZnFkaDBRREJJTUdDSTBOVCtWdjRSUmpCa0Q2K25YTHNSNU14cTRIYnZaUDBEY0JDSUMrQnBUdWhrUWFZQ1VkcEdNRkNBMkJqMkxBVVZUTnlrd2MrSk9tZmN5d1B3WitJUUJoYW9Dd2x3NmlrZ0ZKU3R2VEdkYTZKTEFXUnIvMkpGdmdUNUwyQWZ0REFLQUJaQnJBWkFYMFpZRGNFSlJrWVZvNjVyNC9SM1dwVUwvWnRBL1kzd1ZnR3FpdUJwUmVIQkJqaW1YSnVhRWk5Z3pVQkJNNko3dFdKSGgrUGpldlRmNUhaR3JpcDEvakJ6UmpKNXdYZ1AzaEFBQVBmSUJrSXd4OU55QjRVa1ArZ3FvMkpDZjdTN0EvQkFCd1FRTWsrUUVBMG80TVRPZSt0SWtCN1lzclVuOFM5bzlKL1dCL0NBQTBnRmNEaEdEUUFLc3lrQkl4NEhoQmJ1b1hwSUUvMkI4Q0FBMHdyUUZzQjRLODRoRzBuQjJNR0RDOWlIcWQ4d3orZy8waEFBQ2xCcENuZzFnelFoeUdZRTRPZFY4UHVFdXJYc21TSytNdjZabzAyQjhDa0E0Tk1HNEZCSDlHaUZVRzVtTll1NUpnc2pCbXFEOVJPeUVPL01IK3hvRnBvQ3dhRUd2amFLTHBvU0xKSHFXSnAzS3F6djJjNnNzRzVudk9SN3VFazAwdHlvdzBlTEZNVmllazdCL2pjV0IvQ0FBMG9GaHZqSmcyZjlaWUFtQlNDZHhoYmN1OEx4VEhjbWlwSCt6dlBwQUNZdFNBV1AyRU1IK2FNQjNFUFh0a3pxc3g4NSs5bHBobmM4VVAvTUgrRUFCb0FGbm9GVjhEWEpZQktBRmpuZkJUdnlSdHEyQi9DQUEwZ0Y0RFJNSXRFTlMzbGlkU2duU0tnYVRsZmM2Y2p5QlArNEQ5SVFEUUFJVmdMRkU2U0JyWS9KbUl2OU9qQkpSdmFtU21WcUxBbjJyQ0Q5Z2ZBcEErRFhEQUN0aVZnUmx4Y1JoNndQSkdwaWJwV2duOHdmNFFnREExd0ZZNnlLZ00wTzZKNzZFZU1KWlpHcVYrVzJrZnNEOEVJRXdOaUJ0UzBUcnU1RlpBTjZabkkyenBuaVNZS0pMZXJSVXVUVVQ5dE93dmNMSWpCQUFha09TQURpNHJJS2ltSkhMeXRKei96N3Vua05lZUd2V3pCUDVnZndnQWtFd0QyS3lBTkwvcnA0MklYZEw5MlNtMzlqMVlxWjg4NlEvMk53K3NCTGFtQWJHV0Nvc0V5M1pqcmhtZTN0OFM3WlZBczZiWDRzcGd4eUd0M1NONVFFQzgveFNTL25BQWFaU0JCRDZBd1FvSTFSTVRhWUppaVNWaGxKVWdqYkIvc3NBZjdBOEJBRXBxQUcwNktGbUFKdFFQTjZlZjFKZ2VKWkQwRTJmVnFEOHArNU1IL21CL0NFRGFOVUFJRmcwd0tRUDBTaENZSGpDOGx6UkwvUnpzTDVEMHR3Mk1BYmlpQVFtR0JFU0NVUUVoQk92QXdPeGVUNW5ibjBFbEhnMGJTRWR2ekpqdVR4U2dJUENIQXdCbXlBQkhPaWh4SDlad0E1b1ppY1J4dERzV3dVakJORytzTlB1TG52MlI5b0VBQU1Xc0FQbklzRWllRWFLU0FYYUtsZzRzQkpDR1h0RXc5VXVHQXlTUjluRU5TQUc1cUFGeDAwRWkyZGt1U1ROQzA5VkkrWEF0bTlNK2ZSNUYwQys3NnFBTzF5bGlDUHpoQUlDNE1wQXNIY1Ezb0Vka0NBU21mUnFzSXJXUGxiaGhTS1I5SUFBQXB4VkkwSTFaMDd0ME1rQ1YxZ2lTOXdsdUpWME0vQVhTUHE0Q0tTRFhOU0JaT2tqd1pvUm01QmIwRDEzM2Q1b1A0VnVUOEw1R1lSaFBqa2ZnRHdjQTZNcEFzckRPU0VhSTFoRE1qb1hETXdkY2c5TWFuNEF2NXlPUTlvRURBS3haQVpGc2NGakhEZEFhZ3BETUFhdUdhWS9IOEI0Z0NlcUhBd0E4c3dKVElhR21JWkNjcytCOVdRYkFWRGJOR2xiOHZnajhJUUNBTzFZZ1dmOVhQQzVjWFFhNGxhQWs4ekx4cjhYTm92WHJVL0dEeXNTQnY4QjRyMWRBQ3NoTERXaHFLQk9KVWk0Sng0ZW5Kd29pamV3TFUzYUlPbVBoS0lnbVhFa0QxUWZxaHdBQUZtUWdHYkZha29FWlhCYmhKQUJtMGpkSi9RSVpmNStCRkpEZk1xQ1NHVkNkSjY2WkY1ck9GMllTUkg3eFB0MGFDNDB2SlZXS0RmYUhBd0FzV3dIQm54RWlOQVJ6UnJ1cGNnWWMraWMxanc5T1huNVFQd1FBY0VnR1ZESkNTa293eFRVUjNmek00Tk5FYlBPanpQSCsxSXVBK3NNQVVrQkJ5WUJpR2tGakxndGhhbWgyYm1INm40OTB6L29LdWpVdkZkUDlZSDg0QU1CMUs2QVNSR3ZraFpnOFFmSHcyU21YWUV5aUpNbnh3YW92Q09xSEFBQ1FBWnRLRUpOenllWEJyZ3VoOFZpZ2ZnQUNBQmt3SUFNbWxjQkJ2bmFMOTBIOXdEekFHRUFxWkVCcmJJQWc1U0NaaGdxQ0JHVjFTYTFjUDlnZkRnQUl4d3Fvbi9sT1lRaGNzQVdwQ1BZMVF2N3B6Z25VRHdFQUlBTnpjUXFwRXFSV0QxajhrTTZNVUZBL0JBQ0FEQmhXZ3Rsc0dMQVljQ1hCTkhlSEJ2VkRBQURJZ0NMdmtNKzNtY1ZubmtxQ2lURVBVRDhBQVFDVVpVQW96eFRpTkFSeG1OUXBWVEE5dnEwL1BJd3hYZ0FDQUFqTkNhUHpzUkkvT1JmblhISjVzRCtGaVdwR0tLZ2ZnQUFBUldSQTZDK2s0cmNGcnZPMWs3d1A2Z2NnQUVBSkdhQXhCRFpzQVVnZklUOEFBUUFjTXdRUUE3T2tqNUFmZ0FBQTdoa0NpQUVuNlNQa0J5QUFnQ2VHWUQ0ZURGZ1BPQWNtRVBJREVBREFuQ0VRVEhzeWg2UUhCbFlDZ1BjQkNBQVFvQklVNFZBSFZjSHdTZ0R3UHFEZml1b2Jtbk81aXRWTGNrS0k5bU41MUFpZ0JoTktrQWpreFhCaldpbDRIOURFRk52bjg2TndBQUNYSjdBc0JnSHRQRDE5SzIvd1BrQUlDQURBcFFRT2lRRklId0FnQUlCRld6Q2QwU0FHSlVrZnZBOUFBSUF3YlFIRUFLUVBRQUNBdEl1QmVHV2FLQTE2QU1ZSElBQUFFRXNQZkplRTJVY3hnL0VCaDlwbmZVT3pFQUl6UVFGbk1Wc1MzRlFGS1V2TEd3RFl4ZlE1b0hBQWdIOFdvWWdxY011RGxJbkxDUUF1QXdJQWhLTUtNZVdCNmFFQUFBRUFBTmZsQVFDQVNXUlFCUUFBQUtrV2dIeCtkSEw0ZDNLSUFBQUFBQWdNTTBhQTRRQUFBQUJTN3dBQUFBQUFDQUFBQUFDUU1nSEFNQUFBQUVDb21EMEFBQWNBQUFBQUJ3QUFBQUNrWEFDUUJRSUFBQWdNODIzMTlnb0JtSjRiQWdBQUFBTERESkpIQ2dnQUFDQ2xtRU1Ba0FVQ0FBQUlCa1cyK3M4VU53Z0FBQUJBR0poTjcwZ0JBUUFBcEJTWk9WVUNXU0FBQUlBQU1PZjZMemdBQUFBQU9JQjVBQk1BQUFBUVJ2aWZUQUF3RkF3QUFCQU01cU4wcElBQUFBQlNpa3dSeFVBV0NBQUF3Rk1VSC82RkF3QUFBSUFEZ0FrQUFBQklXZmdQQndBQUFBQUhBQk1BQUFDUXB2QWZEZ0FBQUFBT0FDWUFBQUFnVGVGL1lnY0FEUUFBQUhDYy9Ta2R3SFFUQUFBQUFEaU9tT0YvTWdlQVJCQUFBSURqNFgraVlEMnVBR0IzSUFBQUFDOFFuNjR6aVc0S0V3QUFBT0J5K0o4b1dNL29QQXdBQUFCd2hQMFZrRXdBTUJvTUFBRGdKcEtHL3lvT0FJa2dBQUFBMThKL0JmWVh5aWtnYUFBQUFJQTc3SzkydVlvQVROY1phQUFBQUlCRjlwOU55K3dPQUlNQkFBQUFMa0F0K2FNbEFBS0RBUUFBQUxiRGZ4MzJGL3E3Z1VJREFBQUFiTEcvNW4yMEJBQ0RBUUFBQUZiWWZ6WUpXM0FBR0F3QUFBQXdEODNrRDQwQUNBd0dBQUFBbUEzL1NkaGZVSjBJQmcwQUFBRHdpLzBGN1pHUTBBQUFBQUJ1OWllOEo1a0FUQ29TTkFBQUFJQ1YvUWszNTZkMEFOQUFBQUFBWDlpZldBQ2dBUUFBQUw2d1A3MEFRQU1BQUFDOFlIOFdBWUFHQUFBQXVNLytYQUlBRFFBQUFIQ2MvUmtGQUJvQUFBRGdNdnNMSVdSOVF6UHJtK1J5RmRNRkFQdEdBQUFBRktkK00rd3ZoTWhXVkZhelBxQlFtQ2dVSnZvR000MTFHU0ZFWTEzbVRIOEJueGtBQUtBSSsrZnpvNFhDQlBjVE0yWmViUHFlY1VnSEFRQUFGR2QvTXc5bFR3Rk5COUpCQUFBQVJhaGY4S2Q5TERpQUtSOHduZmRoQlFBQUFQdmJZbjloWUF4Z0JqQWtBQUFBTUp2OXpTVDlaOEJvQ21nNmtBNENBQURVYnlYd24wTEcxdnNqSFFRQUFOamZJdnZiZEFEVHJjQjA5b2NWQUFBZ2VPb1habWY3dUNzQVlsWTZDRElBQUVEWTFHODM4SGRMQU9hVUFXZ0FBQUNCc2I4NzFPK2NBTUFLQUFDQXdEKzlBZ0FaQUFBQTFKOXFBWUFNQUFBQTZrKzFBTXduQTFBQ0FBQWM1MzMzcWQ4UEFZQU1BQUFBNmsrMUFFeVhBU2dCQUFETzhyNHYxTytmQUJTWEFTZ0JBQURtZWQ5VDZ2ZFZBS0FFQUFDQTk5TXVBRE5rUU15em9SREVBQUFBS3RLZlFTbitVbjhnQWhCZkNhQUhBQUFvTUg1NHZCK2dBQ2lJQVZRQkFNRDFNWmtoR05JUFh3RG1Fd09CZmFjQkFJZ2RDd1pKK3VrU2dPSjZBRlVBQUhCOWVoZy83UUlRWHhVQUFBZ1lhZVA2T2ZIL0FVUlZPcXA3bnRvN0FBQUFBRWxGVGtTdVFtQ0MiLCAic2l6ZXMiOiAiNTEyeDUxMiIsICJ0eXBlIjogImltYWdlL3BuZyJ9XX0=" />
  <meta name="theme-color" content="#0e0f13" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Mon Budget" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, deleteField }
      from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDi5L92rZkehT514a5-JDqjTdOMc1_Ee8o",
      authDomain: "monbudget-207b8.firebaseapp.com",
      projectId: "monbudget-207b8",
      storageBucket: "monbudget-207b8.firebasestorage.app",
      messagingSenderId: "686570690847",
      appId: "1:686570690847:web:9634102ee6e5481a12f82a",
      measurementId: "G-66CK2ZJB89"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    //  Expose Firebase to app 
    window._fb = { auth, db, doc, getDoc, setDoc, onSnapshot, deleteField, signInWithEmailAndPassword, signOut, onAuthStateChanged };
  </script>

  <!-- React + Babel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    .tabbar-btn { -webkit-tap-highlight-color: transparent !important; -webkit-touch-callout: none; user-select: none; -webkit-appearance: none; appearance: none; }
    .tabbar-btn:focus { outline: none; }
    .tabbar-btn:focus-visible { outline: none; }
    .tabbar-btn:active { opacity: 1 !important; background: none !important; }

    :root[data-theme="dark"] {
      --bg: #0e0f13; --surface: #16181f; --surface2: #1e2029; --surface3: #252733;
      --border: rgba(255,255,255,0.07); --border2: rgba(255,255,255,0.12);
      --gold: #c9a84c; --gold-light: #e8c96a; --gold-dim: rgba(201,168,76,0.15);
      --green: #4caf82; --green-dim: rgba(76,175,130,0.15);
      --red: #e05c5c;   --red-dim: rgba(224,92,92,0.15);
      --text: #f0ece4;  --text-muted: rgba(240,236,228,0.45); --text-sub: rgba(240,236,228,0.25);
      --header-bg: linear-gradient(160deg, #1a1c25 0%, #12131a 100%);
      --header-text: #f0ece4; --header-muted: rgba(240,236,228,0.45);
      --header-input-bg: rgba(255,255,255,0.08); --header-input-border: rgba(255,255,255,0.12);
      --header-btn-bg: rgba(255,255,255,0.06);   --header-btn-border: rgba(255,255,255,0.15);
      --tab-bg: rgba(14,15,19,0.94); --select-bg: #1e2029; --colorscheme: dark;
      --shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    :root[data-theme="light"] {
      --bg: #f4f2ee; --surface: #ffffff; --surface2: #f0ede8; --surface3: #e8e4de;
      --border: rgba(0,0,0,0.08); --border2: rgba(0,0,0,0.14);
      --gold: #96680e; --gold-light: #b8832a; --gold-dim: rgba(150,104,14,0.10);
      --green: #1e7a48; --green-dim: rgba(30,122,72,0.12);
      --red: #b83232;   --red-dim: rgba(184,50,50,0.10);
      --text: #1c1a16;  --text-muted: rgba(28,26,22,0.52); --text-sub: rgba(28,26,22,0.34);
      --header-bg: linear-gradient(160deg, #2c2a26 0%, #1c1a16 100%);
      --header-text: #f0ece4; --header-muted: rgba(240,236,228,0.5);
      --header-input-bg: rgba(255,255,255,0.08); --header-input-border: rgba(255,255,255,0.15);
      --header-btn-bg: rgba(255,255,255,0.06);   --header-btn-border: rgba(255,255,255,0.18);
      --tab-bg: rgba(244,242,238,0.94); --select-bg: #f0ede8; --colorscheme: light;
      --shadow: 0 4px 20px rgba(0,0,0,0.09);
    }

    :root { --radius: 16px; --radius-sm: 10px; }
    html, body, #root { height: 100%; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; transition: background 0.3s, color 0.3s; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
    .scroll-row::-webkit-scrollbar { display: none; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; color: var(--text); background: transparent; border: none; outline: none; }
    input::placeholder, textarea::placeholder { color: var(--text-muted); }
    button { cursor: pointer; font-family: 'DM Sans', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }

    @keyframes fadeUp  { from { opacity:0; transform:translateY(14px); } to { opacity:1; transform:translateY(0); } }
    @keyframes slideIn { from { opacity:0; transform:translateX(-10px); } to { opacity:1; transform:translateX(0); } }
    @keyframes scaleIn { from { opacity:0; transform:scale(0.96); } to { opacity:1; transform:scale(1); } }
    @keyframes spin    { to { transform: rotate(360deg); } }
    .fade-up  { animation: fadeUp  0.4s ease both; }
    .slide-in { animation: slideIn 0.3s ease both; }
    .scale-in { animation: scaleIn 0.25s ease both; }
    .spinner  { animation: spin 0.9s linear infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef, createContext, useContext, useCallback } = React;

//  Helpers 
function genId()   { return Math.random().toString(36).slice(2, 10); }
function fmtEur(n) { return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(n||0); }
function fmtDate(s){ return new Date(s+"T00:00:00").toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}); }
function mKey(s)   { return s.slice(0,7); }
function nowMKey() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
}
function isEven(mk){ return parseInt(mk.split("-")[1],10) % 2 === 0; }
function dBack(n)  { const d = new Date(); d.setDate(d.getDate()-n); return d.toISOString().split("T")[0]; }

//  Default data 
const DEFAULT_CLEANUP_DAY  = 10;
const DEFAULT_AUTO_CLEANUP = true;
const DEFAULT_SAVINGS_HISTORY = [];
const DEFAULT_SAVINGS_SNAP_DAYS   = [1, 15];
const DEFAULT_SAVINGS_SNAP_ACTIVE = true;
const DEFAULT_CARD_DEBIT_DATES = {}; // { [accountId]: { [monthKey]: dateString } }
const DEFAULT_SHOW_FUTURE_TX = true;
const DEFAULT_ACCOUNTS = [
  { id: genId(), name: "Compte courant", type: "checking", balance: 0 },
];
const DEFAULT_TPL = {}; // { [accountId]: { even:{items:[]}, odd:{items:[]} } }
const emptyAcctTpl = () => ({ even: { items: [] }, odd: { items: [] } });
const SAMPLE_TX = [
  { id:"s1",  title:"Salaire",               amount:2800,   type:"income",  date:dBack(1),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s2",  title:"Allocations familiales", amount:320,    type:"income",  date:dBack(5),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s3",  title:"Loyer",                  amount:950,    type:"expense", date:dBack(2),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s4",  title:"Courses",                amount:187.50, type:"expense", date:dBack(3),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
  { id:"s5",  title:"Netflix",                amount:17.99,  type:"expense", date:dBack(4),  accountId: DEFAULT_ACCOUNTS[0].id, pointed:false },
];

//  Demo data 
const DEMO_EMAIL    = "demo@monbudget.fr";
const DEMO_PASSWORD = "Demo1234!";
const DEMO_ACCOUNTS = [
  { id:"da1", name:"Compte courant",   type:"checking", balance:0, cardName:"Visa Premier" },
  { id:"da2", name:"Compte joint",     type:"checking", balance:0 },
  { id:"da3", name:"Livret A",         type:"savings",  balance:8500,    savingsSubtype:"available" },
  { id:"da4", name:"PEL",              type:"savings",  balance:24000,   savingsSubtype:"blocked"   },
  { id:"da5", name:"Assurance vie",    type:"savings",  balance:15750,   savingsSubtype:"blocked"   },
];
const DEMO_TX = [
  // Mois courant  da1
  { id:"dt01", title:"Salaire",          amount:3200,   type:"income",  date:dBack(2),  accountId:"da1", pointed:true  },
  { id:"dt02", title:"Loyer",            amount:1100,   type:"expense", date:dBack(3),  accountId:"da1", pointed:true  },
  { id:"dt03", title:"lectricit",      amount:68,     type:"expense", date:dBack(5),  accountId:"da1", pointed:false },
  { id:"dt04", title:"Courses Leclerc",  amount:143.20, type:"expense", date:dBack(4),  accountId:"da1", pointed:true  },
  { id:"dt05", title:"Courses Lidl",     amount:54.80,  type:"expense", date:dBack(6),  accountId:"da1", pointed:false },
  { id:"dt06", title:"Netflix",          amount:17.99,  type:"expense", date:dBack(7),  accountId:"da1", pointed:true  },
  { id:"dt07", title:"Spotify",          amount:10.99,  type:"expense", date:dBack(7),  accountId:"da1", pointed:false },
  { id:"dt08", title:"Restaurant",       amount:62.50,  type:"expense", date:dBack(8),  accountId:"da1", pointed:false },
  { id:"dt09", title:"Essence",          amount:85,     type:"expense", date:dBack(9),  accountId:"da1", pointed:true  },
  { id:"dt10", title:"Pharmacie",        amount:23.40,  type:"expense", date:dBack(10), accountId:"da1", pointed:false },
  { id:"dt11", title:"Virement pargne", amount:300,    type:"expense", date:dBack(3),  accountId:"da1", pointed:true  },
  // Mois courant  da2
  { id:"dt12", title:"Salaire conjoint", amount:2400,   type:"income",  date:dBack(2),  accountId:"da2", pointed:true  },
  { id:"dt13", title:"Crche",           amount:480,    type:"expense", date:dBack(4),  accountId:"da2", pointed:true  },
  { id:"dt14", title:"Activits enfants",amount:95,     type:"expense", date:dBack(6),  accountId:"da2", pointed:false },
  { id:"dt15", title:"Abonnement salle", amount:29.99,  type:"expense", date:dBack(8),  accountId:"da2", pointed:false },
  { id:"dt16", title:"Remboursement CB", amount:120,    type:"income",  date:dBack(10), accountId:"da2", pointed:false },
  // Mois prcdent  da1
  { id:"dt17", title:"Salaire",          amount:3200,   type:"income",  date:dBack(33), accountId:"da1", pointed:true  },
  { id:"dt18", title:"Loyer",            amount:1100,   type:"expense", date:dBack(34), accountId:"da1", pointed:true  },
  { id:"dt19", title:"Courses",          amount:198.60, type:"expense", date:dBack(35), accountId:"da1", pointed:true  },
  { id:"dt20", title:"EDF",              amount:72,     type:"expense", date:dBack(36), accountId:"da1", pointed:true  },
  { id:"dt21", title:"Mutuelle",         amount:135,    type:"expense", date:dBack(37), accountId:"da1", pointed:true  },
  { id:"dt22", title:"Prime",            amount:500,    type:"income",  date:dBack(38), accountId:"da1", pointed:true  },
  // Mois prcdent  da2
  { id:"dt23", title:"Salaire conjoint", amount:2400,   type:"income",  date:dBack(33), accountId:"da2", pointed:true  },
  { id:"dt24", title:"Crche",           amount:480,    type:"expense", date:dBack(34), accountId:"da2", pointed:true  },
  { id:"dt25", title:"Vacances",         amount:640,    type:"expense", date:dBack(36), accountId:"da2", pointed:true  },
  // Mois courant  da1  oprations carte Visa Premier
  { id:"dt26", title:"Amazon",           amount:67.90,  type:"expense", date:dBack(3),  accountId:"da1", pointed:false, isCard:true },
  { id:"dt27", title:"Fnac",             amount:129.00, type:"expense", date:dBack(5),  accountId:"da1", pointed:false, isCard:true },
  { id:"dt28", title:"Zara",             amount:84.50,  type:"expense", date:dBack(8),  accountId:"da1", pointed:false, isCard:true },
  { id:"dt29", title:"Resto Le Zinc",    amount:48.00,  type:"expense", date:dBack(11), accountId:"da1", pointed:false, isCard:true },
].map(t => ({ ...t, pointed: t.pointed || false }));
// Date de prlvement dmo : le 5 du mois prochain pour le mois courant, le 5 du mois courant pour le mois prcdent
const DEMO_CARD_DEBIT_DATES = (() => {
  const now = new Date();
  const pad = n => String(n).padStart(2,'0');
  const curMk  = `${now.getFullYear()}-${pad(now.getMonth()+1)}`;
  const nextM  = now.getMonth() === 11 ? 0 : now.getMonth()+1;
  const nextY  = now.getMonth() === 11 ? now.getFullYear()+1 : now.getFullYear();
  const nextMk = `${nextY}-${pad(nextM+1)}`;
  const prevM  = now.getMonth() === 0 ? 11 : now.getMonth()-1;
  const prevY  = now.getMonth() === 0 ? now.getFullYear()-1 : now.getFullYear();
  const prevMk = `${prevY}-${pad(prevM+1)}`;
  return {
    da1: {
      [curMk]: `${nextY}-${pad(nextM+1)}-05`,  // prlvement mois courant  le 5 du mois suivant
    }
  };
})();

const DEMO_SAVINGS_HISTORY = [
  { id:"dsh1", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-2); d.setDate(1);  return d.toISOString().split("T")[0]; })(), available:7800,  blocked:37500, auto:true,  note:"" },
  { id:"dsh2", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-2); d.setDate(15); return d.toISOString().split("T")[0]; })(), available:8100,  blocked:37500, auto:true,  note:"" },
  { id:"dsh3", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-1); d.setDate(1);  return d.toISOString().split("T")[0]; })(), available:8300,  blocked:39000, auto:true,  note:"Versement PEL" },
  { id:"dsh4", date: (() => { const d=new Date(); d.setMonth(d.getMonth()-1); d.setDate(15); return d.toISOString().split("T")[0]; })(), available:8500,  blocked:39000, auto:true,  note:"" },
  { id:"dsh5", date: (() => { const d=new Date(); d.setDate(1); return d.toISOString().split("T")[0]; })(),                             available:8500,  blocked:39750, auto:true,  note:"Intrts assurance vie" },
];

//  Firebase helpers 
const fb = () => window._fb;

function fbSubscribe(uid, onData) {
  const { db, doc, onSnapshot } = fb();
  const ref = doc(db, "budgets", uid);
  return onSnapshot(ref, snap => onData(snap.exists() ? snap.data() : null));
}

async function fbSave(uid, data) {
  const { db, doc, setDoc } = fb();
  await setDoc(doc(db, "budgets", uid), data, { merge: true });
}

//  Auth Context 
const AuthCtx   = createContext(null);
const ThemeCtx  = createContext({ theme:"dark", toggle:()=>{} });
const useTheme  = () => useContext(ThemeCtx);

//  useStore 
function useStore(uid, email) {
  const isDemo = email === DEMO_EMAIL;
  const [ready,        setReady]       = useState(false);
  const [transactions, setTx]          = useState([]);
  const [templates,    setTpl]         = useState(DEFAULT_TPL);
  const [accounts,     setAccounts]    = useState(DEFAULT_ACCOUNTS);
  const [cleanupDay,   setCleanupDay]   = useState(DEFAULT_CLEANUP_DAY);
  const [autoCleanup,  setAutoCleanup]  = useState(DEFAULT_AUTO_CLEANUP);
  const [savingsHistory,    setSavingsHistory]    = useState(DEFAULT_SAVINGS_HISTORY);
  const [savingsSnapDays,   setSavingsSnapDays]   = useState(DEFAULT_SAVINGS_SNAP_DAYS);
  const [savingsSnapActive, setSavingsSnapActive] = useState(DEFAULT_SAVINGS_SNAP_ACTIVE);
  const [cardDebitDates,    setCardDebitDates]    = useState(DEFAULT_CARD_DEBIT_DATES);
  const [showFutureTx,      setShowFutureTx]      = useState(DEFAULT_SHOW_FUTURE_TX);
  const saveTimer = useRef(null);
  const loadedRef = useRef(false); // true once Firestore data is fully loaded
  const lastSaveAt = useRef(0);    // timestamp of last local save, to ignore echo

  //  Subscribe to Firestore in real-time 
  useEffect(() => {
    if (!uid) return;
    const unsub = fbSubscribe(uid, data => {
      // Ignore echoes of our own saves (within 3 seconds)
      if (loadedRef.current && Date.now() - lastSaveAt.current < 3000) return;

      if (data) {
        setTx(        (data.transactions || SAMPLE_TX).map(t => ({ ...t, pointed: t.pointed || false })) );
        setTpl(       (() => {
            const t = data.templates;
            if (!t) return DEFAULT_TPL;
            // Migrate old format { even:{items:[]}, odd:{items:[]} }  per-account
            if (t.even || t.odd) {
              const firstCheckingId = (data.accounts||DEFAULT_ACCOUNTS).find(a=>a.type==="checking")?.id;
              return firstCheckingId ? { [firstCheckingId]: { even: t.even||{items:[]}, odd: t.odd||{items:[]} } } : DEFAULT_TPL;
            }
            return t;
          })() );
        setAccounts(  (data.accounts  || DEFAULT_ACCOUNTS).map(a => ({ ...a, balance: a.balance || 0, savingsSubtype: a.savingsSubtype || "available" })) );
        setCleanupDay(data.cleanupDay || DEFAULT_CLEANUP_DAY);
        setAutoCleanup(data.autoCleanup !== undefined ? data.autoCleanup : DEFAULT_AUTO_CLEANUP);
        setSavingsHistory(data.savingsHistory || DEFAULT_SAVINGS_HISTORY);
        setSavingsSnapDays(data.savingsSnapDays || DEFAULT_SAVINGS_SNAP_DAYS);
        setSavingsSnapActive(data.savingsSnapActive !== undefined ? data.savingsSnapActive : DEFAULT_SAVINGS_SNAP_ACTIVE);
        setCardDebitDates(data.cardDebitDates || DEFAULT_CARD_DEBIT_DATES);
        setShowFutureTx(data.showFutureTx !== undefined ? data.showFutureTx : DEFAULT_SHOW_FUTURE_TX);
        snapDaysRef.current   = data.savingsSnapDays   || DEFAULT_SAVINGS_SNAP_DAYS;
        snapActiveRef.current = data.savingsSnapActive !== undefined ? data.savingsSnapActive : DEFAULT_SAVINGS_SNAP_ACTIVE;
      } else if (!loadedRef.current) {
        // First time: no document yet  save sample data
        const initTx      = isDemo ? DEMO_TX      : SAMPLE_TX;
        const initAccts   = isDemo ? DEMO_ACCOUNTS : DEFAULT_ACCOUNTS;
        const initHistory = isDemo ? DEMO_SAVINGS_HISTORY : DEFAULT_SAVINGS_HISTORY;
        const initCdd     = isDemo ? DEMO_CARD_DEBIT_DATES : DEFAULT_CARD_DEBIT_DATES;
        setTx(initTx);
        setAccounts(initAccts);
        setSavingsHistory(initHistory);
        setCardDebitDates(initCdd);
        fbSave(uid, { transactions:initTx, templates:DEFAULT_TPL, accounts:initAccts, cleanupDay:DEFAULT_CLEANUP_DAY, autoCleanup:DEFAULT_AUTO_CLEANUP, savingsHistory:initHistory, savingsSnapDays:DEFAULT_SAVINGS_SNAP_DAYS, savingsSnapActive:DEFAULT_SAVINGS_SNAP_ACTIVE, cardDebitDates:initCdd, showFutureTx:DEFAULT_SHOW_FUTURE_TX });
      }
      if (!loadedRef.current) {
        loadedRef.current = true;
        setReady(true);
      }
    });
    return () => unsub();
  }, [uid]);

  //  Auto-save to Firestore (debounced 1s) 
  const persist = useCallback((tx, tpl, acct, cd, ac, sh, ssd, ssa, cdd, sft) => {
    if (!uid || !ready) return;
    if (saveTimer.current) clearTimeout(saveTimer.current);
    saveTimer.current = setTimeout(() => {
      // Clean undefined values that Firestore rejects
      const cleanTx = tx.map(t => {
        const clean = {};
        Object.keys(t).forEach(k => { if (t[k] !== undefined) clean[k] = t[k]; });
        return clean;
      });
      lastSaveAt.current = Date.now();
      fbSave(uid, { transactions: cleanTx, templates: tpl, accounts: acct, cleanupDay: cd, autoCleanup: ac, savingsHistory: sh, savingsSnapDays: ssd, savingsSnapActive: ssa, cardDebitDates: cdd, showFutureTx: sft });
    }, 1000);
  }, [uid, ready]);

  //  Auto-cleanup 
  const doCleanup = (cdd) => {
    const currentKey = nowMKey();
    setTx(prev => {
      const filtered = prev.filter(t => {
        if (mKey(t.date) >= currentKey) return true;
        if (t.isCard && t.accountId) {
          const debitDate = cdd[t.accountId]?.[mKey(t.date)];
          if (debitDate && mKey(debitDate) >= currentKey) return true;
        }
        return false;
      });
      return filtered.length !== prev.length ? filtered : prev;
    });
  };

  useEffect(() => {
    if (!ready || !autoCleanup) return;
    const today = new Date();
    const currentDay = today.getDate();
    if (currentDay >= cleanupDay) {
      doCleanup(cardDebitDates);
    }
  }, [ready, autoCleanup, cleanupDay, cardDebitDates]);

  //  Persist on every state change 
  useEffect(() => { if (ready) persist(transactions, templates, accounts, cleanupDay, autoCleanup, savingsHistory, savingsSnapDays, savingsSnapActive, cardDebitDates, showFutureTx); },
    [transactions, templates, accounts, cleanupDay, autoCleanup, savingsHistory, savingsSnapDays, savingsSnapActive, cardDebitDates, showFutureTx, ready, persist]);

  //  Actions 
  const add    = tx  => setTx(p => [{ ...tx, id:genId(), pointed:false }, ...p]);
  const remove = id  => setTx(p => p.filter(t => t.id !== id));
  const update = (id, u) => setTx(p => p.map(t => {
    if (t.id !== id) return t;
    const updated = { ...t, ...u };
    delete updated._tpl;
    return updated;
  }));
  const togglePointed = id => setTx(p => p.map(t => t.id===id ? {...t,pointed:!t.pointed} : t));

  const addTplItem    = (accountId, parity, item) => setTpl(p => {
    const acct = p[accountId] || emptyAcctTpl();
    return { ...p, [accountId]: { ...acct, [parity]: { items: [...acct[parity].items, {...item, id:genId()}] } } };
  });
  const removeTplItem = (accountId, parity, id) => setTpl(p => {
    const acct = p[accountId] || emptyAcctTpl();
    return { ...p, [accountId]: { ...acct, [parity]: { items: acct[parity].items.filter(i=>i.id!==id) } } };
  });
  const updateTplItem = (accountId, parity, id, updates) => setTpl(p => {
    const acct = p[accountId] || emptyAcctTpl();
    return { ...p, [accountId]: { ...acct, [parity]: { items: acct[parity].items.map(i => i.id===id ? {...i,...updates} : i) } } };
  });
  const applyTemplate = (monthK, accountId) => {
    const parity = isEven(monthK) ? "even" : "odd";
    const acct   = templates[accountId] || emptyAcctTpl();
    const items  = acct[parity].items;
    if (!items.length) return;
    if (transactions.some(t => t._tpl===monthK && t.accountId===accountId)) return;
    setTx(p => [...items.map(item => {
      const day = String(item.day || 1).padStart(2, '0');
      return {...item, id:genId(), date:monthK+"-"+day, accountId, _tpl:monthK};
    }), ...p]);
  };

  const addAccount    = ()          => { if (accounts.length>=15) return; setAccounts(p=>[...p,{id:genId(),name:`Nouveau compte ${p.length+1}`,type:"checking",balance:0}]); };
  const removeAccount = id => {
    if (accounts.length<=1) return;
    setAccounts(p => p.filter(a => a.id !== id));
    setTx(p => p.filter(t => t.accountId !== id));
    setTpl(p => { const next = {...p}; delete next[id]; return next; });
    // Explicitly delete the template field in Firestore (merge:true won't delete missing fields)
    const { db, doc, setDoc, deleteField } = fb();
    setDoc(doc(db, "budgets", uid), { templates: { [id]: deleteField() } }, { merge: true });
  };
  const updateAccount = (id,updates)=> setAccounts(p=>p.map(a=>a.id===id?{...a,...updates}:a));
  const moveAccount   = (id, dir) => {
    setAccounts(p => {
      const type  = p.find(a => a.id === id)?.type;
      const group = p.filter(a => a.type === type);
      const rest  = p.filter(a => a.type !== type);
      const idx   = group.findIndex(a => a.id === id);
      const newIdx = idx + dir;
      if (newIdx < 0 || newIdx >= group.length) return p;
      const newGroup = [...group];
      [newGroup[idx], newGroup[newIdx]] = [newGroup[newIdx], newGroup[idx]];
      // Rebuild full array preserving relative positions of the other group
      return p.map(a => {
        if (a.type === type) return newGroup.shift();
        return a;
      });
    });
  };
  const updateCleanupDay  = day  => setCleanupDay(day);
  const updateAutoCleanup = val  => setAutoCleanup(val);
  const cleanupMonth  = () => doCleanup(cardDebitDates);

  //  Card debit dates actions 
  // cardDebitDates: { [accountId]: { [monthKey]: "YYYY-MM-DD" } }
  const setCardDebitDate = (accountId, monthKey, dateStr) => {
    setCardDebitDates(prev => ({
      ...prev,
      [accountId]: { ...(prev[accountId]||{}), [monthKey]: dateStr }
    }));
  };
  const clearCardDebitDate = (accountId, monthKey) => {
    setCardDebitDates(prev => {
      const acct = { ...(prev[accountId]||{}) };
      delete acct[monthKey];
      return { ...prev, [accountId]: acct };
    });
  };

  //  Savings history actions 
  const addSavingsSnapshot = (entry) => setSavingsHistory(p => [{ ...entry, id: genId() }, ...p].sort((a,b) => b.date.localeCompare(a.date)));
  const updateSavingsSnapshot = (id, updates) => setSavingsHistory(p => p.map(e => e.id===id ? {...e,...updates} : e));
  const removeSavingsSnapshot = (id) => setSavingsHistory(p => p.filter(e => e.id !== id));

  const snapDaysRef        = useRef(DEFAULT_SAVINGS_SNAP_DAYS);
  const snapActiveRef      = useRef(DEFAULT_SAVINGS_SNAP_ACTIVE);
  const cardDebitDatesRef  = useRef(DEFAULT_CARD_DEBIT_DATES);
  useEffect(() => { snapDaysRef.current       = savingsSnapDays;   }, [savingsSnapDays]);
  useEffect(() => { snapActiveRef.current     = savingsSnapActive; }, [savingsSnapActive]);
  useEffect(() => { cardDebitDatesRef.current = cardDebitDates;    }, [cardDebitDates]);

  //  Auto-snapshot on configured days 
  // Runs once after Firestore data is fully loaded (loadedRef) to avoid
  // triggering with default values before real config is available.
  useEffect(() => {
    if (!ready || !loadedRef.current) return;
    if (!snapActiveRef.current) return;
    const savingsAccounts = accounts.filter(a => a.type === "savings");
    if (savingsAccounts.length === 0) return;

    const today = new Date();
    const d = today.getDate();
    if (!snapDaysRef.current.includes(d)) return;

    const pad = n => String(n).padStart(2, "0");
    const dateKey = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(d)}`;
    if (savingsHistory.some(e => e.date === dateKey)) return;

    const available = savingsAccounts.filter(a => a.savingsSubtype !== "blocked").reduce((s, a) => s + (a.balance || 0), 0);
    const blocked   = savingsAccounts.filter(a => a.savingsSubtype === "blocked").reduce((s, a) => s + (a.balance || 0), 0);
    addSavingsSnapshot({ date: dateKey, available, blocked, auto: true, note: "" });
  }, [ready]);

  return { ready, transactions, add, remove, update, togglePointed,
    templates, addTplItem, removeTplItem, updateTplItem, applyTemplate,
    accounts, addAccount, removeAccount, updateAccount, moveAccount,
    cleanupDay, updateCleanupDay, autoCleanup, updateAutoCleanup, cleanupMonth,
    savingsHistory, addSavingsSnapshot, updateSavingsSnapshot, removeSavingsSnapshot,
    savingsSnapDays, setSavingsSnapDays, savingsSnapActive, setSavingsSnapActive,
    cardDebitDates, setCardDebitDate, clearCardDebitDate,
    showFutureTx, setShowFutureTx,
    isDemo };
}

//  Magic Word Hash (SHA-256  le mot n'apparat pas en clair) 
const DEMO_MAGIC_HASH = "eef0c396c1a2c19d3119217a759fad0d6ab57465cb9241e80277378bfd970236";

async function hashString(str) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
}

//  Modale Mot Magique 
function MagicWordModal({ onSuccess, onClose }) {
  const [word, setWord]       = useState("");
  const [error, setError]     = useState("");
  const [shaking, setShaking] = useState(false);
  const inputRef              = React.useRef(null);

  React.useEffect(() => { setTimeout(() => inputRef.current?.focus(), 80); }, []);

  const handleCheck = async () => {
    const hash = await hashString(word.trim().toLowerCase());
    if (hash === DEMO_MAGIC_HASH) {
      onSuccess();
    } else {
      setError(" Ce n'est pas le bon mot");
      setShaking(true);
      setTimeout(() => setShaking(false), 500);
      setWord("");
    }
  };

  return (
    <div style={{
      position:"fixed", inset:0, background:"rgba(0,0,0,0.75)", backdropFilter:"blur(4px)",
      display:"flex", alignItems:"center", justifyContent:"center", zIndex:9999, padding:24
    }} onClick={e => e.target===e.currentTarget && onClose()}>
      <div style={{
        background:"var(--surface)", border:"1px solid var(--gold)",
        borderRadius:"var(--radius)", padding:32, maxWidth:360, width:"100%",
        boxShadow:"0 0 40px rgba(212,175,55,0.15)",
        animation: shaking ? "shake 0.4s ease" : "fadeInUp 0.25s ease",
      }}>
        {/* Icne */}
        <div style={{ textAlign:"center", marginBottom:20 }}>
          <div style={{
            display:"inline-flex", alignItems:"center", justifyContent:"center",
            width:64, height:64, borderRadius:"50%",
            background:"linear-gradient(135deg, #2a2208, #3d3010)",
            border:"2px solid var(--gold)", fontSize:28, marginBottom:12
          }}></div>
          <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:22, color:"var(--gold)", margin:0 }}>
            Accs restreint
          </p>
          <p style={{ fontSize:13, color:"var(--text-muted)", marginTop:6, lineHeight:1.5 }}>
            Entrez le mot magique pour accder au mode dmo.
          </p>
        </div>

        {/* Champ */}
        <input
          ref={inputRef}
          type="password"
          value={word}
          onChange={e => { setWord(e.target.value); setError(""); }}
          onKeyDown={e => e.key === "Enter" && handleCheck()}
          placeholder="Mot magique"
          style={{
            width:"100%", fontSize:15, padding:"11px 14px", boxSizing:"border-box",
            background:"var(--surface2)", border:`1px solid ${error ? "var(--red)" : "var(--border)"}`,
            borderRadius:"var(--radius-sm)", color:"var(--text)", marginBottom:8,
            textAlign:"center", letterSpacing:"0.15em"
          }}
        />
        {error && <p style={{ fontSize:12, color:"var(--red)", textAlign:"center", marginBottom:8 }}>{error}</p>}

        {/* Boutons */}
        <div style={{ display:"flex", gap:10, marginTop:4 }}>
          <button onClick={onClose} style={{
            flex:1, padding:"11px", borderRadius:"var(--radius-sm)",
            background:"var(--surface2)", border:"1px solid var(--border)",
            color:"var(--text-muted)", fontSize:14, fontWeight:600, cursor:"pointer"
          }}>Annuler</button>
          <button onClick={handleCheck} style={{
            flex:2, padding:"11px", borderRadius:"var(--radius-sm)",
            background:"linear-gradient(135deg, var(--gold-light), var(--gold))",
            border:"none", color:"#0e0f13", fontSize:14, fontWeight:700, cursor:"pointer"
          }}> Entrer</button>
        </div>
      </div>

      <style>{`
        @keyframes fadeInUp {
          from { opacity:0; transform:translateY(16px); }
          to   { opacity:1; transform:translateY(0); }
        }
        @keyframes shake {
          0%,100% { transform:translateX(0); }
          20%     { transform:translateX(-8px); }
          40%     { transform:translateX(8px); }
          60%     { transform:translateX(-6px); }
          80%     { transform:translateX(6px); }
        }
      `}</style>
    </div>
  );
}

//  Login Screen 
function LoginScreen({ onLogin }) {
  const [email,       setEmail]       = useState("");
  const [password,    setPassword]    = useState("");
  const [error,       setError]       = useState("");
  const [loading,     setLoading]     = useState(false);
  const [demoLoading, setDemoLoading] = useState(false);
  const [showMagic,   setShowMagic]   = useState(false);

  const doLogin = async (credentials) => {
    const em = credentials?.email || email;
    const pw = credentials?.password || password;
    setError("");
    if (credentials) setDemoLoading(true); else setLoading(true);
    try {
      const { auth, signInWithEmailAndPassword } = fb();
      await signInWithEmailAndPassword(auth, em, pw);
    } catch (err) {
      setError("Email ou mot de passe incorrect.");
    } finally {
      setLoading(false); setDemoLoading(false);
    }
  };

  const handleSubmit  = () => doLogin();
  const handleDemo    = () => setShowMagic(true);
  const handleMagicOk = () => {
    setShowMagic(false);
    doLogin({ email: DEMO_EMAIL, password: DEMO_PASSWORD });
  };

  return (
    <>
      {showMagic && <MagicWordModal onSuccess={handleMagicOk} onClose={() => setShowMagic(false)} />}
      <div style={{ minHeight:"100vh", display:"flex", alignItems:"center", justifyContent:"center", padding:24, background:"var(--bg)" }}>
        <div style={{ width:"100%", maxWidth:380 }}>
          <div style={{ textAlign:"center", marginBottom:36 }}>
            <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:38, color:"var(--gold)", letterSpacing:"-0.02em" }}>Mon Budget</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginTop:6 }}>Connectez-vous pour accder  votre budget</p>
          </div>
          <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:24, display:"flex", flexDirection:"column", gap:16 }}>
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.07em", display:"block", marginBottom:6 }}>Email</label>
              <input type="email" value={email} onChange={e=>setEmail(e.target.value)}
                placeholder="votre@email.com" autoComplete="email"
                style={{ width:"100%", fontSize:15, padding:"10px 14px", background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", color:"var(--text)" }} />
            </div>
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.07em", display:"block", marginBottom:6 }}>Mot de passe</label>
              <input type="password" value={password} onChange={e=>setPassword(e.target.value)}
                placeholder="" autoComplete="current-password"
                onKeyDown={e=>e.key==="Enter"&&handleSubmit()}
                style={{ width:"100%", fontSize:15, padding:"10px 14px", background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", color:"var(--text)" }} />
            </div>
            {error && <p style={{ fontSize:13, color:"var(--red)", textAlign:"center" }}>{error}</p>}
            <button onClick={handleSubmit} disabled={loading || demoLoading} style={{
              padding:"13px", borderRadius:"var(--radius-sm)",
              background: loading ? "var(--surface3)" : "linear-gradient(135deg, var(--gold-light), var(--gold))",
              border:"none", color:"#0e0f13", fontSize:15, fontWeight:700,
              opacity: loading ? 0.7 : 1,
            }}>
              {loading ? "Connexion" : "Se connecter"}
            </button>

            {/* Separator */}
            <div style={{ display:"flex", alignItems:"center", gap:10 }}>
              <div style={{ flex:1, height:1, background:"var(--border)" }} />
              <span style={{ fontSize:11, color:"var(--text-sub)", fontWeight:500 }}>ou</span>
              <div style={{ flex:1, height:1, background:"var(--border)" }} />
            </div>

            {/* Demo button */}
            <button onClick={handleDemo} disabled={loading || demoLoading} style={{
              padding:"12px", borderRadius:"var(--radius-sm)",
              background:"var(--surface2)", border:"1px solid var(--border)",
              color:"var(--text-muted)", fontSize:14, fontWeight:600,
              opacity: demoLoading ? 0.7 : 1, display:"flex", alignItems:"center", justifyContent:"center", gap:8
            }}>
              <span style={{ fontSize:16 }}></span>
              {demoLoading ? "Chargement" : "Voir la dmo"}
            </button>
          </div>
        </div>
      </div>
    </>
  );
}

//  Loading Screen 
function LoadingScreen() {
  return (
    <div style={{ minHeight:"100vh", display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center", gap:16, background:"var(--bg)" }}>
      <div className="spinner" style={{ width:36, height:36, border:"3px solid var(--border2)", borderTopColor:"var(--gold)", borderRadius:"50%" }} />
      <p style={{ fontSize:14, color:"var(--text-muted)" }}>Chargement</p>
    </div>
  );
}

//  App 
function App() {
  const [user,       setUser]    = useState(undefined); // undefined = checking, null = not logged in
  const [tab,        setTab]     = useState("dashboard");
  const [showForm,   setForm]    = useState(false);
  const [formAccount,setFormAcc] = useState(null);
  const [theme,      setTheme]   = useState(() => localStorage.getItem("budget_theme") || "dark");

  const store = useStore(user?.uid, user?.email);

  const INACTIVITY_LIMIT = (user?.email === DEMO_EMAIL ? 15 * 60 : 8 * 60 * 60) * 1000; // 15min demo, 8h normal
  const ACTIVITY_KEY     = "budget_last_activity";

  // Update last activity timestamp on any user interaction
  useEffect(() => {
    const touch = () => localStorage.setItem(ACTIVITY_KEY, Date.now().toString());
    const events = ["mousedown", "keydown", "touchstart", "scroll", "click"];
    events.forEach(e => window.addEventListener(e, touch, { passive: true }));
    return () => events.forEach(e => window.removeEventListener(e, touch));
  }, []);

  useEffect(() => {
    const { auth, onAuthStateChanged, signOut } = fb();
    return onAuthStateChanged(auth, async u => {
      if (u) {
        // Check inactivity on auth state change (app open / tab focus)
        const last = parseInt(localStorage.getItem(ACTIVITY_KEY) || "0", 10);
        const elapsed = Date.now() - last;
        if (last > 0 && elapsed > INACTIVITY_LIMIT) {
          await signOut(auth);
          localStorage.removeItem(ACTIVITY_KEY);
          return;
        }
        // Record activity on fresh login
        if (!last) localStorage.setItem(ACTIVITY_KEY, Date.now().toString());
      } else {
        localStorage.removeItem(ACTIVITY_KEY);
      }
      setUser(u || null);
    });
  }, []);

  // Also check inactivity when tab regains focus (fixes iOS Safari background freeze)
  useEffect(() => {
    const checkInactivity = async () => {
      if (!user) return;
      try {
        const last = parseInt(localStorage.getItem(ACTIVITY_KEY) || "0", 10);
        if (last > 0 && Date.now() - last > INACTIVITY_LIMIT) {
          const { auth, signOut } = fb();
          await signOut(auth);
          localStorage.removeItem(ACTIVITY_KEY);
        }
      } catch (e) {
        // localStorage may be blocked in iOS private mode  ignore silently
      }
    };

    // iOS Safari: visibilitychange is the most reliable event when returning from background
    const onVisibilityChange = () => {
      if (document.visibilityState === "visible") checkInactivity();
    };

    // Fallback for desktop browsers
    const onFocus = () => checkInactivity();

    // pageshow fires on iOS when navigating back (bfcache restore)  critical for iOS
    const onPageShow = (e) => {
      // e.persisted = true means page was restored from bfcache (common on iOS)
      if (e.persisted) checkInactivity();
    };

    window.addEventListener("focus", onFocus);
    window.addEventListener("pageshow", onPageShow);
    document.addEventListener("visibilitychange", onVisibilityChange);

    return () => {
      window.removeEventListener("focus", onFocus);
      window.removeEventListener("pageshow", onPageShow);
      document.removeEventListener("visibilitychange", onVisibilityChange);
    };
  }, [user, INACTIVITY_LIMIT]);

  useEffect(() => {
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("budget_theme", theme);
  }, [theme]);

  if (user === undefined) return <LoadingScreen />;
  if (user === null)      return (
    <ThemeCtx.Provider value={{ theme, toggle:()=>setTheme(t=>t==="dark"?"light":"dark") }}>
      <LoginScreen />
    </ThemeCtx.Provider>
  );

  if (!store.ready) return <LoadingScreen />;

  const handleOpenForm = (account=null) => { setFormAcc(account); setForm(true); };

  return (
    <ThemeCtx.Provider value={{ theme, toggle:()=>setTheme(t=>t==="dark"?"light":"dark") }}>
      <div style={{ display:"flex", flexDirection:"column", height:"100vh", maxWidth:480, margin:"0 auto", background:"var(--bg)", transition:"background 0.3s" }}>
        {store.isDemo && (
          <div style={{ background:"linear-gradient(90deg,#c9a84c,#e8c96a)", padding:"8px 16px", display:"flex", alignItems:"center", justifyContent:"center", gap:8, zIndex:50 }}>
            <span style={{ fontSize:14 }}></span>
            <p style={{ fontSize:12, fontWeight:700, color:"#0e0f13", letterSpacing:"0.04em" }}>MODE DMO  Les modifications sont visibles par tous les visiteurs</p>
          </div>
        )}
        <div style={{ flex:1, overflowY:"auto", paddingBottom:80 }}>
          {tab==="dashboard"     && <Dashboard    store={store} onAdd={handleOpenForm} onGoSavings={()=>setTab("savingsStats")} />}
          {tab==="transactions"  && <Transactions store={store} onAdd={handleOpenForm} />}
          {tab==="settings"      && <Settings     store={store} user={user} />}
          {tab==="savingsStats"  && <SavingsStats store={store} onBack={()=>setTab("dashboard")} />}
        </div>
        <TabBar tab={tab === "savingsStats" ? "dashboard" : tab} setTab={setTab} />
        {showForm && <FormModal store={store} account={formAccount} onClose={()=>setForm(false)} />}
      </div>
    </ThemeCtx.Provider>
  );
}

//  TabBar 
function TabBar({ tab, setTab }) {
  const tabs = [
    { id:"dashboard",    icon:"", label:"Tableau"    },
    { id:"transactions", icon:"", label:"Historique" },
    { id:"settings",     icon:"", label:"Rglages"   },
  ];
  return (
    <div style={{ position:"fixed", bottom:0, left:"50%", transform:"translateX(-50%)", width:"100%", maxWidth:480, background:"var(--tab-bg)", backdropFilter:"blur(20px)", borderTop:"1px solid var(--border)", display:"flex", justifyContent:"space-around", padding:"10px 0 16px", zIndex:100 }}>
      {tabs.map(t => (
        <button key={t.id} onClick={()=>setTab(t.id)} onTouchStart={()=>{}} className="tabbar-btn" style={{ display:"flex", flexDirection:"column", alignItems:"center", gap:3, background:"none", border:"none", padding:"4px 16px", color:tab===t.id?"var(--gold)":"var(--text-sub)", transition:"color 0.2s", WebkitUserSelect:"none" }}>
          <span style={{ fontSize:20, lineHeight:1 }}>{t.icon}</span>
          <span style={{ fontSize:10, fontWeight:500, letterSpacing:"0.04em" }}>{t.label}</span>
        </button>
      ))}
    </div>
  );
}

//  PageHeader 
function PageHeader({ title, onAdd, children }) {
  return (
    <div style={{ background:"var(--header-bg)", padding:"16px 20px 18px", borderBottom:"1px solid var(--border)" }}>
      <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:28, letterSpacing:"-0.02em", color:"var(--header-text)", marginBottom:children?14:0 }}>{title}</p>
      {onAdd && !children && (
        <button onClick={onAdd}
          style={{ display:"flex", alignItems:"center", gap:6, padding:"7px 14px", borderRadius:20,
            background:"var(--gold-dim)", border:"1px solid var(--gold)",
            color:"var(--gold)", fontSize:13, fontWeight:600, marginTop:12 }}>
          <span style={{ fontSize:16, lineHeight:1 }}></span> Ajouter
        </button>
      )}
      {children && (
        <div style={{ display:"flex", alignItems:"center", gap:8 }}>
          <div style={{ flex:1 }}>{children}</div>
          {onAdd && (
            <button onClick={onAdd}
              style={{ display:"flex", alignItems:"center", gap:6, padding:"7px 14px", borderRadius:20,
                background:"var(--gold-dim)", border:"1px solid var(--gold)",
                color:"var(--gold)", fontSize:13, fontWeight:600, flexShrink:0, alignSelf:"flex-end" }}>
              <span style={{ fontSize:16, lineHeight:1 }}></span> Ajouter
            </button>
          )}
        </div>
      )}
    </div>
  );
}

//  MonthTabs 
function MonthTabs({ months, selected, onSelect }) {
  return (
    <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2 }}>
      {months.map(m => (
        <button key={m} onClick={()=>onSelect(m)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:selected===m?"var(--gold)":"var(--border)", background:selected===m?"var(--gold-dim)":"var(--surface2)", color:selected===m?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}>
          {new Date(m+"-02").toLocaleDateString("fr-FR",{month:"short",year:"2-digit"})}
        </button>
      ))}
    </div>
  );
}

//  TxRow 
function TxRow({ tx, deletable, onDelete, onEdit, onTogglePointed, clicked, onToggleClicked, delay=0, isCard=false, displayDate=null, accountName=null }) {
  const handleTogglePointed = (e) => {
    e.stopPropagation();
    onTogglePointed();
    onToggleClicked && onToggleClicked(null);
  };
  return (
    <div className="slide-in" onClick={()=>deletable&&onToggleClicked&&onToggleClicked(tx.id)}
      style={{ display:"flex", alignItems:"center", gap:12, padding:"12px 16px", background:clicked?"rgba(128,128,128,0.04)":"transparent", transition:"background 0.15s", animationDelay:`${delay}s`, cursor:deletable?"pointer":"default" }}>
      <div style={{ width:38,height:38, borderRadius:10, flexShrink:0, background:tx.type==="expense"?"var(--red-dim)":"var(--green-dim)", display:"flex", alignItems:"center", justifyContent:"center", fontSize:18, position:"relative" }}>
        {tx.type==="expense"?"":""}
        {tx.pointed && <div style={{ position:"absolute", top:-2, right:-2, width:14, height:14, borderRadius:"50%", background:"var(--gold)", display:"flex", alignItems:"center", justifyContent:"center", fontSize:10, border:"2px solid var(--bg)" }}></div>}
      </div>
      <div style={{ flex:1, minWidth:0 }}>
        <p style={{ fontSize:14, fontWeight:500, whiteSpace:"nowrap", overflow:"hidden", textOverflow:"ellipsis" }}>
          {tx.title}
          {(tx.isCard || isCard) && <span style={{ marginLeft:6, fontSize:10, color:"var(--gold)", background:"rgba(201,168,76,0.12)", padding:"1px 5px", borderRadius:4, fontWeight:600, border:"1px solid rgba(201,168,76,0.25)" }}> carte</span>}
          {tx._transferFrom && <span style={{ marginLeft:6, fontSize:10, color:"var(--green)", background:"var(--green-dim)", padding:"1px 5px", borderRadius:4, fontWeight:600 }}> report</span>}
          {tx._tpl && !tx.pointed && <span style={{ marginLeft:6, fontSize:10, color:"var(--gold)", background:"var(--gold-dim)", padding:"1px 5px", borderRadius:4, fontWeight:600 }}>modle</span>}
        </p>
        <p style={{ fontSize:11, color:"var(--text-sub)", marginTop:1 }}>
          {fmtDate(displayDate || tx.date)}
          {accountName && <span style={{ marginLeft:6, fontSize:10, color:"var(--text-muted)", background:"var(--surface3)", padding:"1px 5px", borderRadius:4, fontWeight:500 }}>{accountName}</span>}
        </p>
      </div>
      <p style={{ fontSize:15, fontWeight:700, flexShrink:0, color:tx.type==="expense"?"var(--red)":"var(--green)" }}>
        {tx.type==="expense"?"":"+"}{fmtEur(tx.amount)}
      </p>
      {deletable && clicked && (
        <>
          {onTogglePointed && <button onClick={handleTogglePointed} style={{ background:tx.pointed?"var(--gold)":"var(--gold-dim)", border:"none", borderRadius:8, width:28,height:28, display:"flex", alignItems:"center", justifyContent:"center", color:tx.pointed?"#0e0f13":"var(--gold)", fontSize:14, flexShrink:0, fontWeight:700 }}></button>}
          {onEdit          && <button onClick={e=>{e.stopPropagation();onEdit();}}   style={{ background:"var(--gold-dim)", border:"none", borderRadius:8, width:28,height:28, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--gold)", fontSize:14, flexShrink:0 }}></button>}
          <button onClick={e=>{e.stopPropagation();onDelete();}} style={{ background:"var(--red-dim)", border:"none", borderRadius:8, width:28,height:28, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--red)", fontSize:14, flexShrink:0 }}></button>
        </>
      )}
    </div>
  );
}

//  DeleteModal 
function DeleteModal({ tx, onCancel, onConfirm }) {
  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
      onClick={e=>e.target===e.currentTarget&&onCancel()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
        <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Supprimer la transaction</p>
        <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
          Voulez-vous vraiment supprimer  {tx.title}  ({fmtEur(tx.amount)}) ?
        </p>
        <div style={{ display:"flex", gap:10 }}>
          <button onClick={onCancel} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
          <button onClick={onConfirm} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>
        </div>
      </div>
    </div>
  );
}

//  CardPanel 
function CardPanel({ account, sel, cardTxM, cardTotal, cardDebitDate, isDebitNextMonth, debitMonthName, store, onAddCard, onEditTx, onDeleteTx, clickedTxId, setClickedTxId }) {
  const [editingDate, setEditingDate] = useState(false);
  const [draftDate,   setDraftDate]   = useState(cardDebitDate || "");
  const [showAllCard, setShowAllCard] = useState(false);
  const CARD_LIMIT = 3;

  // Sync draft when month changes
  useEffect(() => {
    setDraftDate(cardDebitDate || "");
    setEditingDate(false);
  }, [sel, account.id, cardDebitDate]);

  const commitDate = () => {
    if (draftDate) {
      store.setCardDebitDate(account.id, sel, draftDate);
    } else {
      store.clearCardDebitDate(account.id, sel);
    }
    setEditingDate(false);
  };

  const monthLabel = new Date(sel + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" });

  return (
    <div className="fade-up" style={{ background:"var(--surface)", border:"1px solid rgba(201,168,76,0.3)", borderRadius:"var(--radius)", overflow:"hidden" }}>
      {/* Header */}
      <div style={{ display:"flex", alignItems:"center", gap:10, padding:"12px 16px", background:"linear-gradient(90deg, rgba(201,168,76,0.08), transparent)", borderBottom:"1px solid rgba(201,168,76,0.15)" }}>
        <span style={{ fontSize:20 }}></span>
        <div style={{ flex:1 }}>
          <p style={{ fontSize:13, fontWeight:700, color:"var(--gold)" }}>{account.cardName}</p>
          <p style={{ fontSize:11, color:"var(--text-muted)" }}>Carte  dbit diffr  {monthLabel}</p>
        </div>
        {cardTotal > 0 && (
          <div style={{ textAlign:"right" }}>
            <p style={{ fontSize:16, fontWeight:700, color:"var(--red)", fontFamily:"'DM Serif Display',serif" }}>{fmtEur(cardTotal)}</p>
            <p style={{ fontSize:10, color:"var(--text-muted)" }}>{cardTxM.length} dpense{cardTxM.length>1?"s":""}</p>
          </div>
        )}
      </div>

      {/* Debit date row */}
      <div style={{ display:"flex", alignItems:"center", gap:10, padding:"10px 16px", borderBottom:"1px solid var(--border)", background: isDebitNextMonth ? "rgba(224,92,92,0.04)" : "transparent" }}>
        <span style={{ fontSize:14, flexShrink:0 }}>{isDebitNextMonth ? "" : ""}</span>
        <div style={{ flex:1 }}>
          {editingDate ? (
            <div style={{ display:"flex", alignItems:"center", gap:8 }}>
              <input
                type="date"
                value={draftDate}
                onChange={e => setDraftDate(e.target.value)}
                style={{ fontSize:13, padding:"4px 8px", borderRadius:6, border:"1px solid var(--gold)", background:"var(--surface2)", color:"var(--text)", colorScheme:"var(--colorscheme)" }}
              />
              <button onClick={commitDate} style={{ padding:"4px 10px", borderRadius:6, background:"var(--gold)", border:"none", color:"#0e0f13", fontSize:12, fontWeight:700 }}></button>
              <button onClick={()=>setEditingDate(false)} style={{ padding:"4px 8px", borderRadius:6, background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text-muted)", fontSize:12 }}></button>
            </div>
          ) : (
            <div>
              {cardDebitDate ? (
                <span style={{ fontSize:12, color: isDebitNextMonth ? "var(--red)" : "var(--text-muted)" }}>
                  Prlvement prvu le <strong style={{ color: isDebitNextMonth ? "var(--red)" : "var(--text)" }}>{fmtDate(cardDebitDate)}</strong>

                </span>
              ) : (
                <span style={{ fontSize:12, color:"var(--text-sub)", fontStyle:"italic" }}>Date de prlvement non dfinie</span>
              )}
            </div>
          )}
        </div>
        {!editingDate && (
          <button onClick={()=>{ setDraftDate(cardDebitDate||""); setEditingDate(true); }}
            style={{ padding:"4px 10px", borderRadius:6, background:"var(--gold-dim)", border:"1px solid rgba(201,168,76,0.3)", color:"var(--gold)", fontSize:11, fontWeight:600, flexShrink:0 }}>
            {cardDebitDate ? " Modifier" : "+ Dfinir"}
          </button>
        )}
      </div>

      {/* Card transactions */}
      {cardTxM.length > 0 && (
        <div>
          {(showAllCard ? cardTxM : cardTxM.slice(0, CARD_LIMIT)).map((tx, i) => (
            <div key={tx.id}>
              {i > 0 && <div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
              <TxRow
                tx={tx}
                deletable
                clicked={clickedTxId === tx.id}
                onToggleClicked={id => setClickedTxId(clickedTxId === id ? null : id)}
                onDelete={() => onDeleteTx(tx)}
                onEdit={() => onEditTx(tx)}
                onTogglePointed={() => store.togglePointed(tx.id)}
                delay={i * 0.03}
                isCard
              />
            </div>
          ))}
          {cardTxM.length > CARD_LIMIT && (
            <button onClick={() => setShowAllCard(p => !p)}
              style={{ width:"100%", padding:"9px 16px", background:"var(--surface2)", border:"none", borderTop:"1px solid var(--border)", color:"var(--text-muted)", fontSize:12, fontWeight:600, cursor:"pointer", textAlign:"center" }}>
              {showAllCard ? " Voir moins" : ` Voir les ${cardTxM.length - CARD_LIMIT} autres dpenses`}
            </button>
          )}
        </div>
      )}

      {/* Empty state */}
      {cardTxM.length === 0 && (
        <div style={{ padding:"16px", textAlign:"center" }}>
          <p style={{ fontSize:12, color:"var(--text-sub)" }}>Aucune dpense carte ce mois-ci</p>
        </div>
      )}

      {/* Add button */}
      <div style={{ padding:"10px 16px 14px", borderTop: cardTxM.length > 0 ? "1px solid var(--border)" : "none" }}>
        <button onClick={onAddCard} style={{ width:"100%", padding:"9px", borderRadius:"var(--radius-sm)", background:"rgba(201,168,76,0.06)", border:"1px dashed rgba(201,168,76,0.4)", color:"var(--gold)", fontSize:13, fontWeight:600, display:"flex", alignItems:"center", justifyContent:"center", gap:6 }}>
          <span style={{ fontSize:15 }}></span> Dpense carte
        </button>
      </div>
    </div>
  );
}

//  Dashboard 
function SavingsBalanceRow({ account, balance, store }) {
  const [editing, setEditing] = useState(false);
  const [draft,   setDraft]   = useState("");
  const inputRef = useRef(null);

  const startEdit = () => {
    setDraft((account.balance || 0).toString());
    setEditing(true);
    setTimeout(() => { inputRef.current?.select(); }, 0);
  };

  const commit = () => {
    const val = parseFloat(draft.replace(",", "."));
    if (!isNaN(val)) store.updateAccount(account.id, { balance: val });
    setEditing(false);
  };

  const onKeyDown = (e) => {
    if (e.key === "Enter")  commit();
    if (e.key === "Escape") setEditing(false);
  };

  return (
    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 12px", background:"var(--surface2)", borderRadius:"var(--radius-sm)" }}>
      <div style={{ display:"flex", alignItems:"center", gap:8 }}>
        <span style={{ fontSize:13, fontWeight:500 }}>{account.name}</span>
        <span style={{ fontSize:10, fontWeight:600, padding:"2px 6px", borderRadius:6, background:account.savingsSubtype==="blocked"?"var(--red-dim)":"var(--green-dim)", color:account.savingsSubtype==="blocked"?"var(--red)":"var(--green)" }}>
          {account.savingsSubtype==="blocked"?" Bloque":" Disponible"}
        </span>
      </div>
      {editing ? (
        <div style={{ display:"flex", alignItems:"center", gap:6 }}>
          <input ref={inputRef} type="number" step="0.01" value={draft} onChange={e=>setDraft(e.target.value)} onBlur={commit} onKeyDown={onKeyDown}
            inputMode="decimal"
            style={{ width:110, fontSize:14, fontWeight:700, fontFamily:"'DM Serif Display',serif", textAlign:"right",
              padding:"3px 8px", borderRadius:6, border:"1px solid var(--gold)", background:"var(--bg)", color:"var(--gold)",
              outline:"none" }} />
          <button onMouseDown={e=>{e.preventDefault();commit();}}
            style={{ background:"var(--gold-dim)", border:"none", borderRadius:6, width:24, height:24, color:"var(--gold)", fontSize:13, flexShrink:0, cursor:"pointer" }}></button>
        </div>
      ) : (
        <span onClick={startEdit} title="Cliquer pour modifier"
          style={{ fontSize:14, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:balance>=0?"var(--green)":"var(--red)",
            cursor:"pointer", borderBottom:"1px dashed", borderColor:"transparent",
            transition:"border-color 0.15s" }}
          onMouseEnter={e=>e.currentTarget.style.borderColor="currentColor"}
          onMouseLeave={e=>e.currentTarget.style.borderColor="transparent"}>
          {fmtEur(balance)}
        </span>
      )}
    </div>
  );
}

function SynthCardPanel({ entry, sourceTxs, clickedTxId, setClickedTxId, store, onEdit, onDelete }) {
  const LIMIT = 3;
  const [showAll, setShowAll] = useState(false);
  const sortedTxs = [...sourceTxs].sort((a, b) => b.date.localeCompare(a.date));
  const visible = showAll ? sortedTxs : sortedTxs.slice(0, LIMIT);
  return (
    <div className="fade-up" style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>
      <div style={{ display:"flex", alignItems:"center", gap:10, padding:"12px 16px", background:"var(--surface2)", borderBottom:"1px solid var(--border)" }}>
        <span style={{ fontSize:18 }}></span>
        <div style={{ flex:1 }}>
          <p style={{ fontSize:13, fontWeight:600 }}>Prlvement {entry.cardName}</p>
          <p style={{ fontSize:11, color:"var(--text-muted)" }}>Dpenses de {entry.sourceMonthName}  prlev le {fmtDate(entry.debitDateStr)}</p>
        </div>
        <p style={{ fontSize:15, fontWeight:700, color: entry.total >= 0 ? "var(--red)" : "var(--green)" }}>{entry.total >= 0 ? "" : "+"}{fmtEur(Math.abs(entry.total))}</p>
      </div>
      {visible.map((tx, i) => (
        <div key={tx.id}>
          {i > 0 && <div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
          <TxRow
            tx={tx}
            isCard
            deletable
            clicked={clickedTxId === tx.id}
            onToggleClicked={id => setClickedTxId(clickedTxId === id ? null : id)}
            onTogglePointed={() => store.togglePointed(tx.id)}
            onEdit={() => onEdit(tx)}
            onDelete={() => onDelete(tx)}
            delay={i * 0.04}
          />
        </div>
      ))}
      {sortedTxs.length > LIMIT && (
        <button onClick={() => setShowAll(p => !p)}
          style={{ width:"100%", padding:"9px 16px", background:"var(--surface2)", border:"none", borderTop:"1px solid var(--border)", color:"var(--text-muted)", fontSize:12, fontWeight:600, cursor:"pointer", textAlign:"center" }}>
          {showAll ? " Voir moins" : ` Voir les ${sortedTxs.length - LIMIT} autres dpenses`}
        </button>
      )}
    </div>
  );
}

function Dashboard({ store, onAdd, onGoSavings }) {
  const [sel,              setSel]            = useState(nowMKey());
  const [selectedAccountId,setSelectedAccount] = useState("all");
  const [editingTx,        setEditingTx]      = useState(null);
  const [deletingTx,       setDeletingTx]     = useState(null);
  const [clickedTxId,      setClickedTxId]    = useState(null);
  const [cardFormAccount,  setCardFormAccount] = useState(null); // accountId for card add form

  const months = useMemo(() => {
    const today = new Date();
    const Y = today.getFullYear(), M = today.getMonth(), D = today.getDate();
    const fmt = (y,m) => `${y}-${String(m+1).padStart(2,'0')}`;
    const result = [];
    if (!store.autoCleanup || D < store.cleanupDay) {
      const pm = M===0?11:M-1, py = M===0?Y-1:Y;
      const pk = fmt(py,pm);
      const cdd = store.cardDebitDates;
      const currentKey = fmt(Y,M);
      const hasNonDeferredTx = store.transactions.some(t => {
        if (mKey(t.date) !== pk) return false;
        if (t.isCard && t.accountId) {
          const debitDate = cdd[t.accountId]?.[mKey(t.date)];
          if (debitDate && mKey(debitDate) >= currentKey) return false;
        }
        return true;
      });
      if (hasNonDeferredTx) result.push(pk);
    }
    result.push(fmt(Y,M));
    const m1=M===11?0:M+1, y1=M===11?Y+1:Y;
    result.push(fmt(y1,m1));
    const m2=m1===11?0:m1+1, y2=m1===11?y1+1:y1;
    result.push(fmt(y2,m2));
    return result;
  }, [store.cleanupDay, store.autoCleanup, store.transactions, store.cardDebitDates]);

  // Helper: get next month key
  const nextMonthKey = (mk) => {
    const [y, m] = mk.split("-").map(Number);
    const nm = m === 12 ? 1 : m + 1;
    const ny = m === 12 ? y + 1 : y;
    return `${ny}-${String(nm).padStart(2,'0')}`;
  };

  // Separate card transactions from account transactions
  const allTxM = store.transactions.filter(t => mKey(t.date) === sel && (selectedAccountId==="all" || t.accountId === selectedAccountId));
  // Regular (non-card) transactions for the selected month/account
  const txM    = allTxM.filter(t => !t.isCard).sort((a, b) => b.date.localeCompare(a.date));
  // For income/expense display totals: include everything (vision globale)
  const balance = txM.filter(t=>t.type==="income").reduce((s,t)=>s+t.amount,0)
                - txM.filter(t=>t.type==="expense").reduce((s,t)=>s+t.amount,0);

  // For a specific account: get its card info
  const selAcct  = store.accounts.find(a=>a.id===selectedAccountId);
  const hasCard  = selAcct?.type==="checking" && selAcct?.cardName;
  const isSavings = selAcct?.type==="savings";

  // Card transactions for selected account + month
  const cardTxM = hasCard
    ? store.transactions.filter(t => t.isCard && t.accountId === selectedAccountId && mKey(t.date) === sel)
        .sort((a, b) => b.date.localeCompare(a.date))
    : [];
  const cardTotal = cardTxM.reduce((s,t) => s + (t.type==="expense" ? t.amount : -t.amount), 0);

  // Card debit date for this account + month
  const cardDebitDate = hasCard
    ? (store.cardDebitDates[selectedAccountId]?.[sel] || "")
    : "";
  // Determine if card debit is next month
  const isDebitNextMonth = cardDebitDate && mKey(cardDebitDate) !== sel;
  const debitMonthName = cardDebitDate
    ? new Date(cardDebitDate + "T00:00:00").toLocaleDateString("fr-FR", { month: "long" })
    : "";

  // Balance always includes card total (deducted in the month expenses occur)
  const balanceWithCard = balance - cardTotal;

  // Check if a synthetic "Prlvement carte" transaction should appear for this month
  // (i.e., previous month had card transactions with debit date in THIS month)
  const synthCardEntries = useMemo(() => {
    if (selectedAccountId === "all") return [];
    const acct = store.accounts.find(a=>a.id===selectedAccountId);
    if (!acct?.cardName) return [];
    // Look at previous month's card debit dates for this account
    const entries = [];
    // Check all months to see if any debit date falls in 'sel'
    const cdd = store.cardDebitDates[selectedAccountId] || {};
    Object.entries(cdd).forEach(([sourceMk, debitDateStr]) => {
      if (!debitDateStr) return;
      if (mKey(debitDateStr) === sel && sourceMk !== sel) {
        // This month's display should show a synthesis line from sourceMk
        const sourceTxs = store.transactions.filter(t => t.isCard && t.accountId === selectedAccountId && mKey(t.date) === sourceMk);
        const total = sourceTxs.reduce((s,t) => s + (t.type==="expense" ? t.amount : -t.amount), 0);
        if (sourceTxs.length > 0) {
          const sourceMonthName = new Date(sourceMk + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" });
          entries.push({ sourceMk, debitDateStr, total, sourceMonthName, cardName: acct.cardName });
        }
      }
    });
    return entries;
  }, [store.transactions, store.cardDebitDates, store.accounts, selectedAccountId, sel]);

  // synthCardEntries impact the balance of the month where the debit actually occurs
  const synthTotal = synthCardEntries.reduce((s,e) => s + e.total, 0);
  const displayBalance = balanceWithCard - synthTotal;

  // Income/expense display totals: include all transactions + synth card debits

  const expns  = allTxM.filter(t=>t.type==="expense").reduce((s,t)=>s+t.amount,0) + Math.max(0, synthTotal);
  const synthIncome = Math.max(0, -synthTotal); // crdit carte diffr (solde positif)
  const income = allTxM.filter(t=>t.type==="income").reduce((s,t)=>s+t.amount,0) + synthIncome;

  const nextMk = nextMonthKey(sel);
  const nextMonthName = new Date(nextMk + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" });

  // Transfer balance:
  // - Prlvement carte ce mois-ci  carte dj solde  on transfre displayBalance (carte dduite)
  // - Prlvement carte mois suivant  la ligne synthse est dj en nextMk  on transfre AVANT dduction carte
  const cardDebitInNextMonth = hasCard && cardDebitDate && mKey(cardDebitDate) === nextMk;
  const transferBalance = cardDebitInNextMonth ? balance : displayBalance;

  // Check if a transfer transaction already exists for this account+month combo
  const TRANSFER_TAG = "__transfer__";
  const transferExists = selectedAccountId !== "all" && store.transactions.some(
    t => t.accountId === selectedAccountId && t._transferFrom === sel
  );

  const [showTransferConfirm, setShowTransferConfirm] = useState(false);

  const accountBalances = useMemo(() => {
    if (selectedAccountId!=="all") return { checking:[], savings:[] };
    const checking=[], savings=[];
    store.accounts.forEach(acc => {
      if (acc.type==="checking") {
        const at=store.transactions.filter(t=>mKey(t.date)===sel&&t.accountId===acc.id&&!t.isCard);
        const inc=at.filter(t=>t.type==="income").reduce((s,t)=>s+t.amount,0);
        const exp=at.filter(t=>t.type==="expense").reduce((s,t)=>s+t.amount,0);
        // Card expenses always deducted in the month they occur
        const cardExp = acc.cardName
          ? store.transactions.filter(t=>t.isCard&&t.accountId===acc.id&&mKey(t.date)===sel)
              .reduce((s,t)=>s+(t.type==="expense"?t.amount:-t.amount),0)
          : 0;
        // Also subtract synth card debits falling in this month (from previous month's card expenses)
        const acctCdd = store.cardDebitDates[acc.id] || {};
        const acctSynth = Object.entries(acctCdd).reduce((s,[mk,ds]) => {
          if (!ds || mKey(ds)!==sel || mk===sel) return s;
          const txs = store.transactions.filter(t=>t.isCard&&t.accountId===acc.id&&mKey(t.date)===mk);
          return s + txs.reduce((ss,t)=>ss+(t.type==="expense"?t.amount:-t.amount),0);
        }, 0);
        checking.push({account:acc, balance: inc-exp - cardExp - acctSynth });
      } else {
        savings.push({account:acc,balance:acc.balance||0});
      }
    });
    return {checking,savings};
  }, [store.transactions,store.accounts,store.cardDebitDates,sel,selectedAccountId]);

  const checkingBalance = accountBalances.checking.reduce((s,a)=>s+a.balance,0);
  const savingsBalance  = accountBalances.savings.reduce((s,a)=>s+a.balance,0);
  const parity   = isEven(sel) ? "even" : "odd";
  const acctTpl  = (store.templates[selectedAccountId] || emptyAcctTpl());
  const hasTpl   = acctTpl[parity].items.length > 0;
  const applied  = selectedAccountId!=="all" && store.transactions.some(t=>t._tpl===sel&&t.accountId===selectedAccountId);

  const handleTransfer = () => {
    // Remove any existing transfer from this month for this account
    const existing = store.transactions.find(t => t.accountId === selectedAccountId && t._transferFrom === sel);
    if (existing) store.remove(existing.id);
    // Create new transfer transaction in next month
    const day = "01";
    store.add({
      title: `Solde report`,
      amount: Math.round(Math.abs(transferBalance) * 100) / 100,
      type: transferBalance >= 0 ? "income" : "expense",
      accountId: selectedAccountId,
      date: nextMk + "-" + day,
      note: `Report du solde de ${new Date(sel + "-02T00:00:00").toLocaleDateString("fr-FR", { month: "long", year: "numeric" })}`,
      _transferFrom: sel,
    });
    setShowTransferConfirm(false);
  };

  return (
    <div>
      <PageHeader title="Mon Budget" />
      <div style={{ padding:"16px", display:"flex", flexDirection:"column", gap:14 }}>

        {/* Month tabs */}
        <MonthTabs months={months} selected={sel} onSelect={setSel} />

        {/* Account tabs */}
        <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2 }}>
          <button onClick={()=>setSelectedAccount("all")} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:selectedAccountId==="all"?"var(--gold)":"var(--border)", background:selectedAccountId==="all"?"var(--gold-dim)":"var(--surface2)", color:selectedAccountId==="all"?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> Tous les comptes</button>
          {store.accounts.filter(a=>a.type==="checking").map(acc=>(
            <button key={acc.id} onClick={()=>setSelectedAccount(acc.id)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:selectedAccountId===acc.id?"var(--gold)":"var(--border)", background:selectedAccountId===acc.id?"var(--gold-dim)":"var(--surface2)", color:selectedAccountId===acc.id?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> {acc.name}</button>
          ))}
        </div>

        {/* Parity + template */}
        {selectedAccountId!=="all" && !isSavings && (
          <div style={{ display:"flex", alignItems:"center", gap:8, flexWrap:"wrap" }}>
            <span style={{ fontSize:11, fontWeight:600, padding:"3px 10px", borderRadius:20, background:isEven(sel)?"var(--gold-dim)":"var(--green-dim)", color:isEven(sel)?"var(--gold)":"var(--green)", border:`1px solid ${isEven(sel)?"var(--gold)":"var(--green)"}` }}>Mois {isEven(sel)?"pair":"impair"}</span>
            {hasTpl && !applied && <button onClick={()=>store.applyTemplate(sel,selectedAccountId)} style={{ fontSize:11, fontWeight:600, padding:"3px 10px", borderRadius:20, background:"var(--gold-dim)", border:"1px solid var(--gold)", color:"var(--gold)" }}> Appliquer le modle</button>}
            {applied && <span style={{ fontSize:11, color:"var(--text-sub)" }}> Modle appliqu</span>}
          </div>
        )}

        {/* Balance card (individual account) */}
        {selectedAccountId!=="all" && (
          <div className="fade-up" style={{ background:displayBalance>=0?"linear-gradient(135deg,#1e2a1e,#162216)":"linear-gradient(135deg,#2a1e1e,#221616)", border:`1px solid ${displayBalance>=0?"rgba(76,175,130,0.3)":"rgba(224,92,92,0.3)"}`, borderRadius:"var(--radius)", padding:"16px", position:"relative", overflow:"hidden" }}>
            <div style={{ position:"absolute", top:-15, right:-15, width:80, height:80, borderRadius:"50%", background:displayBalance>=0?"rgba(76,175,130,0.06)":"rgba(224,92,92,0.06)" }} />
            <div style={{ display:"flex", alignItems:"flex-start", justifyContent:"space-between", gap:12 }}>
              <div>
                <p style={{ fontSize:11, fontWeight:500, color:"rgba(240,236,228,0.5)", letterSpacing:"0.08em", textTransform:"uppercase", marginBottom:6 }}>Solde {selAcct?.name||""}</p>
                <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:28, color:displayBalance>=0?"#4caf82":"#e05c5c", letterSpacing:"-0.02em" }}>{fmtEur(displayBalance)}</p>
              </div>
              {!isSavings && sel <= nowMKey() && (
                <button
                  onClick={() => setShowTransferConfirm(true)}
                  title={`Reporter le solde vers ${nextMonthName}`}
                  style={{ flexShrink:0, marginTop:2, padding:"6px 11px", borderRadius:8,
                    background: transferExists ? "rgba(201,168,76,0.15)" : "rgba(255,255,255,0.07)",
                    border: transferExists ? "1px solid rgba(201,168,76,0.5)" : "1px solid rgba(255,255,255,0.15)",
                    color: transferExists ? "var(--gold)" : "rgba(240,236,228,0.6)",
                    fontSize:12, fontWeight:600, cursor:"pointer", whiteSpace:"nowrap",
                    display:"flex", alignItems:"center", gap:5 }}>
                  <span style={{ fontSize:14 }}></span>
                  {transferExists ? "Report " : nextMonthName.split(" ")[0]}
                </button>
              )}
            </div>
          </div>
        )}

        {/* All accounts breakdown */}
        {selectedAccountId==="all" && (accountBalances.checking.length>0||accountBalances.savings.length>0) && (
          <div className="fade-up" style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:16, animationDelay:"0.05s" }}>
            {accountBalances.checking.length>0 && <>
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:12 }}>
                <div style={{ display:"flex", alignItems:"center", gap:10 }}><span style={{ fontSize:24 }}></span><p style={{ fontSize:14, fontWeight:600, color:"var(--text)", letterSpacing:"0.04em", textTransform:"uppercase" }}>Comptes courants</p></div>
                <p style={{ fontSize:22, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:checkingBalance>=0?"var(--green)":"var(--red)" }}>{fmtEur(checkingBalance)}</p>
              </div>
              <div style={{ display:"flex", flexDirection:"column", gap:8, marginBottom:accountBalances.savings.length>0?16:0 }}>
                {accountBalances.checking.map(({account,balance})=>(
                  <div key={account.id} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 12px", background:"var(--surface2)", borderRadius:"var(--radius-sm)" }}>
                    <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                      <span style={{ fontSize:13, fontWeight:500 }}>{account.name}</span>
                      {account.cardName && <span style={{ fontSize:10, padding:"1px 6px", borderRadius:4, background:"rgba(201,168,76,0.12)", color:"var(--gold)", fontWeight:600, border:"1px solid rgba(201,168,76,0.25)" }}> {account.cardName}</span>}
                    </div>
                    <span style={{ fontSize:14, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:balance>=0?"var(--green)":"var(--red)" }}>{fmtEur(balance)}</span>
                  </div>
                ))}
              </div>
            </>}
            {accountBalances.savings.length>0 && <>
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:12 }}>
                <div style={{ display:"flex", alignItems:"center", gap:10 }}><span style={{ fontSize:24 }}></span><p style={{ fontSize:14, fontWeight:600, color:"var(--text)", letterSpacing:"0.04em", textTransform:"uppercase" }}>Comptes pargne</p></div>
                <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                  <p style={{ fontSize:22, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:savingsBalance>=0?"var(--green)":"var(--red)" }}>{fmtEur(savingsBalance)}</p>
                  <button onClick={onGoSavings} style={{ padding:"5px 10px", borderRadius:8, background:"var(--gold-dim)", border:"1px solid var(--gold)", color:"var(--gold)", fontSize:11, fontWeight:700, whiteSpace:"nowrap", flexShrink:0 }}> Stats</button>
                </div>
              </div>
              <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
                {accountBalances.savings.map(({account,balance})=>(
                  <SavingsBalanceRow key={account.id} account={account} balance={balance} store={store} />
                ))}
              </div>
            </>}
          </div>
        )}

        {/* Income / Expense (non-card) */}
        <div className="fade-up" style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
          {[{label:"Revenus",val:income,color:"var(--green)",bg:"var(--green-dim)",icon:""},{label:"Dpenses",val:expns,color:"var(--red)",bg:"var(--red-dim)",icon:""}].map(c=>(
            <div key={c.label} style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:"16px" }}>
              <div style={{ display:"flex", alignItems:"center", gap:6, marginBottom:8 }}>
                <span style={{ width:26,height:26, borderRadius:8, background:c.bg, display:"flex", alignItems:"center", justifyContent:"center", fontSize:14, color:c.color, fontWeight:700 }}>{c.icon}</span>
                <span style={{ fontSize:12, color:"var(--text-muted)", fontWeight:500 }}>{c.label}</span>
              </div>
              <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:22, color:c.color }}>{fmtEur(c.val)}</p>
            </div>
          ))}
        </div>

        {/*  Carte  dbit diffr panel  */}
        {hasCard && (
          <CardPanel
            account={selAcct}
            sel={sel}
            cardTxM={cardTxM}
            cardTotal={cardTotal}
            cardDebitDate={cardDebitDate}
            isDebitNextMonth={isDebitNextMonth}
            debitMonthName={debitMonthName}
            store={store}
            onAddCard={() => setCardFormAccount(selectedAccountId)}
            onEditTx={tx => setEditingTx(tx)}
            onDeleteTx={tx => setDeletingTx(tx)}
            clickedTxId={clickedTxId}
            setClickedTxId={setClickedTxId}
          />
        )}

        {/*  Synthetic card debit entries (from previous month)  */}
        {synthCardEntries.map(entry => (
          <SynthCardPanel
            key={entry.sourceMk}
            entry={entry}
            sourceTxs={store.transactions.filter(t => t.isCard && t.accountId === selectedAccountId && mKey(t.date) === entry.sourceMk)}
            clickedTxId={clickedTxId}
            setClickedTxId={setClickedTxId}
            store={store}
            onEdit={tx => setEditingTx(tx)}
            onDelete={tx => setDeletingTx(tx)}
          />
        ))}

        {/* Recent (non-card) */}
        <div className="fade-up">
          <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:10 }}>
            <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", letterSpacing:"0.06em", textTransform:"uppercase" }}>Rcents</p>
            <button onClick={()=>onAdd(selectedAccountId==="all" ? null : selectedAccountId)} style={{ background:"none", border:"none", color:"var(--gold)", fontSize:13, fontWeight:600, padding:0, cursor:"pointer" }}>+ Ajouter</button>
          </div>
          {txM.length===0 ? <EmptyState text="Aucune transaction ce mois-ci" />
            : <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>
                {txM.slice(0,15).map((tx,i)=>(
                  <div key={tx.id}>
                    {i>0&&<div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
                    <TxRow tx={tx} deletable clicked={clickedTxId===tx.id} onToggleClicked={id=>setClickedTxId(clickedTxId===id?null:id)} onDelete={()=>setDeletingTx(tx)} onEdit={()=>setEditingTx(tx)} onTogglePointed={()=>store.togglePointed(tx.id)} delay={i*0.04} accountName={selectedAccountId==="all" ? store.accounts.find(a=>a.id===tx.accountId)?.name : null} />
                  </div>
                ))}
              </div>}
        </div>
      </div>

      {editingTx && <FormModal store={store} transaction={editingTx} onClose={()=>setEditingTx(null)} />}
      {deletingTx && <DeleteModal tx={deletingTx} onCancel={()=>setDeletingTx(null)} onConfirm={()=>{store.remove(deletingTx.id);setDeletingTx(null);}} />}
      {cardFormAccount && <FormModal store={store} account={cardFormAccount} isCardTransaction onClose={()=>setCardFormAccount(null)} />}

      {/* Transfer confirmation modal */}
      {showTransferConfirm && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setShowTransferConfirm(false)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:8 }}>Reporter le solde</p>
            <p style={{ fontSize:13, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
              Une transaction <strong style={{ color: transferBalance>=0 ? "var(--green)" : "var(--red)" }}>
                {transferBalance >= 0 ? "revenu" : "dpense"} de {fmtEur(Math.abs(transferBalance))}
              </strong> sera cre le 1er {nextMonthName} sur le compte <strong>{selAcct?.name}</strong>.
              {transferExists && <span style={{ display:"block", marginTop:8, color:"var(--gold)", fontSize:12 }}> Un report existe dj pour ce mois  il sera remplac.</span>}
            </p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setShowTransferConfirm(false)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              <button onClick={handleTransfer} style={{ flex:2, padding:"10px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:14, fontWeight:700 }}> Confirmer le report</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

//  Transactions 
function Transactions({ store, onAdd }) {
  const [search,        setSearch]      = useState("");
  const [filterType,    setFilter]      = useState("all");
  const [filterAccount, setFilterAcct]  = useState("all");
  const [editingTx,     setEditingTx]   = useState(null);
  const [deletingTx,    setDeletingTx]  = useState(null);
  const [clickedTxId,   setClickedTxId] = useState(null);

  const filtered = useMemo(()=>store.transactions.filter(t=>{
    const q=search.toLowerCase().trim();
    if (q) {
      const matchTitle  = t.title.toLowerCase().includes(q);
      const matchNote   = (t.note||"").toLowerCase().includes(q);
      const matchAmount = String(t.amount).includes(q) || fmtEur(t.amount).toLowerCase().includes(q);
      const dateFr = t.date ? t.date.split("-").reverse().join("/") : "";
      const matchDate   = (t.date||"").includes(q) || dateFr.includes(q);
      if (!matchTitle && !matchNote && !matchAmount && !matchDate) return false;
    }
    if (filterAccount !== "all" && t.accountId !== filterAccount) return false;
    if (!store.showFutureTx && !search.trim()) {
      // Masquer les transactions futures (date strictement > aujourd'hui)
      const today = new Date(); today.setHours(0,0,0,0);
      const txDate = new Date(t.date + "T00:00:00");
      if (txDate > today) return false;
    }
    if (filterType==="card") return !!t.isCard;
    if (filterType==="all") return true;
    return t.type===filterType && !t.isCard;
  }),[store.transactions,search,filterType,filterAccount,store.showFutureTx]);

  const grouped = useMemo(()=>{
    const map={};
    filtered.forEach(tx=>{if(!map[tx.date])map[tx.date]=[];map[tx.date].push(tx);});
    return Object.entries(map).sort((a,b)=>b[0].localeCompare(a[0]));
  },[filtered]);

  // Show card filter button only if any account has a card
  const hasAnyCard = store.accounts.some(a => a.cardName);
  const checkingAccounts = store.accounts.filter(a => a.type === "checking");

  return (
    <div>
      <PageHeader title="Transactions" />
      <div style={{ padding:"12px 16px 0" }}>
        {/* Type filters */}
        <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2, marginBottom:8 }}>
          {[["all","Tout"],["expense","Dpenses"],["income","Revenus"], ...(hasAnyCard ? [["card"," Carte"]] : [])].map(([v,l])=>(
            <button key={v} onClick={()=>setFilter(v)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:filterType===v?"var(--gold)":"var(--border)", background:filterType===v?"var(--gold-dim)":"var(--surface2)", color:filterType===v?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}>{l}</button>
          ))}
        </div>
        {/* Account filters */}
        {checkingAccounts.length > 1 && (
          <div style={{ display:"flex", gap:6, overflowX:"auto", paddingBottom:2, marginBottom:8 }}>
            <button onClick={()=>setFilterAcct("all")} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:filterAccount==="all"?"var(--gold)":"var(--border)", background:filterAccount==="all"?"var(--gold-dim)":"var(--surface2)", color:filterAccount==="all"?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> Tous les comptes</button>
            {checkingAccounts.map(acc=>(
              <button key={acc.id} onClick={()=>setFilterAcct(acc.id)} style={{ flexShrink:0, padding:"6px 14px", borderRadius:20, border:"1px solid", borderColor:filterAccount===acc.id?"var(--gold)":"var(--border)", background:filterAccount===acc.id?"var(--gold-dim)":"var(--surface2)", color:filterAccount===acc.id?"var(--gold)":"var(--text-muted)", fontSize:13, fontWeight:600, transition:"all 0.2s" }}> {acc.name}</button>
            ))}
          </div>
        )}
        {/* Search bar */}
        <div style={{ display:"flex", alignItems:"center", gap:8, background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", padding:"9px 14px", marginBottom:0 }}>
          <span style={{ color:"var(--text-muted)", fontSize:16 }}></span>
          <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Titre, montant, date, note" style={{ flex:1, fontSize:14, color:"var(--text)", background:"transparent" }} />
          {search && <button onClick={()=>setSearch("")} style={{ background:"none", border:"none", color:"var(--text-muted)", fontSize:16, cursor:"pointer", padding:0, lineHeight:1 }}></button>}
        </div>
      </div>
      <div style={{ padding:"12px 16px 16px" }}>
        {grouped.length===0 ? <EmptyState text="Aucune transaction trouve" />
          : grouped.map(([date,txs], gi)=>(
            <div key={date} className="slide-in">
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", margin:"14px 0 6px 4px" }}>
                <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em" }}>{fmtDate(date)}</p>
                {gi===0 && <button onClick={()=>onAdd(filterAccount==="all" ? null : filterAccount)} style={{ background:"none", border:"none", color:"var(--gold)", fontSize:13, fontWeight:600, padding:0, cursor:"pointer" }}>+ Ajouter</button>}
              </div>
              <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>
                {txs.map((tx,i)=>(
                  <div key={tx.id}>
                    {i>0&&<div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
                    <TxRow tx={tx} deletable clicked={clickedTxId===tx.id} onToggleClicked={id=>setClickedTxId(clickedTxId===id?null:id)} onDelete={()=>setDeletingTx(tx)} onEdit={()=>setEditingTx(tx)} onTogglePointed={()=>store.togglePointed(tx.id)} accountName={filterAccount==="all" && store.accounts.length > 1 ? store.accounts.find(a=>a.id===tx.accountId)?.name : null} />
                  </div>
                ))}
              </div>
            </div>
          ))}
      </div>
      {editingTx  && <FormModal store={store} transaction={editingTx} onClose={()=>setEditingTx(null)} />}
      {deletingTx && <DeleteModal tx={deletingTx} onCancel={()=>setDeletingTx(null)} onConfirm={()=>{store.remove(deletingTx.id);setDeletingTx(null);}} />}
    </div>
  );
}

//  Settings 
function Settings({ store, user }) {
  const { theme, toggle } = useTheme();
  const checkingAccounts = store.accounts.filter(a => a.type === "checking");
  const [activeParity,       setParity]          = useState("even");
  const [activeAccountId,    setActiveAccountId] = useState(() => checkingAccounts[0]?.id || "");
  const [showAdd,            setShowAdd]          = useState(false);
  const [editingTplItem,     setEditingTplItem]   = useState(null);
  const [editingAccounts,    setEditingAccounts]  = useState(false);
  const [showCleanupConfirm, setShowCleanupConfirm] = useState(false);
  const [cleanupMessage,     setCleanupMessage]   = useState({ text: "", canDelete: false });

  // Keep activeAccountId in sync if accounts change
  React.useEffect(() => {
    if (!checkingAccounts.find(a => a.id === activeAccountId) && checkingAccounts.length > 0) {
      setActiveAccountId(checkingAccounts[0].id);
    }
  }, [store.accounts]);

  const acctTpl     = (store.templates[activeAccountId] || emptyAcctTpl());
  const tpl         = acctTpl[activeParity];
  const totalIncome = tpl.items.filter(i=>i.type==="income").reduce((s,i)=>s+i.amount,0);
  const totalExpense= tpl.items.filter(i=>i.type==="expense").reduce((s,i)=>s+i.amount,0);

  const handleCleanupClick = () => {
    const currentKey = nowMKey();
    const cdd = store.cardDebitDates;
    const toDelete = store.transactions.filter(t => {
      if (mKey(t.date) >= currentKey) return false;
      if (t.isCard && t.accountId) {
        const debitDate = cdd[t.accountId]?.[mKey(t.date)];
        if (debitDate && mKey(debitDate) >= currentKey) return false;
      }
      return true;
    }).length;
    const toKeep = store.transactions.filter(t => {
      if (mKey(t.date) >= currentKey) return false;
      if (t.isCard && t.accountId) {
        const debitDate = cdd[t.accountId]?.[mKey(t.date)];
        if (debitDate && mKey(debitDate) >= currentKey) return true;
      }
      return false;
    }).length;
    const currentName = new Date().toLocaleDateString("fr-FR", { month:"long", year:"numeric" });
    let msg;
    if (toDelete === 0 && toKeep === 0) {
      msg = `Aucune transaction antrieure  ${currentName}.`;
    } else if (toDelete === 0 && toKeep > 0) {
      msg = `Les ${toKeep} transaction(s) du mois prcdent sont des dpenses carte  dbit diffr  elles seront conserves jusqu' ce que leur prlvement soit pass.`;
    } else if (toKeep > 0) {
      msg = `Supprimer ${toDelete} transaction(s) antrieure(s)  ${currentName} ? Les ${toKeep} transaction(s) carte  dbit diffr seront conserves jusqu' leur prlvement.`;
    } else {
      msg = `Supprimer ${toDelete} transaction(s) antrieure(s)  ${currentName} ?`;
    }
    setCleanupMessage({ text: msg, canDelete: toDelete > 0 });
    setShowCleanupConfirm(true);
  };

  const confirmCleanup = () => {
    store.cleanupMonth();
    setShowCleanupConfirm(false);
  };

  const handleLogout = async () => {
    const { auth, signOut } = fb();
    localStorage.removeItem("budget_last_activity");
    await signOut(auth);
  };

  const [resetting, setResetting] = useState(false);
  const handleDemoReset = async () => {
    if (!window.confirm("Rinitialiser les donnes dmo ? Toutes les modifications seront perdues.")) return;
    setResetting(true);
    try {
      const uid = user.uid;
      await fbSave(uid, {
        transactions: DEMO_TX,
        templates: DEFAULT_TPL,
        accounts: DEMO_ACCOUNTS,
        cleanupDay: DEFAULT_CLEANUP_DAY,
        autoCleanup: DEFAULT_AUTO_CLEANUP,
        savingsHistory: DEMO_SAVINGS_HISTORY,
        savingsSnapDays: DEFAULT_SAVINGS_SNAP_DAYS,
        savingsSnapActive: DEFAULT_SAVINGS_SNAP_ACTIVE,
        cardDebitDates: DEMO_CARD_DEBIT_DATES,
      });
      // Reload page to reinitialize store state cleanly
      window.location.reload();
    } catch(e) {
      alert("Erreur lors de la rinitialisation.");
      setResetting(false);
    }
  };

  return (
    <div>
      <PageHeader title="Rglages" />
      <div style={{ padding:"16px", display:"flex", flexDirection:"column", gap:20 }}>

        {/* Apparence */}
        <Section title="Apparence" icon="">
          <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"14px 16px" }}>
            <div style={{ display:"flex", alignItems:"center", gap:10 }}>
              <span style={{ fontSize:22 }}>{theme==="dark"?"":""}</span>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>{theme==="dark"?"Mode sombre":"Mode clair"}</p>
                <p style={{ fontSize:12, color:"var(--text-muted)" }}>Thme de l'interface</p>
              </div>
            </div>
            <Toggle checked={theme==="light"} onChange={toggle} />
          </div>
          <div style={{ borderTop:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center", padding:"14px 16px" }}>
            <div style={{ display:"flex", alignItems:"center", gap:10 }}>
              <span style={{ fontSize:22 }}></span>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>Transactions futures dans l'historique</p>
                <p style={{ fontSize:12, color:"var(--text-muted)" }}>
                  {store.showFutureTx ? "Affiches  toutes les transactions apparaissent" : "Masques  seules les transactions passes et du jour apparaissent"}
                </p>
              </div>
            </div>
            <Toggle checked={store.showFutureTx} onChange={()=>store.setShowFutureTx(!store.showFutureTx)} />
          </div>
        </Section>

        {/* Comptes */}
        <Section title="Comptes bancaires" icon="">
          <div style={{ padding:"14px 16px" }}>
            <p style={{ fontSize:12, color:"var(--text-muted)", marginBottom:12, lineHeight:1.6 }}>
              Grez vos comptes (max. 15). Les soldes pargne  sont saisis manuellement.
            </p>
            <div style={{ display:"flex", flexDirection:"column", gap:10, marginBottom:12 }}>
              {/* Comptes courants */}
              {store.accounts.filter(a=>a.type==="checking").length > 0 && editingAccounts && (
                <p style={{ fontSize:10, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em" }}> Comptes courants</p>
              )}
              {store.accounts.filter(a=>a.type==="checking").map((acc)=>(
                <AccountRow key={acc.id} acc={acc} store={store} editingAccounts={editingAccounts} />
              ))}
              {/* Comptes pargne */}
              {store.accounts.filter(a=>a.type==="savings").length > 0 && editingAccounts && (
                <p style={{ fontSize:10, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em", marginTop:4 }}> Comptes pargne</p>
              )}
              {store.accounts.filter(a=>a.type==="savings").map((acc)=>(
                <AccountRow key={acc.id} acc={acc} store={store} editingAccounts={editingAccounts} />
              ))}
            </div>
            {!editingAccounts ? (
              <button onClick={()=>setEditingAccounts(true)} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--gold-dim)", border:"1px solid var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600 }}> Modifier les comptes</button>
            ) : (
              <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
                {store.accounts.length<15 && (
                  <button onClick={()=>store.addAccount()} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--green-dim)", border:"1px dashed var(--green)", color:"var(--green)", fontSize:13, fontWeight:600 }}>+ Ajouter un compte ({store.accounts.length}/15)</button>
                )}
                <button onClick={()=>setEditingAccounts(false)} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:14, fontWeight:700 }}> Terminer</button>
              </div>
            )}
          </div>
        </Section>

        {/* Modles */}
        <Section title="Modles rcurrents" icon="">
          <div style={{ padding:"12px 16px 8px", borderBottom:"1px solid var(--border)" }}>
            <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.6 }}>Oprations rcurrentes par compte, pour les mois pairs et impairs.</p>
          </div>

          {/* Slecteur de compte */}
          {checkingAccounts.length > 1 && (
            <div style={{ display:"flex", gap:6, overflowX:"auto", padding:"10px 16px", borderBottom:"1px solid var(--border)" }}>
              {checkingAccounts.map(acc => (
                <button key={acc.id} onClick={()=>setActiveAccountId(acc.id)} style={{ flexShrink:0, padding:"5px 13px", borderRadius:20, border:"1px solid", borderColor:activeAccountId===acc.id?"var(--gold)":"var(--border)", background:activeAccountId===acc.id?"var(--gold-dim)":"var(--surface2)", color:activeAccountId===acc.id?"var(--gold)":"var(--text-muted)", fontSize:12, fontWeight:600 }}> {acc.name}</button>
              ))}
            </div>
          )}

          {/* Slecteur pair/impair */}
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8, padding:"12px 16px" }}>
            {[["even","Mois pairs","2,4,6"],["odd","Mois impairs","1,3,5"]].map(([k,l,sub])=>(
              <button key={k} onClick={()=>setParity(k)} style={{ padding:"10px 12px", borderRadius:"var(--radius-sm)", border:"1px solid", borderColor:activeParity===k?"var(--gold)":"var(--border)", background:activeParity===k?"var(--gold-dim)":"var(--surface2)", textAlign:"left" }}>
                <p style={{ fontSize:13, fontWeight:600, color:activeParity===k?"var(--gold)":"var(--text)" }}>{l}</p>
                <p style={{ fontSize:11, color:"var(--text-muted)", marginTop:2 }}>{sub}</p>
              </button>
            ))}
          </div>

          {/* Totaux */}
          {(totalIncome>0||totalExpense>0) && (
            <div style={{ display:"flex", gap:8, padding:"0 16px 10px" }}>
              {totalIncome>0  && <span style={{ fontSize:11, padding:"3px 8px", borderRadius:12, background:"var(--green-dim)", color:"var(--green)", fontWeight:600 }}> {fmtEur(totalIncome)}</span>}
              {totalExpense>0 && <span style={{ fontSize:11, padding:"3px 8px", borderRadius:12, background:"var(--red-dim)",   color:"var(--red)",   fontWeight:600 }}> {fmtEur(totalExpense)}</span>}
              <span style={{ fontSize:11, padding:"3px 8px", borderRadius:12, background:"var(--surface2)", color:"var(--text-muted)", fontWeight:600 }}>{fmtEur(totalIncome-totalExpense)} net</span>
            </div>
          )}

          {/* Lignes du modle */}
          {checkingAccounts.length === 0
            ? <p style={{ padding:"12px 16px", fontSize:13, color:"var(--text-sub)", textAlign:"center" }}>Aucun compte courant configur</p>
            : tpl.items.length===0
              ? <p style={{ padding:"12px 16px", fontSize:13, color:"var(--text-sub)", textAlign:"center" }}>Aucune opration rcurrente</p>
              : <div>{tpl.items.map((item,i)=>(
                  <div key={item.id}>
                    {i>0&&<div style={{ height:1, background:"var(--border)", margin:"0 16px" }} />}
                    <TplItemRow item={item} onDelete={()=>store.removeTplItem(activeAccountId, activeParity, item.id)} onEdit={()=>setEditingTplItem({item, parity: activeParity})} />
                  </div>
                ))}</div>
          }

          {/* Bouton ajouter */}
          {checkingAccounts.length > 0 && (
            <div style={{ padding:"10px 16px 14px" }}>
              <button onClick={()=>setShowAdd(true)} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--gold-dim)", border:"1px dashed var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600 }}>+ Ajouter une opration rcurrente</button>
            </div>
          )}
        </Section>

        {/* Nettoyage */}
        <Section title="Nettoyage automatique" icon="">
          <div style={{ padding:"14px 16px" }}>
            {/* Toggle activation */}
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:14 }}>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>Nettoyage automatique</p>
                <p style={{ fontSize:12, color:"var(--text-muted)", marginTop:2 }}>
                  {store.autoCleanup ? "Actif  les transactions des mois passs sont supprimes automatiquement" : "Inactif  aucune suppression automatique"}
                </p>
              </div>
              <Toggle checked={store.autoCleanup} onChange={()=>store.updateAutoCleanup(!store.autoCleanup)} />
            </div>

            {/* Slecteur de jour (gris si dsactiv) */}
            <div style={{ opacity: store.autoCleanup ? 1 : 0.4, pointerEvents: store.autoCleanup ? "auto" : "none", transition:"opacity 0.2s" }}>
              <div style={{ display:"flex", alignItems:"center", gap:12, marginBottom:12 }}>
                <div style={{ flex:1 }}>
                  <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:6 }}>Jour de nettoyage</p>
                  <select value={store.cleanupDay} onChange={e=>store.updateCleanupDay(parseInt(e.target.value,10))}
                    style={{ fontSize:15, fontWeight:500, width:"100%", padding:"10px 12px", background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", color:"var(--text)" }}>
                    {Array.from({length:31},(_,i)=>i+1).map(d=>(
                      <option key={d} value={d} style={{ background:"var(--select-bg)" }}>{d===1?"1er":d} du mois</option>
                    ))}
                  </select>
                </div>
                <div style={{ padding:"12px 16px", background:"var(--gold-dim)", border:"1px solid var(--gold)", borderRadius:"var(--radius-sm)", textAlign:"center" }}>
                  <p style={{ fontSize:10, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:2 }}>Actuel</p>
                  <p style={{ fontSize:24, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--gold)" }}>{store.cleanupDay}</p>
                </div>
              </div>
              {(store.cleanupDay === 29 || store.cleanupDay === 30) && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginBottom:12 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le nettoyage automatique pourrait ne pas fonctionner en fvrier, qui ne compte pas de jour {store.cleanupDay}.
                  </p>
                </div>
              )}
              {store.cleanupDay === 31 && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginBottom:12 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le nettoyage automatique pourrait ne pas fonctionner certains mois  avril, juin, septembre, novembre et fvrier ne comptent pas de 31e jour.
                  </p>
                </div>
              )}
            </div>

            <button onClick={handleCleanupClick} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:13, fontWeight:600 }}>
               Nettoyer les mois prcdents maintenant
            </button>
          </div>
        </Section>

        {/* Snapshots pargne */}
        <Section title="Snapshots pargne" icon="">
          <div style={{ padding:"14px 16px" }}>
            {/* Toggle activation */}
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:16 }}>
              <div>
                <p style={{ fontSize:14, fontWeight:500 }}>Snapshots automatiques</p>
                <p style={{ fontSize:12, color:"var(--text-muted)", marginTop:2 }}>
                  {store.savingsSnapActive ? "Actifs  l'pargne est enregistre automatiquement" : "Inactifs  aucun snapshot automatique"}
                </p>
              </div>
              <Toggle checked={store.savingsSnapActive} onChange={()=>store.setSavingsSnapActive(!store.savingsSnapActive)} />
            </div>

            {/* Slecteur des jours */}
            <div style={{ opacity: store.savingsSnapActive ? 1 : 0.4, pointerEvents: store.savingsSnapActive ? "auto" : "none", transition:"opacity 0.2s" }}>
              <p style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:10 }}>
                Jours de snapshot  {store.savingsSnapDays.length} slectionn{store.savingsSnapDays.length > 1 ? "s" : ""}
              </p>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(7, 1fr)", gap:5 }}>
                {Array.from({length:31}, (_,i) => i+1).map(day => {
                  const selected = store.savingsSnapDays.includes(day);
                  const toggle   = () => {
                    if (selected) {
                      store.setSavingsSnapDays(store.savingsSnapDays.filter(d => d !== day));
                    } else {
                      store.setSavingsSnapDays([...store.savingsSnapDays, day].sort((a,b)=>a-b));
                    }
                  };
                  return (
                    <button key={day} onClick={toggle}
                      style={{ padding:"7px 2px", borderRadius:7, border:"1px solid", fontSize:12, fontWeight:600, textAlign:"center",
                        borderColor: selected ? "var(--gold)" : "var(--border)",
                        background:  selected ? "var(--gold-dim)" : "var(--bg)",
                        color:       selected ? "var(--gold)" : "var(--text-muted)",
                        transition:  "all 0.15s" }}>
                      {day}
                    </button>
                  );
                })}
              </div>
              {store.savingsSnapDays.some(d => d === 29 || d === 30) && !store.savingsSnapDays.includes(31) && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginTop:10 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le snapshot automatique du {store.savingsSnapDays.filter(d => d === 29 || d === 30).join(" et du ")} pourrait ne pas se dclencher en fvrier.
                  </p>
                </div>
              )}
              {store.savingsSnapDays.includes(31) && (
                <div style={{ display:"flex", gap:8, padding:"9px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8, marginTop:10 }}>
                  <span style={{ fontSize:13, flexShrink:0 }}></span>
                  <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                    Le snapshot automatique du 31 pourrait ne pas se dclencher certains mois  avril, juin, septembre, novembre et fvrier ne comptent pas de 31e jour.
                    {store.savingsSnapDays.some(d => d === 29 || d === 30) && ` Les jours ${store.savingsSnapDays.filter(d => d === 29 || d === 30).join(" et ")} pourraient galement ne pas se dclencher en fvrier.`}
                  </p>
                </div>
              )}
            </div>
          </div>
        </Section>

        {/* Donnes */}
        <Section title="Donnes" icon="">
          <div style={{ padding:"14px 16px" }}>
            <p style={{ fontSize:13, color:"var(--text-muted)", marginBottom:4 }}>{store.transactions.length} transactions  synchronises sur Firebase</p>
            <p style={{ fontSize:12, color:"var(--text-sub)", marginBottom:12 }}>Connect en tant que {user.email}</p>
            {store.isDemo && (
              <button onClick={handleDemoReset} disabled={resetting}
                style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"rgba(201,168,76,0.1)", border:"1px solid var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600, marginBottom:10, opacity: resetting ? 0.6 : 1 }}>
                {resetting ? " Rinitialisation" : " Rinitialiser les donnes dmo"}
              </button>
            )}
            <button onClick={handleLogout} style={{ width:"100%", padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:13, fontWeight:600 }}>
               Se dconnecter
            </button>
          </div>
        </Section>
      </div>

      {showAdd && <TplAddModal onClose={()=>setShowAdd(false)} onSave={item=>{store.addTplItem(activeAccountId, activeParity, item);setShowAdd(false);}} />}
      {editingTplItem && <TplAddModal item={editingTplItem.item} onClose={()=>setEditingTplItem(null)} onSave={updates=>{store.updateTplItem(activeAccountId, editingTplItem.parity, editingTplItem.item.id, updates);setEditingTplItem(null);}} />}

      {showCleanupConfirm && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setShowCleanupConfirm(false)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Confirmation</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>{cleanupMessage.text}</p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setShowCleanupConfirm(false)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              {cleanupMessage.canDelete && <button onClick={confirmCleanup} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

//  Small components 
function Section({ title, icon, children }) {
  return (
    <div>
      <div style={{ display:"flex", alignItems:"center", gap:6, marginBottom:8 }}>
        <span style={{ fontSize:14 }}>{icon}</span>
        <p style={{ fontSize:12, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em" }}>{title}</p>
      </div>
      <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden" }}>{children}</div>
    </div>
  );
}

function Toggle({ checked, onChange }) {
  return (
    <button onClick={onChange} style={{ width:48,height:26, borderRadius:13, background:checked?"var(--gold)":"var(--surface3)", border:"none", position:"relative", transition:"background 0.25s", flexShrink:0 }}>
      <div style={{ width:20,height:20, borderRadius:"50%", background:"#fff", position:"absolute", top:3, left:checked?25:3, transition:"left 0.25s", boxShadow:"0 1px 4px rgba(0,0,0,0.3)" }} />
    </button>
  );
}

//  AccountRow 
function AccountRow({ acc, store, editingAccounts }) {
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
  const sameType  = store.accounts.filter(a => a.type === acc.type);
  const idx       = sameType.findIndex(a => a.id === acc.id);
  const isFirst   = idx === 0;
  const isLast    = idx === sameType.length - 1;
  const canDelete = store.accounts.length > 1;
  const txCount   = store.transactions.filter(t => t.accountId === acc.id).length;

  const handleDeleteClick = () => {
    if (!canDelete) return;
    if (txCount > 0) { setShowDeleteConfirm(true); }
    else { store.removeAccount(acc.id); }
  };

  return (
    <div style={{ background:"var(--surface2)", borderRadius:"var(--radius-sm)", padding:"12px 14px" }}>
      {!editingAccounts ? (
        <div style={{ display:"flex", alignItems:"center", gap:10 }}>
          <span style={{ fontSize:20 }}>{acc.type==="savings"?"":""}</span>
          <div style={{ flex:1 }}>
            <p style={{ fontSize:14, fontWeight:500 }}>{acc.name}</p>
            <p style={{ fontSize:11, color:"var(--text-muted)" }}>
              {acc.type==="savings"
                ? (acc.savingsSubtype==="blocked" ? " Bloque  " : " Disponible  ") + fmtEur(acc.balance)
                : "Compte courant"}
            </p>
          </div>
        </div>
      ) : (
        <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
          {/* Nom + boutons ordre + supprimer */}
          <div style={{ display:"flex", gap:6 }}>
            <input value={acc.name} onChange={e=>store.updateAccount(acc.id,{name:e.target.value})} placeholder="Nom du compte"
              style={{ flex:1, fontSize:14, padding:"8px 10px", background:"var(--bg)", border:"1px solid var(--border)", borderRadius:8, color:"var(--text)" }} />
            {/* Boutons dplacement (uniquement si plusieurs comptes du mme type) */}
            {sameType.length > 1 && (
              <div style={{ display:"flex", flexDirection:"column", gap:3 }}>
                <button onClick={()=>store.moveAccount(acc.id,-1)} disabled={isFirst}
                  style={{ padding:"3px 8px", borderRadius:6, background:"var(--surface3)", border:"1px solid var(--border)", color:isFirst?"var(--text-sub)":"var(--text)", fontSize:12, opacity:isFirst?0.3:1, lineHeight:1 }}></button>
                <button onClick={()=>store.moveAccount(acc.id,1)} disabled={isLast}
                  style={{ padding:"3px 8px", borderRadius:6, background:"var(--surface3)", border:"1px solid var(--border)", color:isLast?"var(--text-sub)":"var(--text)", fontSize:12, opacity:isLast?0.3:1, lineHeight:1 }}></button>
              </div>
            )}
            <button onClick={handleDeleteClick} disabled={!canDelete}
              style={{ padding:"8px 12px", borderRadius:8, background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:13, fontWeight:600, opacity:canDelete?1:0.4, alignSelf:"stretch" }}></button>
          </div>
          {/* Type courant / pargne */}
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6 }}>
            {[["checking"," Courant"],["savings"," pargne"]].map(([type,label])=>(
              <button key={type} onClick={()=>store.updateAccount(acc.id,{type})}
                style={{ padding:"8px", borderRadius:8, border:"1px solid", borderColor:acc.type===type?"var(--gold)":"var(--border)", background:acc.type===type?"var(--gold-dim)":"var(--bg)", color:acc.type===type?"var(--gold)":"var(--text-muted)", fontSize:12, fontWeight:600 }}>{label}</button>
            ))}
          </div>
          {/* Sous-type pargne (disponible / bloque) */}
          {acc.type==="savings" && (
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6 }}>
              <button onClick={()=>store.updateAccount(acc.id,{savingsSubtype:"available"})}
                style={{ padding:"8px", borderRadius:8, border:"1px solid", borderColor:(acc.savingsSubtype||"available")==="available"?"var(--green)":"var(--border)", background:(acc.savingsSubtype||"available")==="available"?"var(--green-dim)":"var(--bg)", color:(acc.savingsSubtype||"available")==="available"?"var(--green)":"var(--text-muted)", fontSize:12, fontWeight:600 }}> Disponible</button>
              <button onClick={()=>store.updateAccount(acc.id,{savingsSubtype:"blocked"})}
                style={{ padding:"8px", borderRadius:8, border:"1px solid", borderColor:acc.savingsSubtype==="blocked"?"var(--red)":"var(--border)", background:acc.savingsSubtype==="blocked"?"var(--red-dim)":"var(--bg)", color:acc.savingsSubtype==="blocked"?"var(--red)":"var(--text-muted)", fontSize:12, fontWeight:600 }}> Bloque</button>
            </div>
          )}
          {/* Carte  dbit diffr (comptes courants uniquement) */}
          {acc.type==="checking" && (
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.06em", display:"block", marginBottom:4 }}> Carte  dbit diffr</label>
              <div style={{ display:"flex", gap:6, alignItems:"center" }}>
                <input
                  value={acc.cardName||""}
                  onChange={e=>store.updateAccount(acc.id,{cardName:e.target.value})}
                  placeholder="Nom de la carte (ex: Visa SG)  laisser vide si aucune"
                  style={{ flex:1, fontSize:13, padding:"8px 10px", background:"var(--bg)", border:"1px solid var(--border)", borderRadius:8, color:"var(--text)" }}
                />
                {acc.cardName && (
                  <button onClick={()=>store.updateAccount(acc.id,{cardName:""})}
                    style={{ padding:"7px 10px", borderRadius:8, background:"var(--red-dim)", border:"1px solid var(--red)", color:"var(--red)", fontSize:12, fontWeight:600, whiteSpace:"nowrap" }}>
                     Retirer
                  </button>
                )}
              </div>
              {acc.cardName && <p style={{ fontSize:11, color:"var(--text-sub)", marginTop:4 }}>Les dpenses carte apparatront dans un panneau ddi sur le tableau de bord.</p>}
            </div>
          )}
          {/* Solde (pargne uniquement) */}
          {acc.type==="savings" && (
            <div>
              <label style={{ fontSize:11, fontWeight:600, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.06em", display:"block", marginBottom:4 }}>Solde</label>
              <input type="number" step="0.01" value={acc.balance||0} onChange={e=>store.updateAccount(acc.id,{balance:parseFloat(e.target.value)||0})} placeholder="0.00"
                style={{ width:"100%", fontSize:14, padding:"8px 10px", background:"var(--bg)", border:"1px solid var(--border)", borderRadius:8, color:"var(--text)" }} />
            </div>
          )}
        </div>
      )}

      {showDeleteConfirm && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setShowDeleteConfirm(false)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Supprimer le compte</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
              Le compte  {acc.name}  contient <strong style={{ color:"var(--red)" }}>{txCount} transaction{txCount>1?"s":""}</strong> qui {txCount>1?"seront galement supprimes":"sera galement supprime"}.
            </p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setShowDeleteConfirm(false)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              <button onClick={()=>{store.removeAccount(acc.id);setShowDeleteConfirm(false);}} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function TplItemRow({ item, onDelete, onEdit }) {
  const [hover, setHover] = useState(false);
  return (
    <div onMouseEnter={()=>setHover(true)} onMouseLeave={()=>setHover(false)}
      style={{ display:"flex", alignItems:"center", gap:12, padding:"11px 16px", background:hover?"rgba(128,128,128,0.04)":"transparent", transition:"background 0.15s" }}>
      <div style={{ width:36,height:36, borderRadius:9, flexShrink:0, background:item.type==="expense"?"var(--red-dim)":"var(--green-dim)", display:"flex", alignItems:"center", justifyContent:"center", fontSize:16 }}>{item.type==="expense"?"":""}</div>
      <div style={{ flex:1, minWidth:0 }}>
        <p style={{ fontSize:14, fontWeight:500, overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap" }}>{item.title}</p>
        <p style={{ fontSize:11, color:"var(--text-sub)" }}>
          Le {item.day||1}{(item.day||1)===1?"er":""} du mois
          {item.note ? `  ${item.note}` : ""}
        </p>
      </div>
      <p style={{ fontSize:14, fontWeight:700, flexShrink:0, color:item.type==="expense"?"var(--red)":"var(--green)" }}>{item.type==="expense"?"":"+"}{fmtEur(item.amount)}</p>
      {hover && <button onClick={onEdit} style={{ background:"var(--gold-dim)", border:"none", borderRadius:7, width:26,height:26, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--gold)", fontSize:13, flexShrink:0 }}></button>}
      {hover && <button onClick={onDelete} style={{ background:"var(--red-dim)", border:"none", borderRadius:7, width:26,height:26, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--red)", fontSize:13, flexShrink:0 }}></button>}
    </div>
  );
}

function EmptyState({ text }) {
  return <div style={{ textAlign:"center", padding:"40px 20px", color:"var(--text-muted)", fontSize:14 }}><p style={{ fontSize:32, marginBottom:10 }}></p>{text}</div>;
}

function Field({ label, children }) {
  return (
    <div style={{ background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius-sm)", padding:"10px 14px" }}>
      <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:5 }}>{label}</p>
      {children}
    </div>
  );
}

//  TplAddModal 
function TplAddModal({ onClose, onSave, item }) {
  const isEditing = !!item;
  const [type,setType]=useState(item?.type||"expense");
  const [title,setTitle]=useState(item?.title||"");
  const [amount,setAmount]=useState(item?.amount?.toString()||"");
  const [day,setDay]=useState(String(item?.day||"1"));
  const [note,setNote]=useState(item?.note||"");
  const [error,setError]=useState("");
  const handleSave=()=>{
    if(!title.trim()) return setError("Veuillez saisir un libell.");
    const amt=parseFloat(amount.replace(",","."));
    if(isNaN(amt)||amt<=0) return setError("Montant invalide.");
    onSave({title:title.trim(),amount:amt,type,day:parseInt(day,10),note});
  };
  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
      onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", overflow:"hidden" }}>
        <div style={{ background:"var(--surface2)", padding:"16px 20px", borderBottom:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
          <p style={{ fontSize:17, fontWeight:600 }}>{isEditing ? "Modifier l'opration" : "Opration rcurrente"}</p>
          <button onClick={onClose} style={{ background:"transparent", border:"none", color:"var(--text-muted)", fontSize:18 }}></button>
        </div>
        <div style={{ padding:"16px 20px", display:"flex", flexDirection:"column", gap:12 }}>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6, background:"var(--surface2)", borderRadius:"var(--radius-sm)", padding:4 }}>
            {[["expense","Dpense","var(--red)"],["income","Revenu","var(--green)"]].map(([v,l,c])=>(
              <button key={v} onClick={()=>setType(v)} style={{ padding:"9px", borderRadius:8, background:type===v?c+"22":"transparent", border:`1px solid ${type===v?c:"transparent"}`, color:type===v?c:"var(--text-muted)", fontSize:14, fontWeight:600 }}>{l}</button>
            ))}
          </div>
          <Field label="Montant">
            <input value={amount} onChange={e=>setAmount(e.target.value)} placeholder="0,00" inputMode="decimal"
              style={{ fontSize:22, fontFamily:"'DM Serif Display',serif", width:"100%", color:type==="expense"?"var(--red)":"var(--green)" }} />
          </Field>
          <Field label="Libell">
            <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Ex: Loyer, Salaire" style={{ fontSize:15, width:"100%" }} />
          </Field>
          <Field label="Jour du mois">
            <select value={day} onChange={e=>setDay(e.target.value)} style={{ fontSize:15, width:"100%", background:"var(--select-bg)", color:"var(--text)" }}>
              {Array.from({length:28},(_,i)=>i+1).map(d=>(
                <option key={d} value={d} style={{ background:"var(--select-bg)" }}>{d===1?"1er":d} du mois</option>
              ))}
            </select>
          </Field>
          <Field label="Note (optionnelle)">
            <textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Commentaire" rows={2} style={{ fontSize:14, width:"100%", resize:"none", lineHeight:1.5 }} />
          </Field>
          {error && <p style={{ color:"var(--red)", fontSize:13 }}>{error}</p>}
          <button onClick={handleSave} style={{ padding:"13px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:15, fontWeight:700 }}>{isEditing ? "Enregistrer" : "Ajouter"}</button>
        </div>
      </div>
    </div>
  );
}

//  FormModal 
function FormModal({ store, account, transaction, onClose, isCardTransaction=false }) {
  const isEditing = !!transaction;
  // Determine if this is/was a card transaction
  const startAsCard = isCardTransaction || (transaction?.isCard === true);

  const [type,     setType]     = useState(transaction?.type||"expense");
  const [title,    setTitle]    = useState(transaction?.title||"");
  const [amount,   setAmount]   = useState(transaction?.amount?.toString()||"");
  const [selAcctId,setSelAcctId]= useState(transaction?.accountId||account||store.accounts.find(a=>a.type==="checking")?.id||"");
  const [date,     setDate]     = useState(transaction?.date||new Date().toISOString().split("T")[0]);
  const [note,     setNote]     = useState(transaction?.note||"");
  const [asCard,   setAsCard]   = useState(startAsCard);
  const [error,    setError]    = useState("");

  // Check if the selected account has a card
  const selAcct = store.accounts.find(a=>a.id===selAcctId);
  const acctHasCard = selAcct?.type==="checking" && selAcct?.cardName;

  // If account changes and new account has no card, reset asCard
  useEffect(() => {
    if (!acctHasCard) setAsCard(false);
  }, [selAcctId, acctHasCard]);

  const handleSubmit = () => {
    if (!title.trim()) return setError("Veuillez saisir un libell.");
    const amt = parseFloat(amount.replace(",","."));
    if (isNaN(amt)||amt<=0) return setError("Montant invalide.");
    if (!selAcctId) return setError("Veuillez slectionner un compte.");
    const txData = { title:title.trim(), amount:amt, type, accountId:selAcctId, date, note, isCard: acctHasCard ? asCard : false };
    if (isEditing) store.update(transaction.id, txData);
    else store.add(txData);
    onClose();
  };

  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"flex-end" }}
      onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:480, margin:"0 auto", background:"var(--surface)", borderRadius:"24px 24px 0 0", border:"1px solid var(--border)", borderBottom:"none", padding:"0 0 32px", maxHeight:"90vh", overflowY:"auto" }}>
        <div style={{ display:"flex", justifyContent:"center", padding:"12px 0 0" }}>
          <div style={{ width:36,height:4, borderRadius:2, background:"var(--border)" }} />
        </div>
        <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"14px 20px 16px" }}>
          <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:22 }}>{isEditing?"Modifier":"Nouvelle transaction"}</p>
          <button onClick={onClose} style={{ background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:8, width:32,height:32, color:"var(--text-muted)", fontSize:16, display:"flex", alignItems:"center", justifyContent:"center" }}></button>
        </div>
        <div style={{ padding:"0 20px", display:"flex", flexDirection:"column", gap:14 }}>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6, background:"var(--surface2)", borderRadius:"var(--radius-sm)", padding:4 }}>
            {[["expense","Dpense","var(--red)"],["income","Revenu","var(--green)"]].map(([v,l,c])=>(
              <button key={v} onClick={()=>setType(v)} style={{ padding:"9px", borderRadius:8, background:type===v?c+"22":"transparent", border:`1px solid ${type===v?c:"transparent"}`, color:type===v?c:"var(--text-muted)", fontSize:14, fontWeight:600 }}>{l}</button>
            ))}
          </div>
          <div style={{ background:"var(--surface2)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:"14px 16px" }}>
            <p style={{ fontSize:11, color:"var(--text-sub)", fontWeight:600, letterSpacing:"0.07em", textTransform:"uppercase", marginBottom:6 }}>Montant</p>
            <div style={{ display:"flex", alignItems:"baseline", gap:6 }}>
              <span style={{ fontSize:24, color:"var(--text-muted)", fontFamily:"'DM Serif Display',serif" }}></span>
              <input value={amount} onChange={e=>setAmount(e.target.value)} placeholder="0,00" inputMode="decimal"
                style={{ fontSize:34, fontFamily:"'DM Serif Display',serif", flex:1, color:type==="expense"?"var(--red)":"var(--green)" }} />
            </div>
          </div>
          <Field label="Libell"><input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Ex : Courses, Salaire" style={{ fontSize:15, width:"100%", padding:"0 2px" }} /></Field>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
            <Field label="Compte">
              <select value={selAcctId} onChange={e=>setSelAcctId(e.target.value)} style={{ fontSize:14, width:"100%", background:"var(--select-bg)", color:"var(--text)" }}>
                {store.accounts.filter(a=>a.type==="checking").map(a=><option key={a.id} value={a.id} style={{ background:"var(--select-bg)" }}> {a.name}</option>)}
              </select>
            </Field>
            <Field label="Date"><input type="date" value={date} onChange={e=>setDate(e.target.value)} style={{ fontSize:14, width:"100%", colorScheme:"var(--colorscheme)" }} /></Field>
          </div>

          {/* Card toggle  only shown if account has a card */}
          {acctHasCard && (
            <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", padding:"12px 14px", background:asCard?"rgba(201,168,76,0.06)":"var(--surface2)", border:`1px solid ${asCard?"rgba(201,168,76,0.3)":"var(--border)"}`, borderRadius:"var(--radius-sm)", transition:"all 0.2s" }}>
              <div style={{ display:"flex", alignItems:"center", gap:10 }}>
                <span style={{ fontSize:18 }}></span>
                <div>
                  <p style={{ fontSize:13, fontWeight:600, color:asCard?"var(--gold)":"var(--text)" }}>Imputer sur la carte</p>
                  <p style={{ fontSize:11, color:"var(--text-muted)" }}>{selAcct.cardName}  dbit diffr</p>
                </div>
              </div>
              <Toggle checked={asCard} onChange={()=>setAsCard(!asCard)} />
            </div>
          )}

          <Field label="Note (optionnelle)"><textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Commentaire" rows={2} style={{ fontSize:14, width:"100%", resize:"none", lineHeight:1.5 }} /></Field>
          {error && <p style={{ color:"var(--red)", fontSize:13 }}>{error}</p>}
          <button onClick={handleSubmit} style={{ padding:"14px", borderRadius:"var(--radius)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:16, fontWeight:700, boxShadow:"0 4px 20px rgba(201,168,76,0.35)", marginTop:4 }}>Enregistrer</button>
        </div>
      </div>
    </div>
  );
}

//  SavingsStats 
function fmtSnapshotDate(dateStr) {
  const d = new Date(dateStr + "T00:00:00");
  const day = d.getDate();
  return `${day===1?"1er":day} ${d.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}`;
}

function Variation({ value }) {
  if (value === null || value === undefined) return <span style={{ color:"var(--text-sub)", fontSize:12 }}></span>;
  const pos = value >= 0;
  return (
    <span style={{ fontSize:12, fontWeight:700, color: pos ? "var(--green)" : "var(--red)" }}>
      {pos ? "+" : ""}{fmtEur(value)}
    </span>
  );
}

function SavingsSnapshotModal({ snapshot, defaults, onClose, onSave }) {
  const isNew = !snapshot?.id;
  const [date,        setDate]        = useState(snapshot?.date        || new Date().toISOString().split("T")[0]);
  const [available,   setAvailable]   = useState(snapshot?.available?.toString() || defaults?.available?.toString() || "");
  const [blocked,     setBlocked]     = useState(snapshot?.blocked?.toString()   || defaults?.blocked?.toString()   || "");
  const [note,        setNote]        = useState(snapshot?.note        || "");
  const [error,       setError]       = useState("");

  const handleSave = () => {
    const avail = parseFloat(available.replace(",","."));
    const bloc  = parseFloat(blocked.replace(",","."));
    if (isNaN(avail) || avail < 0) return setError("pargne disponible invalide.");
    if (isNaN(bloc)  || bloc  < 0) return setError("pargne bloque invalide.");
    if (!date) return setError("Date requise.");
    onSave({ date, available: avail, blocked: bloc, note, auto: false });
  };

  return (
    <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.75)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
      onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="scale-in" style={{ width:"100%", maxWidth:420, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", overflow:"hidden" }}>
        <div style={{ background:"var(--surface2)", padding:"16px 20px", borderBottom:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
          <p style={{ fontSize:17, fontWeight:600 }}>{isNew ? "Nouvelle entre" : "Modifier l'entre"}</p>
          <button onClick={onClose} style={{ background:"transparent", border:"none", color:"var(--text-muted)", fontSize:18 }}></button>
        </div>
        <div style={{ padding:"16px 20px", display:"flex", flexDirection:"column", gap:12 }}>
          <Field label="Date">
            <input type="date" value={date} onChange={e=>setDate(e.target.value)} style={{ fontSize:14, width:"100%", colorScheme:"var(--colorscheme)", color:"var(--text)" }} />
          </Field>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
            <Field label="pargne disponible ()">
              <input type="number" step="0.01" value={available} onChange={e=>setAvailable(e.target.value)} placeholder="0.00" inputMode="decimal"
                style={{ fontSize:15, width:"100%", color:"var(--green)" }} />
            </Field>
            <Field label="pargne bloque ()">
              <input type="number" step="0.01" value={blocked} onChange={e=>setBlocked(e.target.value)} placeholder="0.00" inputMode="decimal"
                style={{ fontSize:15, width:"100%", color:"var(--red)" }} />
            </Field>
          </div>
          <Field label="Note (optionnelle)">
            <input value={note} onChange={e=>setNote(e.target.value)} placeholder="Ex: rebalancement, intrts" style={{ fontSize:14, width:"100%" }} />
          </Field>
          {!isNew && (
            <div style={{ display:"flex", gap:8, padding:"10px 12px", background:"rgba(201,168,76,0.08)", border:"1px solid rgba(201,168,76,0.25)", borderRadius:8 }}>
              <span style={{ fontSize:14, flexShrink:0 }}></span>
              <p style={{ fontSize:12, color:"var(--text-muted)", lineHeight:1.5 }}>
                Cette modification ne porte que sur ce snapshot historique. Les soldes actuels de vos comptes pargne ne seront pas affects.
              </p>
            </div>
          )}
          {error && <p style={{ color:"var(--red)", fontSize:13 }}>{error}</p>}
          <button onClick={handleSave} style={{ padding:"13px", borderRadius:"var(--radius-sm)", background:"linear-gradient(135deg,var(--gold-light),var(--gold))", border:"none", color:"#0e0f13", fontSize:15, fontWeight:700 }}>
            {isNew ? "Ajouter" : "Enregistrer"}
          </button>
        </div>
      </div>
    </div>
  );
}

function MiniSparkline({ data, color, width=80, height=32 }) {
  if (!data || data.length < 2) return null;
  const min = Math.min(...data);
  const max = Math.max(...data);
  const range = max - min || 1;
  const pts = data.map((v, i) => {
    const x = (i / (data.length - 1)) * width;
    const y = height - ((v - min) / range) * (height - 4) - 2;
    return `${x},${y}`;
  }).join(" ");
  return (
    <svg width={width} height={height} style={{ display:"block" }}>
      <polyline points={pts} fill="none" stroke={color} strokeWidth="2" strokeLinejoin="round" strokeLinecap="round" />
    </svg>
  );
}

//  SavingsChart 
function SavingsChart({ rows }) {
  const [tooltip, setTooltip] = useState(null);
  const W = 440, H = 180, PAD = { top:16, right:16, bottom:36, left:56 };
  const innerW = W - PAD.left - PAD.right;
  const innerH = H - PAD.top  - PAD.bottom;

  // rows are newest-first  reverse for chart (left=oldest, right=newest)
  const sorted = [...rows].reverse();

  const allVals = sorted.flatMap(r => [r.available||0, r.blocked||0, (r.available||0)+(r.blocked||0)]);
  const minV = 0;
  const maxV = Math.max(...allVals, 1);

  const xOf = i => PAD.left + (i / Math.max(sorted.length - 1, 1)) * innerW;
  const yOf = v => PAD.top  + innerH - ((v - minV) / (maxV - minV)) * innerH;

  const makePath = (vals) => vals.map((v, i) => `${i===0?"M":"L"}${xOf(i).toFixed(1)},${yOf(v).toFixed(1)}`).join(" ");
  const makeArea = (vals) => {
    const top  = vals.map((v, i) => `${i===0?"M":"L"}${xOf(i).toFixed(1)},${yOf(v).toFixed(1)}`).join(" ");
    const base = `L${xOf(vals.length-1).toFixed(1)},${(PAD.top+innerH).toFixed(1)} L${PAD.left.toFixed(1)},${(PAD.top+innerH).toFixed(1)} Z`;
    return top + " " + base;
  };

  const availVals = sorted.map(r => r.available||0);
  const blocVals  = sorted.map(r => r.blocked||0);
  const totVals   = sorted.map(r => (r.available||0)+(r.blocked||0));

  // Y-axis ticks (4 ticks)
  const yTicks = [0,1,2,3].map(i => minV + (maxV - minV) * i / 3);

  // X-axis labels: show up to 5 evenly spaced dates
  const xLabelIdxs = sorted.length <= 5
    ? sorted.map((_,i)=>i)
    : [0,1,2,3,4].map(i => Math.round(i * (sorted.length-1)/4));

  const handleMouseMove = (e) => {
    const svg = e.currentTarget;
    const rect = svg.getBoundingClientRect();
    const mx = (e.clientX - rect.left) * (W / rect.width);
    if (mx < PAD.left || mx > W - PAD.right) { setTooltip(null); return; }
    const ratio = (mx - PAD.left) / innerW;
    const idx   = Math.round(ratio * (sorted.length - 1));
    const row   = sorted[Math.max(0, Math.min(idx, sorted.length-1))];
    const cx    = xOf(Math.max(0, Math.min(idx, sorted.length-1)));
    setTooltip({ row, cx, idx });
  };

  return (
    <div style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", padding:"14px 0 0", marginBottom:16, overflow:"hidden" }}>
      <p style={{ fontSize:11, fontWeight:700, color:"var(--text-sub)", textTransform:"uppercase", letterSpacing:"0.08em", padding:"0 16px", marginBottom:8 }}>volution de l'pargne</p>
      <div style={{ overflowX:"auto" }}>
        <svg width={W} height={H} viewBox={`0 0 ${W} ${H}`} style={{ display:"block", minWidth:300, width:"100%" }}
          onMouseMove={handleMouseMove} onMouseLeave={()=>setTooltip(null)}>
          <defs>
            <linearGradient id="gradAvail" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor="#4caf82" stopOpacity="0.25"/>
              <stop offset="100%" stopColor="#4caf82" stopOpacity="0.02"/>
            </linearGradient>
            <linearGradient id="gradBloc" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor="#e05c5c" stopOpacity="0.18"/>
              <stop offset="100%" stopColor="#e05c5c" stopOpacity="0.02"/>
            </linearGradient>
            <linearGradient id="gradTot" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stopColor="#c9a84c" stopOpacity="0.15"/>
              <stop offset="100%" stopColor="#c9a84c" stopOpacity="0.02"/>
            </linearGradient>
          </defs>

          {/* Grid lines */}
          {yTicks.map((v,i) => (
            <g key={i}>
              <line x1={PAD.left} x2={W-PAD.right} y1={yOf(v)} y2={yOf(v)} stroke="rgba(255,255,255,0.05)" strokeWidth="1"/>
              <text x={PAD.left-6} y={yOf(v)+4} textAnchor="end" fontSize="9" fill="rgba(240,236,228,0.35)" fontFamily="DM Sans,sans-serif">
                {v>=1000?`${(v/1000).toFixed(v%1000===0?0:1)}k`:Math.round(v)}
              </text>
            </g>
          ))}

          {/* Area fills */}
          <path d={makeArea(totVals)}   fill="url(#gradTot)"   />
          <path d={makeArea(availVals)} fill="url(#gradAvail)" />
          <path d={makeArea(blocVals)}  fill="url(#gradBloc)"  />

          {/* Lines */}
          <path d={makePath(totVals)}   fill="none" stroke="#c9a84c" strokeWidth="1.5" strokeDasharray="5 3" strokeLinejoin="round" strokeLinecap="round"/>
          <path d={makePath(availVals)} fill="none" stroke="#4caf82" strokeWidth="2"   strokeLinejoin="round" strokeLinecap="round"/>
          <path d={makePath(blocVals)}  fill="none" stroke="#e05c5c" strokeWidth="2"   strokeLinejoin="round" strokeLinecap="round"/>

          {/* X axis labels */}
          {xLabelIdxs.map(i => {
            const r = sorted[i];
            if (!r) return null;
            const d = new Date(r.date+"T00:00:00");
            const label = `${d.getDate()}/${d.getMonth()+1}/${String(d.getFullYear()).slice(2)}`;
            return (
              <text key={i} x={xOf(i)} y={H-6} textAnchor="middle" fontSize="9" fill="rgba(240,236,228,0.4)" fontFamily="DM Sans,sans-serif">{label}</text>
            );
          })}

          {/* Tooltip crosshair */}
          {tooltip && (
            <g>
              <line x1={tooltip.cx} x2={tooltip.cx} y1={PAD.top} y2={PAD.top+innerH} stroke="rgba(255,255,255,0.15)" strokeWidth="1" strokeDasharray="3 3"/>
              <circle cx={tooltip.cx} cy={yOf(availVals[tooltip.idx])} r="4" fill="#4caf82" stroke="var(--surface)" strokeWidth="1.5"/>
              <circle cx={tooltip.cx} cy={yOf(blocVals[tooltip.idx])}  r="4" fill="#e05c5c" stroke="var(--surface)" strokeWidth="1.5"/>
              <circle cx={tooltip.cx} cy={yOf(totVals[tooltip.idx])}   r="3" fill="#c9a84c" stroke="var(--surface)" strokeWidth="1.5"/>
            </g>
          )}
        </svg>
      </div>

      {/* Tooltip info box */}
      {tooltip ? (
        <div style={{ padding:"10px 16px 12px", borderTop:"1px solid var(--border)", display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:8 }}>
          <div>
            <p style={{ fontSize:9, color:"var(--text-sub)", fontWeight:700, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:3 }}>Disponible</p>
            <p style={{ fontSize:14, fontWeight:700, color:"#4caf82", fontFamily:"'DM Serif Display',serif" }}>{fmtEur(tooltip.row.available||0)}</p>
          </div>
          <div>
            <p style={{ fontSize:9, color:"var(--text-sub)", fontWeight:700, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:3 }}>Bloque</p>
            <p style={{ fontSize:14, fontWeight:700, color:"#e05c5c", fontFamily:"'DM Serif Display',serif" }}>{fmtEur(tooltip.row.blocked||0)}</p>
          </div>
          <div>
            <p style={{ fontSize:9, color:"var(--text-sub)", fontWeight:700, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:3 }}>Total</p>
            <p style={{ fontSize:14, fontWeight:700, color:"#c9a84c", fontFamily:"'DM Serif Display',serif" }}>{fmtEur((tooltip.row.available||0)+(tooltip.row.blocked||0))}</p>
          </div>
        </div>
      ) : (
        <div style={{ padding:"8px 16px 10px", borderTop:"1px solid var(--border)" }}>
          <p style={{ fontSize:11, color:"var(--text-sub)", textAlign:"center" }}>Survolez le graphique pour voir les dtails</p>
        </div>
      )}
    </div>
  );
}

function SavingsStats({ store, onBack }) {
  const [showModal,    setShowModal]    = useState(false);
  const [editSnapshot, setEditSnapshot] = useState(null);
  const [deleteSnap,   setDeleteSnap]   = useState(null);

  const history = store.savingsHistory; // sorted desc by date

  // Compute variations
  const rows = useMemo(() => {
    const sorted = [...history].sort((a,b) => b.date.localeCompare(a.date)); // newest first
    return sorted.map((entry, i) => {
      const prev = sorted[i + 1]; // older entry
      return {
        ...entry,
        varAvailable: prev != null ? entry.available - prev.available : null,
        varBlocked:   prev != null ? entry.blocked   - prev.blocked   : null,
        total: (entry.available || 0) + (entry.blocked || 0),
      };
    });
  }, [history]);

  const totalAvailable = store.accounts.filter(a=>a.type==="savings"&&a.savingsSubtype!=="blocked").reduce((s,a)=>s+(a.balance||0),0);
  const totalBlocked   = store.accounts.filter(a=>a.type==="savings"&&a.savingsSubtype==="blocked").reduce((s,a)=>s+(a.balance||0),0);
  const totalSavings   = totalAvailable + totalBlocked;

  // Sparkline data (oldestnewest)
  const sparkAvail   = [...rows].reverse().map(r=>r.available||0);
  const sparkBlocked = [...rows].reverse().map(r=>r.blocked||0);

  const handleSaveNew = (entry) => {
    store.addSavingsSnapshot(entry);
    setShowModal(false);
  };
  const handleSaveEdit = (entry) => {
    store.updateSavingsSnapshot(editSnapshot.id, entry);
    setEditSnapshot(null);
  };

  return (
    <div style={{ minHeight:"100vh", background:"var(--bg)" }}>
      {/* Header */}
      <div style={{ background:"var(--header-bg)", padding:"16px 20px", borderBottom:"1px solid var(--border)" }}>
        <div style={{ display:"flex", alignItems:"center", gap:12 }}>
          <button onClick={onBack} style={{ background:"var(--header-btn-bg)", border:"1px solid var(--header-btn-border)", borderRadius:8, padding:"6px 12px", color:"var(--header-muted)", fontSize:13, fontWeight:500 }}> Retour</button>
          <p style={{ fontFamily:"'DM Serif Display',serif", fontSize:26, letterSpacing:"-0.02em", color:"var(--header-text)" }}>Statistiques pargne</p>
        </div>
      </div>

      {/* Content */}
      <div style={{ padding:"16px" }}>
        {/* Summary cards */}
        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:8, marginBottom:16 }}>
          {[
            { label:"Total pargne", value:totalSavings, color:"var(--gold)", spark: sparkAvail.map((a,i)=>a+(sparkBlocked[i]||0)) },
            { label:"Disponible",    value:totalAvailable, color:"var(--green)", spark: sparkAvail },
            { label:"Bloque",       value:totalBlocked,   color:"var(--red)",   spark: sparkBlocked },
          ].map(c=>(
            <div key={c.label} style={{ background:"var(--surface)", borderRadius:10, padding:"10px 12px", border:"1px solid var(--border)" }}>
              <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:4 }}>{c.label}</p>
              <p style={{ fontSize:16, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:c.color, marginBottom:4 }}>{fmtEur(c.value)}</p>
              <MiniSparkline data={c.spark} color={c.color} />
            </div>
          ))}
        </div>
        {/* Add button */}
        <button onClick={()=>setShowModal(true)} style={{ width:"100%", padding:"11px", borderRadius:"var(--radius-sm)", background:"var(--gold-dim)", border:"1px dashed var(--gold)", color:"var(--gold)", fontSize:13, fontWeight:600, marginBottom:16 }}>
          + Ajouter une entre manuellement
        </button>

        {/* Chart */}
        {rows.length >= 2 && (
          <SavingsChart rows={rows} />
        )}

        {/* Legend */}
        <div style={{ display:"flex", gap:12, marginBottom:12, flexWrap:"wrap" }}>
          <span style={{ fontSize:11, color:"var(--green)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ width:10,height:10,borderRadius:2,background:"var(--green)",display:"inline-block" }}/>Disponible</span>
          <span style={{ fontSize:11, color:"var(--red)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ width:10,height:10,borderRadius:2,background:"var(--red)",display:"inline-block" }}/>Bloque</span>
          <span style={{ fontSize:11, color:"var(--gold)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ width:10,height:10,borderRadius:2,background:"var(--gold)",display:"inline-block" }}/>Total</span>
          <span style={{ fontSize:11, color:"var(--text-sub)", fontWeight:600, display:"flex", alignItems:"center", gap:4 }}><span style={{ fontSize:10 }}></span>Auto</span>
        </div>

        {/* Table / Cards */}
        {rows.length === 0 ? (
          <div style={{ textAlign:"center", padding:"60px 20px", color:"var(--text-muted)" }}>
            <p style={{ fontSize:36, marginBottom:12 }}></p>
            <p style={{ fontSize:15, fontWeight:500, marginBottom:6 }}>Aucune entre pour l'instant</p>
            <p style={{ fontSize:13 }}>Les entres sont cres automatiquement le 1er et le 15 de chaque mois, ou vous pouvez en ajouter manuellement.</p>
          </div>
        ) : (
          <div style={{ display:"flex", flexDirection:"column", gap:10 }}>
            {rows.map((row, i) => (
              <div key={row.id} className="fade-up" style={{ background:"var(--surface)", border:"1px solid var(--border)", borderRadius:"var(--radius)", overflow:"hidden", animationDelay:`${i*0.03}s` }}>
                {/* Date + actions header */}
                <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 14px", background:"var(--surface2)", borderBottom:"1px solid var(--border)" }}>
                  <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                    <span style={{ fontFamily:"'DM Serif Display',serif", fontSize:15, fontWeight:600, color:"var(--gold)" }}>{fmtSnapshotDate(row.date)}</span>
                    {row.auto && <span style={{ fontSize:10, padding:"2px 6px", borderRadius:4, background:"var(--gold-dim)", color:"var(--gold)", fontWeight:600 }}> Auto</span>}
                    {row.note && <span style={{ fontSize:11, color:"var(--text-muted)", fontStyle:"italic" }}>{row.note}</span>}
                  </div>
                  <div style={{ display:"flex", gap:6 }}>
                    <button onClick={()=>setEditSnapshot(row)} style={{ background:"var(--gold-dim)", border:"none", borderRadius:6, width:24,height:24, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--gold)", fontSize:12 }}></button>
                    <button onClick={()=>setDeleteSnap(row)} style={{ background:"var(--red-dim)", border:"none", borderRadius:6, width:24,height:24, display:"flex", alignItems:"center", justifyContent:"center", color:"var(--red)", fontSize:12 }}></button>
                  </div>
                </div>

                {/* 2-column data */}
                <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:0 }}>
                  {/* Available */}
                  <div style={{ padding:"12px 14px", borderRight:"1px solid var(--border)" }}>
                    <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:4 }}>Disponible</p>
                    <p style={{ fontSize:18, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--green)", marginBottom:4 }}>{fmtEur(row.available||0)}</p>
                    <Variation value={row.varAvailable} />
                  </div>
                  {/* Blocked */}
                  <div style={{ padding:"12px 14px" }}>
                    <p style={{ fontSize:10, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em", marginBottom:4 }}>Bloque</p>
                    <p style={{ fontSize:18, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--red)", marginBottom:4 }}>{fmtEur(row.blocked||0)}</p>
                    <Variation value={row.varBlocked} />
                  </div>
                </div>

                {/* Total */}
                <div style={{ padding:"8px 14px", borderTop:"1px solid var(--border)", display:"flex", justifyContent:"space-between", alignItems:"center", background:"rgba(0,0,0,0.02)" }}>
                  <span style={{ fontSize:11, color:"var(--text-sub)", fontWeight:600, textTransform:"uppercase", letterSpacing:"0.06em" }}>Total pargne</span>
                  <span style={{ fontSize:15, fontWeight:700, fontFamily:"'DM Serif Display',serif", color:"var(--gold)" }}>{fmtEur(row.total)}</span>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* Modals */}
      {showModal    && <SavingsSnapshotModal defaults={{ available: totalAvailable, blocked: totalBlocked }} onClose={()=>setShowModal(false)}    onSave={handleSaveNew} />}
      {editSnapshot && <SavingsSnapshotModal snapshot={editSnapshot} onClose={()=>setEditSnapshot(null)} onSave={handleSaveEdit} />}
      {deleteSnap   && (
        <div style={{ position:"fixed", inset:0, zIndex:200, background:"rgba(0,0,0,0.7)", backdropFilter:"blur(6px)", display:"flex", alignItems:"center", justifyContent:"center", padding:20 }}
          onClick={e=>e.target===e.currentTarget&&setDeleteSnap(null)}>
          <div className="scale-in" style={{ width:"100%", maxWidth:400, background:"var(--surface)", borderRadius:"var(--radius)", border:"1px solid var(--border)", padding:24 }}>
            <p style={{ fontSize:18, fontWeight:600, marginBottom:12 }}>Supprimer cette entre</p>
            <p style={{ fontSize:14, color:"var(--text-muted)", marginBottom:20, lineHeight:1.6 }}>
              Supprimer l'entre du <strong>{fmtSnapshotDate(deleteSnap.date)}</strong> ? Cette action est irrversible.
            </p>
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={()=>setDeleteSnap(null)} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--surface2)", border:"1px solid var(--border)", color:"var(--text)", fontSize:14, fontWeight:600 }}>Annuler</button>
              <button onClick={()=>{store.removeSavingsSnapshot(deleteSnap.id);setDeleteSnap(null);}} style={{ flex:1, padding:"10px", borderRadius:"var(--radius-sm)", background:"var(--red)", border:"none", color:"#fff", fontSize:14, fontWeight:600 }}>Supprimer</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

//  Mount 
// Wait for Firebase to initialize before mounting React
function waitForFb(cb) {
  if (window._fb) cb();
  else setTimeout(()=>waitForFb(cb), 50);
}
waitForFb(()=>{
  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
});
</script>
</body>
</html>
